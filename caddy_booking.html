<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>MyCaddy Pro — Elite Golf Management</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&display=swap');

:root {
  --bg: #f8fafc;
  --card: #ffffff;
  --ink: #111827;
  --muted: #6b7280;
  --accent: #007AFF;
  --accent-2: #5AC8FA;
  --ok: #34C759;
  --warn: #FF9500;
  --bad: #FF3B30;
  --ring: rgba(0, 122, 255, 0.25);
  --border: #e5e7eb;
  --chip: #eef2ff;
  --chip-ink: #1e40af;
  --shadow-glass: 0 8px 32px rgba(31, 38, 135, 0.15);
  --blur: blur(20px);
  --glass-bg: rgba(255, 255, 255, 0.8);
  --glass-border: rgba(255, 255, 255, 0.2);
}

* { box-sizing: border-box; }

html, body {
  height: 100%;
  margin: 0;
  font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(135deg, #f0f4f8 0%, #d6e7f0 100%);
  color: var(--ink);
}

.topbar {
  height: 64px;
  background: var(--glass-bg);
  backdrop-filter: var(--blur);
  border-bottom: 1px solid var(--glass-border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 24px;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: 0 1px 20px rgba(0, 0, 0, 0.08);
}

.brand {
  display: flex;
  align-items: center;
  gap: 12px;
  font-weight: 700;
  font-size: 1.25rem;
  color: var(--accent);
}

.logo {
  width: 36px;
  height: 36px;
  border-radius: 10px;
  background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 800;
  font-size: 0.9rem;
  box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
}

.language-selector {
  display: flex;
  background: rgba(0, 122, 255, 0.1);
  border-radius: 12px;
  padding: 4px;
  border: 1px solid rgba(0, 122, 255, 0.2);
}

.lang-btn {
  padding: 8px 16px;
  background: transparent;
  color: var(--muted);
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.9rem;
  font-weight: 600;
  transition: all 0.2s ease;
}

.lang-btn.active {
  background: var(--accent);
  color: white;
  box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
}

.nav {
  display: flex;
  gap: 8px;
  background: rgba(0, 0, 0, 0.05);
  border-radius: 16px;
  padding: 6px;
}

.nav button {
  background: transparent;
  border: 0;
  color: var(--muted);
  padding: 12px 20px;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.95rem;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.nav button.active {
  background: var(--accent);
  color: white;
  box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
  transform: translateY(-1px);
}

.container {
  max-width: 1200px;
  margin: 16px auto;
  padding: 0 16px;
}

.shell {
  max-width: 100%;
  margin: 0;
}

.card {
  background: var(--glass-bg);
  backdrop-filter: var(--blur);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
  box-shadow: var(--shadow-glass);
  padding: 16px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 40px rgba(0, 122, 255, 0.15);
  border-color: rgba(0, 122, 255, 0.3);
}

.btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 12px 20px;
  border-radius: 14px;
  border: none;
  background: var(--accent);
  color: white;
  font-weight: 600;
  font-size: 0.95rem;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  text-decoration: none;
  box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 122, 255, 0.4);
}

.btn.secondary {
  background: rgba(0, 0, 0, 0.06);
  color: var(--ink);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.btn.ghost {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--ink);
  box-shadow: none;
}

.btn.small { padding: 8px 16px; font-size: 0.85rem; }

.grid {
  display: grid;
  grid-template-columns: 1fr 360px;
  gap: 16px;
  margin-top: 16px;
}

.list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.tee {
  padding: 16px;
  border: 2px solid transparent;
  border-radius: 14px;
  background: var(--glass-bg);
  backdrop-filter: var(--blur);
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.tee:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(0, 122, 255, 0.2);
  border-color: var(--accent);
}

.tee.active {
  border-color: var(--ok);
  background: rgba(52, 199, 89, 0.1);
  box-shadow: 0 8px 30px rgba(52, 199, 89, 0.2);
}

.row {
  display: flex;
  gap: 12px;
  align-items: center;
  justify-content: space-between;
}

.chips {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  margin-top: 8px;
}

.chip {
  background: var(--chip);
  color: var(--chip-ink);
  padding: 4px 10px;
  border-radius: 16px;
  font-size: 0.75rem;
  font-weight: 600;
  border: 1px solid rgba(30, 64, 175, 0.2);
}

.pill {
  background: rgba(0, 122, 255, 0.1);
  color: var(--accent);
  padding: 3px 8px;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 600;
  border: 1px solid rgba(0, 122, 255, 0.2);
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 16px;
  background: var(--glass-bg);
  border-radius: 12px;
  overflow: hidden;
  backdrop-filter: var(--blur);
}

th, td {
  padding: 12px 8px;
  border-bottom: 1px solid var(--border);
  text-align: left;
}

th {
  font-size: 0.8rem;
  text-transform: uppercase;
  color: var(--muted);
  letter-spacing: 0.05em;
  font-weight: 600;
  background: rgba(0, 0, 0, 0.02);
}

.status { font-weight: 700; }
.ok { color: var(--ok); }
.bad { color: var(--bad); }
.warn { color: var(--warn); }

.backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(8px);
  opacity: 0;
  pointer-events: none;
  transition: all 0.3s ease;
  z-index: 200;
}

.backdrop.show {
  opacity: 1;
  pointer-events: auto;
}

.drawer {
  position: fixed;
  right: 0;
  top: 0;
  height: 100%;
  width: 500px;
  max-width: 85vw;
  background: var(--glass-bg);
  backdrop-filter: var(--blur);
  border-left: 1px solid var(--glass-border);
  box-shadow: -8px 0 40px rgba(0, 0, 0, 0.2);
  transform: translateX(100%);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 300;
}

.drawer.show { transform: none; }

.drawer header {
  padding: 24px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(255, 255, 255, 0.8);
}

.drawer .body {
  padding: 16px;
  overflow: auto;
  height: calc(100% - 85px);
}

.field {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
  align-items: center;
}

.field input, .field select {
  flex: 1;
  padding: 10px 12px;
  border: 2px solid var(--border);
  border-radius: 10px;
  background: var(--glass-bg);
  font-size: 0.9rem;
  transition: all 0.2s ease;
}

.field input:focus, .field select:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--ring);
}

.caddy {
  border: 2px solid var(--border);
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 12px;
  display: flex;
  gap: 12px;
  align-items: center;
  justify-content: space-between;
  background: var(--glass-bg);
  backdrop-filter: var(--blur);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.caddy:hover {
  transform: translateY(-2px);
  border-color: var(--accent);
  box-shadow: 0 8px 30px rgba(0, 122, 255, 0.15);
}

.caddy.busy {
  background: rgba(255, 59, 48, 0.05);
  border-color: rgba(255, 59, 48, 0.3);
}

.caddy .meta {
  font-size: 0.9rem;
  color: var(--muted);
  margin-top: 4px;
}

.tag {
  font-size: 0.75rem;
  border-radius: 12px;
  padding: 4px 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.02em;
}

.tag.ok {
  background: rgba(52, 199, 89, 0.15);
  color: var(--ok);
  border: 1px solid rgba(52, 199, 89, 0.3);
}

.tag.busy {
  background: rgba(255, 59, 48, 0.15);
  color: var(--bad);
  border: 1px solid rgba(255, 59, 48, 0.3);
}

.actions {
  display: flex;
  gap: 12px;
  align-items: center;
}

.note {
  background: rgba(0, 122, 255, 0.05);
  border: 1px solid rgba(0, 122, 255, 0.2);
  border-radius: 12px;
  padding: 16px;
  margin-top: 16px;
  font-size: 0.9rem;
  color: var(--accent);
  line-height: 1.6;
}

.right { display: flex; justify-content: flex-end; }
.srch-btn { min-width: 120px; }
.muted { color: var(--muted); font-size: 0.9rem; }

h1 {
  font-size: 2rem;
  margin: 0 0 8px;
  font-weight: 700;
  color: var(--ink);
}

h2 {
  font-size: 1.5rem;
  margin: 0 0 16px;
  font-weight: 600;
  color: var(--ink);
}

h3 {
  font-size: 1.25rem;
  margin: 0;
  font-weight: 600;
  color: var(--ink);
}

@media (max-width: 1024px) { .grid { grid-template-columns: 1fr; } }
@media (max-width: 768px) {
  .topbar { padding: 0 16px; height: 60px; }
  .brand { font-size: 1.1rem; }
  .nav { gap: 4px; padding: 4px; }
  .nav button { padding: 10px 16px; font-size: 0.9rem; }
  .container { padding: 0 16px; }
  .card { padding: 20px; }
  .drawer { width: 100vw; }
}
</style>
</head>
<body>

<div class="topbar">
  <div class="brand">
    <div class="logo">MC</div>
    <span id="brandText">MyCaddy Pro — Elite Golf</span>
  </div>
  <div class="language-selector">
    <button class="lang-btn active" data-lang="en">EN</button>
    <button class="lang-btn" data-lang="th">TH</button>
    <button class="lang-btn" data-lang="ko">KO</button>
    <button class="lang-btn" data-lang="ja">JA</button>
  </div>
  <div class="nav">
    <button data-page="page-schedule" class="active" id="scheduleTab">Schedule</button>
    <button data-page="page-events" id="eventsTab">Events</button>
    <button data-page="page-golffood" id="golfFoodTab">GolfFood</button>
  </div>
</div>

<div class="container">
  <section id="page-schedule">
    <div class="shell">
      <div class="grid">
        <section class="card">
          <div class="row" style="margin-bottom: 16px">
            <div style="font-weight: 700; font-size: 1.1rem;" id="bookingsHeader">Your Tee Time Bookings</div>
          </div>
          <div class="list" id="teeList"></div>
        </section>
        
        <section class="card">
          <div class="row">
            <div>
              <div id="detailTitle" style="font-weight: 700; font-size: 1.1rem;">Booking Details</div>
              <div class="muted" id="detailMeta">Select a booking to view details</div>
            </div>
            <div class="right">
              <button class="btn small" id="openDrawerBtn">Book Caddy</button>
            </div>
          </div>
          <div class="note" id="detailNote" style="display: none;"></div>
          <table id="playerTable" style="margin-top: 16px; display: none;">
            <thead>
              <tr>
                <th id="playerHeader">Player</th>
                <th id="bookedHeader">Assigned Caddy</th>
                <th id="waitlistHeader">Waitlist</th>
                <th id="actionsHeader">Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>
      </div>
    </div>
  </section>

  <section id="page-events" style="display: none;">
    <div class="shell">
      <h1 id="eventsTitle">Golf Events & Tournaments</h1>
      <div class="muted">Discover and join golf events in your area</div>

      <div class="card" style="margin-top: 24px; text-align: center; padding: 60px;">
        <h3 style="color: var(--muted);">Events Module</h3>
        <p style="color: var(--muted); margin-top: 12px;">
          Enhanced events management coming soon with tournament booking integration.
        </p>
      </div>
    </div>
  </section>

  <section id="page-golffood" style="display: none;">
    <div class="shell">
      <div class="grid">
        <!-- Menu Section -->
        <div class="card">
          <div class="row" style="margin-bottom: 16px;">
            <div>
              <h1 id="golfFoodTitle" style="font-size: 1.5rem; margin: 0;">GolfFood Menu</h1>
              <div class="muted" id="golfFoodSubtitle">Order food and beverages directly to your location on the course</div>
            </div>
            <div class="right">
              <div style="background: var(--chip); color: var(--chip-ink); padding: 4px 10px; border-radius: 12px; font-size: 0.8rem; font-weight: 600;">
                Hole <span id="currentHole">7</span>
              </div>
            </div>
          </div>

          <!-- Search -->
          <div style="position: relative; margin-bottom: 16px;">
            <input
              type="text"
              id="menuSearch"
              data-i18n-placeholder="searchPlaceholder"
              placeholder="Search menu items..."
              style="width: 100%; padding: 10px 12px; border: 2px solid var(--border); border-radius: 10px; background: var(--glass-bg); font-size: 0.9rem;"
            />
          </div>

          <!-- Categories -->
          <div class="chips" style="margin-bottom: 16px;" id="categoryChips">
            <button class="chip active" data-category="">All Items</button>
            <button class="chip" data-category="drinks">🥤 Beverages</button>
            <button class="chip" data-category="food">🍽️ Food</button>
            <button class="chip" data-category="snacks">🍿 Snacks</button>
          </div>

          <!-- Menu Items -->
          <div id="menuItems" style="max-height: 600px; overflow-y: auto;"></div>
        </div>

        <!-- Cart Section -->
        <div class="card">
          <div class="row" style="margin-bottom: 16px;">
            <h3 id="cartTitle">Your Order</h3>
            <div id="cartCount" class="pill" style="display: none;">0</div>
          </div>

          <!-- Current Location -->
          <div class="note" style="margin-bottom: 16px; background: var(--chip); border-color: var(--accent); color: var(--chip-ink);">
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 8px; height: 8px; background: var(--accent); border-radius: 50%;"></div>
              <span style="font-weight: 600;" id="currentLocationText">Currently at Hole 7</span>
            </div>
          </div>

          <!-- Delivery Options -->
          <div style="background: rgba(0, 0, 0, 0.05); border-radius: 12px; padding: 4px; margin-bottom: 16px; display: flex; gap: 4px;">
            <button class="btn secondary small" id="deliveryBtn" data-option="delivery" style="flex: 1; background: var(--accent); color: white;">🚗 Deliver</button>
            <button class="btn ghost small" id="pickupBtn" data-option="pickup" style="flex: 1;">🏪 Pickup</button>
          </div>

          <!-- Delivery Hole Selection -->
          <div id="deliveryOptions" style="margin-bottom: 16px;">
            <div style="font-weight: 600; margin-bottom: 8px; font-size: 0.9rem; display: flex; align-items: center; gap: 6px;">
              🤖 AI-Optimized Delivery:
            </div>
            <select id="deliveryHole" style="width: 100%; padding: 8px 12px; border: 2px solid var(--border); border-radius: 8px; background: var(--glass-bg);">
              <option value="8">Hole 8 (next)</option>
              <option value="9">Hole 9</option>
              <option value="10">Hole 10</option>
              <option value="11">Hole 11</option>
              <option value="12">Hole 12</option>
            </select>
            <div id="aiSuggestion" class="note" style="margin-top: 8px; display: none; background: rgba(138, 43, 226, 0.1); border-color: rgba(138, 43, 226, 0.3); color: #8a2be2;">
              <span id="aiText"></span>
            </div>
          </div>

          <!-- Cart Items -->
          <div id="cartItems" style="max-height: 450px; overflow-y: auto; margin-bottom: 16px;"></div>

          <!-- Order Summary -->
          <div id="orderSummary" style="display: none;">
            <div style="border-top: 1px solid var(--border); padding-top: 16px; margin-top: 16px;">
              <div class="row" style="margin-bottom: 8px;">
                <span class="muted">Subtotal</span>
                <span id="subtotal">฿0</span>
              </div>
              <div class="row" style="margin-bottom: 8px;">
                <span class="muted">Delivery Fee</span>
                <span id="deliveryFee">฿30</span>
              </div>
              <div class="row" style="font-weight: 700; font-size: 1.1rem;">
                <span>Total</span>
                <span id="orderTotal">฿0</span>
              </div>
            </div>
            <button class="btn" id="placeOrderBtn" style="width: 100%; margin-top: 16px;">🛒 Place Order</button>
          </div>

          <!-- Empty Cart Message -->
          <div id="emptyCart" class="note" style="text-align: center; color: var(--muted);">
            <div style="font-size: 2rem; margin-bottom: 8px;">🛒</div>
            <div style="font-weight: 600;">Your cart is empty</div>
            <div style="font-size: 0.9rem; margin-top: 4px;">Add items from the menu to get started</div>
          </div>

          <!-- Active Orders in Right Panel -->
          <div id="activeOrdersSection" style="display: none; margin-top: 24px; border-top: 1px solid var(--border); padding-top: 16px;">
            <h3 style="margin-bottom: 16px; font-size: 1rem;">🚚 Active Orders (<span id="activeOrderCount">0</span>)</h3>
            <div id="activeOrders" style="max-height: 400px; overflow-y: auto;"></div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<div class="backdrop" id="backdrop"></div>
<aside class="drawer" id="drawer">
  <header>
    <div>
      <div style="font-weight: 800; font-size: 1.2rem;" id="drawerTitle">Book Premium Caddy</div>
      <div class="muted" id="drawerSubtitle">—</div>
    </div>
    <button class="btn ghost small" id="closeDrawer">Close</button>
  </header>
  <div class="body">
    <div class="field">
      <input id="caddySearch" type="number" placeholder="Enter caddy # to find quickly" style="flex: 2;"/>
      <button class="btn small srch-btn" id="findCaddy">Find Caddy</button>
    </div>
    <div id="caddyList"></div>
    <div class="note">
      <span id="bookingTip">Tip: You're selecting for</span> <span class="pill" id="forPlayer">—</span>. 
      <span id="waitlistTip">Join waitlists for preferred caddies while keeping backup assignments. We'll auto-swap when your preferred caddy becomes available.</span>
    </div>
  </div>
</aside>

<script>
(function() {
  'use strict';
  
  // Avoid global variable conflicts by using IIFE
  const query = (s, root = document) => root.querySelector(s);
  const queryAll = (s, root = document) => Array.from(root.querySelectorAll(s));

  // Multi-language translations
  const translations = {
    en: {
      brandText: "MyCaddy Pro — Elite Golf",
      scheduleTab: "Schedule",
      eventsTab: "Events",
      golfFoodTab: "GolfFood",
      scheduleTitle: "Your Golf Schedule",
      scheduleSubtitle: "Upcoming rounds & caddy bookings with real-time synchronization",
      bookingsHeader: "Your Tee Time Bookings",
      detailTitle: "Booking Details",
      detailMeta: "Select a booking to view details",
      bookCaddy: "Book Caddy",
      playerHeader: "Player",
      bookedHeader: "Assigned Caddy",
      waitlistHeader: "Waitlist",
      actionsHeader: "Actions",
      drawerTitle: "Book Premium Caddy",
      changeAdd: "Change / Add",
      removeCaddy: "Remove Caddy", 
      clearWaitlist: "Clear Waitlist",
      bookNow: "Book Now",
      joinWaitlist: "Join Waitlist",
      available: "AVAILABLE",
      booked: "BOOKED",
      rating: "Rating",
      golfFoodTitle: "GolfFood Delivery",
      golfFoodSubtitle: "Order food and beverages directly to your location on the course",
      menuTitle: "Course Menu",
      menuSubtitle: "Fresh meals and beverages delivered to your tee",
      thaiCuisine: "🍜 Thai Cuisine",
      thaiDesc: "Authentic Pad Thai, Green Curry, Tom Yum",
      internationalFood: "🍔 International",
      intlDesc: "Burgers, Sandwiches, Salads, Steaks",
      beverages: "🥤 Beverages & Snacks",
      beverageDesc: "Cold drinks, Energy bars, Fresh fruit",
      orderNowBtn: "🛒 Order Now",
      deliveryTitle: "Delivery Information",
      deliveryTimeTitle: "⏱️ Delivery Time",
      deliveryTimeText: "15-25 minutes to any location on the course",
      gpsTrackingTitle: "📍 GPS Tracking",
      gpsTrackingText: "Live tracking of your order with precise course location",
      paymentTitle: "💳 Payment",
      paymentText: "Mobile payment or charge to your course account",
      locationHeader: "Course Location",
      estimatedTimeHeader: "Est. Time",
      teeBox1: "Tee Box 1-9",
      teeBox10: "Tee Box 10-18",
      clubhouse: "Clubhouse",
      practiceRange: "Practice Range",
      searchPlaceholder: "Search menu items...",
      currentLocationText: "Currently at Hole",
      deliverBtn: "🚗 Deliver",
      pickupBtn: "🏪 Pickup",
      deliverTo: "Deliver to:",
      subtotal: "Subtotal",
      deliveryFee: "Delivery Fee",
      total: "Total",
      placeOrder: "🛒 Place Order",
      emptyCartTitle: "Your cart is empty",
      emptyCartText: "Add items from the menu to get started",
      activeOrdersTitle: "Active Orders",
      allItems: "All Items",
      popular: "Popular",
      quantity: "Quantity",
      each: "each",
      orderPlaced: "Order placed successfully! ETA:",
      minutes: "minutes"
    },
    th: {
      brandText: "มายแคดดี้ โปร — กอล์ฟระดับสูง",
      scheduleTab: "ตารางเวลา",
      eventsTab: "กิจกรรม",
      golfFoodTab: "กอล์ฟฟู้ด",
      scheduleTitle: "ตารางกอล์ฟของคุณ",
      scheduleSubtitle: "รอบการเล่นที่กำลังจะมาถึงและการจองแคดดี้พร้อมการซิงค์แบบเรียลไทม์",
      bookingsHeader: "การจองทีไทม์ของคุณ",
      detailTitle: "รายละเอียดการจอง",
      detailMeta: "เลือกการจองเพื่อดูรายละเอียด",
      bookCaddy: "จองแคดดี้",
      playerHeader: "ผู้เล่น",
      bookedHeader: "แคดดี้ที่มอบหมาย",
      waitlistHeader: "รายการรอ",
      actionsHeader: "การดำเนินการ",
      drawerTitle: "จองแคดดี้พรีเมียม",
      changeAdd: "เปลี่ยน / เพิ่ม",
      removeCaddy: "ลบแคดดี้",
      clearWaitlist: "ล้างรายการรอ",
      bookNow: "จองตอนนี้",
      joinWaitlist: "เข้าร่วมรายการรอ",
      available: "ว่าง",
      booked: "จองแล้ว",
      rating: "คะแนน",
      golfFoodTitle: "บริการส่งกอล์ฟฟู้ด",
      golfFoodSubtitle: "สั่งอาหารและเครื่องดื่มส่งตรงถึงตำแหน่งของคุณในสนาม",
      menuTitle: "เมนูสนาม",
      menuSubtitle: "อาหารและเครื่องดื่มสดส่งถึงทีของคุณ",
      thaiCuisine: "🍜 อาหารไทย",
      thaiDesc: "ผัดไทยแท้, แกงเขียวหวาน, ต้มยำ",
      internationalFood: "🍔 อาหารนานาชาติ",
      intlDesc: "เบอร์เกอร์, แซนด์วิช, สลัด, สเต็ก",
      beverages: "🥤 เครื่องดื่ม & ขนม",
      beverageDesc: "เครื่องดื่มเย็น, เอนเนอร์จี่บาร์, ผลไม้สด",
      orderNowBtn: "🛒 สั่งเลย",
      deliveryTitle: "ข้อมูลการส่ง",
      deliveryTimeTitle: "⏱️ เวลาส่ง",
      deliveryTimeText: "15-25 นาทีไปยังจุดใดก็ได้ในสนาม",
      gpsTrackingTitle: "📍 ติดตาม GPS",
      gpsTrackingText: "ติดตามออเดอร์แบบเรียลไทม์พร้อมตำแหน่งสนามที่แม่นยำ",
      paymentTitle: "💳 การชำระเงิน",
      paymentText: "ชำระเงินผ่านมือถือหรือเรียกเก็บในบัญชีสนาม",
      locationHeader: "ตำแหน่งสนาม",
      estimatedTimeHeader: "เวลาโดยประมาณ",
      teeBox1: "ทีบ็อกซ์ 1-9",
      teeBox10: "ทีบ็อกซ์ 10-18",
      clubhouse: "คลับเฮาส์",
      practiceRange: "สนามฝึก",
      searchPlaceholder: "ค้นหาเมนูอาหาร...",
      currentLocationText: "ปัจจุบันอยู่ที่หลุม",
      deliverBtn: "🚗 ส่งมาส่ง",
      pickupBtn: "🏪 รับเอง",
      deliverTo: "ส่งไปที่:",
      subtotal: "ยอดรวม",
      deliveryFee: "ค่าส่ง",
      total: "รวมทั้งหมด",
      placeOrder: "🛒 สั่งเลย",
      emptyCartTitle: "รถเข็นว่าง",
      emptyCartText: "เพิ่มสินค้าจากเมนูเพื่อเริ่มต้น",
      activeOrdersTitle: "ออเดอร์ที่สั่งแล้ว",
      allItems: "สินค้าทั้งหมด",
      popular: "ยอดนิยม",
      quantity: "จำนวน",
      each: "ต่อชิ้น",
      orderPlaced: "สั่งออเดอร์สำเร็จ! เวลาที่คาดการณ์:",
      minutes: "นาที"
    },
    ko: {
      brandText: "마이캐디 프로 — 엘리트 골프",
      scheduleTab: "일정",
      eventsTab: "이벤트",
      golfFoodTab: "골프푸드",
      scheduleTitle: "귀하의 골프 일정",
      scheduleSubtitle: "다가오는 라운드 및 캐디 예약과 실시간 동기화",
      bookingsHeader: "귀하의 티타임 예약",
      detailTitle: "예약 세부사항",
      detailMeta: "세부사항을 보려면 예약을 선택하세요",
      bookCaddy: "캐디 예약",
      playerHeader: "플레이어",
      bookedHeader: "배정된 캐디",
      waitlistHeader: "대기 목록",
      actionsHeader: "작업",
      drawerTitle: "프리미엄 캐디 예약",
      changeAdd: "변경 / 추가",
      removeCaddy: "캐디 제거",
      clearWaitlist: "대기 목록 지우기",
      bookNow: "지금 예약",
      joinWaitlist: "대기 목록 가입",
      available: "이용 가능",
      booked: "예약됨",
      rating: "평점",
      golfFoodTitle: "골프푸드 배달",
      golfFoodSubtitle: "코스 내 원하는 위치로 음식과 음료를 직접 주문하세요",
      menuTitle: "코스 메뉴",
      menuSubtitle: "티박스로 배달되는 신선한 식사와 음료",
      thaiCuisine: "🍜 태국 요리",
      thaiDesc: "정통 팟타이, 그린 커리, 톰얌",
      internationalFood: "🍔 국제 요리",
      intlDesc: "버거, 샌드위치, 샐러드, 스테이크",
      beverages: "🥤 음료 & 스낵",
      beverageDesc: "차가운 음료, 에너지바, 신선한 과일",
      orderNowBtn: "🛒 지금 주문",
      deliveryTitle: "배달 정보",
      deliveryTimeTitle: "⏱️ 배달 시간",
      deliveryTimeText: "코스 내 어느 위치든 15-25분",
      gpsTrackingTitle: "📍 GPS 추적",
      gpsTrackingText: "정확한 코스 위치로 주문 실시간 추적",
      paymentTitle: "💳 결제",
      paymentText: "모바일 결제 또는 코스 계정 청구",
      locationHeader: "코스 위치",
      estimatedTimeHeader: "예상 시간",
      teeBox1: "티박스 1-9",
      teeBox10: "티박스 10-18",
      clubhouse: "클럽하우스",
      practiceRange: "연습장",
      searchPlaceholder: "메뉴 아이템 검색...",
      currentLocationText: "현재 홀",
      deliverBtn: "🚗 배달",
      pickupBtn: "🏪 픽업",
      deliverTo: "배달 위치:",
      subtotal: "소계",
      deliveryFee: "배달비",
      total: "합계",
      placeOrder: "🛒 주문하기",
      emptyCartTitle: "장바구니가 비어있습니다",
      emptyCartText: "메뉴에서 아이템을 추가하여 시작하세요",
      activeOrdersTitle: "활성 주문",
      allItems: "전체 아이템",
      popular: "인기",
      quantity: "수량",
      each: "개당",
      orderPlaced: "주문이 성공적으로 완료되었습니다! 예상 시간:",
      minutes: "분"
    },
    ja: {
      brandText: "マイキャディプロ — エリートゴルフ",
      scheduleTab: "スケジュール",
      eventsTab: "イベント",
      golfFoodTab: "ゴルフフード",
      scheduleTitle: "あなたのゴルフスケジュール",
      scheduleSubtitle: "今後のラウンドとキャディ予約のリアルタイム同期",
      bookingsHeader: "あなたのティータイム予約",
      detailTitle: "予約詳細",
      detailMeta: "詳細を表示するには予約を選択してください",
      bookCaddy: "キャディ予約",
      playerHeader: "プレイヤー",
      bookedHeader: "割り当てキャディ",
      waitlistHeader: "待ちリスト",
      actionsHeader: "アクション",
      drawerTitle: "プレミアムキャディ予約",
      changeAdd: "変更 / 追加",
      removeCaddy: "キャディ削除",
      clearWaitlist: "待ちリストクリア",
      bookNow: "今すぐ予約",
      joinWaitlist: "待ちリスト参加",
      available: "利用可能",
      booked: "予約済み",
      rating: "評価",
      golfFoodTitle: "ゴルフフード配達",
      golfFoodSubtitle: "コース内のお好きな場所に食事と飲み物を直接注文",
      menuTitle: "コースメニュー",
      menuSubtitle: "ティーボックスまで配達される新鮮な食事と飲み物",
      thaiCuisine: "🍜 タイ料理",
      thaiDesc: "本格パッタイ、グリーンカレー、トムヤム",
      internationalFood: "🍔 国際料理",
      intlDesc: "ハンバーガー、サンドイッチ、サラダ、ステーキ",
      beverages: "🥤 飲み物 & スナック",
      beverageDesc: "冷たい飲み物、エナジーバー、フレッシュフルーツ",
      orderNowBtn: "🛒 今すぐ注文",
      deliveryTitle: "配達情報",
      deliveryTimeTitle: "⏱️ 配達時間",
      deliveryTimeText: "コース内どこでも15-25分",
      gpsTrackingTitle: "📍 GPS追跡",
      gpsTrackingText: "正確なコース位置での注文のライブ追跡",
      paymentTitle: "💳 支払い",
      paymentText: "モバイル決済またはコースアカウントへの請求",
      locationHeader: "コース位置",
      estimatedTimeHeader: "予想時間",
      teeBox1: "ティーボックス 1-9",
      teeBox10: "ティーボックス 10-18",
      clubhouse: "クラブハウス",
      practiceRange: "練習場",
      searchPlaceholder: "メニューアイテムを検索...",
      currentLocationText: "現在のホール",
      deliverBtn: "🚗 配達",
      pickupBtn: "🏪 ピックアップ",
      deliverTo: "配達先:",
      subtotal: "小計",
      deliveryFee: "配達料",
      total: "合計",
      placeOrder: "🛒 注文する",
      emptyCartTitle: "カートは空です",
      emptyCartText: "メニューからアイテムを追加して始めましょう",
      activeOrdersTitle: "アクティブな注文",
      allItems: "全アイテム",
      popular: "人気",
      quantity: "数量",
      each: "各",
      orderPlaced: "注文が正常に完了しました！予想時間:",
      minutes: "分"
    }
  };

  // Current language state
  let currentLang = 'en';

  // Language switching functionality
  function setLanguage(lang) {
    currentLang = lang;
    const t = translations[lang];
    
    // Update language buttons
    queryAll('.lang-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.lang === lang);
    });
    
    // Update all translatable elements
    Object.keys(t).forEach(key => {
      const element = query('#' + key);
      if (element) {
        element.textContent = t[key];
      }
    });

    // Update placeholder attributes
    const placeholderEl = query('[data-i18n-placeholder="searchPlaceholder"]');
    if (placeholderEl && t.searchPlaceholder) {
      placeholderEl.placeholder = t.searchPlaceholder;
    }
    
    // Re-render content
    renderTeeList();
    if (currentTee) renderPlayers();

    // Update food ordering elements if on the golf food tab
    if (typeof renderCategoryChips === 'function') {
      renderCategoryChips();
      updateCart();
      updateActiveOrders();
    }
  }

  // Initialize language switcher
  queryAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => setLanguage(btn.dataset.lang));
  });

  // Tab switching
  const tabBtns = queryAll('.nav button');
  function showTab(id) {
    query('#page-schedule').style.display = (id === 'page-schedule') ? 'block' : 'none';
    query('#page-events').style.display = (id === 'page-events') ? 'block' : 'none';
    query('#page-golffood').style.display = (id === 'page-golffood') ? 'block' : 'none';
    tabBtns.forEach(b => b.classList.toggle('active', b.getAttribute('data-page') === id));
  }
  tabBtns.forEach(b => b.addEventListener('click', () => showTab(b.getAttribute('data-page'))));
  showTab('page-schedule');

  // Storage keys
  const LS_CADDY_ASSIGNMENTS = 'mc:caddy:assignments.v1';
  const LS_CADDY_WAITLISTS = 'mc:caddy:waitlists.v1';
  
  function readJSON(k, def) { 
    try { 
      const s = localStorage.getItem(k); 
      return s ? JSON.parse(s) : def; 
    } catch(e) { 
      return def; 
    } 
  }
  
  function writeJSON(k, v) { 
    try { 
      localStorage.setItem(k, JSON.stringify(v)); 
    } catch(e) {} 
  }

  // Demo tee times
  const teeTimes = [
    { 
      id: 1, 
      date: '2025-09-13', 
      time: '08:00', 
      course: 'Siam Country Club - Plantation Course', 
      bookingRef: 'SCC-091325-008',
      groupName: 'Peter Park Morning Round', 
      players: ['Peter Park', 'Sarah Chen'],
      assignments: {}, 
      waitlists: {}
    },
    { 
      id: 2, 
      date: '2025-09-13', 
      time: '13:30', 
      course: 'Phoenix Gold Golf Course', 
      bookingRef: 'PGC-091325-013',
      groupName: 'Weekend Championship Prep', 
      players: ['Peter Park', 'Marcus Johnson', 'Alex Wong'],
      assignments: {}, 
      waitlists: {}
    }
  ];

  // Enhanced caddy database
  const caddies = [
    { 
      id: 101, 
      name: 'Somchai Precision', 
      nameEn: 'Somchai Precision',
      nameTh: 'สมชาย นำทาง', 
      nameKo: '솜차이 정밀',
      nameJa: 'ソムチャイ プレシジョン',
      rating: 4.95,
      price: 2200,
      avatar: '👨‍💼',
      languages: ['Thai', 'English', 'Korean'],
      specialties: ['Tournament Strategy', 'Course Management'],
      experience: 12
    },
    { 
      id: 102, 
      name: 'Elena Excellence', 
      nameEn: 'Elena Excellence',
      nameTh: 'เอเลน่า เป็นเลิศ', 
      nameKo: '엘레나 탁월',
      nameJa: 'エレナ エクセレンス',
      rating: 4.98, 
      price: 2800, 
      avatar: '👩‍💼',
      languages: ['English', 'Spanish', 'Korean'],
      specialties: ['VIP Concierge', 'Luxury Service'],
      experience: 15
    },
    { 
      id: 103, 
      name: 'Hiroshi Technical', 
      nameEn: 'Hiroshi Technical',
      nameTh: 'ฮิโรชิ เทคนิค', 
      nameKo: '히로시 기술',
      nameJa: 'ヒロシ テクニカル',
      rating: 4.92, 
      price: 2500, 
      avatar: '👨‍🔬',
      languages: ['Japanese', 'English', 'Thai'],
      specialties: ['Technical Analysis', 'Swing Coaching'],
      experience: 18
    },
    { 
      id: 104, 
      name: 'Isabella Innovation', 
      nameEn: 'Isabella Innovation',
      nameTh: 'อิซาเบลล่า นวัตกรรม', 
      nameKo: '이사벨라 혁신',
      nameJa: 'イザベラ イノベーション',
      rating: 4.89, 
      price: 2400, 
      avatar: '👩‍💻',
      languages: ['English', 'French', 'Thai'],
      specialties: ['Digital Analytics', 'Performance Tracking'],
      experience: 10
    },
    { 
      id: 105, 
      name: 'Marcus Elite', 
      nameEn: 'Marcus Elite',
      nameTh: 'มาร์คัส ชั้นนำ', 
      nameKo: '마커스 엘리트',
      nameJa: 'マーカス エリート',
      rating: 4.96, 
      price: 2600, 
      avatar: '👨‍🎓',
      languages: ['English', 'German', 'Thai'],
      specialties: ['Equipment Optimization', 'Mental Game'],
      experience: 14
    }
  ];

  // External booking conflicts
  function getExternalBookings(tee) {
    const key = `${tee.course}-${tee.date}-${tee.time}`;
    const conflicts = {
      'Siam Country Club - Plantation Course-2025-09-13-08:00': [
        {caddyId: 103, bookedBy: 'Wilson Brothers', group: 'Wilson Family Tournament'}
      ],
      'Phoenix Gold Golf Course-2025-09-13-13:30': [
        {caddyId: 102, bookedBy: 'Torres VIP', group: 'Premium Members Round'}
      ]
    };
    return conflicts[key] || [];
  }

  // State
  let currentTee = null;
  let currentPlayer = null;

  // DOM elements
  const teeListEl = query('#teeList');
  const playerTable = query('#playerTable');
  const playerTbody = playerTable?.querySelector('tbody');
  const detailTitle = query('#detailTitle');
  const detailMeta = query('#detailMeta');
  const detailNote = query('#detailNote');
  const openDrawerBtn = query('#openDrawerBtn');
  const drawer = query('#drawer');
  const backdrop = query('#backdrop');
  const drawerSubtitle = query('#drawerSubtitle');
  const forPlayer = query('#forPlayer');
  const closeDrawerBtn = query('#closeDrawer');
  const caddyListEl = query('#caddyList');
  const caddySearch = query('#caddySearch');
  const findCaddy = query('#findCaddy');

  // Helper functions
  function fmtDate(iso) {
    const d = new Date(iso + 'T00:00:00');
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    const locale = currentLang === 'th' ? 'th-TH' : currentLang === 'ko' ? 'ko-KR' : currentLang === 'ja' ? 'ja-JP' : 'en-US';
    return d.toLocaleDateString(locale, options);
  }

  function getCaddyName(caddyId) {
    const caddy = caddies.find(c => c.id === caddyId);
    if (!caddy) return '';

    if (currentLang === 'th' && caddy.nameTh) return caddy.nameTh;
    if (currentLang === 'ko' && caddy.nameKo) return caddy.nameKo;
    if (currentLang === 'ja' && caddy.nameJa) return caddy.nameJa;
    return caddy.nameEn || caddy.name;
  }

  function renderTeeList() {
    if (!teeListEl) return;
    
    teeListEl.innerHTML = '';
    teeTimes.forEach(t => {
      const el = document.createElement('div');
      el.className = 'tee';
      el.innerHTML = `
        <div class="row">
          <div style="font-weight: 700; font-size: 1.1rem;">${t.groupName}</div>
          <span class="muted">Ref ${t.bookingRef}</span>
        </div>
        <div class="chips">
          <span class="chip">${fmtDate(t.date)}</span>
          <span class="chip">${t.time}</span>
          <span class="chip">${t.course}</span>
          <span class="pill">${t.players.length} ${currentLang === 'th' ? 'คน' : currentLang === 'ko' ? '명' : currentLang === 'ja' ? '人' : 'players'}</span>
        </div>
      `;
      el.onclick = () => selectTee(t, el);
      teeListEl.appendChild(el);
    });
    
    if (teeTimes.length > 0) {
      selectTee(teeTimes[0], teeListEl.firstChild);
    }
  }

  function selectTee(t, el) {
    currentTee = t;
    
    // Update active state
    queryAll('.tee').forEach(c => c.classList.remove('active'));
    if (el) el.classList.add('active');
    
    // Update detail panel
    if (detailTitle) detailTitle.textContent = t.groupName;
    if (detailMeta) detailMeta.textContent = `${fmtDate(t.date)} • ${t.time} • ${t.course} — Ref ${t.bookingRef}`;
    
    renderPlayers();
    
    if (detailNote) {
      detailNote.style.display = 'block';
      const tip = translations[currentLang].waitlistTip || 'Advanced caddy booking with waitlist management.';
      detailNote.textContent = `💡 ${tip}`;
    }
  }

  function renderPlayers() {
    if (!currentTee || !playerTbody || !playerTable) return;
    
    playerTbody.innerHTML = '';
    playerTable.style.display = 'table';
    
    currentTee.players.forEach(p => {
      const tr = document.createElement('tr');
      const bookedCaddyId = currentTee.assignments[p];
      const waitCaddyId = currentTee.waitlists[p];
      
      const bookedCaddy = bookedCaddyId ? caddies.find(c => c.id === bookedCaddyId) : null;
      const waitCaddy = waitCaddyId ? caddies.find(c => c.id === waitCaddyId) : null;
      
      const bookedStr = bookedCaddy ? `#${bookedCaddy.id} ${getCaddyName(bookedCaddy.id)}` : '—';
      const waitStr = waitCaddy ? `#${waitCaddy.id} ${getCaddyName(waitCaddy.id)}` : '—';
      
      const t = translations[currentLang];
      
      tr.innerHTML = `
        <td style="font-weight: 600;">${p}</td>
        <td class="status ${bookedCaddyId ? 'ok' : ''}">${bookedStr}</td>
        <td class="status ${waitCaddyId ? 'warn' : ''}">${waitStr}</td>
        <td>
          <div class="actions">
            <button class="btn small" data-act="change">${t.changeAdd}</button>
            ${bookedCaddyId ? `<button class="btn ghost small" data-act="remove">${t.removeCaddy}</button>` : ''}
            ${waitCaddyId ? `<button class="btn ghost small" data-act="clearWait">${t.clearWaitlist}</button>` : ''}
          </div>
        </td>
      `;
      
      // Event handlers
      tr.querySelector('[data-act="change"]').onclick = () => openDrawerFor(p);
      if (bookedCaddyId) {
        tr.querySelector('[data-act="remove"]').onclick = () => {
          delete currentTee.assignments[p];
          syncTeeSheetData();
          renderPlayers();
        };
      }
      if (waitCaddyId) {
        tr.querySelector('[data-act="clearWait"]').onclick = () => {
          delete currentTee.waitlists[p];
          syncTeeSheetData();
          renderPlayers();
        };
      }
      
      playerTbody.appendChild(tr);
    });
  }

  function syncTeeSheetData() {
    if (!currentTee) return;
    
    const syncData = {
      teeTimeId: currentTee.id,
      date: currentTee.date,
      time: currentTee.time,
      course: currentTee.course,
      assignments: currentTee.assignments,
      waitlists: currentTee.waitlists,
      players: currentTee.players,
      lastSync: new Date().toISOString()
    };
    
    writeJSON(LS_CADDY_ASSIGNMENTS, {
      ...readJSON(LS_CADDY_ASSIGNMENTS, {}),
      [currentTee.id]: currentTee.assignments
    });
    
    writeJSON(LS_CADDY_WAITLISTS, {
      ...readJSON(LS_CADDY_WAITLISTS, {}),
      [currentTee.id]: currentTee.waitlists  
    });
    
    window.dispatchEvent(new CustomEvent('caddyAssignmentUpdate', { detail: syncData }));
    console.log('🔄 Tee Sheet Sync:', syncData);
  }

  function openDrawerFor(player) {
    currentPlayer = player;
    
    if (drawerSubtitle) {
      drawerSubtitle.textContent = `${fmtDate(currentTee.date)} • ${currentTee.time} • ${currentTee.course}`;
    }
    if (forPlayer) {
      forPlayer.textContent = player;
    }
    
    renderCaddies();
    showDrawer(true);
  }

  function showDrawer(yes) {
    if (drawer) drawer.classList.toggle('show', !!yes);
    if (backdrop) backdrop.classList.toggle('show', !!yes);
  }

  function renderCaddies() {
    if (!caddyListEl || !currentTee) return;
    
    const busy = getExternalBookings(currentTee);
    caddyListEl.innerHTML = '';
    
    caddies.forEach(c => {
      const external = busy.find(b => b.caddyId === c.id);
      const isAssignedHere = Object.values(currentTee.assignments).includes(c.id);
      const isBusy = !!external && !isAssignedHere;
      
      const wrap = document.createElement('div');
      wrap.className = 'caddy' + (isBusy ? ' busy' : '');
      wrap.id = 'caddy-' + c.id;
      
      const t = translations[currentLang];
      
              wrap.innerHTML = `
        <div style="display: flex; gap: 12px; align-items: center; flex: 1;">
          <div style="font-size: 1.8rem;">${c.avatar}</div>
          <div style="flex: 1;">
            <div style="font-weight: 700; font-size: 1rem; margin-bottom: 4px;">
              #${c.id} ${getCaddyName(c.id)}
              ${isBusy ? `<span class="tag busy">${t.booked}</span>` : `<span class="tag ok">${t.available}</span>`}
            </div>
            <div class="meta">
              ${t.rating} ${c.rating.toFixed(1)} ⭐ • ฿${c.price.toLocaleString()} • ${c.experience}${currentLang === 'th' ? 'ปี' : currentLang === 'ko' ? '년' : currentLang === 'ja' ? '年' : 'yrs'}
            </div>
            <div class="meta" style="margin-top: 2px; color: var(--accent); font-size: 0.8rem;">
              🗣️ ${c.languages.join(', ')} • ${c.specialties.join(', ')}
            </div>
            ${external ? `<div class="meta" style="margin-top: 6px; color: var(--bad); font-size: 0.75rem;">
              Currently with ${external.bookedBy} — ${external.group}
            </div>` : ''}
          </div>
        </div>
        <div class="actions">
          <button class="btn small ${isBusy ? 'secondary' : ''}" ${isBusy ? 'disabled' : ''} data-b="now" style="padding: 8px 12px; font-size: 0.8rem;">
            ${t.bookNow}
          </button>
          <button class="btn secondary small" data-b="wait" style="padding: 8px 12px; font-size: 0.8rem;">
            ${t.joinWaitlist}
          </button>
        </div>
      `;
      
      // Event handlers
      wrap.querySelector('[data-b="now"]').onclick = () => {
        if (isBusy) return;
        currentTee.assignments[currentPlayer] = c.id;
        
        if (currentTee.waitlists[currentPlayer] === c.id) {
          delete currentTee.waitlists[currentPlayer];
        }
        
        syncTeeSheetData();
        renderPlayers();
        showDrawer(false);
      };
      
      wrap.querySelector('[data-b="wait"]').onclick = () => {
        currentTee.waitlists[currentPlayer] = c.id;
        syncTeeSheetData();
        renderPlayers();
      };
      
      caddyListEl.appendChild(wrap);
    });
  }

  // Search functionality
  if (findCaddy) {
    findCaddy.onclick = () => {
      const num = parseInt(caddySearch?.value, 10);
      if (!num) return;
      
      const el = query('#caddy-' + num);
      if (el) {
        el.scrollIntoView({behavior: 'smooth', block: 'center'});
        el.style.outline = '3px solid var(--ring)';
        setTimeout(() => el.style.outline = 'none', 1500);
      }
    };
  }

  // Event handlers
  if (closeDrawerBtn) closeDrawerBtn.onclick = () => showDrawer(false);
  if (backdrop) backdrop.onclick = () => showDrawer(false);
  if (openDrawerBtn) {
    openDrawerBtn.onclick = () => {
      if (currentTee && currentTee.players.length > 0) {
        openDrawerFor(currentTee.players[0]);
      }
    };
  }

  // ==================== GOLF FOOD ORDERING SYSTEM ====================

  // Golf Food Menu Data
  const menuData = {
    categories: [
      { id: "drinks", name: "🥤 Beverages", color: "#3b82f6" },
      { id: "food", name: "🍽️ Food", color: "#10b981" },
      { id: "snacks", name: "🍿 Snacks", color: "#f59e0b" }
    ],
    items: [
      { id: "water", name: "Premium Water", price: 35, time: 1, category: "drinks", popular: true },
      { id: "coke", name: "Coca-Cola", price: 50, time: 2, category: "drinks" },
      { id: "sports", name: "Electrolyte Drink", price: 65, time: 2, category: "drinks", popular: true },
      { id: "coffee", name: "Espresso", price: 85, time: 3, category: "drinks" },
      { id: "smoothie", name: "Green Smoothie", price: 120, time: 4, category: "drinks" },
      { id: "chang-small", name: "Chang Beer (Small)", price: 110, time: 2, category: "drinks", popular: true, sizes: ["Small", "Large"], baseId: "chang" },
      { id: "chang-large", name: "Chang Beer (Large)", price: 150, time: 2, category: "drinks", sizes: ["Small", "Large"], baseId: "chang" },
      { id: "singha-small", name: "Singha Beer (Small)", price: 120, time: 2, category: "drinks", sizes: ["Small", "Large"], baseId: "singha" },
      { id: "singha-large", name: "Singha Beer (Large)", price: 160, time: 2, category: "drinks", sizes: ["Small", "Large"], baseId: "singha" },
      { id: "heineken-small", name: "Heineken Beer (Small)", price: 130, time: 2, category: "drinks", sizes: ["Small", "Large"], baseId: "heineken" },
      { id: "heineken-large", name: "Heineken Beer (Large)", price: 170, time: 2, category: "drinks", sizes: ["Small", "Large"], baseId: "heineken" },
      { id: "club", name: "Signature Club Sandwich", price: 320, time: 12, category: "food", popular: true },
      { id: "salad", name: "Caesar Salad", price: 240, time: 8, category: "food" },
      { id: "soup", name: "Tom Yum Soup", price: 180, time: 6, category: "food" },
      { id: "pasta", name: "Truffle Pasta", price: 380, time: 14, category: "food" },
      { id: "steak", name: "Wagyu Slider", price: 450, time: 16, category: "food" },
      { id: "nuts", name: "Artisan Mixed Nuts", price: 95, time: 1, category: "snacks" },
      { id: "chips", name: "Gourmet Chips", price: 65, time: 1, category: "snacks", popular: true },
      { id: "fruit", name: "Fresh Fruit Bowl", price: 85, time: 3, category: "snacks" }
    ]
  };

  // Golf Food State
  let foodCart = [];
  let activeCategory = '';
  let foodSearch = '';
  let currentHole = 7;
  let deliveryHole = 8;
  let isPickup = false;
  let activeOrders = [];
  let orderCounter = 1000;
  let aiSuggestion = null;
  let showAiSuggestion = false;

  // Golf Food Elements
  const menuSearchEl = query('#menuSearch');
  const categoryChipsEl = query('#categoryChips');
  const menuItemsEl = query('#menuItems');
  const cartItemsEl = query('#cartItems');
  const cartCountEl = query('#cartCount');
  const orderSummaryEl = query('#orderSummary');
  const emptyCartEl = query('#emptyCart');
  const deliveryBtnEl = query('#deliveryBtn');
  const pickupBtnEl = query('#pickupBtn');
  const deliveryHoleEl = query('#deliveryHole');
  const placeOrderBtnEl = query('#placeOrderBtn');
  const subtotalEl = query('#subtotal');
  const deliveryFeeEl = query('#deliveryFee');
  const orderTotalEl = query('#orderTotal');
  const activeOrdersSectionEl = query('#activeOrdersSection');
  const activeOrdersEl = query('#activeOrders');
  const activeOrderCountEl = query('#activeOrderCount');
  const aiSuggestionEl = query('#aiSuggestion');
  const aiTextEl = query('#aiText');

  // Helper functions for food ordering
  function formatPrice(price) {
    return `฿${price.toLocaleString()}`;
  }

  function getFilteredItems() {
    let items = menuData.items;

    if (activeCategory) {
      items = items.filter(item => item.category === activeCategory);
    }

    if (foodSearch) {
      items = items.filter(item =>
        item.name.toLowerCase().includes(foodSearch.toLowerCase())
      );
    }

    return items.sort((a, b) => (b.popular ? 1 : 0) - (a.popular ? 1 : 0));
  }

  function addToCart(item) {
    const existing = foodCart.find(ci => ci.item.id === item.id);
    if (existing) {
      existing.qty += 1;
    } else {
      foodCart.push({ item, qty: 1 });
    }
    updateCart();
    updateAISuggestion();
  }

  function updateCartQty(itemId, qty) {
    if (qty <= 0) {
      foodCart = foodCart.filter(ci => ci.item.id !== itemId);
    } else {
      const cartItem = foodCart.find(ci => ci.item.id === itemId);
      if (cartItem) {
        cartItem.qty = qty;
      }
    }
    updateCart();
    updateAISuggestion();
  }

  function getCartSubtotal() {
    return foodCart.reduce((sum, item) => sum + (item.item.price * item.qty), 0);
  }

  function getCartTotal() {
    const subtotal = getCartSubtotal();
    return subtotal + (subtotal > 0 && !isPickup ? 30 : 0);
  }

  function getCartItemCount() {
    return foodCart.reduce((sum, item) => sum + item.qty, 0);
  }

  function updateAISuggestion() {
    if (foodCart.length === 0 || isPickup) {
      showAiSuggestion = false;
      if (aiSuggestionEl) aiSuggestionEl.style.display = 'none';
      return;
    }

    // Simulate AI analysis
    setTimeout(() => {
      const totalPrepTime = foodCart.reduce((sum, cartItem) => {
        return sum + (cartItem.item.time * cartItem.qty);
      }, 0);

      const averageHolePace = 14;
      const kitchenLoad = Math.random() * 0.5 + 0.75;
      const golfPace = Math.random() * 0.3 + 0.85;

      const adjustedPrepTime = totalPrepTime * kitchenLoad;
      const holesPlayerWillAdvance = Math.ceil(adjustedPrepTime / (averageHolePace * golfPace));

      let recommendedHole = currentHole + holesPlayerWillAdvance;
      if (recommendedHole > 18) recommendedHole = 18;

      let reasoning = '';
      let confidence = 0.8;

      if (totalPrepTime > 15) {
        reasoning = `Large order (${totalPrepTime}min prep) - delivery ${holesPlayerWillAdvance} holes ahead`;
        confidence = 0.9;
      } else if (totalPrepTime > 8) {
        reasoning = `Medium prep time (${totalPrepTime}min) - optimized for hole pace`;
        confidence = 0.85;
      } else if (kitchenLoad > 1.1) {
        reasoning = `Kitchen busy (${Math.round(kitchenLoad * 100)}% load) - added buffer time`;
        confidence = 0.75;
      } else {
        reasoning = `Quick order - optimal delivery timing calculated`;
        confidence = 0.7;
      }

      aiSuggestion = {
        recommendedDeliveryHole: recommendedHole,
        estimatedArrivalTime: Math.round(adjustedPrepTime + 3),
        golfPaceMultiplier: golfPace,
        kitchenLoadFactor: kitchenLoad,
        reasoning,
        confidence
      };

      // AUTOMATIC AI OPTIMIZATION - Always use AI recommendation
      if (deliveryHoleEl && aiSuggestion.recommendedDeliveryHole !== deliveryHole) {
        deliveryHole = aiSuggestion.recommendedDeliveryHole;
        deliveryHoleEl.value = deliveryHole;

        // Show AI notification for 3 seconds
        if (aiSuggestionEl && aiTextEl) {
          aiSuggestionEl.style.display = 'block';
          aiTextEl.textContent = `🤖 Auto-optimized: ${aiSuggestion.reasoning}`;

          setTimeout(() => {
            if (aiSuggestionEl) aiSuggestionEl.style.display = 'none';
          }, 3000);
        }
      }
    }, 1000);
  }

  function renderMenuItems() {
    if (!menuItemsEl) return;

    const items = getFilteredItems();
    menuItemsEl.innerHTML = '';

    // Group beer items by baseId to show only one item per beer type
    const groupedItems = [];
    const beerGroups = {};

    items.forEach(item => {
      if (item.baseId) {
        if (!beerGroups[item.baseId]) {
          beerGroups[item.baseId] = [];
        }
        beerGroups[item.baseId].push(item);
      } else {
        groupedItems.push(item);
      }
    });

    // Add grouped beer items (show only small size as representative)
    Object.keys(beerGroups).forEach(baseId => {
      const beerItems = beerGroups[baseId];
      const smallSize = beerItems.find(item => item.id.includes('-small'));
      if (smallSize) {
        groupedItems.push({
          ...smallSize,
          isBeerGroup: true,
          beerOptions: beerItems
        });
      }
    });

    groupedItems.forEach(item => {
      const el = document.createElement('div');
      el.className = 'tee';
      el.style.cursor = item.isBeerGroup ? 'default' : 'pointer';

      if (item.isBeerGroup) {
        // Beer item with size selection
        const beerName = item.name.split(' (')[0]; // Get beer name without size
        el.innerHTML = `
          <div class="row">
            <div style="flex: 1;">
              <div style="font-weight: 700; font-size: 1rem; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                🍺 ${beerName}
                ${item.popular ? '<span class="chip" style="background: var(--warn); color: white; font-size: 0.7rem;">Popular</span>' : ''}
              </div>
              <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 12px;">
                <span style="font-size: 0.9rem; color: var(--muted);">Available sizes</span>
                <span style="font-size: 0.85rem; color: var(--muted);">${item.time} min</span>
              </div>
              <div style="display: flex; gap: 8px;">
                ${item.beerOptions.map((option, index) => `
                  <button class="btn small beer-option-btn"
                          data-beer-option='${JSON.stringify(option)}'
                          style="flex: 1; font-size: 0.8rem; padding: 6px 12px;">
                    ${option.id.includes('-small') ? 'Small' : 'Large'} - ${formatPrice(option.price)}
                  </button>
                `).join('')}
              </div>
            </div>
          </div>
        `;
      } else {
        // Regular item
        el.innerHTML = `
          <div class="row">
            <div style="flex: 1;">
              <div style="font-weight: 700; font-size: 1rem; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                ${item.name}
                ${item.popular ? '<span class="chip" style="background: var(--warn); color: white; font-size: 0.7rem;">Popular</span>' : ''}
              </div>
              <div style="display: flex; align-items: center; gap: 16px;">
                <span style="font-size: 1.1rem; font-weight: 600; color: var(--accent);">${formatPrice(item.price)}</span>
                <span style="font-size: 0.85rem; color: var(--muted);">${item.time} min</span>
              </div>
            </div>
            <div style="width: 40px; height: 40px; background: rgba(0, 122, 255, 0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: var(--accent); font-size: 1.2rem; font-weight: 700;">+</div>
          </div>
        `;
        el.onclick = () => addToCart(item);
      }

      menuItemsEl.appendChild(el);
    });
  }

  function renderCategoryChips() {
    if (!categoryChipsEl) return;

    const t = translations[currentLang];
    categoryChipsEl.innerHTML = '';

    // All Items chip
    const allChip = document.createElement('button');
    allChip.className = `chip ${!activeCategory ? 'active' : ''}`;
    allChip.style.backgroundColor = !activeCategory ? 'var(--accent)' : '';
    allChip.style.color = !activeCategory ? 'white' : '';
    allChip.textContent = t.allItems || 'All Items';
    allChip.onclick = () => {
      activeCategory = '';
      renderCategoryChips();
      renderMenuItems();
    };
    categoryChipsEl.appendChild(allChip);

    // Category chips
    menuData.categories.forEach(cat => {
      const chip = document.createElement('button');
      chip.className = `chip ${activeCategory === cat.id ? 'active' : ''}`;
      chip.style.backgroundColor = activeCategory === cat.id ? 'var(--accent)' : '';
      chip.style.color = activeCategory === cat.id ? 'white' : '';
      chip.textContent = cat.name;
      chip.onclick = () => {
        activeCategory = cat.id;
        renderCategoryChips();
        renderMenuItems();
      };
      categoryChipsEl.appendChild(chip);
    });
  }

  function updateCart() {
    const itemCount = getCartItemCount();
    const subtotal = getCartSubtotal();
    const total = getCartTotal();
    const t = translations[currentLang];

    // Update cart count
    if (cartCountEl) {
      cartCountEl.style.display = itemCount > 0 ? 'block' : 'none';
      cartCountEl.textContent = itemCount;
    }

    // Show/hide cart sections
    if (emptyCartEl) emptyCartEl.style.display = foodCart.length === 0 ? 'block' : 'none';
    if (orderSummaryEl) orderSummaryEl.style.display = foodCart.length > 0 ? 'block' : 'none';

    // Update totals
    if (subtotalEl) subtotalEl.textContent = formatPrice(subtotal);
    if (deliveryFeeEl) deliveryFeeEl.textContent = !isPickup && subtotal > 0 ? '฿30' : '฿0';
    if (orderTotalEl) orderTotalEl.textContent = formatPrice(total);

    // Render cart items
    if (cartItemsEl) {
      cartItemsEl.innerHTML = '';

      foodCart.forEach(cartItem => {
        const el = document.createElement('div');
        el.className = 'card';
        el.style.marginBottom = '12px';
        el.innerHTML = `
          <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
            <div style="flex: 1;">
              <div style="font-weight: 600; margin-bottom: 4px;">${cartItem.item.name}</div>
              <div style="font-size: 0.85rem; color: var(--muted);">${formatPrice(cartItem.item.price)} each</div>
            </div>
            <div style="font-weight: 700; color: var(--accent);">${formatPrice(cartItem.item.price * cartItem.qty)}</div>
          </div>
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div style="font-size: 0.8rem; color: var(--muted);">Quantity</div>
            <div style="display: flex; align-items: center; gap: 12px;">
              <button class="btn ghost small" onclick="updateCartQty('${cartItem.item.id}', ${cartItem.qty - 1})" style="width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center;">−</button>
              <span style="font-weight: 600; min-width: 24px; text-align: center;">${cartItem.qty}</span>
              <button class="btn ghost small" onclick="updateCartQty('${cartItem.item.id}', ${cartItem.qty + 1})" style="width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center;">+</button>
            </div>
          </div>
        `;
        cartItemsEl.appendChild(el);
      });
    }
  }

  function toggleDeliveryOption(pickup) {
    isPickup = pickup;
    const t = translations[currentLang];

    if (deliveryBtnEl && pickupBtnEl) {
      if (pickup) {
        deliveryBtnEl.className = 'btn ghost small';
        pickupBtnEl.className = 'btn secondary small';
        pickupBtnEl.style.background = 'var(--accent)';
        pickupBtnEl.style.color = 'white';
      } else {
        deliveryBtnEl.className = 'btn secondary small';
        deliveryBtnEl.style.background = 'var(--accent)';
        deliveryBtnEl.style.color = 'white';
        pickupBtnEl.className = 'btn ghost small';
      }

      // Update button text with translations
      deliveryBtnEl.textContent = t.deliverBtn || '🚗 Deliver';
      pickupBtnEl.textContent = t.pickupBtn || '🏪 Pickup';
    }

    // Show/hide delivery options
    const deliveryOptionsEl = query('#deliveryOptions');
    if (deliveryOptionsEl) {
      deliveryOptionsEl.style.display = pickup ? 'none' : 'block';
    }

    updateCart();
    updateAISuggestion();
  }

  function placeOrder() {
    if (foodCart.length === 0) return;

    const orderId = `G${++orderCounter}`;
    const orderData = {
      id: orderId,
      items: foodCart.map(ci => `${ci.qty}x ${ci.item.name}`),
      total: getCartTotal(),
      status: 'confirmed',
      eta: Math.round(Math.random() * 10 + 15),
      orderHole: currentHole,
      deliveryHole: isPickup ? null : deliveryHole,
      pickup: isPickup,
      progress: 10,
      aiOptimized: aiSuggestion && aiSuggestion.recommendedDeliveryHole !== deliveryHole,
      aiReasoning: aiSuggestion ? aiSuggestion.reasoning : null
    };

    activeOrders.push(orderData);
    foodCart = [];

    // Start order simulation
    simulateOrderProgress(orderId);

    updateCart();
    updateActiveOrders();

    // Order placed successfully - no annoying popup
    console.log(`Order ${orderId} placed successfully! ETA: ${orderData.eta} minutes`);
  }

  function simulateOrderProgress(orderId) {
    const order = activeOrders.find(o => o.id === orderId);
    if (!order) return;

    const totalTime = order.eta * 60000; // Convert to milliseconds

    // Preparing (25%)
    setTimeout(() => {
      const current = activeOrders.find(o => o.id === orderId);
      if (current) {
        current.status = 'preparing';
        current.progress = 25;
        updateActiveOrders();
      }
    }, totalTime * 0.15);

    // Ready (75%)
    setTimeout(() => {
      const current = activeOrders.find(o => o.id === orderId);
      if (current) {
        current.status = 'ready';
        current.progress = 75;
        updateActiveOrders();
      }
    }, totalTime * 0.6);

    // Delivering (90%)
    if (!order.pickup) {
      setTimeout(() => {
        const current = activeOrders.find(o => o.id === orderId);
        if (current) {
          current.status = 'delivering';
          current.progress = 90;
          updateActiveOrders();
        }
      }, totalTime * 0.8);
    }

    // Delivered (100%)
    setTimeout(() => {
      const current = activeOrders.find(o => o.id === orderId);
      if (current) {
        current.status = 'delivered';
        current.progress = 100;
        updateActiveOrders();

        // Remove after 2 minutes
        setTimeout(() => {
          activeOrders = activeOrders.filter(o => o.id !== orderId);
          updateActiveOrders();
        }, 120000);
      }
    }, totalTime);
  }

  function updateActiveOrders() {
    if (!activeOrdersSectionEl || !activeOrdersEl || !activeOrderCountEl) return;

    const visibleOrders = activeOrders.filter(o => o.status !== 'delivered');

    activeOrdersSectionEl.style.display = visibleOrders.length > 0 ? 'block' : 'none';
    activeOrderCountEl.textContent = visibleOrders.length;

    activeOrdersEl.innerHTML = '';

    visibleOrders.forEach(order => {
      const el = document.createElement('div');
      el.className = 'card';
      el.style.borderLeft = '3px solid var(--accent)';
      el.style.marginBottom = '12px';
      el.style.padding = '12px';

      const statusColor = {
        'confirmed': 'var(--warn)',
        'preparing': 'var(--warn)',
        'ready': '#8a2be2',
        'delivering': 'var(--accent)',
        'delivered': 'var(--ok)'
      }[order.status];

      const statusText = {
        'confirmed': 'Order Confirmed',
        'preparing': 'Kitchen Preparing',
        'ready': 'Ready for ' + (order.pickup ? 'Pickup' : 'Delivery'),
        'delivering': 'On the Way',
        'delivered': 'Delivered Successfully'
      }[order.status];

      el.innerHTML = `
        <div style="margin-bottom: 8px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
            <span style="font-weight: 600; font-size: 0.9rem;">Order ${order.id}</span>
            <span style="font-weight: 600; color: var(--accent); font-size: 0.9rem;">${formatPrice(order.total)}</span>
          </div>
          <div style="font-size: 0.75rem; color: var(--muted); margin-bottom: 6px;">
            📍 ${order.orderHole}${order.pickup ? ' → 🏪 Pickup' : ` → 🚗 ${order.deliveryHole}`}${order.aiOptimized ? ' • 🤖' : ''}
          </div>
        </div>

        <div style="margin-bottom: 8px;">
          <div style="display: flex; justify-content: space-between; font-size: 0.75rem; margin-bottom: 4px;">
            <span style="font-weight: 600; color: ${statusColor};">${statusText}</span>
            <span>${order.status === 'delivered' ? '✓ Done!' : `${order.eta}min`}</span>
          </div>
          <div style="width: 100%; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden;">
            <div style="height: 100%; background: ${statusColor}; width: ${order.progress}%; transition: width 0.5s ease;"></div>
          </div>
        </div>

        <div style="font-size: 0.7rem; color: var(--muted); padding-top: 6px; border-top: 1px solid var(--border);">
          ${order.items.join(', ')}
        </div>

        ${order.aiOptimized && order.aiReasoning ? `
          <div style="margin-top: 6px; padding: 6px; background: rgba(138, 43, 226, 0.1); border-radius: 6px; font-size: 0.7rem; color: #8a2be2;">
            🤖 ${order.aiReasoning}
          </div>
        ` : ''}
      `;

      activeOrdersEl.appendChild(el);
    });
  }

  // Initialize Golf Food System
  function initGolfFood() {
    // Search functionality
    if (menuSearchEl) {
      menuSearchEl.addEventListener('input', (e) => {
        foodSearch = e.target.value;
        renderMenuItems();
      });
    }

    // Delivery option buttons
    if (deliveryBtnEl) {
      deliveryBtnEl.addEventListener('click', () => toggleDeliveryOption(false));
    }
    if (pickupBtnEl) {
      pickupBtnEl.addEventListener('click', () => toggleDeliveryOption(true));
    }

    // Delivery hole selection
    if (deliveryHoleEl) {
      deliveryHoleEl.addEventListener('change', (e) => {
        deliveryHole = parseInt(e.target.value);
        updateAISuggestion();
      });
    }

    // Place order button
    if (placeOrderBtnEl) {
      placeOrderBtnEl.addEventListener('click', placeOrder);
    }

    // AI is now automatic - no manual buttons needed

    // Make functions globally available
    window.updateCartQty = updateCartQty;
    window.addToCart = addToCart;

    // Add event listeners for beer option buttons
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('beer-option-btn')) {
        try {
          const beerOption = JSON.parse(e.target.getAttribute('data-beer-option'));
          addToCart(beerOption);
        } catch (error) {
          console.error('Error parsing beer option:', error);
        }
      }
    });

    // Initial render
    renderCategoryChips();
    renderMenuItems();
    updateCart();
    updateActiveOrders();
  }

  // Initialize
  setLanguage('en');
  renderTeeList();
  initGolfFood();
})();
</script>

</body>
</html>