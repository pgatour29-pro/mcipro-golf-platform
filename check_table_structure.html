<!DOCTYPE html>
<html>
<head><title>Check Table Structure</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
<h1>Check Table Structure</h1>
<button onclick="check()">CHECK</button>
<pre id="out"></pre>
<script>
const db = window.supabase.createClient(
    'https://pyeeplwsnupmhgbguwqs.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB5ZWVwbHdzbnVwbWhnYmd1d3FzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk4NDM2NjksImV4cCI6MjA3NTQxOTY2OX0.KVQ6WvDKz9s77lxn3AhSA_YTMCN6rsht9kDkMIDhngk'
);

async function check() {
    const out = document.getElementById('out');
    out.textContent = 'Checking...\n\n';

    // Get one row from society_members
    const {data, error} = await db.from('society_members').select('*').limit(1);

    if (error) {
        out.textContent += 'ERROR: ' + error.message + '\n';
        return;
    }

    out.textContent += 'society_members columns:\n';
    if (data && data[0]) {
        Object.keys(data[0]).forEach(k => {
            out.textContent += '  - ' + k + ': ' + typeof data[0][k] + '\n';
            if (typeof data[0][k] === 'object' && data[0][k] !== null) {
                out.textContent += '    ' + JSON.stringify(data[0][k]).substring(0, 100) + '\n';
            }
        });
    }

    // Also check society_handicaps
    out.textContent += '\n\nsociety_handicaps columns:\n';
    const {data: h} = await db.from('society_handicaps').select('*').limit(1);
    if (h && h[0]) {
        Object.keys(h[0]).forEach(k => {
            out.textContent += '  - ' + k + ': ' + typeof h[0][k] + '\n';
        });
    }

    // Check Pluto specifically
    out.textContent += '\n\nSearching for Pluto in user_profiles...\n';
    const {data: p} = await db.from('user_profiles').select('line_user_id, name').ilike('name', '%pluto%');
    if (p) {
        p.forEach(x => out.textContent += 'Found: ' + x.name + ' ID: ' + x.line_user_id + '\n');
    }

    // Check ALL handicaps for that ID
    if (p && p[0]) {
        const id = p[0].line_user_id;
        out.textContent += '\nHandicaps for ' + id + ':\n';
        const {data: hcps} = await db.from('society_handicaps').select('*').eq('golfer_id', id);
        if (hcps) {
            hcps.forEach(h => out.textContent += JSON.stringify(h) + '\n');
        } else {
            out.textContent += 'NONE FOUND\n';
        }
    }

    out.textContent += '\nDONE';
}
</script>
</body>
</html>
