<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check JOA Golf Pattaya Society</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>JOA Golf Pattaya Society Checker</h1>
    <div id="results"></div>

    <script>
        const SUPABASE_URL = 'https://pyeeplwsnupmhgbguwqs.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB5ZWVwbHdzbnVwbWhnYmd1d3FzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk4NDM2NjksImV4cCI6MjA3NTQxOTY2OX0.KVQ6WvDKz9s77lxn3AhSA_YTMCN6rsht9kDkMIDhngk';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        async function checkJOASociety() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>Checking...</p>';

            try {
                // 1. Check if JOA Golf Pattaya exists in society_profiles
                const { data: societies, error: societiesError } = await supabase
                    .from('society_profiles')
                    .select('*')
                    .ilike('society_name', '%JOA%');

                if (societiesError) {
                    results.innerHTML += `<p style="color: red;">Error checking societies: ${societiesError.message}</p>`;
                } else {
                    results.innerHTML += `<h2>Society Profiles with "JOA":</h2>`;
                    results.innerHTML += `<pre>${JSON.stringify(societies, null, 2)}</pre>`;
                }

                // 2. Check all society profiles
                const { data: allSocieties, error: allError } = await supabase
                    .from('society_profiles')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (allError) {
                    results.innerHTML += `<p style="color: red;">Error checking all societies: ${allError.message}</p>`;
                } else {
                    results.innerHTML += `<h2>All Society Profiles (${allSocieties.length}):</h2>`;
                    results.innerHTML += `<pre>${JSON.stringify(allSocieties, null, 2)}</pre>`;
                }

                // 3. Check for JOAGOLFPAT organizer_id
                const { data: joaOrg, error: joaError } = await supabase
                    .from('society_profiles')
                    .select('*')
                    .eq('organizer_id', 'JOAGOLFPAT');

                if (joaError) {
                    results.innerHTML += `<p style="color: red;">Error checking JOAGOLFPAT: ${joaError.message}</p>`;
                } else {
                    results.innerHTML += `<h2>JOAGOLFPAT Organizer:</h2>`;
                    results.innerHTML += `<pre>${JSON.stringify(joaOrg, null, 2)}</pre>`;
                }

                // 4. Check current user's profile
                const currentUser = JSON.parse(localStorage.getItem('userProfile') || '{}');
                results.innerHTML += `<h2>Current User Profile:</h2>`;
                results.innerHTML += `<pre>${JSON.stringify(currentUser, null, 2)}</pre>`;

                // 5. Check if user has society_organizer role
                if (currentUser.lineUserId) {
                    const { data: userProfile, error: userError } = await supabase
                        .from('user_profiles')
                        .select('*')
                        .eq('line_user_id', currentUser.lineUserId)
                        .single();

                    if (userError) {
                        results.innerHTML += `<p style="color: red;">Error checking user: ${userError.message}</p>`;
                    } else {
                        results.innerHTML += `<h2>User Database Profile:</h2>`;
                        results.innerHTML += `<pre>${JSON.stringify(userProfile, null, 2)}</pre>`;
                    }
                }

            } catch (error) {
                results.innerHTML += `<p style="color: red;">Unexpected error: ${error.message}</p>`;
            }
        }

        // Run check on load
        checkJOASociety();
    </script>
</body>
</html>
