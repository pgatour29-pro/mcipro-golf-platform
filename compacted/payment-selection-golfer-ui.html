<!-- =====================================================
     GOLFER PAYMENT SELECTION UI
     ===================================================== -->
<!-- Payment preference selection for golfers during registration -->

<!-- Payment Selection Modal -->
<div id="golferPaymentModal" class="modal-backdrop" style="display: none;">
    <div class="modal-container max-w-2xl">
        <div class="modal-header bg-gradient-to-r from-sky-600 to-sky-400 text-white">
            <div>
                <h2 class="text-xl font-bold">Select Payment Options</h2>
                <p class="text-sm text-sky-100 mt-1">Choose where you'd like to pay each fee</p>
            </div>
            <button onclick="closeGolferPaymentModal()" class="text-white hover:bg-white/20 rounded-lg p-2">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>

        <div class="modal-body">
            <!-- Event Summary -->
            <div class="bg-gradient-to-br from-sky-50 to-sky-100 rounded-xl p-4 mb-6 border border-sky-200">
                <div class="flex items-center gap-3 mb-3">
                    <span class="material-symbols-outlined text-sky-600 text-3xl">event</span>
                    <div>
                        <h3 class="font-bold text-gray-900" id="paymentEventTitle">Event Name</h3>
                        <p class="text-sm text-gray-600" id="paymentEventInfo">Event Date</p>
                    </div>
                </div>
            </div>

            <!-- Fee Selection Grid -->
            <div class="space-y-4" id="feeSelectionContainer">
                <!-- Green Fee -->
                <div class="payment-selection-item">
                    <div class="flex items-center justify-between mb-2">
                        <div>
                            <h4 class="font-bold text-gray-900">Green Fee</h4>
                            <p class="text-sm text-gray-600">Golf course entry fee</p>
                        </div>
                        <div class="text-2xl font-bold text-sky-600" id="greenFeeAmount">฿0</div>
                    </div>
                    <select id="payGreenAt" class="payment-location-select w-full border-2 border-gray-200 rounded-lg px-4 py-3 focus:border-sky-500 focus:ring-2 focus:ring-sky-200">
                        <option value="">Choose payment location...</option>
                        <option value="bar">Society Bar</option>
                        <option value="course">Golf Course</option>
                        <option value="organizer">Pay Organizer</option>
                    </select>
                </div>

                <!-- Cart Fee -->
                <div class="payment-selection-item">
                    <div class="flex items-center justify-between mb-2">
                        <div>
                            <h4 class="font-bold text-gray-900">Cart Fee</h4>
                            <p class="text-sm text-gray-600">Golf cart rental</p>
                        </div>
                        <div class="text-2xl font-bold text-sky-600" id="cartFeeAmount">฿0</div>
                    </div>
                    <select id="payCartAt" class="payment-location-select w-full border-2 border-gray-200 rounded-lg px-4 py-3 focus:border-sky-500 focus:ring-2 focus:ring-sky-200">
                        <option value="">Choose payment location...</option>
                        <option value="bar">Society Bar</option>
                        <option value="course">Golf Course</option>
                        <option value="organizer">Pay Organizer</option>
                    </select>
                </div>

                <!-- Caddy Fee -->
                <div class="payment-selection-item">
                    <div class="flex items-center justify-between mb-2">
                        <div>
                            <h4 class="font-bold text-gray-900">Caddy Fee</h4>
                            <p class="text-sm text-gray-600">Caddie service fee</p>
                        </div>
                        <div class="text-2xl font-bold text-sky-600" id="caddyFeeAmount">฿0</div>
                    </div>
                    <select id="payCaddyAt" class="payment-location-select w-full border-2 border-gray-200 rounded-lg px-4 py-3 focus:border-sky-500 focus:ring-2 focus:ring-sky-200">
                        <option value="">Choose payment location...</option>
                        <option value="bar">Society Bar</option>
                        <option value="course">Golf Course</option>
                        <option value="organizer">Pay Organizer</option>
                    </select>
                </div>

                <!-- Transport Fee (if applicable) -->
                <div id="transportFeeSection" class="payment-selection-item" style="display: none;">
                    <div class="flex items-center justify-between mb-2">
                        <div>
                            <h4 class="font-bold text-gray-900">Transport Fee</h4>
                            <p class="text-sm text-gray-600">Transportation to course</p>
                        </div>
                        <div class="text-2xl font-bold text-sky-600" id="transportFeeAmount">฿0</div>
                    </div>
                    <select id="payTransportAt" class="payment-location-select w-full border-2 border-gray-200 rounded-lg px-4 py-3 focus:border-sky-500 focus:ring-2 focus:ring-sky-200">
                        <option value="">Choose payment location...</option>
                        <option value="bar">Society Bar</option>
                        <option value="organizer">Pay Organizer</option>
                    </select>
                </div>

                <!-- Competition Fee (if applicable) -->
                <div id="competitionFeeSection" class="payment-selection-item" style="display: none;">
                    <div class="flex items-center justify-between mb-2">
                        <div>
                            <h4 class="font-bold text-gray-900">Competition Fee</h4>
                            <p class="text-sm text-gray-600">Entry into competition prizes</p>
                        </div>
                        <div class="text-2xl font-bold text-sky-600" id="competitionFeeAmount">฿0</div>
                    </div>
                    <select id="payCompetitionAt" class="payment-location-select w-full border-2 border-gray-200 rounded-lg px-4 py-3 focus:border-sky-500 focus:ring-2 focus:ring-sky-200">
                        <option value="">Choose payment location...</option>
                        <option value="bar">Society Bar</option>
                        <option value="organizer">Pay Organizer</option>
                    </select>
                </div>
            </div>

            <!-- Total Summary -->
            <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 mt-6 border-2 border-green-300">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-bold text-gray-900">Total Amount Due</h3>
                        <p class="text-sm text-gray-600">All fees combined</p>
                    </div>
                    <div class="text-4xl font-bold text-green-600" id="totalPaymentAmount">฿0</div>
                </div>
            </div>

            <!-- Payment Summary Breakdown -->
            <div class="mt-4 space-y-2">
                <h4 class="font-medium text-gray-700 text-sm">Payment Summary by Location:</h4>
                <div id="paymentBreakdownSummary" class="grid grid-cols-2 gap-2 text-xs">
                    <!-- Populated dynamically -->
                </div>
            </div>

            <!-- Actions -->
            <div class="flex gap-3 mt-6">
                <button onclick="saveGolferPaymentSelections()" class="btn-primary flex-1">
                    <span class="material-symbols-outlined text-sm">check</span>
                    Confirm Selections
                </button>
                <button onclick="closeGolferPaymentModal()" class="btn-secondary flex-1">
                    Cancel
                </button>
            </div>

            <!-- Helper Text -->
            <div class="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-3">
                <div class="flex gap-2">
                    <span class="material-symbols-outlined text-blue-600 text-sm">info</span>
                    <p class="text-xs text-blue-900">
                        <strong>Important:</strong> Select where you prefer to pay each fee. This helps the organizer track payments.
                        You can pay at the society bar before the round, at the golf course directly, or to the organizer.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Payment Info Card (for registration page) -->
<div id="quickPaymentInfo" class="bg-gradient-to-br from-amber-50 to-amber-100 rounded-xl p-4 border border-amber-200 mb-4" style="display: none;">
    <div class="flex items-start gap-3">
        <span class="material-symbols-outlined text-amber-600 text-3xl">payments</span>
        <div class="flex-1">
            <h3 class="font-bold text-gray-900 mb-2">Payment Options</h3>
            <div class="space-y-2 text-sm">
                <div class="flex items-center gap-2">
                    <span class="material-symbols-outlined text-amber-600 text-sm">local_bar</span>
                    <span><strong>Society Bar:</strong> Pay before the round starts</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="material-symbols-outlined text-green-600 text-sm">golf_course</span>
                    <span><strong>Golf Course:</strong> Pay directly at the course</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="material-symbols-outlined text-purple-600 text-sm">person</span>
                    <span><strong>Organizer:</strong> Pay the event organizer</span>
                </div>
            </div>
            <button onclick="openGolferPaymentModal()" class="mt-3 btn-primary text-sm w-full">
                Set Payment Preferences
            </button>
        </div>
    </div>
</div>

<!-- Styles -->
<style>
.payment-selection-item {
    background: linear-gradient(to bottom right, #f9fafb, #f3f4f6);
    border: 1px solid #e5e7eb;
    border-radius: 0.75rem;
    padding: 1rem;
}

.payment-location-select {
    transition: all 0.2s ease;
    font-size: 0.875rem;
    font-weight: 500;
}

.payment-location-select:focus {
    outline: none;
}

.payment-location-select option {
    padding: 0.5rem;
}

#paymentBreakdownSummary > div {
    background-color: white;
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    padding: 0.5rem;
    text-align: center;
}

#paymentBreakdownSummary .location-badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
}

#paymentBreakdownSummary .badge-bar {
    background-color: #fef3c7;
    color: #92400e;
}

#paymentBreakdownSummary .badge-course {
    background-color: #d1fae5;
    color: #065f46;
}

#paymentBreakdownSummary .badge-organizer {
    background-color: #ddd6fe;
    color: #5b21b6;
}

/* Animations */
.payment-selection-item {
    animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.payment-location-select:hover {
    border-color: #0ea5e9;
    box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
}
</style>

<!-- JavaScript for Payment Selection -->
<script>
// Global state for payment selection
let golferPaymentState = {
    eventId: null,
    registrationId: null,
    eventData: null,
    wantTransport: false,
    wantCompetition: false
};

/**
 * Open golfer payment modal
 */
function openGolferPaymentModal() {
    // Show modal
    document.getElementById('golferPaymentModal').style.display = 'flex';

    // Populate event data
    populatePaymentForm();

    // Show quick info
    document.getElementById('quickPaymentInfo').style.display = 'block';
}

/**
 * Populate payment form with event data
 */
function populatePaymentForm() {
    const event = golferPaymentState.eventData;
    if (!event) return;

    // Set event details
    document.getElementById('paymentEventTitle').textContent = event.name;
    document.getElementById('paymentEventInfo').textContent = event.date;

    // Set fee amounts
    document.getElementById('greenFeeAmount').textContent = `฿${event.baseFee.toLocaleString()}`;
    document.getElementById('cartFeeAmount').textContent = `฿${event.cartFee.toLocaleString()}`;
    document.getElementById('caddyFeeAmount').textContent = `฿${event.caddyFee.toLocaleString()}`;

    // Show/hide optional fees
    if (golferPaymentState.wantTransport && event.transportFee > 0) {
        document.getElementById('transportFeeSection').style.display = 'block';
        document.getElementById('transportFeeAmount').textContent = `฿${event.transportFee.toLocaleString()}`;
    } else {
        document.getElementById('transportFeeSection').style.display = 'none';
    }

    if (golferPaymentState.wantCompetition && event.competitionFee > 0) {
        document.getElementById('competitionFeeSection').style.display = 'block';
        document.getElementById('competitionFeeAmount').textContent = `฿${event.competitionFee.toLocaleString()}`;
    } else {
        document.getElementById('competitionFeeSection').style.display = 'none';
    }

    // Calculate total
    updateTotalAmount();

    // Add change listeners
    ['payGreenAt', 'payCartAt', 'payCaddyAt', 'payTransportAt', 'payCompetitionAt'].forEach(id => {
        const select = document.getElementById(id);
        if (select) {
            select.addEventListener('change', updatePaymentBreakdown);
        }
    });
}

/**
 * Update total amount display
 */
function updateTotalAmount() {
    const event = golferPaymentState.eventData;
    if (!event) return;

    let total = event.baseFee + event.cartFee + event.caddyFee;

    if (golferPaymentState.wantTransport) {
        total += event.transportFee;
    }

    if (golferPaymentState.wantCompetition) {
        total += event.competitionFee;
    }

    document.getElementById('totalPaymentAmount').textContent = `฿${total.toLocaleString()}`;
}

/**
 * Update payment breakdown summary
 */
function updatePaymentBreakdown() {
    const event = golferPaymentState.eventData;
    if (!event) return;

    const breakdown = {
        bar: 0,
        course: 0,
        organizer: 0
    };

    // Green fee
    const payGreenAt = document.getElementById('payGreenAt').value;
    if (payGreenAt && breakdown[payGreenAt] !== undefined) {
        breakdown[payGreenAt] += event.baseFee;
    }

    // Cart fee
    const payCartAt = document.getElementById('payCartAt').value;
    if (payCartAt && breakdown[payCartAt] !== undefined) {
        breakdown[payCartAt] += event.cartFee;
    }

    // Caddy fee
    const payCaddyAt = document.getElementById('payCaddyAt').value;
    if (payCaddyAt && breakdown[payCaddyAt] !== undefined) {
        breakdown[payCaddyAt] += event.caddyFee;
    }

    // Transport fee
    if (golferPaymentState.wantTransport) {
        const payTransportAt = document.getElementById('payTransportAt').value;
        if (payTransportAt && breakdown[payTransportAt] !== undefined) {
            breakdown[payTransportAt] += event.transportFee;
        }
    }

    // Competition fee
    if (golferPaymentState.wantCompetition) {
        const payCompetitionAt = document.getElementById('payCompetitionAt').value;
        if (payCompetitionAt && breakdown[payCompetitionAt] !== undefined) {
            breakdown[payCompetitionAt] += event.competitionFee;
        }
    }

    // Render breakdown
    const container = document.getElementById('paymentBreakdownSummary');
    const labels = {
        bar: 'Society Bar',
        course: 'Golf Course',
        organizer: 'Organizer'
    };

    container.innerHTML = Object.entries(breakdown)
        .filter(([_, amount]) => amount > 0)
        .map(([location, amount]) => `
            <div>
                <div class="location-badge badge-${location}">${labels[location]}</div>
                <div class="font-bold text-gray-900">฿${amount.toLocaleString()}</div>
            </div>
        `).join('');
}

/**
 * Save golfer payment selections
 */
async function saveGolferPaymentSelections() {
    try {
        // Validate all selections are made
        const payGreenAt = document.getElementById('payGreenAt').value;
        const payCartAt = document.getElementById('payCartAt').value;
        const payCaddyAt = document.getElementById('payCaddyAt').value;

        if (!payGreenAt || !payCartAt || !payCaddyAt) {
            NotificationManager.show('Please select payment location for all required fees', 'error');
            return;
        }

        // Get optional selections
        let payTransportAt = null;
        let payCompetitionAt = null;

        if (golferPaymentState.wantTransport) {
            payTransportAt = document.getElementById('payTransportAt').value;
            if (!payTransportAt) {
                NotificationManager.show('Please select payment location for transport fee', 'error');
                return;
            }
        }

        if (golferPaymentState.wantCompetition) {
            payCompetitionAt = document.getElementById('payCompetitionAt').value;
            if (!payCompetitionAt) {
                NotificationManager.show('Please select payment location for competition fee', 'error');
                return;
            }
        }

        // Save preferences (this will be called after registration is created)
        golferPaymentState.preferences = {
            payGreenAt,
            payCartAt,
            payCaddyAt,
            payTransportAt,
            payCompetitionAt
        };

        NotificationManager.show('Payment preferences saved', 'success');
        closeGolferPaymentModal();

        // If callback exists, call it
        if (window.onPaymentPreferencesSaved) {
            window.onPaymentPreferencesSaved(golferPaymentState.preferences);
        }
    } catch (error) {
        console.error('[GolferPayment] Error saving selections:', error);
        NotificationManager.show('Failed to save payment preferences', 'error');
    }
}

/**
 * Close golfer payment modal
 */
function closeGolferPaymentModal() {
    document.getElementById('golferPaymentModal').style.display = 'none';
}
</script>
