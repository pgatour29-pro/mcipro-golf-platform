<!DOCTYPE html>
<html>
<head>
    <title>Fix Ryan Thomas & Pluto Handicaps</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 900px; margin: 0 auto; }
        button { padding: 10px 20px; font-size: 16px; margin: 5px; cursor: pointer; }
        pre { background: #f0f0f0; padding: 15px; border-radius: 5px; white-space: pre-wrap; max-height: 500px; overflow-y: auto; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        h2 { margin-top: 30px; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
    </style>
</head>
<body>
    <h1>Fix Ryan Thomas & Pluto Handicaps</h1>
    <p><strong>Task:</strong> Find them in society_members, create universal handicap = 0</p>
    <p><strong>Current:</strong> Society handicap = +1.6 (stored as -1.6)</p>

    <h2>Step 1: Search All Tables</h2>
    <button id="searchBtn">Search for Ryan Thomas & Pluto</button>

    <h2>Step 2: Fix Handicaps (after finding IDs)</h2>
    <button id="fixBtn" disabled>Create Universal Handicap = 0</button>

    <h2>Output</h2>
    <pre id="output"></pre>

    <script>
        const db = window.supabase.createClient(
            'https://pyeeplwsnupmhgbguwqs.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB5ZWVwbHdzbnVwbWhnYmd1d3FzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk4NDM2NjksImV4cCI6MjA3NTQxOTY2OX0.KVQ6WvDKz9s77lxn3AhSA_YTMCN6rsht9kDkMIDhngk'
        );

        const TRGG_SOCIETY_ID = '7c0e4b72-d925-44bc-afda-38259a7ba346';
        let ryanId = null;
        let plutoId = null;

        function log(msg, type = '') {
            const span = document.createElement('span');
            span.className = type;
            span.textContent = msg + '\n';
            document.getElementById('output').appendChild(span);
            console.log(msg);
        }

        function clearLog() {
            document.getElementById('output').innerHTML = '';
        }

        // Step 1: Find and fix Ryan & Pluto
        document.getElementById('searchBtn').addEventListener('click', async function() {
            this.disabled = true;
            clearLog();

            log('Creating universal handicap = 0 for TRGG-GUEST-1002 (Ryan/Pluto with +1.6)...', 'info');

            // TRGG-GUEST-1002 has -1.6 (which is +1.6 handicap)
            const golferId = 'TRGG-GUEST-1002';

            // Delete existing universal if any
            await db.from('society_handicaps')
                .delete()
                .eq('golfer_id', golferId)
                .is('society_id', null);

            // Insert universal = 0
            const { error } = await db.from('society_handicaps')
                .insert({
                    golfer_id: golferId,
                    society_id: null,
                    handicap_index: 0,
                    calculation_method: 'MANUAL',
                    last_calculated_at: new Date().toISOString()
                });

            if (error) {
                log('Error: ' + error.message, 'error');
            } else {
                log('✓ Created universal handicap = 0 for ' + golferId, 'success');
            }

            // Verify
            const { data: verify } = await db
                .from('society_handicaps')
                .select('*')
                .eq('golfer_id', golferId);

            log('\nCurrent handicaps for ' + golferId + ':');
            for (const h of (verify || [])) {
                const label = h.society_id === null ? 'Universal' : 'Society (TRGG)';
                log('  ' + label + ': ' + h.handicap_index, 'success');
            }

            log('\nNOTE: Only found ONE player with -1.6. If Pluto is different, tell me their golfer_id.', 'info');

            this.disabled = false;
        });

        // Step 2: Create universal handicaps
        document.getElementById('fixBtn').addEventListener('click', async function() {
            this.disabled = true;
            log('\n=== CREATING UNIVERSAL HANDICAPS ===\n', 'info');

            if (ryanId) {
                log('Creating universal handicap for Ryan Thomas (ID: ' + ryanId + ')...');

                // Delete existing universal if any
                await db.from('society_handicaps')
                    .delete()
                    .eq('golfer_id', ryanId)
                    .is('society_id', null);

                // Insert universal = 0
                const { error } = await db.from('society_handicaps')
                    .insert({
                        golfer_id: ryanId,
                        society_id: null,
                        handicap_index: 0,
                        calculation_method: 'MANUAL',
                        last_calculated_at: new Date().toISOString()
                    });

                if (error) {
                    log('  Error: ' + error.message, 'error');
                } else {
                    log('  ✓ Ryan Thomas universal handicap = 0', 'success');
                }
            }

            if (plutoId) {
                log('Creating universal handicap for Pluto (ID: ' + plutoId + ')...');

                // Delete existing universal if any
                await db.from('society_handicaps')
                    .delete()
                    .eq('golfer_id', plutoId)
                    .is('society_id', null);

                // Insert universal = 0
                const { error } = await db.from('society_handicaps')
                    .insert({
                        golfer_id: plutoId,
                        society_id: null,
                        handicap_index: 0,
                        calculation_method: 'MANUAL',
                        last_calculated_at: new Date().toISOString()
                    });

                if (error) {
                    log('  Error: ' + error.message, 'error');
                } else {
                    log('  ✓ Pluto universal handicap = 0', 'success');
                }
            }

            // Verify
            log('\n=== VERIFICATION ===', 'info');

            if (ryanId) {
                const { data: ryanHcps } = await db
                    .from('society_handicaps')
                    .select('society_id, handicap_index')
                    .eq('golfer_id', ryanId);

                log('\nRyan Thomas handicaps:');
                for (const h of (ryanHcps || [])) {
                    const label = h.society_id === null ? 'Universal' : 'Society';
                    log('  ' + label + ': ' + h.handicap_index);
                }
            }

            if (plutoId) {
                const { data: plutoHcps } = await db
                    .from('society_handicaps')
                    .select('society_id, handicap_index')
                    .eq('golfer_id', plutoId);

                log('\nPluto handicaps:');
                for (const h of (plutoHcps || [])) {
                    const label = h.society_id === null ? 'Universal' : 'Society';
                    log('  ' + label + ': ' + h.handicap_index);
                }
            }

            log('\n✓ DONE!', 'success');
        });
    </script>
</body>
</html>
