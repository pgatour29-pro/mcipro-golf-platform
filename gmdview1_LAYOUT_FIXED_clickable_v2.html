<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GM Operations — Enhanced Analytics Center</title>
<style>
:root{--brand:#0ea5e9;--success:#10b981;--warning:#f59e0b;--danger:#ef4444;--text-strong:#111827;--text-subtle:#6b7280;--border-subtle:#e5e7eb;--card-bg:#ffffff;--shadow-sm:0 1px 2px rgba(0,0,0,.06);--shadow-md:0 4px 6px -1px rgba(0,0,0,.1);--gradient-bg:linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)}
*{box-sizing:border-box}
body{margin:0;background:var(--gradient-bg);color:#111827;font:14px/1.4 ui-sans-serif,system-ui,-apple-system;min-height:100vh}

.module{max-width:1280px;margin:24px auto;padding:16px}
.header-row{display:flex;align-items:center;gap:12px;justify-content:space-between;margin-bottom:16px}
.controls{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
select,button,input{font:inherit}
.lang-select,.date-select{padding:6px 10px;border:1px solid var(--border-subtle);border-radius:10px;background:#fff}

.status{padding:6px 10px;border:1px solid var(--border-subtle);border-radius:10px;background:#ecfdf5;color:#065f46;position:relative}
.status.ai-enhanced{background:linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);color:#1e40af;border-color:#3b82f6}
.status.ai-enhanced::before{content:'🧠';margin-right:6px}

.ai-learning-indicator{position:fixed;top:20px;right:20px;background:var(--brand);color:white;padding:8px 16px;border-radius:20px;font-size:12px;font-weight:600;z-index:1000;animation:float 3s ease-in-out infinite;box-shadow:var(--shadow-md)}

@keyframes float{0%,100%{transform:translateY(0px)}50%{transform:translateY(-5px)}}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.8;transform:scale(1.02)}}

.module-tabs{display:flex;gap:8px;margin:10px 0 16px;flex-wrap:wrap}
.module-tab{padding:8px 12px;border:1px solid var(--border-subtle);border-radius:10px;cursor:pointer;background:#f1f5f9;transition:all 0.2s ease}
.module-tab.active{background:#fff;box-shadow:inset 0 0 0 1px var(--brand)}
.module-tab:hover{background:#e2e8f0}

.module-content{display:none}
.module-content.active{display:block}

.kpi-row{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:12px;margin-bottom:12px}
.metric-card{border:1px solid var(--border-subtle);border-radius:14px;background:var(--card-bg);padding:14px;box-shadow:var(--shadow-sm);cursor:pointer;transition:all 0.3s ease;position:relative;overflow:hidden}
.metric-card:hover{transform:translateY(-2px);box-shadow:var(--shadow-md)}
.metric-card.ai-enhanced{border-color:#3b82f6}
.metric-card.ai-enhanced::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--brand),#3b82f6,var(--success));animation:pulse 2s infinite}

.metric-value{font-weight:700;font-size:1.5rem}
.metric-label{color:#475569;font-size:.875rem}
.metric-change{font-size:.85rem}
.metric-change.up{color:var(--success)}.metric-change.down{color:var(--danger)}
.metric-confidence{font-size:0.75rem;color:var(--brand);background:rgba(59,130,246,0.1);padding:2px 6px;border-radius:8px;margin-top:4px;display:inline-block}

.card{border:1px solid var(--border-subtle);border-radius:14px;padding:14px;background:#fff;box-shadow:var(--shadow-sm);margin-bottom:12px}
.section-title{font-size:1.1rem;font-weight:700;margin:8px 0 12px}
.btn{padding:8px 12px;border:1px solid var(--border-subtle);border-radius:10px;background:#fff;cursor:pointer;transition:all 0.2s ease}
.btn:hover{background:#f8fafc}
.btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
.btn.primary:hover{background:#0284c7}

.small{font-size:.85rem;color:#64748b}
.revenue-breakdown{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}
.revenue-item{border:1px dashed var(--border-subtle);border-radius:12px;padding:10px;cursor:pointer;transition:all 0.2s ease}
.revenue-item:hover{border-color:var(--brand);background:#f8fafc}
.revenue-amount{font-weight:700}

.ai-decision-log{background:#fff;border:1px solid var(--border-subtle);border-radius:12px;padding:16px;margin-bottom:12px}
.decision-item{display:flex;align-items:center;gap:12px;padding:8px 0;border-bottom:1px solid #f1f5f9}
.decision-item:last-child{border-bottom:none}
.decision-time{font-size:11px;color:var(--brand);min-width:45px;font-weight:600}
.decision-text{flex:1;font-size:13px;color:var(--text-strong)}
.decision-impact{font-size:11px;color:var(--success);font-weight:600;background:rgba(16,185,129,0.1);padding:3px 8px;border-radius:12px}

.alerts-container{background:#fff;border:1px solid var(--border-subtle);border-radius:12px;padding:16px;margin-bottom:12px}
.alert-item{display:flex;align-items:center;gap:12px;padding:12px;border-radius:8px;margin-bottom:8px;transition:all 0.2s ease}
.alert-item.critical{background:rgba(239,68,68,0.05);border:1px solid rgba(239,68,68,0.2)}
.alert-item.warning{background:rgba(245,158,11,0.05);border:1px solid rgba(245,158,11,0.2)}
.alert-item.opportunity{background:rgba(16,185,129,0.05);border:1px solid rgba(16,185,129,0.2)}
.alert-icon{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:white;flex-shrink:0}
.alert-icon.critical{background:var(--danger)}
.alert-icon.warning{background:var(--warning)}
.alert-icon.opportunity{background:var(--success)}
.alert-content{flex:1}
.alert-title{font-weight:600;margin-bottom:4px;color:var(--text-strong)}
.alert-description{font-size:12px;color:var(--text-subtle);line-height:1.3}
.alert-action{background:var(--brand);color:white;border:none;padding:6px 12px;border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;transition:all 0.2s ease}
.alert-action:hover{background:#0284c7}

.ai-analysis-panel{background:#fff;border:1px solid var(--border-subtle);border-radius:12px;padding:16px;margin-bottom:12px}
.ai-analysis-title{font-size:14px;font-weight:600;margin-bottom:8px;display:flex;align-items:center;gap:6px;color:var(--brand)}
.ai-analysis-content{font-size:13px;line-height:1.4;color:var(--text-subtle)}

.model-performance{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-bottom:12px}
.model-card{border:1px solid var(--border-subtle);border-radius:10px;background:#fff;padding:12px;text-align:center}
.model-name{font-size:12px;font-weight:600;color:var(--text-strong);margin-bottom:6px}
.model-accuracy{font-size:20px;font-weight:800;color:var(--brand);margin-bottom:4px}
.model-status{font-size:10px;color:var(--success);font-weight:600;text-transform:uppercase;letter-spacing:0.5px}

.weather-widget{background:#f8fafc;border:1px solid var(--border-subtle);border-radius:12px;padding:16px;margin-bottom:12px}
.weather-current{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.weather-temp{font-size:24px;font-weight:700;color:var(--text-strong)}
.weather-condition{font-size:14px;color:var(--text-subtle);font-weight:500}
.weather-impact{font-size:12px;color:var(--warning);background:rgba(245,158,11,0.1);padding:6px 10px;border-radius:6px;font-weight:600}

.toast{position:fixed;right:16px;bottom:16px;background:#111827;color:#fff;padding:10px 12px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.25);z-index:99999}
.drawer{position:fixed;top:0;right:-540px;width:540px;height:100vh;background:#fff;border-left:1px solid var(--border-subtle);box-shadow:-10px 0 30px rgba(0,0,0,.08);transition:right .25s ease;z-index:9999;display:flex;flex-direction:column}
.drawer.open{right:0}

/* Live Course Traffic Styles */
.pace-fast{background:#dcfce7;color:#166534}
.pace-normal{background:#dbeafe;color:#1e40af}
.pace-slow{background:#fef3c7;color:#92400e}
.pace-very-slow{background:#fee2e2;color:#dc2626}
.drawer-header{padding:14px;border-bottom:1px solid var(--border-subtle);display:flex;align-items:center;justify-content:space-between}
.drawer-body{padding:14px;overflow:auto}
.input,.select{width:100%;padding:8px 10px;border:1px solid var(--border-subtle);border-radius:10px;background:#fff}
.table{width:100%;border-collapse:collapse;margin:8px 0}
.table th,.table td{border-bottom:1px solid #eef2f7;padding:8px 6px;text-align:left}
.grid{display:grid;gap:12px}
.grid-2{grid-template-columns:repeat(2,minmax(0,1fr))}
.share-box{border:1px dashed var(--border-subtle);border-radius:12px;padding:10px}
.checkbox{display:flex;gap:8px;align-items:center}
.footer{margin-top:auto;padding:12px;border-top:1px solid #eef2f7;display:flex;gap:8px;justify-content:flex-end}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--border-subtle);background:#fff;font-size:.75rem;color:#334155}

.weather-radar-container{width:100%;height:300px;border:1px solid var(--border-subtle);border-radius:12px;overflow:hidden;margin-bottom:16px;position:relative}
.weather-radar-map{width:100%;height:100%;background:linear-gradient(135deg,#0f172a 0%,#1e293b 50%,#334155 100%);position:relative;overflow:hidden}
.map-grid{position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(rgba(59,130,246,0.1) 1px,transparent 1px),linear-gradient(90deg,rgba(59,130,246,0.1) 1px,transparent 1px);background-size:30px 30px;pointer-events:none}
.geo-markers{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}
.geo-marker{position:absolute;transform:translate(-50%,-50%);text-align:center;z-index:5}
.marker-icon{font-size:16px;margin-bottom:2px;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.5))}
.marker-label{font-size:9px;color:white;background:rgba(0,0,0,0.7);padding:2px 6px;border-radius:4px;white-space:nowrap;font-weight:600}
.course-location .marker-icon{font-size:20px;animation:courseBeacon 2s ease-in-out infinite}
.competitor-marker .marker-icon{color:#f59e0b}
@keyframes courseBeacon{0%,100%{transform:scale(1);filter:drop-shadow(0 0 5px rgba(59,130,246,0.5))}50%{transform:scale(1.1);filter:drop-shadow(0 0 15px rgba(59,130,246,0.8))}}
.precipitation-overlay{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:3}
.precip-cell{position:absolute;border-radius:8px;animation:precipPulse 2s ease-in-out infinite;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:white;text-shadow:0 1px 2px rgba(0,0,0,0.8);border:2px solid rgba(255,255,255,0.3)}
.precip-cell.light{background:rgba(34,197,94,0.7);box-shadow:0 0 20px rgba(34,197,94,0.4)}
.precip-cell.moderate{background:rgba(251,191,36,0.8);box-shadow:0 0 25px rgba(251,191,36,0.5)}
.precip-cell.heavy{background:rgba(239,68,68,0.9);box-shadow:0 0 30px rgba(239,68,68,0.6)}
@keyframes precipPulse{0%,100%{opacity:0.8;box-shadow:0 0 20px currentColor}50%{opacity:1;box-shadow:0 0 40px currentColor}}
.movement-arrow{position:absolute;top:50%;left:50%;font-size:14px;font-weight:900;color:white;text-shadow:0 0 6px rgba(0,0,0,0.8);animation:arrowPulse 1.5s ease-in-out infinite;transform:translate(-50%,-50%)}
.movement-arrow::before{content:'↗'}
.movement-arrow.se::before{transform:rotate(135deg);display:inline-block}
.movement-arrow.e::before{transform:rotate(90deg);display:inline-block}
@keyframes arrowPulse{0%,100%{opacity:0.7}50%{opacity:1;transform:translate(-50%,-50%) scale(1.2)}}
.radar-sweep{position:absolute;top:50%;left:50%;width:2px;height:50%;background:linear-gradient(to top,var(--brand),transparent);transform-origin:bottom;animation:radarSweep 4s linear infinite;box-shadow:0 0 10px var(--brand);z-index:4}
@keyframes radarSweep{0%{transform:translate(-50%,-100%) rotate(0deg)}100%{transform:translate(-50%,-100%) rotate(360deg)}}
.competitor-table-container{overflow-x:auto;margin-top:12px}
.optimization-control{display:flex;align-items:center;justify-content:space-between;padding:12px;background:var(--card-bg);border:1px solid var(--border-subtle);border-radius:8px;margin-bottom:8px;transition:all 0.2s ease}
.optimization-control:hover{border-color:var(--brand)}
.control-toggle{width:44px;height:24px;background:var(--text-subtle);border-radius:12px;position:relative;cursor:pointer;transition:all 0.2s ease}
.control-toggle.active{background:var(--success)}
.control-toggle::after{content:'';position:absolute;top:2px;left:2px;width:20px;height:20px;background:white;border-radius:50%;transition:all 0.2s ease}
.control-toggle.active::after{transform:translateX(20px)}
.activity-feed{max-height:200px;overflow-y:auto}
.activity-item{display:flex;align-items:center;gap:12px;padding:8px 0;border-bottom:1px solid var(--border-subtle)}
.activity-item:last-child{border-bottom:none}
.activity-time{font-size:11px;color:var(--brand);min-width:40px;font-weight:600}
.activity-text{font-size:12px;flex:1;color:var(--text-strong)}

@media print{.controls,.module-tabs,.drawer,.toast,.ai-learning-indicator{display:none!important} .card,.metric-card{break-inside:avoid} body{background:#fff}}
@media (max-width: 768px){.kpi-row{grid-template-columns:repeat(2,minmax(0,1fr))}.module{padding:8px}}
</style>
<style>
/* BLUE CHIP LABELS FOR MAP MARKERS (scoped to radar map) */
.weather-radar-map .geo-marker .marker-label{
  background: rgba(24,119,242,.95);
  color: #fff;
  border: 1px solid rgba(255,255,255,.25);
  border-radius: 10px;
  padding: 3px 8px;
  line-height: 1.2;
  box-shadow: 0 2px 6px rgba(0,0,0,.25);
  white-space: nowrap;
}
</style>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/prop-types@15.8.1/prop-types.js"></script>
<script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
#daily-dashboard-root, #elite-root { overflow: visible !important; }
#daily-dashboard-root .min-h-screen { min-height: auto !important; }
#daily-dashboard-root .sticky { position: static !important; }
</style>

<style>
/* === AI Tab Reposition (fixed top-right) === */
.ai-learning-indicator{
  position: fixed !important;
  top: 8px !important;
  right: 12px !important;
  z-index: 11000 !important; /* above drawer/backdrop */
}
.ai-learning-indicator * { pointer-events: auto; }
</style>
</head>
<body>
  <!-- AI Learning Indicator -->
  <div class="ai-learning-indicator" id="ai-learning">
    🧠 AI Learning: 94.7%
  </div>

<div class="module" id="gm-module">
  <div class="header-row">
    <h1 data-i18n="gmOps">GM Operations — Enhanced Analytics</h1>
    <div class="controls">
      <span class="status ai-enhanced" id="selftest">AI Engine Online</span>
      <select id="lang" class="lang-select" aria-label="Language">
        <option value="en">EN</option><option value="th">TH</option><option value="ko">KO</option><option value="ja">JA</option>
      </select>
      <select id="range" class="date-select" aria-label="Range">
        <option value="now" data-i18n="now">Now</option><option value="today" data-i18n="today">Today</option><option value="week" data-i18n="week">This Week</option><option value="month" data-i18n="month">This Month</option><option value="quarter" data-i18n="quarter">Quarter</option><option value="year" data-i18n="year">Year</option>
      </select>
      <button class="btn primary" id="gm-oneclick"><span data-i18n="refreshPublish">AI Refresh & Publish</span></button>
    </div>
  </div>

  <div class="module-tabs" id="tabs">
    <div class="module-tab active" data-module="revenue" data-i18n="tab_revenue">Revenue</div>
    <div class="module-tab" data-module="daily" data-i18n="tab_daily">Daily</div>
    <div class="module-tab" data-module="cash" data-i18n="tab_cash">Cash</div>
    <div class="module-tab" data-module="pace" data-i18n="tab_pace">Tee Sheet & Pace</div>
    <div class="module-tab" data-module="labor" data-i18n="tab_labor">Labor & Service</div>
    <div class="module-tab" data-module="retail" data-i18n="tab_retail">F&B / Retail</div>
    <div class="module-tab" data-module="members" data-i18n="tab_members">Membership & Events</div>
    <div class="module-tab" data-module="weather" data-i18n="tab_weather">Weather Intelligence</div>
    <div class="module-tab" data-module="aiperformance" data-i18n="tab_aiperformance">AI Performance</div>
    <div class="module-tab" data-module="risk" data-i18n="tab_risk">Risk & Compliance</div>
    <div class="module-tab" data-module="reports" data-i18n="tab_reports">Reports</div>
  </div>

  <!-- Revenue -->
  <div id="revenue" class="module-content active">
    <div class="kpi-row">
      <div class="metric-card ai-enhanced" data-drill="revenue_now">
        <div class="metric-value" data-kpi="revenue_now">฿0</div>
        <div class="metric-label" data-i18n="kpi_revenue_now">Revenue Now</div>
        <div class="metric-change up" data-kpi="revenue_change">+0%</div>
        <div class="metric-confidence">94% AI Confidence</div>
      </div>
      <div class="metric-card ai-enhanced" data-drill="eod_forecast">
        <div class="metric-value" data-kpi="eod_forecast">฿0</div>
        <div class="metric-label" data-i18n="kpi_eod_forecast">EoD AI Forecast</div>
        <div class="metric-confidence">91% Confidence</div>
      </div>
      <div class="metric-card ai-enhanced" data-drill="rev_per_round">
        <div class="metric-value" data-kpi="rev_per_round">฿0</div>
        <div class="metric-label" data-i18n="kpi_rev_per_round">Revenue / Round</div>
        <div class="metric-confidence">88% Confidence</div>
      </div>
      <div class="metric-card" data-drill="utilization">
        <div class="metric-value" data-kpi="utilization">0%</div>
        <div class="metric-label" data-i18n="kpi_utilization">Utilization</div>
      </div>
      <div class="metric-card ai-enhanced" data-drill="dyn_lift">
        <div class="metric-value" data-kpi="dyn_lift">฿0</div>
        <div class="metric-label" data-i18n="kpi_dyn_lift">Dynamic Pricing Lift</div>
        <div class="metric-confidence">96% Confidence</div>
      </div>
    </div>

    <div class="card">
      <div class="section-title" data-i18n="sec_rev_src">Revenue by Source</div>
      <div class="revenue-breakdown" id="rev-breakdown"></div>
    </div>

    <div class="ai-decision-log">
      <div class="section-title">🧠 Recent AI Decisions</div>
      <div class="decision-item">
        <div class="decision-time">14:23</div>
        <div class="decision-text">Auto-deployed +1 cart attendant based on guest flow prediction</div>
        <div class="decision-impact">+12% efficiency</div>
      </div>
      <div class="decision-item">
        <div class="decision-time">14:19</div>
        <div class="decision-text">Adjusted pricing for afternoon slots (+4% increase)</div>
        <div class="decision-impact">+฿18,400 revenue</div>
      </div>
      <div class="decision-item">
        <div class="decision-time">14:15</div>
        <div class="decision-text">Activated weather-based indoor promotions</div>
        <div class="decision-impact">+23% F&B</div>
      </div>
    </div>

    <div class="alerts-container">
      <div class="section-title">🚨 Intelligent Alerts</div>
      <div class="alert-item critical">
        <div class="alert-icon critical">⚠️</div>
        <div class="alert-content">
          <div class="alert-title">Critical: Cart Shortage Predicted</div>
          <div class="alert-description">AI forecasts 23% cart shortage at 14:15 based on booking patterns</div>
        </div>
        <button class="alert-action" onclick="handleAlert('cart-shortage')">Deploy Backup</button>
      </div>
      <div class="alert-item opportunity">
        <div class="alert-icon opportunity">💰</div>
        <div class="alert-content">
          <div class="alert-title">Revenue Opportunity: Dynamic Pricing</div>
          <div class="alert-description">Market window available for 6% increase with 94% retention probability</div>
        </div>
        <button class="alert-action" onclick="handleAlert('pricing-opportunity')">Optimize Pricing</button>
      </div>
    </div>

    <div class="card">
      <div class="section-title" data-i18n="sec_actions">AI Recommended Actions</div>
      <div id="action-queue" class="small">-</div>
    </div>
  </div>

  <!-- Daily -->
  <div id="daily" class="module-content">
    <div id="daily-dashboard-root" style="width: 100%; height:auto; min-height:auto;"></div>
  </div>

  <!-- Cash -->
  <div id="cash" class="module-content">
    <div class="kpi-row">
      <div class="metric-card" data-drill="opening_cash">
        <div class="metric-value" data-kpi="opening_cash">฿0</div>
        <div class="metric-label" data-i18n="kpi_opening_cash">Opening Cash</div>
      </div>
      <div class="metric-card ai-enhanced" data-drill="cash_in">
        <div class="metric-value" data-kpi="cash_in">฿0</div>
        <div class="metric-label" data-i18n="kpi_cash_in">Cash Inflows</div>
        <div class="metric-confidence">92% AI Tracking</div>
      </div>
      <div class="metric-card" data-drill="cash_out">
        <div class="metric-value" data-kpi="cash_out">฿0</div>
        <div class="metric-label" data-i18n="kpi_cash_out">Cash Outflows</div>
      </div>
      <div class="metric-card ai-enhanced" data-drill="deposits">
        <div class="metric-value" data-kpi="deposits">฿0</div>
        <div class="metric-label" data-i18n="kpi_deposits">Deposits</div>
        <div class="metric-confidence">89% Prediction</div>
      </div>
      <div class="metric-card" data-drill="cash_variance">
        <div class="metric-value" data-kpi="cash_variance">฿0</div>
        <div class="metric-label" data-i18n="kpi_cash_variance">Cash Variance</div>
      </div>
    </div>
    <div class="card">
      <div class="section-title" data-i18n="sec_deposit_plan">AI-Optimized Deposit Plan</div>
      <div id="deposit-plan" class="small">Auto-scheduling deposits at 14:30 and 16:30 based on cash flow predictions</div>
    </div>
  </div>

  <!-- Pace -->
  <div id="pace" class="module-content">
    <div class="kpi-row">
      <div class="metric-card ai-enhanced" data-drill="pace_p50">
        <div class="metric-value" data-kpi="pace_p50">0m</div>
        <div class="metric-label" data-i18n="kpi_pace_p50">Pace of Play (Median)</div>
        <div class="metric-confidence">95% Accuracy</div>
      </div>
      <div class="metric-card ai-enhanced" data-drill="pace_p90">
        <div class="metric-value" data-kpi="pace_p90">0m</div>
        <div class="metric-label" data-i18n="kpi_pace_p90">Pace 90% (AI Predicted)</div>
        <div class="metric-confidence">88% Confidence</div>
      </div>
      <div class="metric-card ai-enhanced" data-drill="no_show_risk">
        <div class="metric-value" data-kpi="no_show_risk">0%</div>
        <div class="metric-label" data-i18n="kpi_no_show">No-Show Risk (AI)</div>
        <div class="metric-confidence">93% Prediction</div>
      </div>
      <div class="metric-card" data-drill="waitlist_fill">
        <div class="metric-value" data-kpi="waitlist_fill">0%</div>
        <div class="metric-label" data-i18n="kpi_waitlist">Waitlist Fill</div>
      </div>
      <div class="metric-card" data-drill="rounds_today">
        <div class="metric-value" data-kpi="rounds_today">0</div>
        <div class="metric-label" data-i18n="kpi_rounds_today">Rounds Today</div>
      </div>
    </div>

    <div class="ai-analysis-panel">
      <div class="ai-analysis-title">🎯 AI Pace Control Analysis</div>
      <div class="ai-analysis-content">
        Current pace optimization is running 12% above baseline. AI recommends deploying marshal to hole 7 at 14:15 to prevent 18-minute delay formation. Staff deployment algorithm suggests +2 cart attendants for optimal guest experience.
      </div>
    </div>

    <!-- Live Course Traffic Module -->
    <div class="card" style="margin-top: 20px;">
      <div class="section-title" data-i18n="traffic_title">📍 Live Course Traffic Monitor</div>
      <div class="course-map" style="background:#f8fafc;border-radius:12px;padding:20px;margin-bottom:16px;">
        <div class="course-selector" style="margin-bottom:16px;display:flex;align-items:center;gap:12px;">
          <label for="courseSelect" style="font-weight:600;color:var(--text-subtle)" data-i18n="course_view">View:</label>
          <select id="courseSelect" class="lang-select" onchange="switchCourseView(this.value)">
            <option value="A" selected data-i18n="course_a">Course A (Holes 1-9)</option>
            <option value="B" data-i18n="course_b">Course B (Holes 1-9)</option>
            <option value="C" data-i18n="course_c">Course C (Holes 1-9)</option>
            <option value="D" data-i18n="course_d">Course D (Holes 1-9)</option>
            <option value="18" data-i18n="course_18">18 Hole Course</option>
          </select>
        </div>

        <div id="courseDisplay">
          <!-- Course A View (Default) -->
          <div id="courseA" class="course-view" style="display:block">
            <div style="text-align:center;margin-bottom:16px;font-weight:600;color:var(--text-subtle)">Course A</div>
            <div class="hole-layout" style="display:grid;grid-template-columns:repeat(9,1fr);gap:8px;margin-bottom:16px;">
              <div class="hole clear" data-hole="A1" onclick="showHoleDetails('A1', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">1</div>
              <div class="hole clear" data-hole="A2" onclick="showHoleDetails('A2', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">2</div>
              <div class="hole busy" data-hole="A3" onclick="showHoleDetails('A3', 'Johnson Group (4)', 'normal')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#fef3c7;color:#92400e;">3</div>
              <div class="hole backed-up" data-hole="A4" onclick="showHoleDetails('A4', 'Smith Group (4)', 'slow')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#fee2e2;color:#dc2626;">4</div>
              <div class="hole backed-up" data-hole="A5" onclick="showHoleDetails('A5', 'Corporate (12)', 'very-slow')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#fee2e2;color:#dc2626;">5</div>
              <div class="hole busy" data-hole="A6" onclick="showHoleDetails('A6', 'Williams Group (2)', 'normal')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#fef3c7;color:#92400e;">6</div>
              <div class="hole clear" data-hole="A7" onclick="showHoleDetails('A7', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">7</div>
              <div class="hole clear" data-hole="A8" onclick="showHoleDetails('A8', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">8</div>
              <div class="hole clear" data-hole="A9" onclick="showHoleDetails('A9', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">9</div>
            </div>
          </div>

          <!-- Course B View -->
          <div id="courseB" class="course-view" style="display:none">
            <div style="text-align:center;margin-bottom:16px;font-weight:600;color:var(--text-subtle)">Course B</div>
            <div class="hole-layout" style="display:grid;grid-template-columns:repeat(9,1fr);gap:8px;margin-bottom:16px;">
              <div class="hole clear" data-hole="B1" onclick="showHoleDetails('B1', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">1</div>
              <div class="hole clear" data-hole="B2" onclick="showHoleDetails('B2', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">2</div>
              <div class="hole clear" data-hole="B3" onclick="showHoleDetails('B3', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">3</div>
              <div class="hole busy" data-hole="B4" onclick="showHoleDetails('B4', 'Thompson Group (4)', 'normal')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#fef3c7;color:#92400e;">4</div>
              <div class="hole busy" data-hole="B5" onclick="showHoleDetails('B5', 'Lee Group (3)', 'normal')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#fef3c7;color:#92400e;">5</div>
              <div class="hole clear" data-hole="B6" onclick="showHoleDetails('B6', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">6</div>
              <div class="hole clear" data-hole="B7" onclick="showHoleDetails('B7', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">7</div>
              <div class="hole clear" data-hole="B8" onclick="showHoleDetails('B8', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">8</div>
              <div class="hole clear" data-hole="B9" onclick="showHoleDetails('B9', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">9</div>
            </div>
          </div>

          <!-- 18 Hole View -->
          <div id="course18" class="course-view" style="display:none">
            <div style="text-align:center;margin:24px 0 16px 0;font-weight:600;color:var(--text-subtle)">Front Nine</div>
            <div class="hole-layout" style="display:grid;grid-template-columns:repeat(9,1fr);gap:8px;margin-bottom:16px;">
              <div class="hole clear" data-hole="1" onclick="showHoleDetails('1', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">1</div>
              <div class="hole clear" data-hole="2" onclick="showHoleDetails('2', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">2</div>
              <div class="hole busy" data-hole="3" onclick="showHoleDetails('3', 'Johnson Group (4)', 'normal')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#fef3c7;color:#92400e;">3</div>
              <div class="hole backed-up" data-hole="4" onclick="showHoleDetails('4', 'Smith Group (4)', 'slow')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#fee2e2;color:#dc2626;">4</div>
              <div class="hole backed-up" data-hole="5" onclick="showHoleDetails('5', 'Corporate (12)', 'very-slow')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#fee2e2;color:#dc2626;">5</div>
              <div class="hole busy" data-hole="6" onclick="showHoleDetails('6', 'Williams Group (2)', 'normal')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#fef3c7;color:#92400e;">6</div>
              <div class="hole clear" data-hole="7" onclick="showHoleDetails('7', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">7</div>
              <div class="hole clear" data-hole="8" onclick="showHoleDetails('8', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">8</div>
              <div class="hole clear" data-hole="9" onclick="showHoleDetails('9', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">9</div>
            </div>
            <div style="text-align:center;margin:24px 0 16px 0;font-weight:600;color:var(--text-subtle)">Back Nine</div>
            <div class="hole-layout" style="display:grid;grid-template-columns:repeat(9,1fr);gap:8px;margin-bottom:16px;">
              <div class="hole clear" data-hole="10" onclick="showHoleDetails('10', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">10</div>
              <div class="hole clear" data-hole="11" onclick="showHoleDetails('11', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">11</div>
              <div class="hole clear" data-hole="12" onclick="showHoleDetails('12', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">12</div>
              <div class="hole busy" data-hole="13" onclick="showHoleDetails('13', 'Thompson Group (4)', 'normal')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#fef3c7;color:#92400e;">13</div>
              <div class="hole busy" data-hole="14" onclick="showHoleDetails('14', 'Lee Group (3)', 'normal')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#fef3c7;color:#92400e;">14</div>
              <div class="hole clear" data-hole="15" onclick="showHoleDetails('15', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">15</div>
              <div class="hole clear" data-hole="16" onclick="showHoleDetails('16', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">16</div>
              <div class="hole clear" data-hole="17" onclick="showHoleDetails('17', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">17</div>
              <div class="hole clear" data-hole="18" onclick="showHoleDetails('18', 'Available', 'clear')" style="width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;transition:all 0.2s;border:2px solid transparent;background:#dcfce7;color:#166534;">18</div>
            </div>
          </div>
        </div>

        <div style="display:flex;gap:16px;align-items:center;justify-content:center;margin-top:16px;flex-wrap:wrap;">
          <div style="display:flex;align-items:center;gap:6px;font-size:0.75rem;"><div style="width:12px;height:12px;border-radius:50%;background:#dcfce7;"></div><span>Clear</span></div>
          <div style="display:flex;align-items:center;gap:6px;font-size:0.75rem;"><div style="width:12px;height:12px;border-radius:50%;background:#fef3c7;"></div><span>Busy</span></div>
          <div style="display:flex;align-items:center;gap:6px;font-size:0.75rem;"><div style="width:12px;height:12px;border-radius:50%;background:#fee2e2;"></div><span>Backed Up</span></div>
        </div>
      </div>

      <div id="holeDetails" style="background:#f8fafc;border-radius:8px;padding:16px;margin-top:16px;min-height:100px;">
        <div style="text-align:center;padding:20px;color:var(--text-subtle)">
          <div style="font-size:2rem;margin-bottom:8px">⛳</div>
          <div data-i18n="select_hole">Select a hole to view details</div>
        </div>
      </div>
    </div>

    <!-- Pace Monitoring Section -->
    <div class="card" style="margin-top: 20px;">
      <div class="section-title" data-i18n="pace_monitor">⏱️ Live Pace Monitoring</div>
      <div style="margin-bottom:16px">
        <div style="padding:12px;border-radius:8px;margin-bottom:12px;border-left:4px solid var(--warning);background:rgba(245,158,11,0.1);">
          <div style="font-weight:600;color:var(--warning);margin-bottom:4px;" data-i18n="pace_alert_title">Pace Alert</div>
          <div style="font-size:0.875rem;color:var(--text-strong)" data-i18n="pace_behind">Hole 5 - Corporate group 15 min behind</div>
          <button class="btn" style="margin-top:8px;padding:6px 12px;font-size:0.75rem;background:var(--warning);color:white;" onclick="sendPaceAlert('5')" data-i18n="send_alert_btn">Send Alert</button>
        </div>
      </div>
      <div style="overflow-x:auto;">
        <table style="width:100%;border-collapse:collapse;">
          <thead>
            <tr style="background:#f8fafc;">
              <th style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-weight:600;font-size:0.75rem;" data-i18n="group_col">Group</th>
              <th style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-weight:600;font-size:0.75rem;" data-i18n="hole_col">Hole</th>
              <th style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-weight:600;font-size:0.75rem;" data-i18n="pace_col">Pace</th>
              <th style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-weight:600;font-size:0.75rem;" data-i18n="action_col">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-size:0.875rem;">Smith Group (4)</td>
              <td style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-size:0.875rem;">4th</td>
              <td style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-size:0.875rem;"><span style="padding:4px 8px;border-radius:6px;font-size:0.75rem;font-weight:600;background:rgba(245,158,11,0.1);color:#92400e;">-8 min</span></td>
              <td style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-size:0.875rem;"><button class="btn" style="padding:4px 8px;font-size:0.7rem;" onclick="contactGroup('Smith Group')" data-i18n="contact_btn">Contact</button></td>
            </tr>
            <tr>
              <td style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-size:0.875rem;">Corporate (12)</td>
              <td style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-size:0.875rem;">5th</td>
              <td style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-size:0.875rem;"><span style="padding:4px 8px;border-radius:6px;font-size:0.75rem;font-weight:600;background:rgba(239,68,68,0.1);color:#dc2626;">-15 min</span></td>
              <td style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-size:0.875rem;"><button class="btn" style="padding:4px 8px;font-size:0.7rem;background:var(--warning);color:white;" onclick="deployRanger('5')" data-i18n="ranger_btn">Send Ranger</button></td>
            </tr>
            <tr>
              <td style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-size:0.875rem;">Johnson Group (4)</td>
              <td style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-size:0.875rem;">3rd</td>
              <td style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-size:0.875rem;"><span style="padding:4px 8px;border-radius:6px;font-size:0.75rem;font-weight:600;background:rgba(59,130,246,0.1);color:#1e40af;">On time</span></td>
              <td style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-size:0.875rem;"><span style="color:var(--text-subtle);font-size:0.75rem">No action</span></td>
            </tr>
            <tr>
              <td style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-size:0.875rem;">Thompson Group (4)</td>
              <td style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-size:0.875rem;">13th</td>
              <td style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-size:0.875rem;"><span style="padding:4px 8px;border-radius:6px;font-size:0.75rem;font-weight:600;background:rgba(16,185,129,0.1);color:#166534;">+5 min</span></td>
              <td style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-size:0.875rem;"><span style="color:var(--success);font-size:0.75rem">Excellent</span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Hole History Report -->
    <div id="historyCard" class="card" style="margin-top: 20px;">
      <div class="section-title" data-i18n="hole_history">📊 Hole History Report</div>
      <div style="color:var(--text-subtle);margin-bottom:16px;font-size:0.9rem;" data-i18n="hole_events_desc">Event log of arrivals, alerts, and interventions per hole. Filters match the Live Course Traffic view.</div>
      <div style="display:flex;flex-wrap:wrap;gap:8px;margin:8px 0 12px;">
        <label style="color:var(--text-subtle);font-size:0.85rem;" for="historyCourse">Course</label>
        <select id="historyCourse" class="lang-select" onchange="populateHoleOptions(this.value);renderHoleHistory()">
          <option value="A" selected data-i18n="course_a">Course A</option>
          <option value="B" data-i18n="course_b">Course B</option>
          <option value="C" data-i18n="course_c">Course C</option>
          <option value="D" data-i18n="course_d">Course D</option>
          <option value="18" data-i18n="course_18">18-Hole</option>
        </select>

        <label style="color:var(--text-subtle);font-size:0.85rem;" for="historyHole">Hole</label>
        <select id="historyHole" class="lang-select" onchange="renderHoleHistory()">
          <option value="" data-i18n="all_holes">All holes</option>
        </select>
      </div>
      <div style="overflow-x:auto;">
        <table style="width:100%;border-collapse:collapse;">
          <thead>
            <tr style="background:#f8fafc;">
              <th style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-weight:600;font-size:0.75rem;width:160px;" data-i18n="time_col">Time</th>
              <th style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-weight:600;font-size:0.75rem;" data-i18n="hole_col">Hole</th>
              <th style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-weight:600;font-size:0.75rem;" data-i18n="group_col">Group</th>
              <th style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-weight:600;font-size:0.75rem;" data-i18n="event_col">Event</th>
              <th style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-weight:600;font-size:0.75rem;" data-i18n="pace_col">Pace</th>
              <th style="padding:8px;text-align:left;border-bottom:1px solid var(--border-subtle);font-weight:600;font-size:0.75rem;" data-i18n="action_col">Action</th>
            </tr>
          </thead>
          <tbody id="historyBody"></tbody>
        </table>
      </div>
      <div id="historyEmpty" style="display:none;padding:12px;color:var(--text-subtle);font-size:0.9rem;" data-i18n="no_events">No events for the selected filter.</div>
    </div>
  </div>

  <!-- Labor -->
  <div id="labor" class="module-content">
    <div class="kpi-row">
      <div class="metric-card ai-enhanced" data-drill="labor_pct">
        <div class="metric-value" data-kpi="labor_pct">0%</div>
        <div class="metric-label" data-i18n="kpi_labor_pct">Labor % of Revenue (AI)</div>
        <div class="metric-confidence">91% Optimization</div>
      </div>
      <div class="metric-card ai-enhanced" data-drill="staff_gap">
        <div class="metric-value" data-kpi="staff_gap">0</div>
        <div class="metric-label" data-i18n="kpi_staff_gap">AI Staffing Gap</div>
        <div class="metric-confidence">96% Accuracy</div>
      </div>
      <div class="metric-card" data-drill="proshop_sla">
        <div class="metric-value" data-kpi="proshop_sla">0'</div>
        <div class="metric-label" data-i18n="kpi_sla_proshop">Pro Shop SLA</div>
      </div>
      <div class="metric-card" data-drill="fnb_sla">
        <div class="metric-value" data-kpi="fnb_sla">0'</div>
        <div class="metric-label" data-i18n="kpi_sla_fnb">F&B Ticket SLA</div>
      </div>
      <div class="metric-card" data-drill="caddy_avail">
        <div class="metric-value" data-kpi="caddy_avail">0</div>
        <div class="metric-label" data-i18n="kpi_caddy_avail">Caddies Available</div>
      </div>
    </div>

    <div class="card">
      <div class="section-title">AI Automation Controls</div>
      <div class="optimization-control">
        <div>
          <div style="font-weight:600">Dynamic Pricing</div>
          <div style="font-size:12px;color:var(--text-subtle)">Real-time price optimization based on demand</div>
        </div>
        <div class="control-toggle active" data-toggle="pricing" onclick="toggleControl(this)"></div>
      </div>
      <div class="optimization-control">
        <div>
          <div style="font-weight:600">Staff Optimization</div>
          <div style="font-size:12px;color:var(--text-subtle)">Automatic staff deployment and scheduling</div>
        </div>
        <div class="control-toggle active" data-toggle="staffing" onclick="toggleControl(this)"></div>
      </div>
      <div class="optimization-control">
        <div>
          <div style="font-weight:600">Inventory Management</div>
          <div style="font-size:12px;color:var(--text-subtle)">Auto-reorder based on usage patterns</div>
        </div>
        <div class="control-toggle active" data-toggle="inventory" onclick="toggleControl(this)"></div>
      </div>
      <div class="optimization-control">
        <div>
          <div style="font-weight:600">Weather Adjustments</div>
          <div style="font-size:12px;color:var(--text-subtle)">Automatic operations changes for weather</div>
        </div>
        <div class="control-toggle active" data-toggle="weather" onclick="toggleControl(this)"></div>
      </div>
    </div>

    <div class="card">
      <div class="section-title">AI Activity Feed</div>
      <div class="activity-feed">
        <div class="activity-item">
          <div class="activity-time">14:23</div>
          <div class="activity-text">Auto-pricing: Increased afternoon slots by 4% (+฿18,400 projected)</div>
        </div>
        <div class="activity-item">
          <div class="activity-time">14:19</div>
          <div class="activity-text">Staff optimization: Deployed +1 cart attendant (predicted bottleneck)</div>
        </div>
        <div class="activity-item">
          <div class="activity-time">14:15</div>
          <div class="activity-text">Weather adjustment: Activated indoor promotions (65% rain chance)</div>
        </div>
        <div class="activity-item">
          <div class="activity-time">14:12</div>
          <div class="activity-text">Inventory alert: Auto-ordered 200 golf balls (stock threshold reached)</div>
        </div>
      </div>
    </div>

    <div class="ai-analysis-panel">
      <div class="ai-analysis-title">👥 AI Staff Optimization</div>
      <div class="ai-analysis-content">
        Staff deployment algorithm recommends +2 additional cart attendants for optimal guest experience. Pro Shop peak predicted at 13:45 requires immediate attention. Labor optimization running 12% above efficiency baseline.
      </div>
    </div>
  </div>

  <!-- Retail -->
  <div id="retail" class="module-content">
    <div class="kpi-row">
      <div class="metric-card ai-enhanced" data-drill="avg_basket">
        <div class="metric-value" data-kpi="avg_basket">฿0</div>
        <div class="metric-label" data-i18n="kpi_avg_basket">AI Avg Basket Size</div>
        <div class="metric-confidence">87% Prediction</div>
      </div>
      <div class="metric-card" data-drill="top_movers">
        <div class="metric-value" data-kpi="top_movers">0</div>
        <div class="metric-label" data-i18n="kpi_top_movers">Top Movers</div>
      </div>
      <div class="metric-card ai-enhanced" data-drill="overstock">
        <div class="metric-value" data-kpi="overstock">0</div>
        <div class="metric-label" data-i18n="kpi_overstock">AI Overstock Alerts</div>
        <div class="metric-confidence">94% Detection</div>
      </div>
      <div class="metric-card" data-drill="waste_cost">
        <div class="metric-value" data-kpi="waste_cost">฿0</div>
        <div class="metric-label" data-i18n="kpi_waste">Waste Cost</div>
      </div>
      <div class="metric-card ai-enhanced" data-drill="lessons_rev">
        <div class="metric-value" data-kpi="lessons_rev">฿0</div>
        <div class="metric-label" data-i18n="kpi_lessons">Lessons Revenue (AI)</div>
        <div class="metric-confidence">89% Forecast</div>
      </div>
    </div>

    <div class="ai-analysis-panel">
      <div class="ai-analysis-title">🛒 AI Retail Intelligence</div>
      <div class="ai-analysis-content">
        Inventory optimization suggests restocking 200 golf balls. F&B indoor promotions activated due to 65% rain probability. Average basket size trending +12% above baseline with AI recommendations.
      </div>
    </div>
  </div>

  <!-- Members -->
  <div id="members" class="module-content">
    <div class="kpi-row">
      <div class="metric-card ai-enhanced" data-drill="member_mix">
        <div class="metric-value" data-kpi="member_mix">0%</div>
        <div class="metric-label" data-i18n="kpi_member_mix">AI Member Mix</div>
        <div class="metric-confidence">92% Analysis</div>
      </div>
      <div class="metric-card" data-drill="nps">
        <div class="metric-value" data-kpi="nps">0</div>
        <div class="metric-label" data-i18n="kpi_nps">NPS Score</div>
      </div>
      <div class="metric-card ai-enhanced" data-drill="event_profit">
        <div class="metric-value" data-kpi="event_profit">฿0</div>
        <div class="metric-label" data-i18n="kpi_event_profit">AI Event Profitability</div>
        <div class="metric-confidence">88% Forecast</div>
      </div>
      <div class="metric-card" data-drill="group_show">
        <div class="metric-value" data-kpi="group_show">0%</div>
        <div class="metric-label" data-i18n="kpi_group_show">Group Show Rate</div>
      </div>
      <div class="metric-card" data-drill="society_rev">
        <div class="metric-value" data-kpi="society_rev">฿0</div>
        <div class="metric-label" data-i18n="kpi_society_rev">Society Revenue</div>
      </div>
    </div>

    <div class="ai-analysis-panel">
      <div class="ai-analysis-title">👥 AI Member Intelligence</div>
      <div class="ai-analysis-content">
        Member engagement analysis shows 87% satisfaction rate. Event profitability optimization suggests focusing on premium experiences. AI recommends strategic member retention initiatives based on behavioral patterns.
      </div>
    </div>
  </div>

  <!-- Weather Intelligence -->
  <div id="weather" class="module-content">
    <div class="kpi-row">
      <div class="metric-card ai-enhanced" data-drill="weather_impact">
        <div class="metric-value" data-kpi="weather_impact">-8%</div>
        <div class="metric-label">Weather Impact Analysis</div>
        <div class="metric-confidence">91% AI Confidence</div>
      </div>
      <div class="metric-card ai-enhanced" data-drill="rain_probability">
        <div class="metric-value" data-kpi="rain_probability">65%</div>
        <div class="metric-label">Rain Probability (3hr)</div>
        <div class="metric-confidence">88% Accuracy</div>
      </div>
      <div class="metric-card" data-drill="temp_current">
        <div class="metric-value" data-kpi="temp_current">28°C</div>
        <div class="metric-label">Current Temperature</div>
      </div>
      <div class="metric-card" data-drill="wind_speed">
        <div class="metric-value" data-kpi="wind_speed">12 km/h</div>
        <div class="metric-label">Wind Speed</div>
      </div>
      <div class="metric-card ai-enhanced" data-drill="weather_revenue_impact">
        <div class="metric-value" data-kpi="weather_revenue_impact">฿-28K</div>
        <div class="metric-label">Revenue Impact (AI)</div>
        <div class="metric-confidence">94% Forecast</div>
      </div>
    </div>

    <div class="card">
      <div class="section-title">Live Weather Radar & Market Intelligence</div>
      <div class="weather-radar-container">
        <div class="weather-radar-map" id="weather-radar-map">
          <div class="map-grid"></div>
          <div class="geo-markers">
            <div class="geo-marker course-location" style="top: 50%; left: 50%;">
              <div class="marker-icon">⛳</div>
              <div class="marker-label">Your Golf Course</div>
            </div>
            <div class="geo-marker city-marker" style="top: 20%; left: 30%;">
              <div class="marker-icon">🏙️</div>
              <div class="marker-label">Pattaya City</div>
            </div>
            <div class="geo-marker competitor-marker" style="top: 30%; left: 70%;">
              <div class="marker-icon">🏌️</div>
              <div class="marker-label">Competitor Course</div>
            </div>
          </div>
          <div class="precipitation-overlay" id="precipitation-overlay">
            <div class="precip-cell moderate" style="top: 25%; left: 40%; width: 60px; height: 40px;">
              <span>MOD</span>
              <div class="movement-arrow se"></div>
            </div>
            <div class="precip-cell light" style="top: 60%; left: 20%; width: 40px; height: 30px;">
              <span>LGT</span>
              <div class="movement-arrow e"></div>
            </div>
          </div>
          <div class="radar-sweep" id="radar-sweep"></div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="section-title">Market Intelligence & Competitor Analysis</div>
      <div class="kpi-row">
        <div class="metric-card ai-enhanced">
          <div class="metric-value">฿2,983</div>
          <div class="metric-label">Avg Competitor Pricing</div>
          <div class="metric-confidence">AI Market Scan</div>
        </div>
        <div class="metric-card">
          <div class="metric-value">87%</div>
          <div class="metric-label">Market Capture</div>
        </div>
        <div class="metric-card">
          <div class="metric-value">4.2/5</div>
          <div class="metric-label">Competitive Rating</div>
        </div>
        <div class="metric-card ai-enhanced">
          <div class="metric-value">23%</div>
          <div class="metric-label">AI Demand Growth</div>
          <div class="metric-confidence">94% Forecast</div>
        </div>
      </div>
      <div class="competitor-table-container">
        <table class="table">
          <thead>
            <tr>
              <th>Competitor</th>
              <th>Current Price</th>
              <th>Change</th>
              <th>AI Status</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Pattaya Country Club</td>
              <td>฿3,200</td>
              <td class="metric-change up">+6.7%</td>
              <td><span class="badge" style="background: #fef3c7; color: #92400e">Monitoring</span></td>
            </tr>
            <tr>
              <td>Hermes Golf Club</td>
              <td>฿2,800</td>
              <td class="metric-change down">-1.8%</td>
              <td><span class="badge" style="background: #dcfce7; color: #166534">Stable</span></td>
            </tr>
            <tr>
              <td>GreenWood Golf</td>
              <td>฿2,950</td>
              <td class="metric-change up">+5.4%</td>
              <td><span class="badge" style="background: #fee2e2; color: #991b1b">Risk</span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="weather-widget">
      <div class="weather-current">
        <div>
          <div class="weather-temp">28°C</div>
          <div class="weather-condition">Partly Cloudy</div>
        </div>
      </div>
      <div class="weather-impact">65% rain chance at 15:00 - Indoor promotions activated by AI</div>
    </div>

    <div class="ai-analysis-panel">
      <div class="ai-analysis-title">🌤️ AI Weather-Based Adjustments</div>
      <div class="ai-analysis-content">
        • Reduced afternoon pricing by 3% due to rain risk<br>
        • Increased F&B indoor seating capacity<br>
        • Activated covered driving range promotions<br>
        • Adjusted staffing for potential early departures<br>
        • Competitor price monitoring shows 6% average increase
      </div>
    </div>
  </div>

  <!-- AI Performance -->
  <div id="aiperformance" class="module-content">
    <div class="model-performance">
      <div class="model-card">
        <div class="model-name">Revenue Forecasting</div>
        <div class="model-accuracy" id="revenue-accuracy">94.7%</div>
        <div class="model-status">Learning Active</div>
      </div>
      <div class="model-card">
        <div class="model-name">Dynamic Pricing</div>
        <div class="model-accuracy" id="pricing-accuracy">88.2%</div>
        <div class="model-status">Optimizing</div>
      </div>
      <div class="model-card">
        <div class="model-name">Weather Impact</div>
        <div class="model-accuracy" id="weather-accuracy">91.5%</div>
        <div class="model-status">Stable</div>
      </div>
      <div class="model-card">
        <div class="model-name">Staff Allocation</div>
        <div class="model-accuracy" id="staff-accuracy">96.1%</div>
        <div class="model-status">Excellent</div>
      </div>
    </div>

    <div class="ai-analysis-panel">
      <div class="ai-analysis-title">🧠 AI Learning Progress</div>
      <div class="ai-analysis-content">
        All AI models are performing above baseline expectations. Revenue forecasting model has improved 2.3% this week through continuous learning. Dynamic pricing algorithm has generated +12.4% revenue increase since activation.
      </div>
    </div>

    <div class="card">
      <div class="section-title">Model Training History</div>
      <div class="decision-item">
        <div class="decision-time">Today</div>
        <div class="decision-text">Processed 15,847 data points across all models</div>
        <div class="decision-impact">+0.8% accuracy</div>
      </div>
      <div class="decision-item">
        <div class="decision-time">Yesterday</div>
        <div class="decision-text">Revenue model achieved 98.2% prediction accuracy</div>
        <div class="decision-impact">Best performance</div>
      </div>
    </div>
  </div>

  <!-- Risk -->
  <div id="risk" class="module-content">
    <div class="kpi-row">
      <div class="metric-card ai-enhanced" data-drill="discount_exception">
        <div class="metric-value" data-kpi="discount_exception">0%</div>
        <div class="metric-label" data-i18n="kpi_discount_exception">AI Discount Exceptions</div>
        <div class="metric-confidence">97% Detection</div>
      </div>
      <div class="metric-card" data-drill="refund_rate">
        <div class="metric-value" data-kpi="refund_rate">0%</div>
        <div class="metric-label" data-i18n="kpi_refund_rate">Refund Rate</div>
      </div>
      <div class="metric-card ai-enhanced" data-drill="cash_incidents">
        <div class="metric-value" data-kpi="cash_incidents">0</div>
        <div class="metric-label" data-i18n="kpi_cash_incidents">AI Cash Incidents</div>
        <div class="metric-confidence">99% Monitoring</div>
      </div>
      <div class="metric-card" data-drill="audit_flags">
        <div class="metric-value" data-kpi="audit_flags">0</div>
        <div class="metric-label" data-i18n="kpi_audit_flags">Audit Flags</div>
      </div>
      <div class="metric-card" data-drill="compliance_score">
        <div class="metric-value" data-kpi="compliance_score">0</div>
        <div class="metric-label" data-i18n="kpi_compliance_score">Compliance Score</div>
      </div>
    </div>

    <div class="ai-analysis-panel">
      <div class="ai-analysis-title">🛡️ AI Risk Management</div>
      <div class="ai-analysis-content">
        AI monitoring systems are operating at 99% detection accuracy. No significant risk patterns detected. Compliance score remains above 96% with automated monitoring preventing potential violations.
      </div>
    </div>
  </div>

  <!-- Reports -->
  <div id="reports" class="module-content">
    <div class="card">
      <div class="section-title" data-i18n="sec_reports">AI-Enhanced Reports & Analytics</div>
      <div class="small" id="freshness"></div>
      <div style="margin-top:8px">
        <button class="btn primary" id="exportBtn" data-i18n="btn_export">Export AI-Enhanced Daily Brief PDF</button>
      </div>
    </div>

    <div class="ai-analysis-panel">
      <div class="ai-analysis-title">📊 AI Report Intelligence</div>
      <div class="ai-analysis-content">
        Automated report generation includes predictive insights, anomaly detection, and optimization recommendations. All data points are validated through AI algorithms with 94%+ accuracy across key metrics.
      </div>
    </div>
  </div>
</div>

<!-- Enhanced Drawer with AI features -->
<div class="drawer" id="drawer" aria-hidden="true">
  <div class="drawer-header">
    <div id="drawer-title">Metric</div>
    <div class="badge" id="mode-badge">AI</div>
  </div>
  <div class="drawer-body">
    <div class="grid grid-2">
      <div>
        <label class="small" data-i18n="mode">Mode</label>
        <select id="mode" class="select">
          <option value="ai">AI Predictive</option>
          <option value="manual">Manual Override</option>
        </select>
      </div>
      <div>
        <label class="small" data-i18n="target">Target</label>
        <input id="target" class="input" placeholder="value">
      </div>
    </div>
    <hr/>
    <div class="share-box">
      <div class="small" style="margin-bottom:6px" data-i18n="shareWith">Share with departments</div>
      <div class="grid grid-2" id="shareDepts">
        <label class="checkbox"><input type="checkbox" value="Pro Shop"> Pro Shop</label>
        <label class="checkbox"><input type="checkbox" value="F&B"> F&B</label>
        <label class="checkbox"><input type="checkbox" value="Kiosk"> Kiosk</label>
        <label class="checkbox"><input type="checkbox" value="Range"> Range</label>
        <label class="checkbox"><input type="checkbox" value="Lessons"> Lessons</label>
        <label class="checkbox"><input type="checkbox" value="Events"> Events</label>
        <label class="checkbox"><input type="checkbox" value="Maintenance"> Maintenance</label>
        <label class="checkbox"><input type="checkbox" value="Finance"> Finance</label>
      </div>
    </div>
    <hr/>
    <div>
      <div class="section-title" data-i18n="breakdown">AI Breakdown & Analysis</div>
      <table class="table" id="drill-table">
        <thead><tr><th data-i18n="item">Item</th><th data-i18n="value">Value</th><th data-i18n="adjust">AI Adjust</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
  <div class="footer">
    <button class="btn" id="applyBtn" data-i18n="apply">Apply AI Changes</button>
    <button class="btn primary" id="shareBtn" data-i18n="share">Share</button>
    <button class="btn" id="closeBtn" data-i18n="close">Close</button>
  </div>
</div>

<script>
// Enhanced 4-language dictionary with AI terminology
var I18N={
  en:{gmOps:"GM Operations — Enhanced Analytics",refreshPublish:"AI Refresh & Publish",now:"Now",today:"Today",week:"This Week",month:"This Month",quarter:"Quarter",year:"Year",
  tab_revenue:"Revenue",tab_daily:"Daily",tab_cash:"Cash",tab_pace:"Tee Sheet & Pace",tab_labor:"Labor & Service",tab_retail:"F&B / Retail",tab_members:"Membership & Events",tab_weather:"Weather Intelligence",tab_aiperformance:"AI Performance",tab_risk:"Risk & Compliance",tab_reports:"Reports",
  kpi_revenue_now:"Revenue Now",kpi_eod_forecast:"EoD AI Forecast",kpi_rev_per_round:"Revenue / Round",kpi_utilization:"Utilization",kpi_dyn_lift:"Dynamic Pricing Lift",
  sec_rev_src:"Revenue by Source",sec_actions:"AI Recommended Actions",
  src_green:"Green Fees",src_cart:"Cart Rentals",src_shop:"Pro Shop",src_fnb:"F&B",src_lessons:"Lessons",src_events:"Events",
  act_raise_gf:"%TIME%: AI suggests raise green fee +%INC%% (expected +%DELTA%)",
  act_skims:"AI recommends skims at %A% & %B% (cash risk %RISK%)",
  act_staff:"AI: +1 Pro Shop staff in %WINDOW% to hit SLA < %SLA%m",
  kpi_opening_cash:"Opening Cash",kpi_cash_in:"Cash Inflows",kpi_cash_out:"Cash Outflows",kpi_deposits:"Deposits",kpi_cash_variance:"Cash Variance",
  sec_deposit_plan:"AI-Optimized Deposit Plan",kpi_pace_p50:"Pace of Play (Median)",kpi_pace_p90:"Pace 90% (AI Predicted)",kpi_no_show:"No-Show Risk (AI)",kpi_waitlist:"Waitlist Fill",kpi_rounds_today:"Rounds Today",
  kpi_labor_pct:"Labor % of Revenue (AI)",kpi_staff_gap:"AI Staffing Gap",kpi_sla_proshop:"Pro Shop SLA",kpi_sla_fnb:"F&B Ticket SLA",kpi_caddy_avail:"Caddies Available",
  kpi_avg_basket:"AI Avg Basket Size",kpi_top_movers:"Top Movers",kpi_overstock:"AI Overstock Alerts",kpi_waste:"Waste Cost",kpi_lessons:"Lessons Revenue (AI)",
  kpi_member_mix:"AI Member Mix",kpi_nps:"NPS Score",kpi_event_profit:"AI Event Profitability",kpi_group_show:"Group Show Rate",kpi_society_rev:"Society Revenue",
  kpi_discount_exception:"AI Discount Exceptions",kpi_refund_rate:"Refund Rate",kpi_cash_incidents:"AI Cash Incidents",kpi_audit_flags:"Audit Flags",kpi_compliance_score:"Compliance Score",
  sec_reports:"AI-Enhanced Reports & Analytics",btn_export:"Export AI-Enhanced Daily Brief PDF",mode:"Mode",target:"Target",shareWith:"Share with departments",breakdown:"AI Breakdown & Analysis",item:"Item",value:"Value",adjust:"AI Adjust",apply:"Apply AI Changes",share:"Share",close:"Close",
  // Course Traffic Module
  traffic_title:"Live Course Traffic Monitor",pace_monitor:"Live Pace Monitoring",hole_history:"Hole History Report",course_view:"View:",
  course_a:"Course A (Holes 1-9)",course_b:"Course B (Holes 1-9)",course_c:"Course C (Holes 1-9)",course_d:"Course D (Holes 1-9)",course_18:"18 Hole Course",
  select_hole:"Select a hole to view details",hole_available:"Available",hole_details:"Hole Details",pace_analysis:"Pace Analysis",
  contact_group:"Contact Group",send_alert:"Send Pace Alert",send_ranger:"Send Ranger",view_history:"View History",
  pace_alert_title:"Pace Alert",pace_behind:"Corporate group 15 min behind",send_alert_btn:"Send Alert",
  group_col:"Group",hole_col:"Hole",pace_col:"Pace",action_col:"Action",time_col:"Time",event_col:"Event",
  contact_btn:"Contact",ranger_btn:"Send Ranger",no_action:"No action",excellent:"Excellent",
  on_pace:"On Pace",behind_pace:"Behind Pace",significantly_behind:"Significantly Behind",
  clear_status:"Clear",busy_status:"Busy",backed_up_status:"Backed Up",
  hole_events_desc:"Event log of arrivals, alerts, and interventions per hole. Filters match the Live Course Traffic view.",
  all_holes:"All holes",no_events:"No events for the selected filter.",
  arrived_event:"Arrived",departed_event:"Departed",alert_sent_event:"Alert Sent",marshal_dispatched_event:"Marshal Dispatched"},
  th:{gmOps:"ศูนย์ปฏิบัติการผู้จัดการทั่วไป — วิเคราะห์ข้อมูลขั้นสูง",refreshPublish:"AI รีเฟรชและเผยแพร่",now:"ขณะนี้",today:"วันนี้",week:"สัปดาห์นี้",month:"เดือนนี้",quarter:"ไตรมาส",year:"ปี",
  tab_revenue:"รายได้",tab_cash:"เงินสด",tab_pace:"ทีชีตและจังหวะ",tab_labor:"แรงงานและบริการ",tab_retail:"F&B / ค้าปลีก",tab_members:"สมาชิกและอีเวนต์",tab_weather:"ข่าวกรองสภาพอากาศ",tab_aiperformance:"ประสิทธิภาพ AI",tab_risk:"ความเสี่ยงและกำกับ",tab_reports:"รายงาน",
  kpi_revenue_now:"รายได้ปัจจุบัน",kpi_eod_forecast:"คาดการณ์สิ้นวัน AI",kpi_rev_per_round:"รายได้ต่อรอบ",kpi_utilization:"การใช้งาน",kpi_dyn_lift:"ส่วนเพิ่มราคาไดนามิก",
  sec_rev_src:"รายได้ตามแหล่งที่มา",sec_actions:"การดำเนินการที่ AI แนะนำ",
  // Course Traffic Module - Thai
  traffic_title:"ระบบตรวจสอบการเคลื่อนไหวสนามแบบสด",pace_monitor:"การติดตามจังหวะแบบสด",hole_history:"รายงานประวัติหลุม",course_view:"มุมมอง:",
  course_a:"สนาม A (หลุม 1-9)",course_b:"สนาม B (หลุม 1-9)",course_c:"สนาม C (หลุม 1-9)",course_d:"สนาม D (หลุม 1-9)",course_18:"สนาม 18 หลุม",
  select_hole:"เลือกหลุมเพื่อดูรายละเอียด",hole_available:"ว่าง",hole_details:"รายละเอียดหลุม",pace_analysis:"วิเคราะห์จังหวะ",
  contact_group:"ติดต่อกลุ่ม",send_alert:"ส่งการแจ้งเตือนจังหวะ",send_ranger:"ส่งเรนเจอร์",view_history:"ดูประวัติ",
  pace_alert_title:"การแจ้งเตือนจังหวะ",pace_behind:"กลุ่มบริษัทล่าช้า 15 นาที",send_alert_btn:"ส่งการแจ้งเตือน",
  group_col:"กลุ่ม",hole_col:"หลุม",pace_col:"จังหวะ",action_col:"การดำเนินการ",time_col:"เวลา",event_col:"เหตุการณ์",
  contact_btn:"ติดต่อ",ranger_btn:"ส่งเรนเจอร์",no_action:"ไม่มีการดำเนินการ",excellent:"ยอดเยี่ยม",
  on_pace:"ตามจังหวะ",behind_pace:"ล่าช้า",significantly_behind:"ล่าช้ามาก",
  clear_status:"ว่าง",busy_status:"ไม่ว่าง",backed_up_status:"ติดขัด",
  hole_events_desc:"บันทึกเหตุการณ์การมาถึง การแจ้งเตือน และการแทรกแซงต่อหลุม ตัวกรองตรงกับมุมมองการเคลื่อนไหวสนามแบบสด",
  all_holes:"ทุกหลุม",no_events:"ไม่มีเหตุการณ์สำหรับตัวกรองที่เลือก",
  arrived_event:"มาถึง",departed_event:"ออกแล้ว",alert_sent_event:"ส่งการแจ้งเตือนแล้ว",marshal_dispatched_event:"ส่งมาร์แชลแล้ว",
  tab_revenue:"รายได้",tab_cash:"เงินสด",tab_pace:"ทีชีตและจังหวะ",tab_labor:"แรงงานและบริการ",tab_retail:"F&B / ค้าปลีก",tab_members:"สมาชิกและอีเวนต์",tab_weather:"ข่าวกรองสภาพอากาศ",tab_aiperformance:"ประสิทธิภาพ AI",tab_risk:"ความเสี่ยงและกำกับ",tab_reports:"รายงาน",
  kpi_revenue_now:"รายได้ปัจจุบัน",kpi_eod_forecast:"คาดการณ์สิ้นวัน AI",kpi_rev_per_round:"รายได้ต่อรอบ",kpi_utilization:"การใช้งาน",kpi_dyn_lift:"ส่วนเพิ่มราคาไดนามิก",
  sec_rev_src:"รายได้ตามแหล่งที่มา",sec_actions:"การดำเนินการที่ AI แนะนำ",
  src_green:"กรีนฟี",src_cart:"รถกอล์ฟ",src_shop:"โปรช็อป",src_fnb:"อาหารและเครื่องดื่ม",src_lessons:"คอร์สสอน",src_events:"อีเวนต์",
  kpi_opening_cash:"เงินสดต้นวัน",kpi_cash_in:"เงินสดเข้า",kpi_cash_out:"เงินสดออก",kpi_deposits:"เงินฝาก",kpi_cash_variance:"ส่วนต่างเงินสด",
  sec_deposit_plan:"แผนฝาก AI",kpi_pace_p50:"ความเร็วรอบการเล่น (AI มัธยฐาน)",kpi_pace_p90:"ความเร็วรอบการเล่น (AI P90)",kpi_no_show:"ความเสี่ยงไม่มาเล่น (AI)",kpi_waitlist:"อัตราเติมจากรอคิว",kpi_rounds_today:"รอบวันนี้",
  kpi_labor_pct:"ค่าแรงต่อรายได้ (AI)",kpi_staff_gap:"ส่วนต่างกำลังคน AI",kpi_sla_proshop:"SLA โปรช็อป",kpi_sla_fnb:"SLA ใบสั่งอาหาร",kpi_caddy_avail:"แคดดี้พร้อมใช้งาน",
  kpi_avg_basket:"ตะกร้าเฉลี่ย AI",kpi_top_movers:"สินค้าขายดี",kpi_overstock:"แจ้งเตือนคงคลังเกิน AI",kpi_waste:"ต้นทุนสูกเสีย",kpi_lessons:"รายได้คอร์สสอน (AI)",
  kpi_member_mix:"สัดส่วนสมาชิก AI",kpi_nps:"คะแนน NPS",kpi_event_profit:"กำไรงานอีเวนต์ AI",kpi_group_show:"อัตราการมาของกรุ๊ป",kpi_society_rev:"รายได้โซไซตี้",
  kpi_discount_exception:"ข้อยกเว้นส่วนลด AI",kpi_refund_rate:"อัตราคืนเงิน",kpi_cash_incidents:"เหตุการณ์เงินสด AI",kpi_audit_flags:"ธงตรวจสอบ",kpi_compliance_score:"คะแนนกำกับ",
  sec_reports:"รายงานและส่งออกที่ปรับปรุงด้วย AI",btn_export:"ส่งออก PDF สรุปรายวันที่ปรับปรุงด้วย AI",mode:"โหมด",target:"เป้าหมาย",shareWith:"แชร์ให้แผนก",breakdown:"รายละเอียด AI",item:"รายการ",value:"ค่า",adjust:"ปรับ AI",apply:"ใช้การเปลี่ยนแปลง AI",share:"แชร์",close:"ปิด"},
  ko:{gmOps:"GM 운영 — 고급 분석",refreshPublish:"AI 새로고침 및 게시",now:"현재",today:"오늘",week:"이번 주",month:"이번 달",quarter:"분기",year:"연도",
  tab_revenue:"매출",tab_cash:"현금",tab_pace:"티시트·페이스",tab_labor:"인력·서비스",tab_retail:"F&B·리테일",tab_members:"회원·이벤트",tab_weather:"날씨 인텔리전스",tab_aiperformance:"AI 성능",tab_risk:"리스크·준수",tab_reports:"리포트",
  kpi_revenue_now:"현재 매출",kpi_eod_forecast:"마감 AI 예측",kpi_rev_per_round:"라운드당 매출",kpi_utilization:"이용률",kpi_dyn_lift:"동적 가격 상승분",
  sec_rev_src:"매출 소스별",sec_actions:"AI 권장 실행 항목",
  src_green:"그린피",src_cart:"카트 대여",src_shop:"프로샵",src_fnb:"F&B",src_lessons:"레슨",src_events:"이벤트",
  kpi_opening_cash:"시재금",kpi_cash_in:"현금 유입",kpi_cash_out:"현금 유출",kpi_deposits:"입금",kpi_cash_variance:"현금 차이",
  sec_deposit_plan:"AI 입금 계획",kpi_pace_p50:"플레이 속도 (AI 중앙값)",kpi_pace_p90:"플레이 속도 (AI P90)",kpi_no_show:"노쇼 위험 (AI)",kpi_waitlist:"대기자 충원율",kpi_rounds_today:"오늘 라운드",
  kpi_labor_pct:"매출 대비 인건비 (AI)",kpi_staff_gap:"AI 인력 부족",kpi_sla_proshop:"프로샵 SLA",kpi_sla_fnb:"F&B 티켓 SLA",kpi_caddy_avail:"캐디 가용",
  kpi_avg_basket:"AI 평균 장바구니",kpi_top_movers:"판매 급상승",kpi_overstock:"AI 재고 과다 경보",kpi_waste:"폐기 비용",kpi_lessons:"레슨 매출 (AI)",
  kpi_member_mix:"AI 회원 비중",kpi_nps:"NPS 점수",kpi_event_profit:"AI 이벤트 수익",kpi_group_show:"그룹 도착률",kpi_society_rev:"소사이어티 매출",
  kpi_discount_exception:"AI 할인 예외율",kpi_refund_rate:"환불율",kpi_cash_incidents:"AI 현금 사고",kpi_audit_flags:"감사 플래그",kpi_compliance_score:"준수 점수",
  sec_reports:"AI 강화 리포트·내보내기",btn_export:"AI 강화 일일 브리핑 PDF 내보내기",mode:"모드",target:"목표",shareWith:"부서에 공유",breakdown:"AI 세부내역",item:"항목",value:"값",adjust:"AI 조정",apply:"AI 변경사항 적용",share:"공유",close:"닫기",
  // Course Traffic Module - Korean
  traffic_title:"실시간 코스 교통 모니터",pace_monitor:"실시간 페이스 모니터링",hole_history:"홀 히스토리 리포트",course_view:"보기:",
  course_a:"코스 A (홀 1-9)",course_b:"코스 B (홀 1-9)",course_c:"코스 C (홀 1-9)",course_d:"코스 D (홀 1-9)",course_18:"18홀 코스",
  select_hole:"홀을 선택하여 세부 정보 보기",hole_available:"이용 가능",hole_details:"홀 세부 정보",pace_analysis:"페이스 분석",
  contact_group:"그룹 연락",send_alert:"페이스 알림 전송",send_ranger:"레인저 파견",view_history:"히스토리 보기",
  pace_alert_title:"페이스 알림",pace_behind:"기업 그룹 15분 지연",send_alert_btn:"알림 전송",
  group_col:"그룹",hole_col:"홀",pace_col:"페이스",action_col:"액션",time_col:"시간",event_col:"이벤트",
  contact_btn:"연락",ranger_btn:"레인저 파견",no_action:"액션 없음",excellent:"우수",
  on_pace:"정시",behind_pace:"지연",significantly_behind:"심각한 지연",
  clear_status:"이용 가능",busy_status:"이용 중",backed_up_status:"정체됨",
  hole_events_desc:"홀별 도착, 알림, 개입의 이벤트 로그. 필터는 실시간 코스 교통 보기와 일치합니다.",
  all_holes:"모든 홀",no_events:"선택한 필터에 대한 이벤트가 없습니다.",
  arrived_event:"도착함",departed_event:"출발함",alert_sent_event:"알림 전송됨",marshal_dispatched_event:"마샬 파견됨"},
  ja:{gmOps:"GM運営 — 高度な分析",refreshPublish:"AI更新して公開",now:"現在",today:"本日",week:"今週",month:"今月",quarter:"四半期",year:"年",
  tab_revenue:"売上",tab_cash:"現金",tab_pace:"ティーシート・進行",tab_labor:"人員・サービス",tab_retail:"F&B・小売",tab_members:"会員・イベント",tab_weather:"天気インテリジェンス",tab_aiperformance:"AIパフォーマンス",tab_risk:"リスク・順守",tab_reports:"レポート",
  kpi_revenue_now:"現在売上",kpi_eod_forecast:"本日見込 AI",kpi_rev_per_round:"1ラウンド当売上",kpi_utilization:"稼働率",kpi_dyn_lift:"動的価格効果",
  sec_rev_src:"収益の内訳",sec_actions:"AI推奨アクション",
  src_green:"グリーンフィー",src_cart:"カートレンタル",src_shop:"プロショップ",src_fnb:"F&B",src_lessons:"レッスン",src_events:"イベント",
  kpi_opening_cash:"釣銭準備金",kpi_cash_in:"現金流入",kpi_cash_out:"現金流出",kpi_deposits:"入金",kpi_cash_variance:"現金差異",
  sec_deposit_plan:"AI入金計画",kpi_pace_p50:"プレー進行ペース（AI中央値）",kpi_pace_p90:"プレー進行ペース（AI P90）",kpi_no_show:"ノーショーリスク（AI）",kpi_waitlist:"ウェイトリスト充当率",kpi_rounds_today:"本日のラウンド",
  kpi_labor_pct:"売上に対する人件費（AI）",kpi_staff_gap:"AI人員不足",kpi_sla_proshop:"プロショップ SLA",kpi_sla_fnb:"F&B チケット SLA",kpi_caddy_avail:"キャディ稼働",
  kpi_avg_basket:"AI平均バスケット",kpi_top_movers:"売れ筋",kpi_overstock:"AI在庫過多アラート",kpi_waste:"廃棄コスト",kpi_lessons:"レッスン売上（AI）",
  kpi_member_mix:"AI会員比率",kpi_nps:"NPSスコア",kpi_event_profit:"AIイベント採算",kpi_group_show:"団体来場率",kpi_society_rev:"ソサエティ売上",
  kpi_discount_exception:"AI割引例外率",kpi_refund_rate:"返金率",kpi_cash_incidents:"AI現金インシデント",kpi_audit_flags:"監査フラグ",kpi_compliance_score:"コンプライアンス評価",
  sec_reports:"AI強化レポートとエクスポート",btn_export:"AI強化日次ブリーフ PDF 書き出し",mode:"モード",target:"目標",shareWith:"部門と共有",breakdown:"AI内訳",item:"項目",value:"値",adjust:"AI調整",apply:"AI変更を適用",share:"共有",close:"閉じる",
  // Course Traffic Module - Japanese
  traffic_title:"ライブコース交通モニター",pace_monitor:"ライブペースモニタリング",hole_history:"ホール履歴レポート",course_view:"ビュー:",
  course_a:"コース A (ホール 1-9)",course_b:"コース B (ホール 1-9)",course_c:"コース C (ホール 1-9)",course_d:"コース D (ホール 1-9)",course_18:"18ホールコース",
  select_hole:"ホールを選択して詳細を表示",hole_available:"利用可能",hole_details:"ホール詳細",pace_analysis:"ペース分析",
  contact_group:"グループ連絡",send_alert:"ペースアラート送信",send_ranger:"レンジャー派遣",view_history:"履歴を表示",
  pace_alert_title:"ペースアラート",pace_behind:"企業グループ15分遅れ",send_alert_btn:"アラート送信",
  group_col:"グループ",hole_col:"ホール",pace_col:"ペース",action_col:"アクション",time_col:"時間",event_col:"イベント",
  contact_btn:"連絡",ranger_btn:"レンジャー派遣",no_action:"アクションなし",excellent:"優秀",
  on_pace:"時間通り",behind_pace:"遅れ",significantly_behind:"大幅遅れ",
  clear_status:"利用可能",busy_status:"使用中",backed_up_status:"渋滞",
  hole_events_desc:"ホール別の到着、アラート、介入のイベントログ。フィルターはライブコース交通ビューと一致します。",
  all_holes:"全ホール",no_events:"選択されたフィルターに対するイベントはありません。",
  arrived_event:"到着",departed_event:"出発",alert_sent_event:"アラート送信済み",marshal_dispatched_event:"マーシャル派遣済み"}
};

function t(key){ var lc=localStorage.getItem('gm_lang')||'en'; var d=I18N[lc]||I18N.en; return d[key]||key; }
function tAll(lc){ var d=I18N[lc]||I18N.en; var nodes=document.querySelectorAll('[data-i18n]'); for(var i=0;i<nodes.length;i++){ var k=nodes[i].getAttribute('data-i18n'); if(d[k]) nodes[i].textContent=d[k]; } localStorage.setItem('gm_lang', lc); refreshCourseTrafficModule(); }

function refreshCourseTrafficModule() {
  // Refresh dynamically generated content in course traffic module
  if (typeof renderHoleHistory === 'function') {
    renderHoleHistory();
  }

  // Refresh any selected hole details if a hole is currently selected
  if (window.selectedHole && window.selectedHole.dataset) {
    var holeNum = window.selectedHole.dataset.hole;
    var onClick = window.selectedHole.getAttribute('onclick');
    if (onClick) {
      try {
        eval(onClick);
      } catch(e) {
        console.log('Could not refresh hole details');
      }
    }
  } else {
    // No hole selected, refresh the default placeholder
    var detailsDiv = document.getElementById('holeDetails');
    if (detailsDiv && detailsDiv.innerHTML.includes('⛳')) {
      detailsDiv.innerHTML = '<div style="text-align:center;padding:20px;color:var(--text-subtle)"><div style="font-size:2rem;margin-bottom:8px">⛳</div><div>'+t('select_hole')+'</div></div>';
    }
  }

  // Refresh course name labels in the course views if they exist
  var courseViews = document.querySelectorAll('.course-view div[style*="text-align:center"][style*="margin-bottom:16px"]');
  for (var i = 0; i < courseViews.length; i++) {
    var view = courseViews[i];
    var parent = view.closest('.course-view');
    if (parent) {
      var courseId = parent.id;
      if (courseId === 'courseA') view.textContent = t('course_a').replace(' (Holes 1-9)', '');
      else if (courseId === 'courseB') view.textContent = t('course_b').replace(' (Holes 1-9)', '');
      else if (courseId === 'courseC') view.textContent = t('course_c').replace(' (Holes 1-9)', '');
      else if (courseId === 'courseD') view.textContent = t('course_d').replace(' (Holes 1-9)', '');
      else if (courseId === 'course18') {
        // Handle 18-hole course labels
        var labels = parent.querySelectorAll('div[style*="text-align:center"][style*="margin:24px 0 16px 0"]');
        if (labels.length >= 2) {
          // Translate "Front Nine" and "Back Nine" if we have those translations
          labels[0].textContent = 'Front Nine'; // Keep English for now
          labels[1].textContent = 'Back Nine';  // Keep English for now
        }
      }
    }
  }
}
function fmtTHB(n){ return "฿"+Number(n||0).toLocaleString(); }
function fmtPct(n){ var sign = Number(n) >= 0 ? "+" : ""; return sign + Number(n).toFixed(1) + "%"; }
function fmtMin(n){ n=Number(n)||0; var h=Math.floor(n/60); var m=Math.round(n%60); if(h>0){ return h+'h '+m+'m'; } return m+'m'; }
function fmtInt(n){ return Number(n||0).toString(); }
function parseNum(val){ var num = Number(String(val).replace(/[^0-9.-]/g,'')); return isNaN(num)?0:num; }
function fmtByType(n,t){ if(t==='currency') return fmtTHB(n); if(t==='percent') return fmtPct(n); if(t==='minutes') return fmtMin(n); if(t==='count') return fmtInt(n); return n; }

// Enhanced State with AI features
var DATA={}, STATE={range:'now', currentMetric:null, type:'currency', base:null, target:null, aiEngine: null};

// Enhanced AI Engine
class EnhancedPredictionEngine {
  constructor() {
    this.learningRate = 94.7;
    this.modelAccuracies = {
      revenue: 94.7,
      pricing: 88.2,
      weather: 91.5,
      staff: 96.1
    };
  }

  updateLearningIndicator() {
    const indicator = document.getElementById('ai-learning');
    if (indicator) {
      this.learningRate = Math.min(99.9, this.learningRate + (Math.random() * 0.1 - 0.05));
      indicator.textContent = `🧠 AI Learning: ${this.learningRate.toFixed(1)}%`;
    }
  }

  simulateLearning() {
    Object.keys(this.modelAccuracies).forEach(key => {
      this.modelAccuracies[key] = Math.min(99.9, 
        Math.max(85, this.modelAccuracies[key] + (Math.random() * 0.2 - 0.1))
      );
    });
    this.updateModelAccuracies();
  }

  updateModelAccuracies() {
    const accuracyElements = {
      'revenue-accuracy': this.modelAccuracies.revenue,
      'pricing-accuracy': this.modelAccuracies.pricing,
      'weather-accuracy': this.modelAccuracies.weather,
      'staff-accuracy': this.modelAccuracies.staff
    };

    Object.entries(accuracyElements).forEach(([id, accuracy]) => {
      const element = document.getElementById(id);
      if (element) {
        element.textContent = `${accuracy.toFixed(1)}%`;
      }
    });
  }
}

// Enhanced range-based data with AI predictions
function seedData(range){
  var mult = (range==='today')?1:(range==='week')?6:(range==='month')?26:(range==='quarter')?78:(range==='year')?312:1;
  DATA = {
    revenue_now: 950000*mult, revenue_change: 18.0, eod_forecast:1985000*mult, rev_per_round:3540, utilization:87, dyn_lift:62000*mult,
    opening_cash:120000, cash_in:524000*mult, cash_out:38000*mult, deposits:240000*mult, cash_variance:-1200,
    pace_p50:225, pace_p90:245, no_show_risk:6, waitlist_fill:42, rounds_today:247*mult,
    labor_pct:24, staff_gap:3, proshop_sla:5, fnb_sla:11, caddy_avail:132,
    avg_basket:540, top_movers:7, overstock:3, waste_cost:2800*mult, lessons_rev:25200*mult,
    member_mix:38, nps:64, event_profit:88000*mult, group_show:92, society_rev:24500*mult,
    discount_exception:1.2, refund_rate:0.8, cash_incidents:0, audit_flags:1, compliance_score:96,
    // New AI-enhanced metrics
    weather_impact: -8,
    rain_probability: 65,
    temp_current: 28,
    wind_speed: 12,
    weather_revenue_impact: -28000*mult
  };
}

var META={
  revenue_now:{type:'currency'}, revenue_change:{type:'percent'}, eod_forecast:{type:'currency'}, rev_per_round:{type:'currency'},
  utilization:{type:'percent'}, dyn_lift:{type:'currency'},
  opening_cash:{type:'currency'}, cash_in:{type:'currency'}, cash_out:{type:'currency'}, deposits:{type:'currency'}, cash_variance:{type:'currency'},
  pace_p50:{type:'minutes'}, pace_p90:{type:'minutes'}, no_show_risk:{type:'percent'}, waitlist_fill:{type:'percent'}, rounds_today:{type:'count'},
  labor_pct:{type:'percent'}, staff_gap:{type:'count'}, proshop_sla:{type:'minutes'}, fnb_sla:{type:'minutes'}, caddy_avail:{type:'count'},
  avg_basket:{type:'currency'}, top_movers:{type:'count'}, overstock:{type:'count'}, waste_cost:{type:'currency'}, lessons_rev:{type:'currency'},
  member_mix:{type:'percent'}, nps:{type:'count'}, event_profit:{type:'currency'}, group_show:{type:'percent'}, society_rev:{type:'currency'},
  discount_exception:{type:'percent'}, refund_rate:{type:'percent'}, cash_incidents:{type:'count'}, audit_flags:{type:'count'}, compliance_score:{type:'count'},
  weather_impact:{type:'percent'}, rain_probability:{type:'percent'}, temp_current:{type:'count'}, wind_speed:{type:'count'}, weather_revenue_impact:{type:'currency'}
};

function updateCards(){
  for(var key in DATA){
    var node=document.querySelector('[data-kpi="'+key+'"]');
    if(!node) continue;
    var t=(META[key]&&META[key].type)||'currency';
    if(key === 'temp_current') {
      node.textContent = DATA[key] + '°C';
    } else if(key === 'wind_speed') {
      node.textContent = DATA[key] + ' km/h';
    } else {
      node.textContent = fmtByType(DATA[key], t);
    }
    if(key==='revenue_change'){ node.classList.remove('up','down'); node.classList.add(DATA[key]>=0?'up':'down'); }
  }
  var fr=document.getElementById('freshness'); 
  if(fr) fr.textContent='AI-Enhanced refresh '+new Date().toLocaleString()+' • Range: '+STATE.range.toUpperCase() + ' • Models: 94%+ accuracy';
}

// Revenue by source now derives from revenue_now and re-renders on language/range/Apply
var SOURCE_SHARES = [
  {key:'src_green', pct:0.568},
  {key:'src_cart', pct:0.186},
  {key:'src_shop', pct:0.116},
  {key:'src_fnb', pct:0.074},
  {key:'src_lessons', pct:0.029},
  {key:'src_events', pct:0.028}
];

function mountRevenueSources(){
  var wrap=document.getElementById('rev-breakdown'); if(!wrap) return; wrap.innerHTML='';
  var base = DATA.revenue_now || 0;
  for(var i=0;i<SOURCE_SHARES.length;i++){
    var s=SOURCE_SHARES[i];
    var amt = Math.round(base * s.pct);
    var pct = (s.pct*100).toFixed(1)+'%';
    var el=document.createElement('div');
    el.className='revenue-item';
    el.setAttribute('data-drill','source:'+s.key);
    el.innerHTML='<div class="revenue-amount">'+fmtTHB(amt)+'</div><div class="revenue-source">'+t(s.key)+'</div><div class="revenue-percent">'+pct+'</div>';
    wrap.appendChild(el);
  }
  renderActions();
}

// Enhanced Actions block with AI recommendations
function i18nAction(templateKey, pairs){
  var s = t(templateKey);
  for(var k in pairs){ s = s.replaceAll('%'+k+'%', pairs[k]); }
  return s;
}

function renderActions(){
  var q=document.getElementById('action-queue'); if(!q) return;
  var inc=5, delta=fmtTHB(Math.round(DATA.revenue_now*0.0295));
  var items=[
    i18nAction('act_raise_gf', {TIME:'14:00–16:00', INC:inc, DELTA:delta}),
    i18nAction('act_skims', {A:'14:30', B:'16:30', RISK:'medium'}),
    i18nAction('act_staff', {WINDOW:'13–17h', SLA:'4'})
  ];
  q.innerHTML = items.map(function(s){ return '<div style="margin-bottom:8px">🤖 '+s+'</div>'; }).join('');
}

// Enhanced Alert Handling
function handleAlert(alertType) {
  var button = event.target;
  var originalText = button.textContent;
  button.textContent = 'AI Processing...';
  button.disabled = true;
  
  setTimeout(function() {
    button.textContent = 'AI Executed ✓';
    button.style.background = 'var(--success)';
    toast('AI action completed: ' + alertType);
    
    // Simulate AI decision logging
    if(STATE.aiEngine) {
      var descriptions = {
        'cart-shortage': 'AI deployed backup carts based on predictive analysis',
        'pace-control': 'AI sent marshal to hole 7 using pace optimization',
        'pricing-opportunity': 'AI optimized pricing strategy with 94% confidence'
      };
      console.log('AI Decision:', descriptions[alertType]);
    }
  }, 2000);
}

// Toggle Control Function
function toggleControl(element) {
  element.classList.toggle('active');
  var toggleType = element.getAttribute('data-toggle');
  var isActive = element.classList.contains('active');
  var status = isActive ? 'enabled' : 'disabled';
  
  toast('AI ' + toggleType + ' optimization ' + status);
  
  // Update AI engine based on toggle
  if(STATE.aiEngine && isActive) {
    STATE.aiEngine.simulateLearning();
  }
}

// Manual Data Entry Functions
function addCompetitorRow() {
  toast('Use the competitor table in Weather Intelligence tab for market analysis');
}

function saveMarketData() {
  toast('AI market data synchronized successfully');
}

// Weather Radar Controls
function zoomRadar(direction) {
  var map = document.getElementById('weather-radar-map');
  var currentZoom = map.getAttribute('data-zoom') || '1';
  var newZoom = parseFloat(currentZoom);
  
  if (direction === 'in' && newZoom < 3) {
    newZoom += 0.5;
  } else if (direction === 'out' && newZoom > 0.5) {
    newZoom -= 0.5;
  }
  
  map.setAttribute('data-zoom', newZoom);
  map.style.transform = 'scale(' + newZoom + ')';
  toast('Radar zoom: ' + newZoom + 'x');
}

function toggleRadarSweep() {
  var sweep = document.getElementById('radar-sweep');
  if(!sweep) return;
  
  var isActive = sweep.style.animationPlayState !== 'paused';
  if (isActive) {
    sweep.style.animationPlayState = 'paused';
    toast('Radar sweep paused');
  } else {
    sweep.style.animationPlayState = 'running';
    toast('Radar sweep active');
  }
}

// Check Competitor Prices
function checkCompetitorPrice(competitorId) {
  toast('AI scanning competitor: ' + competitorId.replace('-', ' '));
  
  // Simulate price check
  setTimeout(function() {
    var priceChange = (Math.random() - 0.5) * 10; // Random price change
    var message = 'Price ' + (priceChange > 0 ? 'increased' : 'decreased') + ' by ' + Math.abs(priceChange).toFixed(1) + '%';
    toast('AI detected: ' + message);
  }, 2000);
}

// Refresh Competitor Data
function refreshCompetitorData() {
  toast('AI refreshing competitor intelligence...');
  
  setTimeout(function() {
    toast('Market intelligence updated with 94% confidence');
  }, 1500);
}

// Enhanced Drawer with AI features
function openDrawer(key,title){
  STATE.currentMetric=key; STATE.type=(META[key]&&META[key].type)||'currency'; STATE.base=DATA[key]; STATE.target=DATA[key];
  document.getElementById('drawer-title').textContent = title || key;
  document.getElementById('drawer').classList.add('open'); document.getElementById('drawer').setAttribute('aria-hidden','false');
  document.getElementById('target').value = STATE.target;
  
  var tbody=document.querySelector('#drill-table tbody'); tbody.innerHTML='';
  var aiSuggestion = STATE.base * (1 + (Math.random() * 0.1 - 0.05)); // AI suggests small variance
  var rows=[
    ['Current Value', fmtByType(STATE.base, STATE.type)], 
    ['AI Prediction', fmtByType(aiSuggestion, STATE.type), "<input class='input' id='ai_sug' value='"+Math.round(aiSuggestion)+"'>"], 
    ['Manual Override', fmtByType(STATE.target, STATE.type), "<input class='input' id='override' value='"+STATE.target+"'>"]
  ];
  
  for(var i=0;i<rows.length;i++){ 
    var tr=document.createElement('tr'); 
    tr.innerHTML='<td>'+rows[i][0]+'</td><td>'+rows[i][1]+'</td><td>'+(rows[i][2]||'')+'</td>'; 
    tbody.appendChild(tr); 
  }
  
  function sync(v){ 
    var n=parseNum(v); 
    STATE.target=n; 
    var ai=document.getElementById('ai_sug'), ov=document.getElementById('override'); 
    if(ai) ai.value=n; 
    if(ov) ov.value=n; 
  }
  
  document.getElementById('target').oninput=function(){sync(this.value)}; 
  var ai=document.getElementById('ai_sug'); 
  var ov=document.getElementById('override'); 
  if(ai) ai.oninput=function(){sync(this.value)}; 
  if(ov) ov.oninput=function(){sync(this.value)};
}

function closeDrawer(){ 
  document.getElementById('drawer').classList.remove('open'); 
  document.getElementById('drawer').setAttribute('aria-hidden','true'); 
}

function applyChanges(){
  var k=STATE.currentMetric; if(!k) return;
  DATA[k]=STATE.target;
  if(k==='revenue_now'){ 
    var base=STATE.base||0; 
    if(base>0){ DATA.revenue_change = ((STATE.target - base)/base)*100; } 
  }
  updateCards(); 
  if(k==='revenue_now' || k==='dyn_lift') mountRevenueSources();
  toast('AI changes applied successfully');
}

function shareMetric(){ 
  var boxes=document.querySelectorAll('#shareDepts input:checked'); 
  var list=[]; 
  for(var i=0;i<boxes.length;i++) list.push(boxes[i].value); 
  toast(list.length?('AI shared with: '+list.join(', ')):'No departments selected for AI sharing'); 
}

function toast(msg){ 
  var t=document.createElement('div'); 
  t.className='toast'; 
  t.textContent=msg; 
  document.body.appendChild(t); 
  setTimeout(function(){t.parentNode && t.parentNode.removeChild(t);},3000); 
}

function exportDailyBrief(){ 
  toast('Generating AI-enhanced PDF report...');
  setTimeout(function(){
    window.print(); 
  }, 1000);
}

// Initialize AI Engine and Enhanced Features
document.addEventListener('DOMContentLoaded', function(){
  // Initialize AI Engine
  STATE.aiEngine = new EnhancedPredictionEngine();
  
  // Persisted language
  var savedLang = localStorage.getItem('gm_lang') || 'en';
  document.getElementById('lang').value = savedLang; tAll(savedLang);

  // Init data for current range
  STATE.range = document.getElementById('range').value;
  seedData(STATE.range); updateCards(); mountRevenueSources();

  // Start AI learning simulation
  setInterval(function(){
    if(STATE.aiEngine) {
      STATE.aiEngine.updateLearningIndicator();
      STATE.aiEngine.simulateLearning();
    }
  }, 10000); // Update every 10 seconds

  // Daily Dashboard initialization function
  function initDailyDashboard() {

var dailyRoot = document.getElementById('daily-dashboard-root');
if (!dailyRoot) return;
if (dailyRoot.dataset.mounted === '1') return;
dailyRoot.dataset.mounted = '1';

var mount = document.createElement('div');
mount.id = 'elite-root';
dailyRoot.style.minHeight = 'auto';
dailyRoot.style.height = 'auto';
dailyRoot.style.overflow = 'visible';
dailyRoot.style.width = '100%';
dailyRoot.appendChild(mount);

if (typeof window.mountEliteGM === 'function') {
  window.mountEliteGM(mount);
} else {
  console.error('Elite GM mount function missing'); console.log('window.mountEliteGM keys:', Object.keys(window).filter(k=>k.indexOf('mountElite')>=0));;
}

// Lock background when Elite slide-over appears
var lock = function(){ document.documentElement.classList.add('scroll-lock'); document.body.classList.add('scroll-lock'); };
var unlock = function(){ document.documentElement.classList.remove('scroll-lock'); document.body.classList.remove('scroll-lock'); };
var obs = new MutationObserver(function(){
  var sheet = document.querySelector('#daily-dashboard-root .fixed.inset-0.z-30');
  if (sheet) lock(); else unlock();
});
obs.observe(dailyRoot, { childList: true, subtree: true });


  }

  // Tabs
  document.getElementById('tabs').addEventListener('click', function(e){
    var tab=e.target.closest('.module-tab'); if(!tab) return;
    var module = tab.getAttribute('data-module');

    var panes=document.querySelectorAll('.module-content');
    for(var i=0;i<panes.length;i++) panes[i].classList.remove('active');
    document.getElementById(module).classList.add('active');
    var tabs=document.querySelectorAll('.module-tab');
    for(var j=0;j<tabs.length;j++) tabs[j].classList.remove('active');
    tab.classList.add('active');

    // Initialize Daily dashboard when Daily tab is clicked
    if (module === 'daily') {
      setTimeout(initDailyDashboard, 100);
    }
  });

  // Enhanced Drill with AI context
  document.getElementById('gm-module').addEventListener('click', function(e){
    var n=e.target.closest('[data-drill]'); if(!n) return;
    var key=n.getAttribute('data-drill'); 
    var label=n.querySelector('.metric-label'); 
    var title= label? label.textContent : key; 
    openDrawer(key,title);
  });

  // Drawer buttons with AI enhancements
  document.getElementById('applyBtn').addEventListener('click', applyChanges);
  document.getElementById('shareBtn').addEventListener('click', shareMetric);
  document.getElementById('closeBtn').addEventListener('click', closeDrawer);
  document.getElementById('mode').addEventListener('change', function(){ 
    var badge = document.getElementById('mode-badge');
    badge.textContent = this.value.toUpperCase(); 
    if(this.value === 'ai') {
      badge.style.background = 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)';
      badge.style.color = '#1e40af';
    } else {
      badge.style.background = '#fff';
      badge.style.color = '#334155';
    }
  });

  // Enhanced Global controls
  document.getElementById('lang').addEventListener('change', function(e){ 
    tAll(e.target.value); 
    mountRevenueSources(); 
    renderActions(); 
  });
  
  document.getElementById('range').addEventListener('change', function(e){ 
    STATE.range=e.target.value; 
    seedData(STATE.range); 
    updateCards(); 
    mountRevenueSources(); 
  });
  
  document.getElementById('gm-oneclick').addEventListener('click', function(){ 
    toast('AI analyzing and refreshing all metrics...');
    setTimeout(function(){
      seedData(STATE.range); 
      updateCards(); 
      mountRevenueSources(); 
      toast('AI refresh completed with 94%+ accuracy');
    }, 1500);
  });
  
  document.getElementById('exportBtn').addEventListener('click', exportDailyBrief);

  // Set initial status
  document.getElementById('selftest').textContent='AI Engine Online';
  
  // Initial AI update
  setTimeout(function(){
    if(STATE.aiEngine) {
      STATE.aiEngine.updateLearningIndicator();
      STATE.aiEngine.updateModelAccuracies();
    }
  }, 1000);

  // === COMPLETE LIVE COURSE TRAFFIC MODULE FUNCTIONS ===
  var selectedHole = null;

  // Course switching for Live Course Traffic
  function switchCourseView(courseValue) {
    var courseIds = ['courseA','courseB','courseC','courseD','course18'];
    for (var i=0;i<courseIds.length;i++){
      var el=document.getElementById(courseIds[i]);
      if(el) el.style.display='none';
    }
    var target = document.getElementById('course'+courseValue);
    if (target) target.style.display='block';

    // deselect any selected hole
    var holes = document.querySelectorAll('.hole.selected');
    for (var j=0;j<holes.length;j++){ holes[j].classList.remove('selected'); }
    selectedHole = null;
    var detailsDiv = document.getElementById('holeDetails');
    if (detailsDiv) {
      detailsDiv.innerHTML = '<div style="text-align:center;padding:20px;color:var(--text-subtle)"><div style="font-size:2rem;margin-bottom:8px">⛳</div><div>'+t('select_hole')+'</div></div>';
    }
  }
  window.switchCourseView = switchCourseView;

  // Hole details with full functionality
  function showHoleDetails(holeNumber, groupName, paceStatus) {
    var holes = document.querySelectorAll('.hole.selected');
    for (var i=0;i<holes.length;i++){ holes[i].classList.remove('selected'); }
    var currentHole = document.querySelector('[data-hole="'+holeNumber+'"]');
    if (currentHole) {
      currentHole.classList.add('selected');
      currentHole.style.borderColor = 'var(--brand)';
      currentHole.style.boxShadow = '0 0 0 3px rgba(37,99,235,0.2)';
      selectedHole = currentHole;
    }

    var detailsDiv = document.getElementById('holeDetails');
    if (!detailsDiv) return;

    if (groupName === 'Available') {
      detailsDiv.innerHTML =
        '<div style="text-align:center;padding:20px">'+
          '<div style="font-size:2rem;margin-bottom:12px;color:var(--success)">✅</div>'+
          '<div style="font-size:1.125rem;font-weight:600;margin-bottom:8px">Hole '+holeNumber+' - '+t('hole_available')+'</div>'+
          '<div style="font-size:0.875rem;color:var(--text-subtle);margin-bottom:16px">This hole is currently open and ready for the next group</div>'+
          '<div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap">'+
            '<button class="btn" style="padding:6px 12px;font-size:0.75rem;" onclick="viewHoleStats(\''+holeNumber+'\')">'+t('view_history')+'</button>'+
          '</div>'+
        '</div>';
    } else {
      var paceInfo = getPaceInfo(paceStatus);
      detailsDiv.innerHTML =
        '<div style="padding:16px">'+
          '<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">'+
            '<div>'+
              '<div style="font-size:1.125rem;font-weight:600;margin-bottom:4px">'+groupName+'</div>'+
              '<div style="font-size:0.875rem;color:var(--text-subtle)">Hole '+holeNumber+'</div>'+
            '</div>'+
            '<div class="pace-status '+paceClass(paceStatus)+'" style="padding:4px 8px;border-radius:6px;font-size:0.75rem;font-weight:600;display:inline-block;">'+paceInfo.label+'</div>'+
          '</div>'+
          '<div style="background:#f8fafc;border-radius:8px;padding:12px;margin-bottom:16px">'+
            '<div style="font-size:0.875rem;font-weight:600;margin-bottom:8px">'+t('pace_analysis')+'</div>'+
            '<div style="font-size:0.875rem;color:'+paceInfo.color+'">'+paceInfo.description+'</div>'+
          '</div>'+
          '<div style="display:flex;gap:8px;flex-wrap:wrap">'+
            '<button class="btn" style="padding:6px 12px;font-size:0.75rem;" onclick="contactGroup(\''+groupName+'\')">'+t('contact_group')+'</button>'+
            '<button class="btn" style="padding:6px 12px;font-size:0.75rem;background:var(--warning);color:white;" onclick="sendPaceAlert(\''+holeNumber+'\')">'+t('send_alert')+'</button>'+
            '<button class="btn" style="padding:6px 12px;font-size:0.75rem;" onclick="deployRanger(\''+holeNumber+'\')">'+t('send_ranger')+'</button>'+
            '<button class="btn" style="padding:6px 12px;font-size:0.75rem;" onclick="viewHoleStats(\''+holeNumber+'\')">'+t('view_history')+'</button>'+
          '</div>'+
        '</div>';
    }
  }
  window.showHoleDetails = showHoleDetails;

  // Pace utility functions
  function paceClass(pace){
    if(pace === 'normal') return 'pace-normal';
    if(pace === 'slow') return 'pace-slow';
    if(pace === 'very-slow') return 'pace-very-slow';
    return 'pace-normal';
  }

  function getPaceInfo(pace) {
    var paceMap = {
      'clear': {label:t('hole_available'), color:'var(--text-subtle)', description:'Hole is available for next group.'},
      'normal': {label:t('on_pace'), color:'var(--brand)', description:'Group is maintaining good pace of play. '+t('no_action')+'.'},
      'slow': {label:t('behind_pace'), color:'var(--warning)', description:'Group is 5–10 minutes behind expected pace. Consider monitoring.'},
      'very-slow': {label:t('significantly_behind'), color:'var(--danger)', description:'Group is more than 10 minutes behind pace. Intervention recommended.'}
    };
    return paceMap[pace] || paceMap['normal'];
  }

  function translateEvent(event) {
    var eventMap = {
      'Arrived': t('arrived_event'),
      'Departed': t('departed_event'),
      'Alert Sent': t('alert_sent_event'),
      'Marshal Dispatched': t('marshal_dispatched_event')
    };
    return eventMap[event] || event;
  }

  // Action functions
  function contactGroup(groupName){
    alert('Message sent to '+groupName+': Please improve pace.');
  }
  window.contactGroup = contactGroup;

  function sendPaceAlert(holeNumber){
    alert('Pace alert sent for Hole '+holeNumber+'. Marshal notified.');
  }
  window.sendPaceAlert = sendPaceAlert;

  function deployRanger(holeNumber){
    alert('Ranger dispatched to Hole '+holeNumber+'. ETA 3–5 min.');
  }
  window.deployRanger = deployRanger;

  // -------------------- Hole History Report Data --------------------
  var historyData = [
    // Course A
    {course:'A', hole:'A3', time:'2025-09-22T08:10:00', group:'Johnson Group (4)', event:'Arrived', pace:'normal', delta:0, action:'—'},
    {course:'A', hole:'A3', time:'2025-09-22T08:28:00', group:'Johnson Group (4)', event:'Departed', pace:'normal', delta:+1, action:'—'},
    {course:'A', hole:'A4', time:'2025-09-22T08:15:00', group:'Smith Group (4)', event:'Arrived', pace:'slow', delta:-8, action:'Monitor'},
    {course:'A', hole:'A4', time:'2025-09-22T08:36:00', group:'Smith Group (4)', event:'Alert Sent', pace:'slow', delta:-10, action:'Pace SMS'},
    {course:'A', hole:'A5', time:'2025-09-22T08:05:00', group:'Corporate (12)', event:'Arrived', pace:'very-slow', delta:-12, action:'—'},
    {course:'A', hole:'A5', time:'2025-09-22T08:20:00', group:'Corporate (12)', event:'Marshal Dispatched', pace:'very-slow', delta:-15, action:'Ranger'},
    // Course B
    {course:'B', hole:'B4', time:'2025-09-22T07:55:00', group:'Thompson Group (4)', event:'Arrived', pace:'normal', delta:0, action:'—'},
    {course:'B', hole:'B5', time:'2025-09-22T08:12:00', group:'Lee Group (3)', event:'Arrived', pace:'normal', delta:+2, action:'—'},
    // Course C
    {course:'C', hole:'C2', time:'2025-09-22T08:18:00', group:'Davis Group (3)', event:'Arrived', pace:'normal', delta:0, action:'—'},
    {course:'C', hole:'C5', time:'2025-09-22T08:22:00', group:'Wilson Group (4)', event:'Arrived', pace:'normal', delta:+1, action:'—'},
    {course:'C', hole:'C9', time:'2025-09-22T08:40:00', group:'Martinez Group (2)', event:'Arrived', pace:'normal', delta:0, action:'—'},
    // 18-hole course
    {course:'18', hole:'3', time:'2025-09-22T08:11:00', group:'Johnson Group (4)', event:'Arrived', pace:'normal', delta:0, action:'—'},
    {course:'18', hole:'4', time:'2025-09-22T08:17:00', group:'Smith Group (4)', event:'Arrived', pace:'slow', delta:-8, action:'Monitor'},
    {course:'18', hole:'5', time:'2025-09-22T08:19:00', group:'Corporate (12)', event:'Arrived', pace:'very-slow', delta:-15, action:'Ranger'},
    {course:'18', hole:'13', time:'2025-09-22T08:30:00', group:'Thompson Group (4)', event:'Arrived', pace:'normal', delta:+5, action:'—'},
    {course:'18', hole:'14', time:'2025-09-22T08:33:00', group:'Lee Group (3)', event:'Arrived', pace:'normal', delta:+4, action:'—'}
  ];

  // History utility functions
  function formatTime(ts){
    try{
      return new Date(ts).toLocaleString(undefined,{hour:'2-digit',minute:'2-digit',year:'numeric',month:'short',day:'2-digit'});
    }catch(e){ return ts; }
  }

  function pacePill(pace, delta){
    var cls = 'pace-normal', txt = t('on_pace');
    if(pace==='slow'){ cls='pace-slow'; txt=(delta||0)+' min '+t('behind_pace').toLowerCase(); }
    if(pace==='very-slow'){ cls='pace-very-slow'; txt=(delta||0)+' min '+t('significantly_behind').toLowerCase(); }
    if(pace==='normal' && (delta||0) > 0){ cls='pace-fast'; txt='+'+delta+' min'; }
    if(pace==='normal' && (delta||0) === 0){ cls='pace-normal'; txt=t('on_pace'); }
    return '<span class="pace-status '+cls+'" style="padding:4px 8px;border-radius:6px;font-size:0.75rem;font-weight:600;display:inline-block;">'+txt+'</span>';
  }

  function currentTrafficCourse(){
    var select = document.getElementById('courseSelect');
    return select ? select.value : 'A';
  }

  function populateHoleOptions(course){
    var holeSel = document.getElementById('historyHole');
    if(!holeSel) return;
    var prev = holeSel.value;
    holeSel.innerHTML = '';
    var optAll = document.createElement('option');
    optAll.value = '';
    optAll.textContent = 'All holes';
    holeSel.appendChild(optAll);
    // Collect distinct holes for the course
    var seen = {};
    for(var i=0;i<historyData.length;i++){
      var row = historyData[i];
      if(row.course===course && !seen[row.hole]){
        var o = document.createElement('option');
        o.value = row.hole;
        o.textContent = row.hole;
        holeSel.appendChild(o);
        seen[row.hole]=true;
      }
    }
    // try to restore previous selection
    if(seen[prev]) holeSel.value = prev;
  }

  function renderHoleHistory(){
    var course = document.getElementById('historyCourse').value;
    var hole = document.getElementById('historyHole').value;
    var tbody = document.getElementById('historyBody');
    var empty = document.getElementById('historyEmpty');
    if (!tbody || !empty) return;

    tbody.innerHTML = '';
    var filtered = historyData.filter(function(r){
      if(r.course!==course) return false;
      if(hole && r.hole!==hole) return false;
      return true;
    }).sort(function(a,b){ return new Date(b.time) - new Date(a.time); });

    if(filtered.length===0){
      empty.style.display = 'block';
      return;
    }
    empty.style.display = 'none';
    for(var i=0;i<filtered.length;i++){
      var r = filtered[i];
      var tr = document.createElement('tr');
      tr.innerHTML = '<td style="white-space:nowrap;padding:8px;font-size:0.875rem;">'+formatTime(r.time)+'</td>'+
                     '<td style="padding:8px;font-size:0.875rem;">'+r.hole+'</td>'+
                     '<td style="padding:8px;font-size:0.875rem;">'+r.group+'</td>'+
                     '<td style="padding:8px;font-size:0.875rem;">'+translateEvent(r.event)+'</td>'+
                     '<td style="padding:8px;font-size:0.875rem;">'+pacePill(r.pace, r.delta)+'</td>'+
                     '<td style="padding:8px;font-size:0.875rem;">'+(r.action||'—')+'</td>';
      tbody.appendChild(tr);
    }
  }
  window.renderHoleHistory = renderHoleHistory;

  function syncHistoryToHole(holeNumber){
    // Determine course from current traffic selector
    var course = currentTrafficCourse();
    // Set filters
    var courseSel = document.getElementById('historyCourse');
    var holeSel = document.getElementById('historyHole');
    if(courseSel && holeSel){
      courseSel.value = course;
      populateHoleOptions(course);
      // normalize hole id format for course
      var holeId = ''+holeNumber;
      if(course!=='18' && holeId.indexOf(course) !== 0){
        holeId = course + holeId;
      }
      holeSel.value = holeId;
      renderHoleHistory();
      // bring into view
      var card = document.getElementById('historyCard');
      if(card) card.scrollIntoView({behavior:'smooth', block:'start'});
    }
  }

  function viewHoleStats(holeNumber){
    syncHistoryToHole(holeNumber);
  }
  window.viewHoleStats = viewHoleStats;

  // Initialize course traffic on page load
  setTimeout(function() {
    if (typeof switchCourseView === 'function') {
      switchCourseView('A');
    }
    // Initialize history if elements exist
    if (document.getElementById('historyCourse')) {
      populateHoleOptions('A');
      renderHoleHistory();
    }
  }, 500);

});
</script>
<script>
/* === Competitor CRUD (ONLY in Market Intelligence & Competitor Analysis) === */
(function(){
  function q(sel, root){ return (root||document).querySelector(sel); }
  function qa(sel, root){ return Array.prototype.slice.call((root||document).querySelectorAll(sel)); }
  function txt(el){ return (el && el.textContent||"").trim(); }

  function findMarketCard(){
    var heads = qa(".section-title, h2, h3");
    for(var i=0;i<heads.length;i++){
      var t = txt(heads[i]).toLowerCase();
      if(t.includes("market intelligence") && t.includes("competitor analysis")){
        return heads[i].closest(".card") || heads[i].parentElement;
      }
    }
    return null;
  }

  function ensureTable(card){
    var table = card.querySelector("table");
    if(!table) return null;
    var thead = table.querySelector("thead");
    if(!thead){
      thead = document.createElement("thead");
      var trh = document.createElement("tr");
      trh.innerHTML = "<th>Competitor</th><th>Current Price</th><th>Change</th><th>AI Status</th><th>Actions</th>";
      thead.appendChild(trh);
      table.insertBefore(thead, table.firstChild);
    }else{
      var trh = thead.querySelector("tr") || thead.appendChild(document.createElement("tr"));
      var ths = trh.querySelectorAll("th");
      if(!ths.length || ths[ths.length-1].textContent.trim().toLowerCase()!=="actions"){
        var th = document.createElement("th"); th.textContent = "Actions"; trh.appendChild(th);
      }
    }
    var tbody = table.querySelector("tbody");
    if(!tbody){
      tbody = document.createElement("tbody"); table.appendChild(tbody);
    }
    return {table:table, tbody:tbody};
  }

  function readRows(tbody){
    var rows = [];
    qa("tr", tbody).forEach(function(tr){
      var tds = tr.querySelectorAll("td");
      if(tds.length){
        rows.push({
          name: txt(tds[0]),
          price: tds[1]?txt(tds[1]):"",
          change: tds[2]?txt(tds[2]):"",
          status: tds[3]?txt(tds[3]):""
        });
      }
    });
    return rows.filter(function(r){ return r.name; });
  }

  function writeRows(tbody, rows){
    tbody.innerHTML = "";
    rows.forEach(function(r){
      var tr = document.createElement("tr");
      tr.innerHTML = ""
        + "<td class='mi-name' contenteditable='true'>" + (r.name||"") + "</td>"
        + "<td class='mi-price' contenteditable='true'>" + (r.price||"") + "</td>"
        + "<td class='mi-change' contenteditable='true'>" + (r.change||"") + "</td>"
        + "<td class='mi-status' contenteditable='true'>" + (r.status||"") + "</td>"
        + "<td class='mi-actions'><button class='btn btn-sm mi-delete' title='Delete'>Delete</button></td>";
      tbody.appendChild(tr);
    });
  }

  function save(tbody, KEY){
    try{
      var rows=[];
      qa("tr", tbody).forEach(function(tr){
        rows.push({
          name: txt(tr.querySelector(".mi-name")),
          price: txt(tr.querySelector(".mi-price")),
          change: txt(tr.querySelector(".mi-change")),
          status: txt(tr.querySelector(".mi-status"))
        });
      });
      localStorage.setItem(KEY, JSON.stringify(rows));
      window.dispatchEvent(new Event('mi-table-updated'));
    }catch(_){}
  }

  function addBar(card, tbody, KEY){
    var holder = document.createElement("div");
    holder.className = "mi-addbar";
    holder.style.cssText = "display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin:12px 8px 8px 8px";
    holder.innerHTML = ""
      + "<input class='input mi-in-name' placeholder='Competitor name' />"
      + "<input class='input mi-in-price' placeholder='Current price' />"
      + "<input class='input mi-in-change' placeholder='Change %' />"
      + "<select class='select mi-in-status'><option>Monitoring</option><option>Stable</option><option>Risk</option></select>"
      + "<button class='btn primary mi-add'>Add</button>";
    card.appendChild(holder);
    holder.querySelector(".mi-add").addEventListener("click", function(){
      var name = holder.querySelector(".mi-in-name").value.trim();
      if(!name) return;
      var price = holder.querySelector(".mi-in-price").value.trim();
      var change = holder.querySelector(".mi-in-change").value.trim();
      var status = holder.querySelector(".mi-in-status").value;
      var tr = document.createElement("tr");
      tr.innerHTML = ""
        + "<td class='mi-name' contenteditable='true'>" + name + "</td>"
        + "<td class='mi-price' contenteditable='true'>" + price + "</td>"
        + "<td class='mi-change' contenteditable='true'>" + change + "</td>"
        + "<td class='mi-status' contenteditable='true'>" + status + "</td>"
        + "<td class='mi-actions'><button class='btn btn-sm mi-delete'>Delete</button></td>";
      tbody.appendChild(tr);
      save(tbody, KEY);
      holder.querySelector(".mi-in-name").value = "";
      holder.querySelector(".mi-in-price").value = "";
      holder.querySelector(".mi-in-change").value = "";
      holder.querySelector(".mi-in-status").value = "Monitoring";
    });
  }

  function initCRUD(){
    var card = findMarketCard(); if(!card) return;
    var refs = ensureTable(card); if(!refs) return;
    var table = refs.table, tbody = refs.tbody;
    var KEY = "market_intel_competitors";
    var saved = null; try{ saved = JSON.parse(localStorage.getItem(KEY)||"null"); }catch(_){}
    var base = readRows(tbody);
    writeRows(tbody, (Array.isArray(saved)&&saved.length)? saved : base);

    table.addEventListener("click", function(e){
      var del = e.target.closest(".mi-delete");
      if(del){ var tr = del.closest("tr"); if(tr) tr.remove(); save(tbody, KEY); }
    });
    tbody.addEventListener("blur", function(e){
      var el = e.target;
      if(el && el.matches(".mi-name,.mi-price,.mi-change,.mi-status")) save(tbody, KEY);
    }, true);

    addBar(card, tbody, KEY);
  }

  // Map sync: pins from table rows, blue chips already styled
  function initMapSync(){
    function debounce(fn, ms){ var t; return function(){ var a=arguments; clearTimeout(t); t=setTimeout(function(){ fn.apply(null,a); }, ms); }; }
    var map = document.getElementById("weather-radar-map");
    if(!map) return;
    var layer = map.querySelector(".geo-markers");
    if(!layer){ layer = document.createElement("div"); layer.className="geo-markers"; map.appendChild(layer); }
    function qa(root){ return Array.prototype.slice.call(root.querySelectorAll("tr")); }
    function posFor(name){
      var h=0; for(var i=0;i<name.length;i++){ h=(h*31+name.charCodeAt(i))>>>0; }
      var a=(h%360)*Math.PI/180, r=18+(h%12);
      var x=50+Math.cos(a)*r, y=50+Math.sin(a)*r;
      x=Math.max(4,Math.min(96,x)); y=Math.max(4,Math.min(96,y));
      return {left:x.toFixed(1)+"%", top:y.toFixed(1)+"%"};
    }
    function render(){
      // find table again each render
      var card = findMarketCard(); if(!card) return;
      var table = card.querySelector("table"); if(!table) return;
      var tbody = table.querySelector("tbody"); if(!tbody) return;
      Array.prototype.slice.call(layer.querySelectorAll(".geo-marker.mi-competitor")).forEach(function(n){n.remove();});
      qa(tbody).forEach(function(tr){
        var name = (tr.querySelector(".mi-name")||{}).textContent || (tr.cells && tr.cells[0] && tr.cells[0].textContent) || "";
        name = (name||"").trim();
        if(!name) return;
        var p = posFor(name);
        var m = document.createElement("div");
        m.className="geo-marker mi-competitor";
        m.style.position="absolute"; m.style.top=p.top; m.style.left=p.left;
        m.innerHTML = "<div class='marker-icon'>🏌️</div><div class='marker-label'></div>";
        m.querySelector(".marker-label").textContent = name;
        layer.appendChild(m);
      });
    }
    var safeRender = debounce(render, 60);
    render();
    window.addEventListener("mi-table-updated", safeRender);
    // Keep in sync with DOM edits: observe only the competitor table tbody
    (function(){
      var card = findMarketCard(); if(!card) return;
      var table = card.querySelector("table"); if(!table) return;
      var tbody = table.querySelector("tbody"); if(!tbody) return;
      var mo = new MutationObserver(function(){ safeRender(); });
      mo.observe(tbody, {subtree:true, childList:true, characterData:true});
    })();
  }

  function init(){
    initCRUD();
    initMapSync();
  }

  if(document.readyState === "loading"){ document.addEventListener("DOMContentLoaded", init); } else { init(); }
})();
</script>

<script>
/* === Elite GM Module (embedded) === */
;(function(window, React, ReactDOM){ 
  try {


    // Expose a global mount using the local GMEliteDashboard from this scope
    window.mountEliteGM = function(container){
  try {
    console.log('React version:', window.React && React.version);
    console.log('ReactDOM available:', typeof window.ReactDOM);
    console.log('createRoot available:', window.ReactDOM && typeof window.ReactDOM.createRoot);

    if (window.ReactDOM && typeof ReactDOM.createRoot === 'function') {
      var root = ReactDOM.createRoot(container);
      root.render(React.createElement(GMEliteDashboard));
      return;
    }
    if (window.ReactDOM && typeof ReactDOM.render === 'function') {
      ReactDOM.render(React.createElement(GMEliteDashboard), container);
      return;
    }
    console.error('ReactDOM not loaded yet. Retrying in 300ms...');
    setTimeout(function(){ window.mountEliteGM(container); }, 300);
  } catch (e) {
    console.error('Elite mount error', e);
  }
};
  } catch (e) {
    console.error('Elite module load error', e);
  }
})(window, window.React, window.ReactDOM);
</script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.js"></script>
    <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script>
        const { useState, useEffect, useMemo } = React;
        const { createRoot } = ReactDOM;
        const { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, CartesianGrid, Legend, Cell, PieChart, Pie } = Recharts;

        // ------------------------------------------------------------
        // i18n (English, Thai, Korean, Japanese)
        // ------------------------------------------------------------
        const LANGUAGES = ["en", "th", "ko", "ja"];
        const translations = {
            // KPI labels
            "Rounds Today": { en: "Rounds Today", th: "รอบวันนี้", ko: "오늘 라운드", ja: "本日のラウンド" },
            "Revenue Today": { en: "Revenue Today", th: "รายได้วันนี้", ko: "오늘 수익", ja: "本日の収益" },
            "Avg Min/Hole": { en: "Avg Min/Hole", th: "นาที/หลุม เฉลี่ย", ko: "평균 분/홀", ja: "平均分/ホール" },
            "Caddies In Use": { en: "Caddies In Use", th: "แคดดี้ที่ใช้งาน", ko: "사용 중 캐디", ja: "使用中キャディ" },
            "Carts Active": { en: "Carts Active", th: "รถกอล์ฟที่ใช้งาน", ko: "사용 중 카트", ja: "稼働中カート" },
            "Society Share": { en: "Society Share", th: "สังคมกอล์ฟ", ko: "소사이어티 비중", ja: "社交ゴルフ割合" },
            "Active Alerts": { en: "Active Alerts", th: "การแจ้งเตือน", ko: "활성 알림", ja: "アクティブアラート" },

            // Section titles
            "Revenue by Source • Today": { en: "Revenue by Source • Today", th: "รายได้ตามแหล่งที่มา • วันนี้", ko: "오늘 소스별 수익", ja: "収益の内訳・本日" },
            "Rounds Breakdown • Today": { en: "Rounds Breakdown • Today", th: "รายละเอียดรอบ • วันนี้", ko: "오늘 라운드 내역", ja: "ラウンド内訳・本日" },
            "Department Revenue • Today": { en: "Department Revenue • Today", th: "รายได้แผนก • วันนี้", ko: "오늘 부서 수익", ja: "部門別収益・本日" },

            // Slide-over titles
            "Rounds Breakdown": { en: "Rounds Breakdown", th: "รายละเอียดรอบ", ko: "라운드 내역", ja: "ラウンド内訳" },
            "Revenue by Channel": { en: "Revenue by Channel", th: "รายได้ตามช่องทาง", ko: "채널별 수익", ja: "チャネル別収益" },
            "Society Share Detail": { en: "Society Share", th: "สังคมกอล์ฟ", ko: "소사이어티 비중", ja: "社交ゴルフ割合" },
            "Caddie Utilization": { en: "Caddie Utilization", th: "การใช้งานแคดดี้", ko: "캐디 활용", ja: "キャディ稼働状況" },
            "Department Revenue": { en: "Department Revenue", th: "รายได้แผนก", ko: "부서 수익", ja: "部門別収益" },
            "Close": { en: "Close", th: "ปิด", ko: "닫기", ja: "閉じる" },

            // Data labels / axes / legends
            "Members": { en: "Members", th: "สมาชิก", ko: "회원", ja: "会員" },
            "Guests": { en: "Guests", th: "แขก", ko: "게스트", ja: "ゲスト" },
            "Walk-ins": { en: "Walk-ins", th: "ผู้มาใช้บริการ", ko: "현장 방문", ja: "当日客" },
            "Societies": { en: "Societies", th: "สังคมกอล์ฟ", ko: "소사이어티", ja: "社交ゴルフ" },
            "Tournaments": { en: "Tournaments", th: "ทัวร์นาเมนต์", ko: "토너먼트", ja: "トーナメント" },
            "Green Fee": { en: "Green Fee", th: "กรีนฟี", ko: "그린피", ja: "グリーンフィー" },
            "Caddy Fee": { en: "Caddy Fee", th: "ค่าแคดดี้", ko: "캐디 비용", ja: "キャディ料金" },
            "Cart": { en: "Cart", th: "รถกอล์ฟ", ko: "카트", ja: "カート" },
            "F&B": { en: "F&B", th: "อาหารและเครื่องดื่ม", ko: "식음료", ja: "飲食" },
            "Pro Shop": { en: "Pro Shop", th: "โปรช็อป", ko: "프로샵", ja: "プロショップ" },
            "Lessons": { en: "Lessons", th: "บทเรียน", ko: "레슨", ja: "レッスン" },
            "Events": { en: "Events", th: "อีเวนต์", ko: "이벤트", ja: "イベント" },
            "Tournaments": { en: "Tournaments", th: "ทัวร์นาเมนต์", ko: "토너먼트", ja: "トーナメント" },
            "Membership Dues": { en: "Membership Dues", th: "ค่าธรรมเนียมสมาชิก", ko: "회원비", ja: "회費" },

            // Misc UI text
            "Updated": { en: "Updated", th: "อัปเดต", ko: "업데이트", ja: "更新" },
            "Total rounds:": { en: "Total rounds:", th: "รอบทั้งหมด:", ko: "총 라운드:", ja: "総ラウンド:" },
            "Total:": { en: "Total:", th: "รวม:", ko: "합계:", ja: "合計:" },
            "Caddies in use:": { en: "Caddies in use:", th: "แคดดี้ที่ใช้งาน:", ko: "사용 중 캐디:", ja: "使用中キャディ:" },
            "Booked Online": { en: "Booked Online", th: "จองออนไลน์", ko: "온라인 예약", ja: "オンライン予約" },
            "Booked via Check-in (Call-in)": { en: "Booked via Check-in (Call-in)", th: "จองผ่านเช็คอิน (โทร)", ko: "체크인(전화) 예약", ja: "チェックイン(電話)予約" },
            "Booked via Check-in": { en: "Booked via Check-in", th: "จองผ่านเช็คอิน", ko: "체크인 예약", ja: "チェックイン予약" },
            "From Rotation": { en: "From Rotation", th: "จากคิวหมุนเวียน", ko: "로테이션", ja: "ローテーション" },
            "Guests / Non-members": { en: "Guests / Non-members", th: "แขก / ไม่เป็นสมาชิก", ko: "게스트/비회원", ja: "ゲスト/非会員" },
            "rounds": { en: "rounds", th: "รอบ", ko: "라운드", ja: "ラウンド" },
            "Fill": { en: "fill", th: "การใช้", ko: "충원", ja: "充足" },
            "Total In Use": { en: "Total In Use", th: "ใช้งานทั้งหมด", ko: "총 사용", ja: "総稼働" },
            "of": { en: "of", th: "จาก", ko: "중", ja: "の" }
        };

        function t(label, lang) {
            return translations[label]?.[lang] ?? label;
        }

        // ------------------------------------------------------------
        // Helpers
        // ------------------------------------------------------------
        // High-contrast, premium palette (accessible on white)
        const SOURCE_COLORS = [
            "#2563EB", // royal blue
            "#10B981", // emerald
            "#F59E0B", // amber
            "#8B5CF6", // violet
            "#EF4444", // red
            "#14B8A6", // teal
            "#F43F5E", // rose
            "#111827", // near-black
        ];
        const nowHHMM = () => new Date().toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
        fmtTHB = (n) =>
            new Intl.NumberFormat("en-TH", { style: "currency", currency: "THB", maximumFractionDigits: 0 }).format(n);

        // Live seed to fake real-time updates
        function useLiveFeed(intervalMs = 5000) {
            const [tick, setTick] = useState(0);
            useEffect(() => {
                const id = setInterval(() => setTick((t) => t + 1), intervalMs);
                return () => clearInterval(id);
            }, [intervalMs]);
            return { seed: tick % 60 };
        }

        const rnd = (seed, base, spread) => Math.round(base + Math.sin(seed) * spread);
        const societyPercent = (v) => `${v}%`;

        // ------------------------------------------------------------
        // Data Generators
        // ------------------------------------------------------------
        function makeRoundsBreakdown(seed) {
            const members = Math.max(80, rnd(seed + 2, 120, 30));
            const guests = Math.max(40, rnd(seed + 3, 86, 26));
            const walkins = Math.max(20, rnd(seed + 5, 44, 18));
            const societies = Math.max(60, rnd(seed + 6, 92, 22));
            const tournaments = Math.max(15, rnd(seed + 7, 38, 12));
            const data = [
                { name: "Members", value: members },
                { name: "Guests", value: guests },
                { name: "Walk-ins", value: walkins },
                { name: "Societies", value: societies },
                { name: "Tournaments", value: tournaments },
            ];
            const total = data.reduce((a, b) => a + b.value, 0);
            return { data, total };
        }

        function makeSocietyDaily(seed) {
            const names = [
                "Thai Eagles",
                "Baba Links Pattaya",
                "Bangkok Lions",
                "Siam Sunday",
                "Eastern Seaboard",
                "Chonburi Aces",
                "Rayong Rovers",
                "Pattaya Panthers",
                "Jomtien Jaguars",
                "Naklua Knights",
            ];
            const rows = names.map((n, i) => {
                const rounds = Math.max(8, Math.round(18 + i * 2 + (Math.sin(seed + i) + 1) * 6));
                const avgSpend = 2200 + i * 60 + Math.round((Math.cos(seed + i) + 1) * 120);
                const revenue = rounds * avgSpend;
                const fill = Math.min(100, 65 + ((i * 7) % 20) + Math.round((Math.sin(seed + i) + 1) * 8));
                return { society: n, rounds, avgSpend, revenue, fill };
            });
            const totalSocietyRounds = rows.reduce((a, b) => a + b.rounds, 0);
            const totalSocietyRevenue = rows.reduce((a, b) => a + b.revenue, 0);
            return { rows, totalSocietyRounds, totalSocietyRevenue };
        }

        function makeRevenueBreakdown(seed) {
            const { data } = makeRoundsBreakdown(seed);
            const yieldMap = {
                Members: 1800,
                Guests: 2500,
                "Walk-ins": 2200,
                Societies: 2000,
                Tournaments: 2800,
            };
            const rows = data.map((r) => ({
                channel: r.name,
                rounds: r.value,
                revenue: r.value * (yieldMap[r.name] ?? 2000),
            }));
            const total = rows.reduce((a, b) => a + b.revenue, 0);
            return { rows, total };
        }

        function makeRevenueBySource(seed) {
            const base = [
                { name: "Green Fee", value: 420000 },
                { name: "Caddy Fee", value: 180000 },
                { name: "Cart", value: 125000 },
                { name: "F&B", value: 145000 },
                { name: "Pro Shop", value: 88000 },
                { name: "Lessons", value: 35000 },
                { name: "Events", value: 85000 },
                { name: "Tournaments", value: 95000 },
                { name: "Membership Dues", value: 165000 },
            ];
            return base.map((d, i) => ({
                ...d,
                value: Math.max(0, Math.round(d.value * (0.88 + (Math.sin(seed + i) + 1) / 8))),
            }));
        }

        // Caddie usage: online vs call-in (check-in) vs rotation, plus who booked
        function makeCaddyUsage(seed) {
            const avail = 200; // Increased total available caddies
            const totalInUse = Math.max(95, rnd(seed + 7, 165, 25)); // Higher usage

            // Ensure ONLINE is dominant booking mode with better distribution
            let online = Math.max(40, Math.round(totalInUse * (0.62 + (Math.sin(seed + 13) + 1) * 0.06))); // ~62% - 74%
            let viaCheckin = Math.max(15, Math.round(totalInUse * (0.18 + (Math.cos(seed + 14) + 1) * 0.04))); // ~18% - 26%
            let tournaments = Math.max(8, Math.round(totalInUse * (0.08 + (Math.sin(seed + 15) + 1) * 0.03))); // ~8% - 14%
            // The remainder is rotation
            let fromRotation = Math.max(0, totalInUse - online - viaCheckin - tournaments);

            if (online <= viaCheckin) {
                const bump = viaCheckin - online + 5;
                online = Math.min(totalInUse - tournaments, online + bump);
                fromRotation = Math.max(0, totalInUse - online - viaCheckin - tournaments);
            }

            const bookedTotal = online + viaCheckin;

            // booked channel split must equal bookedTotal (Members / Societies / Guests)
            let members = Math.max(15, rnd(seed + 9, Math.round(bookedTotal * 0.38), 12));
            let societies = Math.max(18, rnd(seed + 10, Math.round(bookedTotal * 0.42), 15));
            let guests = Math.max(8, bookedTotal - members - societies);
            const normSum = members + societies + guests;
            if (normSum !== bookedTotal) {
                const diff = bookedTotal - normSum;
                members = Math.max(0, members + diff);
            }

            return { totalInUse, online, viaCheckin, tournaments, fromRotation, booked: { members, societies, guests }, avail };
        }

        function makeDepartmentBreakdown(seed) {
            const departments = [
                { name: "F&B", value: rnd(seed, 120000, 20000) },
                { name: "Pro Shop", value: rnd(seed + 1, 72000, 10000) },
                { name: "Front Desk", value: rnd(seed + 2, 30000, 5000) },
                { name: "Kiosk", value: rnd(seed + 3, 20000, 5000) },
                { name: "Lessons", value: rnd(seed + 4, 22000, 4000) },
                { name: "Events", value: rnd(seed + 5, 54000, 7000) },
            ];
            const total = departments.reduce((a, b) => a + b.value, 0);
            return { departments, total };
        }

        // ------------------------------------------------------------
        // KPI builder
        // ------------------------------------------------------------
        function kpiData(seed, roundsToday, revenueToday, societySharePct, caddyUsage) {
            const pace = rnd(seed + 2, 13, 2.5);
            const carts = { used: rnd(seed + 4, 105, 8), fleet: 140 };
            const alerts = rnd(seed + 6, 2, 3);
            return [
                { key: "rounds", label: "Rounds Today", value: String(roundsToday), delta: Math.round((roundsToday - 330) / 3.3) },
                { key: "revenue", label: "Revenue Today", value: fmtTHB(revenueToday), delta: Math.round((revenueToday - 950000) / 9500) },
                { key: "pace", label: "Avg Min/Hole", value: String(pace), delta: -(pace - 12.5) * 8 },
                { key: "caddies", label: "Caddies In Use", value: `${caddyUsage.totalInUse}/${caddyUsage.avail}`, delta: Math.round((caddyUsage.totalInUse - 140) / 1.4) },
                { key: "carts", label: "Carts Active", value: `${carts.used}/${carts.fleet}`, delta: Math.round((carts.used - 100) / 1.0) },
                { key: "society", label: "Society Share", value: societyPercent(societySharePct), delta: Math.round((societySharePct - 45) * 2.2) },
                { key: "alerts", label: "Active Alerts", value: String(alerts), delta: alerts > 1 ? 15 : -12 },
            ];
        }

        // ------------------------------------------------------------
        // UI Pieces
        // ------------------------------------------------------------
        function KpiCard({ label, value, delta, onOpen }) {
            const positive = delta >= 0;
            return React.createElement(
                'button',
                {
                    className: "text-left border border-neutral-200 rounded-2xl bg-white hover:shadow-md transition-shadow p-4",
                    onClick: onOpen
                },
                React.createElement('div', { className: "text-neutral-500 text-sm" }, label),
                React.createElement(
                    'div',
                    { className: "mt-1 flex items-end justify-between" },
                    React.createElement('div', { className: "text-2xl font-semibold tracking-tight" }, value),
                    React.createElement(
                        'div',
                        {
                            className: `text-xs px-2.5 py-1 rounded-full ${positive ? "bg-emerald-50 text-emerald-700" : "bg-rose-50 text-rose-700"}`
                        },
                        (positive ? "▲" : "▼") + " " + Math.abs(delta) + "%"
                    )
                )
            );
        }

        function DepartmentDetails({ depts, total, lang }) {
            return React.createElement(
                'div',
                null,
                React.createElement(
                    'div',
                    { className: "mb-3" },
                    t("Total:", lang) + " ",
                    React.createElement('span', { className: "font-semibold" }, fmtTHB(total))
                ),
                React.createElement(
                    'div',
                    { className: "grid grid-cols-1 md:grid-cols-2 gap-6" },
                    React.createElement(
                        'div',
                        { className: "h-[260px]" },
                        React.createElement(
                            ResponsiveContainer,
                            { width: "100%", height: "100%" },
                            React.createElement(
                                PieChart,
                                null,
                                React.createElement(
                                    Pie,
                                    { data: depts, dataKey: "value", nameKey: "name", innerRadius: 50, outerRadius: 90 },
                                    depts.map((_, i) =>
                                        React.createElement(Cell, { key: i, fill: SOURCE_COLORS[i % SOURCE_COLORS.length] })
                                    )
                                ),
                                React.createElement(Tooltip, { formatter: (v) => fmtTHB(Number(v)) }),
                                React.createElement(Legend, { formatter: (v) => t(String(v), lang) })
                            )
                        )
                    ),
                    React.createElement(
                        'div',
                        { className: "text-sm space-y-2" },
                        depts.map((d) =>
                            React.createElement(
                                'div',
                                { key: d.name, className: "flex items-center justify-between border rounded-xl p-2" },
                                React.createElement('div', null, t(d.name, lang)),
                                React.createElement('div', { className: "font-medium" }, fmtTHB(d.value))
                            )
                        )
                    )
                )
            );
        }

        function SocietyShareDetails({ rows, totalRounds, totalSocietyRounds, lang }) {
            const pct = Math.round((totalSocietyRounds / Math.max(1, totalRounds)) * 100);
            return React.createElement(
                'div',
                null,
                React.createElement(
                    'div',
                    { className: "mb-3 text-sm" },
                    "Society rounds: ",
                    React.createElement('span', { className: "font-semibold" }, totalSocietyRounds),
                    " " + (t("of", lang) ?? "of") + " " + totalRounds + " (" + pct + "%)"
                ),
                React.createElement(
                    'div',
                    { className: "grid grid-cols-1 md:grid-cols-2 gap-6" },
                    React.createElement(
                        'div',
                        { className: "h-[280px]" },
                        React.createElement(
                            ResponsiveContainer,
                            { width: "100%", height: "100%" },
                            React.createElement(
                                BarChart,
                                { data: rows, layout: "vertical", margin: { top: 8, right: 16, left: 16, bottom: 8 } },
                                React.createElement(CartesianGrid, { vertical: false, stroke: "#eee" }),
                                React.createElement(XAxis, { type: "number", hide: true }),
                                React.createElement(YAxis, { type: "category", dataKey: "society", width: 160, tick: { fill: "#374151" } }),
                                React.createElement(Tooltip, { formatter: (v) => (typeof v === "number" ? v : v) }),
                                React.createElement(
                                    Bar,
                                    { dataKey: "rounds", radius: [0, 8, 8, 0] },
                                    rows.map((_, i) =>
                                        React.createElement(Cell, { key: i, fill: SOURCE_COLORS[i % SOURCE_COLORS.length] })
                                    )
                                )
                            )
                        )
                    ),
                    React.createElement(
                        'div',
                        { className: "text-sm space-y-2" },
                        rows.map((r) =>
                            React.createElement(
                                'div',
                                { key: r.society, className: "border rounded-xl p-2 flex items-center justify-between gap-3" },
                                React.createElement('div', { className: "min-w-[140px]" }, r.society),
                                React.createElement('div', { className: "opacity-70" }, r.rounds + " " + t("rounds", lang)),
                                React.createElement('div', { className: "opacity-70" }, t("Fill", lang) + " " + r.fill + "%"),
                                React.createElement('div', { className: "font-medium" }, fmtTHB(r.revenue))
                            )
                        )
                    )
                )
            );
        }

        function CaddyUsageDetails({ usage, lang }) {
            const modeRows = [
                { label: t("Booked Online", lang), value: usage.online },
                { label: t("Booked via Check-in (Call-in)", lang), value: usage.viaCheckin },
                { label: t("Tournaments", lang), value: usage.tournaments },
                { label: t("From Rotation", lang), value: usage.fromRotation },
            ];
            const channelRows = [
                { name: t("Members", lang), value: usage.booked.members },
                { name: t("Societies", lang), value: usage.booked.societies },
                { name: t("Guests / Non-members", lang), value: usage.booked.guests },
            ];
            return React.createElement(
                'div',
                null,
                React.createElement(
                    'div',
                    { className: "mb-3 text-sm" },
                    t("Caddies in use:", lang) + " ",
                    React.createElement('span', { className: "font-semibold" }, usage.totalInUse),
                    " " + (t("of", lang) ?? "of") + " " + usage.avail
                ),
                React.createElement(
                    'div',
                    { className: "grid grid-cols-1 md:grid-cols-2 gap-6" },
                    React.createElement(
                        'div',
                        { className: "h-[260px]" },
                        React.createElement(
                            ResponsiveContainer,
                            { width: "100%", height: "100%" },
                            React.createElement(
                                BarChart,
                                { data: modeRows, margin: { top: 10, right: 10, left: 0, bottom: 0 } },
                                React.createElement(CartesianGrid, { vertical: false, stroke: "#eee" }),
                                React.createElement(XAxis, { dataKey: "label", tick: { fill: "#374151" } }),
                                React.createElement(YAxis, { allowDecimals: false, tick: { fill: "#374151" } }),
                                React.createElement(Tooltip),
                                React.createElement(
                                    Bar,
                                    { dataKey: "value", radius: [8, 8, 0, 0] },
                                    modeRows.map((_, i) =>
                                        React.createElement(Cell, { key: i, fill: SOURCE_COLORS[i % SOURCE_COLORS.length] })
                                    )
                                )
                            )
                        )
                    ),
                    React.createElement(
                        'div',
                        { className: "h-[260px]" },
                        React.createElement(
                            ResponsiveContainer,
                            { width: "100%", height: "100%" },
                            React.createElement(
                                BarChart,
                                { data: channelRows, margin: { top: 10, right: 10, left: 0, bottom: 0 } },
                                React.createElement(CartesianGrid, { vertical: false, stroke: "#eee" }),
                                React.createElement(XAxis, { dataKey: "name", tick: { fill: "#374151" } }),
                                React.createElement(YAxis, { allowDecimals: false, tick: { fill: "#374151" } }),
                                React.createElement(Tooltip),
                                React.createElement(
                                    Bar,
                                    { dataKey: "value", radius: [8, 8, 0, 0] },
                                    channelRows.map((_, i) =>
                                        React.createElement(Cell, { key: i, fill: SOURCE_COLORS[i % SOURCE_COLORS.length] })
                                    )
                                )
                            )
                        )
                    )
                ),
                React.createElement(
                    'div',
                    { className: "mt-4 grid grid-cols-5 gap-3 text-sm" },
                    React.createElement(
                        'div',
                        { className: "border rounded-xl p-3" },
                        React.createElement('div', { className: "text-neutral-500" }, t("Booked Online", lang)),
                        React.createElement('div', { className: "text-lg font-semibold" }, usage.online)
                    ),
                    React.createElement(
                        'div',
                        { className: "border rounded-xl p-3" },
                        React.createElement('div', { className: "text-neutral-500" }, t("Booked via Check-in", lang)),
                        React.createElement('div', { className: "text-lg font-semibold" }, usage.viaCheckin)
                    ),
                    React.createElement(
                        'div',
                        { className: "border rounded-xl p-3" },
                        React.createElement('div', { className: "text-neutral-500" }, t("Tournaments", lang)),
                        React.createElement('div', { className: "text-lg font-semibold" }, usage.tournaments)
                    ),
                    React.createElement(
                        'div',
                        { className: "border rounded-xl p-3" },
                        React.createElement('div', { className: "text-neutral-500" }, t("From Rotation", lang)),
                        React.createElement('div', { className: "text-lg font-semibold" }, usage.fromRotation)
                    ),
                    React.createElement(
                        'div',
                        { className: "border rounded-xl p-3" },
                        React.createElement('div', { className: "text-neutral-500" }, t("Total In Use", lang)),
                        React.createElement('div', { className: "text-lg font-semibold" }, usage.totalInUse)
                    )
                )
            );
        }

        // ------------------------------------------------------------
        // Main Component
        // ------------------------------------------------------------
        function GMEliteDashboard() {
            const { seed } = useLiveFeed();
            const [lang, setLang] = useState("en");

            const rounds = useMemo(() => makeRoundsBreakdown(seed), [seed]);
            const societyDaily = useMemo(() => makeSocietyDaily(seed), [seed]);
            const rev = useMemo(() => makeRevenueBySource(seed), [seed]);
            const departments = useMemo(() => makeDepartmentBreakdown(seed), [seed]);
            const caddyUsage = useMemo(() => makeCaddyUsage(seed), [seed]);
            const revenueByChannel = useMemo(() => makeRevenueBreakdown(seed), [seed]);

            const societySharePct = useMemo(() => {
                const totalRounds = rounds.total;
                const sRounds = societyDaily.totalSocietyRounds;
                return Math.round((sRounds / Math.max(1, totalRounds)) * 100);
            }, [rounds, societyDaily]);

            const revenueToday = useMemo(() => rev.reduce((a, b) => a + b.value, 0), [rev]);
            const roundsToday = useMemo(() => rounds.total, [rounds]);
            const kpis = useMemo(
                () => kpiData(seed, roundsToday, revenueToday, societySharePct, caddyUsage),
                [seed, roundsToday, revenueToday, societySharePct, caddyUsage]
            );

            const [sheet, setSheet] = useState(null);

            // ----------------------------------------------------------
            // Self-tests (additive)
            // ----------------------------------------------------------
            useEffect(() => {
                // i18n basic checks
                const __modesSum = (caddyUsage.online||0) + (caddyUsage.viaCheckin||0) + (caddyUsage.tournaments||0) + (caddyUsage.fromRotation||0);
const __modesDiff = Math.abs(__modesSum - (caddyUsage.totalInUse||0));
console.log('[SANITY] caddieUsage modesSum=', __modesSum, 'totalInUse=', caddyUsage.totalInUse, 'diff=', __modesDiff);
const __bookedSum = (caddyUsage.booked?.members||0) + (caddyUsage.booked?.societies||0) + (caddyUsage.booked?.guests||0);
const __bookedModes = (caddyUsage.online||0) + (caddyUsage.viaCheckin||0);
console.log('[SANITY] bookedSum=', __bookedSum, 'bookedModes=', __bookedModes);
console.assert(Math.abs(__bookedSum - __bookedModes) <= 1, "Booked channel split matches booked modes");
                console.assert(caddyUsage.online > caddyUsage.viaCheckin, "Online bookings dominant");
            }, [rounds, revenueByChannel, caddyUsage]);

            return React.createElement(
                'div',
                { className: "min-h-screen bg-neutral-50 text-neutral-900" },
                // App bar
                React.createElement(
                    'div',
                    { className: "sticky top-0 z-10 backdrop-blur bg-white/90 border-b border-neutral-200" },
                    React.createElement(
                        'div',
                        { className: "mx-auto max-w-[1200px] px-4 py-3 flex items-center justify-between" },
                        React.createElement(
                            'div',
                            { className: "flex items-center gap-3" },
                            React.createElement(
                                'div',
                                { className: "h-8 w-8 rounded-2xl bg-neutral-900 grid place-items-center" },
                                React.createElement(
                                    'svg',
                                    {
                                        xmlns: "http://www.w3.org/2000/svg",
                                        className: "h-4 w-4 text-white",
                                        viewBox: "0 0 24 24",
                                        fill: "currentColor"
                                    },
                                    React.createElement('path', {
                                        d: "M12 2a7 7 0 0 1 7 7v3.268l1.447 2.894A1 1 0 0 1 19.553 17H4.447a1 1 0 0 1-.894-1.447L5 12.268V9a7 7 0 0 1 7-7zm-3 18a3 3 0 0 0 6 0H9z"
                                    })
                                )
                            ),
                            React.createElement('div', { className: "font-semibold tracking-tight" }, "MyCaddy Pro • GM Elite"),
                            React.createElement(
                                'span',
                                { className: "ml-3 text-xs text-neutral-500" },
                                t("Updated", lang) + " " + nowHHMM()
                            )
                        ),
                        React.createElement(
                            'select',
                            {
                                className: "ml-auto border rounded-lg px-2 py-1 text-sm",
                                value: lang,
                                onChange: (e) => setLang(e.target.value)
                            },
                            React.createElement('option', { value: "en" }, "English"),
                            React.createElement('option', { value: "th" }, "ไทย"),
                            React.createElement('option', { value: "ko" }, "한국어"),
                            React.createElement('option', { value: "ja" }, "日本語")
                        )
                    )
                ),

                // KPIs
                React.createElement(
                    'div',
                    { className: "mx-auto max-w-[1200px] px-4 py-6" },
                    React.createElement(
                        'div',
                        { className: "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-7 gap-4" },
                        kpis.map((k) =>
                            React.createElement(KpiCard, {
                                key: k.key,
                                label: t(k.label, lang),
                                value: k.value,
                                delta: k.delta,
                                onOpen: () => {
                                    if (k.key === "rounds") setSheet("rounds");
                                    if (k.key === "revenue") setSheet("revenue");
                                    if (k.key === "society") setSheet("society");
                                    if (k.key === "caddies") setSheet("caddies");
                                }
                            })
                        )
                    )
                ),

                // Main grid
                React.createElement(
                    'div',
                    { className: "mx-auto max-w-[1200px] px-4 pb-10 grid grid-cols-1 lg:grid-cols-3 gap-6" },
                    // Revenue by Source
                    React.createElement(
                        'div',
                        { className: "border border-neutral-200 rounded-2xl bg-white lg:col-span-2" },
                        React.createElement(
                            'div',
                            { className: "px-5 pt-4 pb-2 border-b border-neutral-100" },
                            React.createElement('h2', { className: "text-base font-semibold" }, t("Revenue by Source • Today", lang))
                        ),
                        React.createElement(
                            'div',
                            { className: "p-4" },
                            React.createElement(
                                'div',
                                { className: "h-[280px]" },
                                React.createElement(
                                    ResponsiveContainer,
                                    { width: "100%", height: "100%" },
                                    React.createElement(
                                        BarChart,
                                        { data: rev, margin: { top: 10, right: 10, left: 0, bottom: 0 } },
                                        React.createElement(CartesianGrid, { vertical: false, stroke: "#eee" }),
                                        React.createElement(XAxis, { dataKey: "name", tick: { fill: "#374151" }, tickFormatter: (v) => t(String(v), lang) }),
                                        React.createElement(YAxis, { tickFormatter: (v) => fmtTHB(v).replace("THB", "฿"), tick: { fill: "#374151" } }),
                                        React.createElement(Tooltip, { formatter: (v) => fmtTHB(Number(v)), cursor: { fill: "#f7f7f7" } }),
                                        React.createElement(
                                            Bar,
                                            { dataKey: "value", radius: [8, 8, 0, 0] },
                                            rev.map((_, i) =>
                                                React.createElement(Cell, { key: i, fill: SOURCE_COLORS[i % SOURCE_COLORS.length] })
                                            )
                                        ),
                                        React.createElement(Legend, { formatter: (v) => t(String(v), lang) })
                                    )
                                )
                            )
                        )
                    ),

                    // Rounds Breakdown
                    React.createElement(
                        'div',
                        { className: "border border-neutral-200 rounded-2xl bg-white" },
                        React.createElement(
                            'div',
                            { className: "px-5 pt-4 pb-2 border-b border-neutral-100" },
                            React.createElement('h2', { className: "text-base font-semibold" }, t("Rounds Breakdown • Today", lang))
                        ),
                        React.createElement(
                            'div',
                            { className: "p-4" },
                            React.createElement(
                                'div',
                                { className: "h-[240px]" },
                                React.createElement(
                                    ResponsiveContainer,
                                    { width: "100%", height: "100%" },
                                    React.createElement(
                                        PieChart,
                                        null,
                                        React.createElement(
                                            Pie,
                                            { data: rounds.data, dataKey: "value", nameKey: "name", innerRadius: 50, outerRadius: 90 },
                                            rounds.data.map((_, i) =>
                                                React.createElement(Cell, { key: i, fill: SOURCE_COLORS[i % SOURCE_COLORS.length] })
                                            )
                                        ),
                                        React.createElement(Tooltip),
                                        React.createElement(Legend, { formatter: (v) => t(String(v), lang) })
                                    )
                                )
                            ),
                            React.createElement(
                                'div',
                                { className: "mt-3 text-xs text-neutral-500" },
                                t("Total rounds:", lang) + " " + rounds.total
                            )
                        )
                    ),

                    // Department Breakdown
                    React.createElement(
                        'div',
                        { className: "border border-neutral-200 rounded-2xl bg-white lg:col-span-3" },
                        React.createElement(
                            'div',
                            { className: "px-5 pt-4 pb-2 border-b border-neutral-100" },
                            React.createElement('h2', { className: "text-base font-semibold" }, t("Department Revenue • Today", lang))
                        ),
                        React.createElement(
                            'div',
                            { className: "p-4" },
                            React.createElement(DepartmentDetails, { depts: departments.departments, total: departments.total, lang: lang })
                        )
                    )
                ),

                // Slide-over
                sheet && React.createElement(
                    'div',
                    { className: "fixed inset-0 z-30" },
                    React.createElement('div', { className: "absolute inset-0 bg-black/30", onClick: () => setSheet(null) }),
                    React.createElement(
                        'div',
                        { className: "absolute right-0 top-0 h-full w-full sm:w-[720px] bg-white shadow-xl p-6 overflow-auto" },
                        React.createElement(
                            'div',
                            { className: "flex items-center justify-between border-b pb-3" },
                            React.createElement(
                                'div',
                                { className: "text-lg font-semibold capitalize" },
                                sheet === "rounds" && t("Rounds Breakdown", lang),
                                sheet === "revenue" && t("Revenue by Channel", lang),
                                sheet === "society" && t("Society Share Detail", lang),
                                sheet === "caddies" && t("Caddie Utilization", lang),
                                sheet === "departments" && t("Department Revenue", lang)
                            ),
                            React.createElement(
                                'button',
                                { className: "px-3 py-1.5 rounded-lg border border-neutral-300", onClick: () => setSheet(null) },
                                t("Close", lang)
                            )
                        ),
                        React.createElement(
                            'div',
                            { className: "mt-4 text-sm text-neutral-700 space-y-4" },
                            sheet === "rounds" && React.createElement(
                                'div',
                                { className: "grid grid-cols-1 md:grid-cols-2 gap-6" },
                                React.createElement(
                                    'div',
                                    { className: "h-[260px]" },
                                    React.createElement(
                                        ResponsiveContainer,
                                        { width: "100%", height: "100%" },
                                        React.createElement(
                                            PieChart,
                                            null,
                                            React.createElement(
                                                Pie,
                                                { data: rounds.data, dataKey: "value", nameKey: "name", innerRadius: 60, outerRadius: 100 },
                                                rounds.data.map((_, i) =>
                                                    React.createElement(Cell, { key: i, fill: SOURCE_COLORS[i % SOURCE_COLORS.length] })
                                                )
                                            ),
                                            React.createElement(Tooltip),
                                            React.createElement(Legend, { formatter: (v) => t(String(v), lang) })
                                        )
                                    )
                                ),
                                React.createElement(
                                    'div',
                                    { className: "text-sm space-y-2" },
                                    rounds.data.map((r) =>
                                        React.createElement(
                                            'div',
                                            { key: r.name, className: "flex items-center justify-between border rounded-xl p-2" },
                                            React.createElement('div', null, t(r.name, lang)),
                                            React.createElement('div', { className: "font-medium" }, r.value)
                                        )
                                    )
                                )
                            ),

                            sheet === "revenue" && React.createElement(
                                'div',
                                { className: "grid grid-cols-1 md:grid-cols-2 gap-6" },
                                React.createElement(
                                    'div',
                                    { className: "h-[260px]" },
                                    React.createElement(
                                        ResponsiveContainer,
                                        { width: "100%", height: "100%" },
                                        React.createElement(
                                            BarChart,
                                            { data: revenueByChannel.rows },
                                            React.createElement(CartesianGrid, { vertical: false, stroke: "#eee" }),
                                            React.createElement(XAxis, { dataKey: "channel", tick: { fill: "#374151" }, tickFormatter: (v) => t(String(v), lang) }),
                                            React.createElement(YAxis, { tickFormatter: (v) => fmtTHB(v).replace("THB", "฿"), tick: { fill: "#374151" } }),
                                            React.createElement(Tooltip, { formatter: (v) => fmtTHB(Number(v)), cursor: { fill: "#f7f7f7" } }),
                                            React.createElement(
                                                Bar,
                                                { dataKey: "revenue", radius: [8, 8, 0, 0] },
                                                revenueByChannel.rows.map((_, i) =>
                                                    React.createElement(Cell, { key: i, fill: SOURCE_COLORS[i % SOURCE_COLORS.length] })
                                                )
                                            ),
                                            React.createElement(Legend, { formatter: (v) => t(String(v), lang) })
                                        )
                                    )
                                ),
                                React.createElement(
                                    'div',
                                    { className: "text-sm space-y-2" },
                                    revenueByChannel.rows.map((r) =>
                                        React.createElement(
                                            'div',
                                            { key: r.channel, className: "flex items-center justify-between border rounded-xl p-2" },
                                            React.createElement('div', null, t(r.channel, lang)),
                                            React.createElement('div', { className: "opacity-70" }, r.rounds + " " + t("rounds", lang)),
                                            React.createElement('div', { className: "font-medium" }, fmtTHB(r.revenue))
                                        )
                                    )
                                )
                            ),

                            sheet === "society" && React.createElement(SocietyShareDetails, {
                                rows: societyDaily.rows,
                                totalRounds: rounds.total,
                                totalSocietyRounds: societyDaily.totalSocietyRounds,
                                lang: lang
                            }),

                            sheet === "caddies" && React.createElement(CaddyUsageDetails, { usage: caddyUsage, lang: lang }),

                            sheet === "departments" && React.createElement(DepartmentDetails, {
                                depts: departments.departments,
                                total: departments.total,
                                lang: lang
                            })
                        )
                    )
                )
            );
        }

        // Initialize when DOM is loaded
        window.mountEliteGM = function(container){
  try {
    console.log('React version:', window.React && React.version);
    console.log('ReactDOM available:', typeof window.ReactDOM);
    console.log('createRoot available:', window.ReactDOM && typeof window.ReactDOM.createRoot);

    if (window.ReactDOM && typeof ReactDOM.createRoot === 'function') {
      var root = ReactDOM.createRoot(container);
      root.render(React.createElement(GMEliteDashboard));
      return;
    }
    if (window.ReactDOM && typeof ReactDOM.render === 'function') {
      ReactDOM.render(React.createElement(GMEliteDashboard), container);
      return;
    }
    console.error('ReactDOM not loaded yet. Retrying in 300ms...');
    setTimeout(function(){ window.mountEliteGM(container); }, 300);
  } catch (e) {
    console.error('Elite mount error', e);
  }
};
</script>

<script>
/* === Layout Cleanup: remove masthead, keep content tight === */
(function(){
  function removeMasthead(){
    try{
      var root = document.getElementById('daily-dashboard-root');
      if (!root) return;
      // Header container: <div class="mx-auto max-w-[1200px] px-4 py-3 flex items-center justify-between">
      var candidates = root.querySelectorAll('[class*="mx-auto"][class*="max-w-"][class*="justify-between"]');
      for (var i=0;i<candidates.length;i++){
        var el = candidates[i];
        var title = el.textContent || "";
        if (/MyCaddy\s*Pro/i.test(title) && el.querySelector('select')){
          el.parentNode && el.parentNode.removeChild(el);
          break;
        }
      }
    }catch(e){ console.error('Masthead removal failed', e); }
  }
  // After mount
  document.addEventListener('DOMContentLoaded', removeMasthead);
  setTimeout(removeMasthead, 300);
  setTimeout(removeMasthead, 1000);
  var tabs = document.getElementById('tabs') || document.querySelector('.tabs,[role="tablist"]');
  if (tabs){
    tabs.addEventListener('click', function(e){
      var t = e.target.closest('[data-module="daily"], #daily-tab, .daily-tab');
      if (t) setTimeout(removeMasthead, 50);
    });
  }
})();
</script>
</body>
</html>