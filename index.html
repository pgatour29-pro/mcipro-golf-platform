<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>MciPro - Professional Golf Course Management Platform</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- OpenStreetMap with Leaflet (Free Alternative) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">

    <!-- Firebase SDK for Production Cloud Sync -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

    <style>
        /* CSS Variables for Premium Theme */
        :root {
            --primary-50: #ecfdf5;
            --primary-100: #d1fae5;
            --primary-200: #a7f3d0;
            --primary-300: #6ee7b7;
            --primary-400: #34d399;
            --primary-500: #10b981;
            --primary-600: #059669;
            --primary-700: #047857;
            --primary-800: #065f46;
            --primary-900: #064e3b;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --blue-500: #3b82f6;
            --blue-600: #2563eb;
            --orange-500: #f97316;
            --orange-600: #ea580c;
            --purple-500: #8b5cf6;
            --purple-600: #7c3aed;
            --red-500: #ef4444;
            --red-600: #dc2626;
            --yellow-500: #eab308;
            --green-500: #22c55e;
            --emerald-500: #10b981;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--gray-50);
            color: var(--gray-900);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Screen Management */
        .screen {
            display: none;
            min-height: 100vh;
            width: 100%;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }

        /* Tab Management */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: slideUp 0.2s ease-out;
        }

        /* Premium UI Components */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border-radius: 20px;
        }

        .premium-gradient {
            background: linear-gradient(135deg, var(--primary-600), var(--primary-500));
        }

        .hero-gradient {
            background: linear-gradient(135deg, var(--primary-900) 0%, var(--primary-700) 25%, var(--primary-600) 50%, var(--blue-600) 75%, var(--purple-600) 100%);
        }

        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .card-hover:hover {
            transform: translateY(-6px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .btn-primary {
            background: var(--primary-600);
            color: white;
            padding: 14px 28px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .btn-primary:hover {
            background: var(--primary-700);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(5, 150, 105, 0.4);
        }

        .btn-secondary {
            background: var(--gray-600);
            color: white;
            padding: 14px 28px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-secondary:hover {
            background: var(--gray-700);
            transform: translateY(-2px);
        }

        .btn-logout {
            background: var(--red-600);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-logout:hover {
            background: var(--red-700);
            transform: translateY(-1px);
        }

        .tab-button {
            padding: 16px 32px;
            border: none;
            background: transparent;
            color: var(--gray-500);
            font-weight: 500;
            font-size: 15px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .tab-button:hover {
            color: var(--gray-700);
            background: var(--gray-50);
        }

        .tab-button.active {
            color: var(--blue-600);
            border-bottom-color: var(--blue-600);
            background: var(--blue-50);
            font-weight: 600;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 16px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .status-confirmed {
            background: var(--primary-100);
            color: var(--primary-800);
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-cancelled {
            background: #fee2e2;
            color: #991b1b;
        }

        .metric-card {
            background: white;
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--gray-200);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .metric-card:hover {
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .metric-value {
            font-size: 36px;
            font-weight: 900;
            color: var(--primary-600);
            line-height: 1;
            margin-bottom: 8px;
        }

        .metric-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .line-login-btn {
            background: #00c300;
            color: white;
            padding: 18px 32px;
            border-radius: 14px;
            border: none;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .line-login-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .line-login-btn:hover::before {
            left: 100%;
        }

        .line-login-btn:hover {
            background: #00b300;
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0, 195, 0, 0.4);
        }

        .otp-input {
            width: 56px;
            height: 56px;
            border: 3px solid var(--gray-300);
            border-radius: 12px;
            text-align: center;
            font-size: 20px;
            font-weight: 700;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
        }

        .otp-input:focus {
            outline: none;
            border-color: var(--primary-600);
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.15);
            transform: scale(1.05);
        }


        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(4px);
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 5px solid var(--gray-300);
            border-top: 5px solid var(--primary-600);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Form Styles */
        .form-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--gray-300);
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-600);
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
        }

        .form-label {
            display: block;
            font-weight: 700;
            color: var(--gray-700);
            margin-bottom: 10px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .metric-card {
                padding: 20px;
            }

            .metric-value {
                font-size: 28px;
            }

            .tab-button {
                padding: 8px 12px;
                font-size: 12px;
                min-width: auto;
                white-space: nowrap;
            }

            .btn-primary, .btn-secondary {
                padding: 12px 24px;
                font-size: 14px;
            }

            /* Mobile Header Fixes */
            .nav-header {
                padding: 0;
            }

            .nav-header .max-w-7xl {
                max-width: 100%;
                padding: 0 16px;
            }

            .nav-header .flex {
                flex-wrap: wrap;
                gap: 8px;
            }

            .nav-header h1 {
                font-size: 22.5px; /* 18px * 1.25 = 22.5px */
            }

            .nav-header p {
                font-size: 15px; /* 12px * 1.25 = 15px */
            }

            /* Mobile Navigation Tabs */
            .tab-navigation .flex {
                justify-content: flex-start;
                overflow-x: auto;
                scrollbar-width: none;
                -ms-overflow-style: none;
                padding-bottom: 8px;
            }

            .tab-navigation .flex::-webkit-scrollbar {
                display: none;
            }

            /* Horizontal Scrolling for Mobile Caddys */
            .scrollbar-hide {
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }

            /* Mobile Caddy Cards */
            @media (max-width: 768px) {
                .mobile-caddie-card {
                    min-width: 280px;
                    max-width: 280px;
                    flex-shrink: 0;
                    scroll-snap-align: start;
                }

                /* Smooth scrolling for mobile caddies */
                #promotionalCaddysContainer {
                    scroll-behavior: smooth;
                    scroll-snap-type: x mandatory;
                    overscroll-behavior-x: contain;
                    -webkit-overflow-scrolling: touch;
                }

                /* Add scroll indicators */
                .mobile-scroll-container {
                    position: relative;
                }

                .mobile-scroll-container::after {
                    content: '';
                    position: absolute;
                    top: 50%;
                    right: 8px;
                    transform: translateY(-50%);
                    width: 20px;
                    height: 20px;
                    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8));
                    pointer-events: none;
                    border-radius: 50%;
                }
            }

            .tab-navigation {
                border-bottom: 1px solid #e5e7eb;
                background: white;
            }

            /* Schedule Filter Buttons */
            .schedule-filter-btn {
                padding: 8px 16px;
                border-radius: 8px;
                border: 2px solid #e5e7eb;
                background: white;
                color: #6b7280;
                font-weight: 500;
                font-size: 14px;
                transition: all 0.2s;
                cursor: pointer;
            }

            .schedule-filter-btn:hover {
                border-color: #059669;
                color: #059669;
            }

            .schedule-filter-btn.active {
                border-color: #059669;
                background: #059669;
                color: white;
            }

            /* Schedule Item Cards */
            .schedule-item {
                border: 1px solid #e5e7eb;
                border-radius: 12px;
                padding: 20px;
                background: white;
                transition: all 0.2s;
            }

            .schedule-item:hover {
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            }

            .schedule-item.editing {
                border-color: #059669;
                background: #f0fdf4;
            }

            /* Mobile Button Groups */
            .nav-header .space-x-4 {
                gap: 8px;
                flex-wrap: wrap;
            }

            .nav-header .space-x-4 > * {
                margin-left: 0;
            }

            /* Emergency and Chat buttons on mobile */
            .emergency-btn {
                padding: 10px; /* 8px * 1.25 = 10px */
                min-width: 55px; /* 44px * 1.25 = 55px */
                height: 55px; /* 44px * 1.25 = 55px */
            }

            .btn-logout {
                padding: 10px 15px; /* 8px * 1.25 = 10px, 12px * 1.25 = 15px */
                font-size: 15px; /* 12px * 1.25 = 15px */
            }

            /* Chat button mobile optimization */
            .nav-header .btn-primary {
                padding: 10px 15px; /* 8px * 1.25 = 10px, 12px * 1.25 = 15px */
                font-size: 15px; /* 12px * 1.25 = 15px */
            }

            /* Grid layout adjustments for mobile */
            .grid {
                gap: 12px;
            }

            /* Hero sections mobile */
            .hero-section {
                padding: 16px;
                text-align: center;
            }

            .hero-section h2 {
                font-size: 24px;
            }

            /* Mobile stats cards */
            .stats-card {
                padding: 16px;
            }

            /* Mobile Chat Interface Styles */
            #chatModal {
                align-items: flex-start;
                justify-content: flex-start;
            }

            .chat-modal-container {
                border-radius: 0 !important;
                max-height: 100vh !important;
                height: 100vh !important;
                height: calc(var(--vh, 1vh) * 100) !important;
            }

            /* Mobile chat room view with proper viewport handling */
            #chatRoomView {
                height: 100vh;
                height: calc(var(--vh, 1vh) * 100);
                max-height: 100vh;
                max-height: calc(var(--vh, 1vh) * 100);
            }

            /* Mobile chat list view with proper viewport handling */
            #chatListView {
                height: 100vh;
                height: calc(var(--vh, 1vh) * 100);
                max-height: 100vh;
                max-height: calc(var(--vh, 1vh) * 100);
            }

            #chatListView {
                width: 100% !important;
            }

            #chatRoomView {
                width: 100% !important;
            }

            /* Mobile chat list items */
            #chatListView .hover\\:bg-gray-50:hover {
                background-color: #f9fafb;
            }

            #chatListView .active\\:bg-gray-100:active {
                background-color: #f3f4f6;
            }

            /* Mobile message bubbles */
            #mobileChatMessages .max-w-xs {
                max-width: 280px;
            }

            /* Mobile textarea */
            #mobileMessageInput {
                font-size: 16px !important; /* Prevent zoom on iOS */
                line-height: 1.4;
            }

            /* Mobile send button */
            #mobileSendButton {
                min-width: 44px;
                min-height: 44px;
            }

            /* Touch-friendly mobile header buttons */
            #mobileChatHeader button {
                min-width: 44px;
                min-height: 44px;
            }

            /* Mobile chat search */
            #chatListView input {
                font-size: 16px !important; /* Prevent zoom on iOS */
            }

            /* Mobile input area safe positioning */
            #chatRoomView > div:last-child {
                position: fixed !important;
                bottom: 0 !important;
                left: 0 !important;
                right: 0 !important;
                z-index: 1000 !important;
                background: white !important;
                border-top: 1px solid #e5e7eb !important;
                padding-bottom: env(safe-area-inset-bottom, 0px) !important;
                min-height: calc(60px + env(safe-area-inset-bottom, 0px)) !important;
            }

            /* Adjust chat messages area to account for fixed input */
            #mobileChatMessages {
                padding-bottom: calc(80px + env(safe-area-inset-bottom, 20px)) !important;
                height: calc(100vh - 60px - 80px - env(safe-area-inset-bottom, 20px)) !important;
                height: calc(calc(var(--vh, 1vh) * 100) - 60px - 80px - env(safe-area-inset-bottom, 20px)) !important;
            }

            /* Mobile chat header adjustments */
            #mobileChatHeader {
                position: sticky !important;
                top: 0 !important;
                z-index: 999 !important;
                background: white !important;
                border-bottom: 1px solid #e5e7eb !important;
            }

            /* Keyboard handling - prevent scrolling issues */
            #chatRoomView.keyboard-open #mobileChatMessages {
                height: calc(50vh - 80px) !important;
            }
        }

        /* Navigation Enhancement */
        .nav-header {
            background: white;
            border-bottom: 1px solid var(--gray-200);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 40;
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 3px solid var(--primary-200);
            object-fit: cover;
        }

        /* Emergency Button */
        .emergency-btn {
            background: var(--red-600);
            color: white;
            padding: 15px; /* 12px * 1.25 = 15px */
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .emergency-btn:hover {
            background: var(--red-700);
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        /* Advanced Status Indicators */
        .status-online {
            width: 12px;
            height: 12px;
            background: var(--green-500);
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7);
            }
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(34, 197, 94, 0);
            }
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
            }
        }

        @keyframes emergency-flash {
            0% { background: rgba(220, 38, 38, 0.95); }
            25% { background: rgba(245, 158, 11, 0.95); }
            50% { background: rgba(220, 38, 38, 0.95); }
            75% { background: rgba(245, 158, 11, 0.95); }
            100% { background: rgba(220, 38, 38, 0.95); }
        }

        /* Pro Shop POS System Styles */
        .category-tab {
            padding: 8px 16px;
            border: 1px solid var(--gray-300);
            border-radius: 20px;
            background: white;
            color: var(--gray-600);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .category-tab:hover {
            background: var(--gray-50);
            border-color: var(--purple-300);
        }

        .category-tab.active {
            background: var(--purple-600);
            border-color: var(--purple-600);
            color: white;
        }

        .product-card {
            padding: 12px;
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .product-card:hover {
            border-color: var(--purple-300);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        .product-image {
            margin-bottom: 8px;
        }

        .table-header {
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            color: var(--gray-900);
            border-bottom: 1px solid var(--gray-200);
        }

        .table-cell {
            padding: 12px 16px;
            font-size: 14px;
            color: var(--gray-900);
            border-bottom: 1px solid var(--gray-100);
        }

        /* Modal improvements */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.75);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(2px);
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            padding: 24px;
            margin: 20px;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Form improvements */
        .form-textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s ease;
            resize: vertical;
        }

        .form-textarea:focus {
            outline: none;
            border-color: var(--purple-500);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }

        /* Enhanced button styles */
        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
            font-weight: 500;
            border-radius: 6px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            text-decoration: none;
        }

        .btn-sm:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-sm.btn-outline {
            background: white;
            border: 1px solid var(--gray-300);
            color: var(--gray-700);
        }

        .btn-sm.btn-outline:hover:not(:disabled) {
            background: var(--gray-50);
            border-color: var(--gray-400);
        }

        .btn-sm.btn-primary {
            background: var(--purple-600);
            color: white;
        }

        .btn-sm.btn-primary:hover:not(:disabled) {
            background: var(--purple-700);
        }

        /* Responsive improvements */
        @media (max-width: 768px) {
            .product-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .category-tab {
                font-size: 13px;
                padding: 6px 12px;
            }

            .table-header,
            .table-cell {
                padding: 8px 12px;
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .modal-content {
                margin: 10px;
                padding: 16px;
            }
        }

        /* Profile Creation Styles */
        .role-selection-card {
            cursor: pointer;
        }

        .role-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            background: white;
            transition: all 0.2s ease;
            min-height: 80px;
        }

        .role-card:hover {
            border-color: var(--primary-500);
            background: var(--primary-50);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }

        .role-selection-card input:checked + .role-card {
            border-color: var(--primary-500);
            background: var(--primary-100);
            color: var(--primary-700);
        }

        .role-card .material-symbols-outlined {
            margin-bottom: 8px;
            color: var(--primary-600);
        }

        .role-selection-card input:checked + .role-card .material-symbols-outlined {
            color: var(--primary-700);
        }

        /* Language Selector Styles */
        .language-btn {
            width: 40px;
            height: 30px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.8);
            color: var(--gray-600);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
        }

        .language-btn:hover {
            background: rgba(255, 255, 255, 0.95);
            border-color: var(--primary-color);
            transform: translateY(-1px);
        }

        .language-btn.active {
            background: var(--blue-600);
            border-color: var(--blue-600);
            color: white;
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
            transform: translateY(-1px);
        }
    </style>

    <script>
        // Tailwind Configuration
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            200: '#a7f3d0',
                            300: '#6ee7b7',
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                            800: '#065f46',
                            900: '#064e3b'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        };

        // ===== GLOBAL STATE MANAGEMENT =====

        // ===== GLOBAL DATA CLEANUP SYSTEM =====
        function clearAllDemoData() {
            console.log('üßπ Clearing all demo data from application...');

            // List of data keys to preserve (only courses, caddies, societies)
            const preservedKeys = [
                'mcipro_user_profiles',
                'mci-pro-language',
                'caddie_system_data',
                'golf_courses_data',
                'societies_data',
                'mcipro_sync_users_',
                'last_local_sync',
                'last_local_update',
                'played_audio_alerts'
            ];

            // Keys to force remove (all demo/activity data)
            const demoDataKeys = [
                'mcipro_bookings',
                'mcipro_schedule',
                'schedule_items',
                'food_orders',
                'chat_messages',
                'maintenance_reports',
                'waitlist_data',
                'cart_data',
                'order_history',
                'rounds_history',
                'earnings_history',
                'payment_history',
                'notification_history',
                'search_history',
                'recent_activities',
                'performance_stats',
                'user_preferences',
                'activity_log'
            ];

            // Remove all demo data keys
            demoDataKeys.forEach(key => {
                localStorage.removeItem(key);
                console.log(`Removed: ${key}`);
            });

            // Also clear any profile-specific data except the profile definitions
            const allKeys = [];
            for (let i = 0; i < localStorage.length; i++) {
                allKeys.push(localStorage.key(i));
            }

            allKeys.forEach(key => {
                // Remove all data except the preserved keys
                if (!preservedKeys.some(preserved => key.includes(preserved)) &&
                    !key.startsWith('profile_') &&
                    !key.includes('language')) {
                    localStorage.removeItem(key);
                    console.log(`Cleaned: ${key}`);
                }
            });

            // Force empty data for all major systems
            localStorage.setItem('mcipro_bookings', JSON.stringify([]));
            localStorage.setItem('mcipro_schedule', JSON.stringify({ events: [] }));
            localStorage.setItem('schedule_items', JSON.stringify([]));
            localStorage.setItem('food_orders', JSON.stringify([]));
            localStorage.setItem('chat_messages', JSON.stringify([]));

            console.log('‚úÖ All demo data cleared - only courses, caddies, and societies preserved');
        }

        // ===== INTERNATIONALIZATION SYSTEM =====
        let currentLanguage = 'en';

        const translations = {
            en: {
                // Login Screen
                'app.title': 'MciPro',
                'app.subtitle': 'Professional Golf Course Management',
                'login.golfer': 'Login as Golfer',
                'login.caddie': 'Login as Caddy',
                'login.manager': 'Login as Manager',
                'login.proshop': 'Login as Pro Shop',

                // Navigation & Common
                'nav.logout': 'Logout',
                'nav.emergency': 'Emergency Alert',
                'common.back': 'Back',
                'common.next': 'Next',
                'common.save': 'Save',
                'common.cancel': 'Cancel',
                'common.close': 'Close',
                'common.loading': 'Loading...',
                'common.settings': 'Settings',

                // Manager Dashboard
                'manager.title': 'Manager Dashboard',
                'manager.welcome': 'Welcome back, Manager!',
                'manager.overview': 'Overview',
                'manager.staff': 'Staff Management',
                'manager.analytics': 'Analytics',
                'manager.reports': 'Reports',
                'manager.course.operations': 'Course Operations',
                'manager.managing': 'Managing Pattaya Golf Club',
                'manager.monthly.revenue': 'Monthly Revenue',
                'manager.holes.active': '18 Holes Active',
                'manager.staff.members': '47 Staff Members',
                'manager.satisfaction': '98% Satisfaction',
                'manager.todays.rounds': "Today's Rounds",
                'manager.active.caddies': 'Active Caddys',
                'manager.course.occupancy': 'Course Occupancy',
                'manager.emergency.alerts': 'Emergency Alerts',
                'manager.current.rounds': 'Current Rounds',
                'manager.staff.status': 'Staff Status',

                // Caddy Dashboard
                'caddie.title': 'Caddy Dashboard',
                'caddie.welcome': 'Welcome back, Caddy!',
                'caddie.overview': 'Overview',
                'caddie.assignments': 'Assignments',
                'caddie.tracking': 'Tracking',
                'caddie.reports': 'Reports',
                'caddie.earnings': 'Earnings',
                'caddie.monthly.earnings': 'Monthly Earnings',
                'caddie.elite.status': 'Elite Status',
                'caddie.current.round': 'Current Round',
                'caddie.performance': 'Performance',

                // Pro Shop
                'proshop.title': 'Pro Shop Dashboard',
                'proshop.welcome': 'Welcome back, Pro Shop!',
                'proshop.pos': 'Point of Sale',
                'proshop.inventory': 'Inventory',
                'proshop.sales': 'Sales Reports',
                'proshop.customers': 'Customers',
                'proshop.pos.title': 'Pro Shop POS',
                'proshop.equipment': 'Golf Equipment & Merchandise',
                'proshop.items': '450+ Items',
                'proshop.sales.today': '28 Sales Today',
                'proshop.service': '4.9‚òÖ Service',
                'proshop.todays.sales': "Today's Sales",
                'proshop.search.products': 'Search products...',
                'proshop.all.categories': 'All Categories',
                'proshop.golf.clubs': 'Golf Clubs',
                'proshop.golf.balls': 'Golf Balls',
                'proshop.apparel': 'Apparel',
                'proshop.accessories': 'Accessories',
                'proshop.beverages': 'Beverages',
                'proshop.snacks': 'Snacks',
                'proshop.shopping.cart': 'Shopping Cart',
                'proshop.cart.empty': 'Cart is empty',
                'proshop.add.products': 'Add products to start a sale',
                'proshop.subtotal': 'Subtotal:',
                'proshop.tax': 'Tax (7%):',
                'proshop.total': 'Total:',
                'proshop.cash.payment': 'Cash Payment',
                'proshop.card.payment': 'Card Payment',
                'proshop.payment.successful': 'Payment Successful!',
                'proshop.print.receipt': 'Print Receipt',
                'proshop.new.sale': 'New Sale',

                // Golfer Dashboard
                'golfer.title': 'Golfer Dashboard',
                'golfer.welcome': 'Welcome back',
                'golfer.overview': 'Overview',
                'golfer.booking': 'Booking',
                'golfer.food': 'Food & Drinks',
                'golfer.gps': 'GPS & Navigation',
                'golfer.emergency': 'Emergency',

                // Maintenance Dashboard
                'login.maintenance': 'Login as Maintenance',
                'maintenance.title': 'Maintenance Dashboard',
                'maintenance.welcome': 'Welcome back, Maintenance!',
                'maintenance.overview': 'Overview',
                'maintenance.course.updates': 'Course Updates',
                'maintenance.tasks': 'Task Management',
                'maintenance.equipment': 'Equipment',
                'maintenance.schedule': 'Schedule',
                'maintenance.course.maintenance': 'Course Maintenance',
                'maintenance.professional.care': 'Professional Golf Course Care',
                'maintenance.courses.active': '4 Courses Active',
                'maintenance.tasks.today': '12 Tasks Today',
                'maintenance.crew.members': '8 Crew Members',
                'maintenance.course.condition': 'Course Condition',
                'maintenance.excellent.rating': 'Excellent rating',
                'maintenance.holes.maintained': 'Holes Maintained',
                'maintenance.water.usage': 'Water Usage (hrs)',
                'maintenance.optimal.level': 'Optimal level',
                'maintenance.equipment.issues': 'Equipment Issues',
                'maintenance.needs.attention': 'Needs attention',
                'maintenance.pending.tasks': 'Pending Tasks',
                'maintenance.due.today': 'Due today',
                'maintenance.live.updates': 'Live Course Updates',
                'maintenance.report.conditions': 'Report course conditions with photos and detailed descriptions',
                'maintenance.submit.update': 'Submit Course Update',
                'maintenance.course.section': 'Course Section',
                'maintenance.select.section': 'Select course section...',
                'maintenance.hole.number': 'Hole Number',
                'maintenance.select.hole': 'Select hole number...',
                'maintenance.area.type': 'Area Type',
                'maintenance.select.area': 'Select area type...',
                'maintenance.tee.box': 'Tee Box',
                'maintenance.fairway': 'Fairway',
                'maintenance.rough': 'Rough',
                'maintenance.fairway.bunker': 'Fairway Bunker',
                'maintenance.greenside.bunker': 'Greenside Bunker',
                'maintenance.green': 'Green',
                'maintenance.flag.cup': 'Flag and Cup',
                'maintenance.issue.priority': 'Issue Priority',
                'maintenance.low.routine': 'Low - Routine maintenance',
                'maintenance.medium.attention': 'Medium - Needs attention',
                'maintenance.high.urgent': 'High - Urgent repair',
                'maintenance.critical.safety': 'Critical - Safety concern',
                'maintenance.description': 'Description',
                'maintenance.describe.issue': 'Describe the issue or condition in detail...',
                'maintenance.upload.photos': 'Upload Photos',
                'maintenance.click.upload': 'Click to upload photos or drag and drop',
                'maintenance.choose.photos': 'Choose Photos',
                'maintenance.submit.course.update': 'Submit Course Update',
                'maintenance.recent.updates': 'Recent Course Updates',
                'maintenance.all.courses': 'All Courses',

                // Emergency & Safety
                'emergency.alert': 'Emergency Alert',
                'emergency.select.type': 'Select the type of assistance you need',
                'emergency.safety.info': 'Safety Info',
                'emergency.course.safety': 'Course Safety Information',
                'emergency.alert.sent': 'Alert Sent Successfully',

                // Profile Creation
                'profile.create': 'Create Your Profile',
                'profile.choose.role': 'Choose your role and fill in your information',
                'profile.golfer.info': 'Golfer Information',
                'profile.caddie.info': 'Caddy Information',
                'profile.manager.info': 'Manager Information',
                'profile.proshop.info': 'Pro Shop Information',
                'profile.maintenance.info': 'Maintenance Information',
                'profile.handicap': 'Handicap',
                'profile.experience.level': 'Experience Level',
                'profile.select.level': 'Select level...',
                'profile.beginner': 'Beginner',
                'profile.intermediate': 'Intermediate',
                'profile.advanced': 'Advanced',
                'profile.professional': 'Professional',
                'profile.club.affiliation': 'Club Affiliation',
                'profile.select.society': 'Select society...',
                'profile.playing.style': 'Playing Style',
                'profile.years.experience': 'Years of Experience',
                'profile.specialty': 'Specialty',
                'profile.select.specialty': 'Select specialty...',
                'profile.championship.course': 'Championship Course',
                'profile.beginner.support': 'Beginner Support',
                'profile.tournament.play': 'Tournament Play',
                'profile.vip.service': 'VIP Service',
                'profile.international.service': 'International Service',
                'profile.languages': 'Languages (select multiple)',
                'profile.preferred.avatar': 'Preferred Avatar',
                'profile.avatar.man': 'Man',
                'profile.avatar.woman': 'Woman',
                'profile.avatar.bald.man': 'Bald Man',
                'profile.avatar.bald.woman': 'Bald Woman',
                'profile.avatar.curly.man': 'Curly Hair Man',
                'profile.avatar.curly.woman': 'Curly Hair Woman',
                'profile.avatar.white.man': 'White Hair Man',
                'profile.avatar.white.woman': 'White Hair Woman',
                'profile.years.management': 'Years in Management',
                'profile.golf.professional': 'Golf Professional',

                // Common Form Elements
                'form.email': 'Email',
                'form.phone': 'Phone',
                'form.first.name': 'First Name',
                'form.last.name': 'Last Name',
                'form.create.profile': 'Create Profile',
                'form.submit': 'Submit',

                // Page Titles
                'page.title': 'MciPro - Professional Golf Course Management Platform',
            },

            th: {
                // Login Screen
                'app.title': 'MciPro',
                'app.subtitle': '‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏≠‡∏•‡πå‡∏ü‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û',
                'login.golfer': '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡∏Å‡∏≠‡∏•‡πå‡∏ü',
                'login.caddie': '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Ñ‡∏î‡∏î‡∏µ‡πâ',
                'login.manager': '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£',
                'login.proshop': '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡∏ä‡πá‡∏≠‡∏õ',

                // Navigation & Common
                'nav.logout': '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö',
                'nav.emergency': '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô',
                'common.back': '‡∏Å‡∏•‡∏±‡∏ö',
                'common.next': '‡∏ñ‡∏±‡∏î‡πÑ‡∏õ',
                'common.save': '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
                'common.cancel': '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                'common.close': '‡∏õ‡∏¥‡∏î',
                'common.loading': '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...',
                'common.settings': '‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤',

                // Manager Dashboard
                'manager.title': '‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£',
                'manager.welcome': '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£!',
                'manager.overview': '‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°',
                'manager.staff': '‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô',
                'manager.analytics': '‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå',
                'manager.reports': '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô',
                'manager.course.operations': '‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡∏™‡∏ô‡∏≤‡∏°',
                'manager.managing': '‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏≠‡∏•‡πå‡∏ü‡∏û‡∏±‡∏ó‡∏¢‡∏≤',
                'manager.monthly.revenue': '‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
                'manager.holes.active': '18 ‡∏´‡∏•‡∏∏‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô',
                'manager.staff.members': '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô 47 ‡∏Ñ‡∏ô',
                'manager.satisfaction': '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à 98%',
                'manager.todays.rounds': '‡∏£‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ',
                'manager.active.caddies': '‡πÅ‡∏Ñ‡∏î‡∏î‡∏µ‡πâ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô',
                'manager.course.occupancy': '‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏ô‡∏≤‡∏°',
                'manager.emergency.alerts': '‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô',
                'manager.current.rounds': '‡∏£‡∏≠‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô',
                'manager.staff.status': '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô',

                // Caddy Dashboard
                'caddie.title': '‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏Ñ‡∏î‡∏î‡∏µ‡πâ',
                'caddie.welcome': '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö ‡πÅ‡∏Ñ‡∏î‡∏î‡∏µ‡πâ!',
                'caddie.overview': '‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°',
                'caddie.assignments': '‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢',
                'caddie.tracking': '‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°',
                'caddie.reports': '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô',
                'caddie.earnings': '‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ',
                'caddie.monthly.earnings': '‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
                'caddie.elite.status': '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏¥‡πÄ‡∏®‡∏©',
                'caddie.current.round': '‡∏£‡∏≠‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô',
                'caddie.performance': '‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô',

                // Pro Shop
                'proshop.title': '‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÇ‡∏õ‡∏£‡∏ä‡πá‡∏≠‡∏õ',
                'proshop.welcome': '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö ‡πÇ‡∏õ‡∏£‡∏ä‡πá‡∏≠‡∏õ!',
                'proshop.pos': '‡∏à‡∏∏‡∏î‡∏Ç‡∏≤‡∏¢',
                'proshop.inventory': '‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',
                'proshop.sales': '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢',
                'proshop.customers': '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤',
                'proshop.pos.title': '‡∏à‡∏∏‡∏î‡∏Ç‡∏≤‡∏¢‡πÇ‡∏õ‡∏£‡∏ä‡πá‡∏≠‡∏õ',
                'proshop.equipment': '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≠‡∏•‡πå‡∏ü‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',
                'proshop.items': '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ 450+ ‡∏ä‡∏¥‡πâ‡∏ô',
                'proshop.sales.today': '‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ 28 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£',
                'proshop.service': '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ 4.9‚òÖ',
                'proshop.todays.sales': '‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ',
                'proshop.search.products': '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...',
                'proshop.all.categories': '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
                'proshop.golf.clubs': '‡πÑ‡∏°‡πâ‡∏Å‡∏≠‡∏•‡πå‡∏ü',
                'proshop.golf.balls': '‡∏•‡∏π‡∏Å‡∏Å‡∏≠‡∏•‡πå‡∏ü',
                'proshop.apparel': '‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤',
                'proshop.accessories': '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°',
                'proshop.beverages': '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°',
                'proshop.snacks': '‡∏Ç‡∏ô‡∏°',
                'proshop.shopping.cart': '‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',
                'proshop.cart.empty': '‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤',
                'proshop.add.products': '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢',
                'proshop.subtotal': '‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏¢‡πà‡∏≠‡∏¢:',
                'proshop.tax': '‡∏†‡∏≤‡∏©‡∏µ (7%):',
                'proshop.total': '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:',
                'proshop.cash.payment': '‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î',
                'proshop.card.payment': '‡∏ä‡∏≥‡∏£‡∏∞‡∏î‡πâ‡∏ß‡∏¢‡∏ö‡∏±‡∏ï‡∏£',
                'proshop.payment.successful': '‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                'proshop.print.receipt': '‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à',
                'proshop.new.sale': '‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà',

                // Golfer Dashboard
                'golfer.title': '‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ô‡∏±‡∏Å‡∏Å‡∏≠‡∏•‡πå‡∏ü',
                'golfer.welcome': '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö',
                'golfer.overview': '‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°',
                'golfer.booking': '‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á',
                'golfer.food': '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°',
                'golfer.gps': 'GPS ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏ó‡∏≤‡∏á',
                'golfer.emergency': '‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô',

                // Maintenance Dashboard
                'login.maintenance': '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡∏°‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏ô‡∏≤‡∏°',
                'maintenance.title': '‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ó‡∏µ‡∏°‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏ô‡∏≤‡∏°',
                'maintenance.welcome': '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö ‡∏ó‡∏µ‡∏°‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏ô‡∏≤‡∏°!',
                'maintenance.overview': '‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°',
                'maintenance.course.updates': '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏†‡∏≤‡∏û‡∏™‡∏ô‡∏≤‡∏°',
                'maintenance.tasks': '‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô',
                'maintenance.equipment': '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå',
                'maintenance.schedule': '‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô',
                'maintenance.course.maintenance': '‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏≠‡∏•‡πå‡∏ü',
                'maintenance.professional.care': '‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏≠‡∏•‡πå‡∏ü‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û',
                'maintenance.courses.active': '4 ‡∏™‡∏ô‡∏≤‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
                'maintenance.tasks.today': '‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ 12 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£',
                'maintenance.crew.members': '‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô 8 ‡∏Ñ‡∏ô',
                'maintenance.course.condition': '‡∏™‡∏†‡∏≤‡∏û‡∏™‡∏ô‡∏≤‡∏°',
                'maintenance.excellent.rating': '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°',
                'maintenance.holes.maintained': '‡∏´‡∏•‡∏∏‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•‡πÅ‡∏•‡πâ‡∏ß',
                'maintenance.water.usage': '‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ô‡πâ‡∏≥ (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)',
                'maintenance.optimal.level': '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°',
                'maintenance.equipment.issues': '‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå',
                'maintenance.needs.attention': '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•',
                'maintenance.pending.tasks': '‡∏á‡∏≤‡∏ô‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
                'maintenance.due.today': '‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ',
                'maintenance.live.updates': '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏†‡∏≤‡∏û‡∏™‡∏ô‡∏≤‡∏°‡πÅ‡∏ö‡∏ö‡∏™‡∏î',
                'maintenance.report.conditions': '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏†‡∏≤‡∏û‡∏™‡∏ô‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î',
                'maintenance.submit.update': '‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ô‡∏≤‡∏°',
                'maintenance.course.section': '‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏™‡∏ô‡∏≤‡∏°',
                'maintenance.select.section': '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏™‡∏ô‡∏≤‡∏°...',
                'maintenance.hole.number': '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏´‡∏•‡∏∏‡∏°',
                'maintenance.select.hole': '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏´‡∏•‡∏∏‡∏°...',
                'maintenance.area.type': '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà',
                'maintenance.select.area': '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà...',
                'maintenance.tee.box': '‡∏à‡∏∏‡∏î‡∏ï‡∏µ‡∏≠‡∏≠‡∏Å',
                'maintenance.fairway': '‡πÅ‡∏ü‡∏£‡πå‡πÄ‡∏ß‡∏¢‡πå',
                'maintenance.rough': '‡∏£‡∏±‡∏ü',
                'maintenance.fairway.bunker': '‡∏ö‡∏±‡∏á‡πÄ‡∏Å‡∏≠‡∏£‡πå‡πÅ‡∏ü‡∏£‡πå‡πÄ‡∏ß‡∏¢‡πå',
                'maintenance.greenside.bunker': '‡∏ö‡∏±‡∏á‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏Ç‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏µ‡∏ô',
                'maintenance.green': '‡∏Å‡∏£‡∏µ‡∏ô',
                'maintenance.flag.cup': '‡∏ò‡∏á‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏∏‡∏°',
                'maintenance.issue.priority': '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç',
                'maintenance.low.routine': '‡∏ï‡πà‡∏≥ - ‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏õ‡∏Å‡∏ï‡∏¥',
                'maintenance.medium.attention': '‡∏Å‡∏•‡∏≤‡∏á - ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•',
                'maintenance.high.urgent': '‡∏™‡∏π‡∏á - ‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏î‡πà‡∏ß‡∏ô',
                'maintenance.critical.safety': '‡∏ß‡∏¥‡∏Å‡∏§‡∏ï - ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢',
                'maintenance.description': '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î',
                'maintenance.describe.issue': '‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏†‡∏≤‡∏û‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏î‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î...',
                'maintenance.upload.photos': '‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û',
                'maintenance.click.upload': '‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡∏°‡∏≤‡∏ß‡∏≤‡∏á',
                'maintenance.choose.photos': '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û',
                'maintenance.submit.course.update': '‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ô‡∏≤‡∏°',
                'maintenance.recent.updates': '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î',
                'maintenance.all.courses': '‡∏ó‡∏∏‡∏Å‡∏™‡∏ô‡∏≤‡∏°',

                // Emergency & Safety
                'emergency.alert': '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô',
                'emergency.select.type': '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£',
                'emergency.safety.info': '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢',
                'emergency.course.safety': '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡∏™‡∏ô‡∏≤‡∏°',
                'emergency.alert.sent': '‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß',

                // Profile Creation
                'profile.create': '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì',
                'profile.choose.role': '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                'profile.golfer.info': '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏Å‡∏≠‡∏•‡πå‡∏ü',
                'profile.caddie.info': '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏Ñ‡∏î‡∏î‡∏µ‡πâ',
                'profile.manager.info': '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£',
                'profile.proshop.info': '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡∏ä‡πá‡∏≠‡∏õ',
                'profile.maintenance.info': '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏ô‡∏≤‡∏°',
                'profile.handicap': '‡πÅ‡∏Æ‡∏ô‡∏î‡∏¥‡πÅ‡∏Ñ‡∏õ',
                'profile.experience.level': '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå',
                'profile.select.level': '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö...',
                'profile.beginner': '‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà',
                'profile.intermediate': '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏•‡∏≤‡∏á',
                'profile.advanced': '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á',
                'profile.professional': '‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û',
                'profile.club.affiliation': '‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î‡∏Ñ‡∏•‡∏±‡∏ö',
                'profile.select.society': '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏Ñ‡∏°...',
                'profile.playing.style': '‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô',
                'profile.years.experience': '‡∏õ‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå',
                'profile.specialty': '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç',
                'profile.select.specialty': '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç...',
                'profile.championship.course': '‡∏™‡∏ô‡∏≤‡∏°‡∏ä‡∏¥‡∏á‡πÅ‡∏ä‡∏°‡∏õ‡πå',
                'profile.beginner.support': '‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà',
                'profile.tournament.play': '‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô',
                'profile.vip.service': '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ß‡∏µ‡πÑ‡∏≠‡∏û‡∏µ',
                'profile.international.service': '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ô‡∏≤‡∏ô‡∏≤‡∏ä‡∏≤‡∏ï‡∏¥',
                'profile.languages': '‡∏†‡∏≤‡∏©‡∏≤ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏†‡∏≤‡∏©‡∏≤)',
                'profile.preferred.avatar': '‡∏≠‡∏ß‡∏ï‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£',
                'profile.avatar.man': '‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢',
                'profile.avatar.woman': '‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á',
                'profile.avatar.bald.man': '‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢‡∏´‡∏±‡∏ß‡∏•‡πâ‡∏≤‡∏ô',
                'profile.avatar.bald.woman': '‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏´‡∏±‡∏ß‡∏•‡πâ‡∏≤‡∏ô',
                'profile.avatar.curly.man': '‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢‡∏ú‡∏°‡∏´‡∏¢‡∏¥‡∏Å',
                'profile.avatar.curly.woman': '‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏ú‡∏°‡∏´‡∏¢‡∏¥‡∏Å',
                'profile.avatar.white.man': '‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢‡∏ú‡∏°‡∏Ç‡∏≤‡∏ß',
                'profile.avatar.white.woman': '‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á‡∏ú‡∏°‡∏Ç‡∏≤‡∏ß',
                'profile.years.management': '‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£',
                'profile.golf.professional': '‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏Å‡∏≠‡∏•‡πå‡∏ü',

                // Common Form Elements
                'form.email': '‡∏≠‡∏µ‡πÄ‡∏°‡∏•',
                'form.phone': '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå',
                'form.first.name': '‡∏ä‡∏∑‡πà‡∏≠',
                'form.last.name': '‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•',
                'form.create.profile': '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå',
                'form.submit': '‡∏™‡πà‡∏á',

                // Page Titles
                'page.title': 'MciPro - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏≠‡∏•‡πå‡∏ü‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û',
            },

            ko: {
                // Login Screen
                'app.title': 'MciPro',
                'app.subtitle': 'Ï†ÑÎ¨∏ Í≥®ÌîÑÏû• Í¥ÄÎ¶¨ ÌîåÎû´Ìèº',
                'login.golfer': 'Í≥®Ìçº Î°úÍ∑∏Ïù∏',
                'login.caddie': 'Ï∫êÎîî Î°úÍ∑∏Ïù∏',
                'login.manager': 'Îß§ÎãàÏ†Ä Î°úÍ∑∏Ïù∏',
                'login.proshop': 'ÌîÑÎ°úÏÉµ Î°úÍ∑∏Ïù∏',

                // Navigation & Common
                'nav.logout': 'Î°úÍ∑∏ÏïÑÏõÉ',
                'nav.emergency': 'ÏùëÍ∏â ÏïåÎ¶º',
                'common.back': 'Îí§Î°ú',
                'common.next': 'Îã§Ïùå',
                'common.save': 'Ï†ÄÏû•',
                'common.cancel': 'Ï∑®ÏÜå',
                'common.close': 'Îã´Í∏∞',
                'common.loading': 'Î°úÎî© Ï§ë...',
                'common.settings': 'ÏÑ§Ï†ï',

                // Manager Dashboard
                'manager.title': 'Îß§ÎãàÏ†Ä ÎåÄÏãúÎ≥¥Îìú',
                'manager.welcome': 'ÌôòÏòÅÌï©ÎãàÎã§, Îß§ÎãàÏ†ÄÎãò!',
                'manager.overview': 'Í∞úÏöî',
                'manager.staff': 'ÏßÅÏõê Í¥ÄÎ¶¨',
                'manager.analytics': 'Î∂ÑÏÑù',
                'manager.reports': 'Î≥¥Í≥†ÏÑú',
                'manager.course.operations': 'ÏΩîÏä§ Ïö¥ÏòÅ',
                'manager.managing': 'ÌååÌÉÄÏïº Í≥®ÌîÑ ÌÅ¥ÎüΩ Í¥ÄÎ¶¨',
                'manager.monthly.revenue': 'ÏõîÎ≥Ñ Îß§Ï∂ú',
                'manager.holes.active': '18ÌôÄ Ïö¥ÏòÅ Ï§ë',
                'manager.staff.members': 'ÏßÅÏõê 47Î™Ö',
                'manager.satisfaction': 'ÎßåÏ°±ÎèÑ 98%',
                'manager.todays.rounds': 'Ïò§ÎäòÏùò ÎùºÏö¥Îìú',
                'manager.active.caddies': 'ÌôúÎèô Ï§ëÏù∏ Ï∫êÎîî',
                'manager.course.occupancy': 'ÏΩîÏä§ Ï†êÏú†Ïú®',
                'manager.emergency.alerts': 'ÏùëÍ∏â ÏïåÎ¶º',
                'manager.current.rounds': 'ÌòÑÏû¨ ÎùºÏö¥Îìú',
                'manager.staff.status': 'ÏßÅÏõê ÏÉÅÌÉú',

                // Caddy Dashboard
                'caddie.title': 'Ï∫êÎîî ÎåÄÏãúÎ≥¥Îìú',
                'caddie.welcome': 'ÌôòÏòÅÌï©ÎãàÎã§, Ï∫êÎîîÎãò!',
                'caddie.overview': 'Í∞úÏöî',
                'caddie.assignments': 'Î∞∞Ï†ï',
                'caddie.tracking': 'Ï∂îÏ†Å',
                'caddie.reports': 'Î≥¥Í≥†ÏÑú',
                'caddie.earnings': 'ÏàòÏûÖ',
                'caddie.monthly.earnings': 'ÏõîÎ≥Ñ ÏàòÏûÖ',
                'caddie.elite.status': 'ÏóòÎ¶¨Ìä∏ ÏÉÅÌÉú',
                'caddie.current.round': 'ÌòÑÏû¨ ÎùºÏö¥Îìú',
                'caddie.performance': 'ÏÑ±Í≥º',

                // Pro Shop
                'proshop.title': 'ÌîÑÎ°úÏÉµ ÎåÄÏãúÎ≥¥Îìú',
                'proshop.welcome': 'ÌôòÏòÅÌï©ÎãàÎã§, ÌîÑÎ°úÏÉµ!',
                'proshop.pos': 'POS ÏãúÏä§ÌÖú',
                'proshop.inventory': 'Ïû¨Í≥†',
                'proshop.sales': 'ÌåêÎß§ Î≥¥Í≥†ÏÑú',
                'proshop.customers': 'Í≥†Í∞ù',
                'proshop.pos.title': 'ÌîÑÎ°úÏÉµ POS',
                'proshop.equipment': 'Í≥®ÌîÑ Ïû•ÎπÑ Î∞è ÏÉÅÌíà',
                'proshop.items': '450+ ÏÉÅÌíà',
                'proshop.sales.today': 'Ïò§Îäò 28Í±¥ ÌåêÎß§',
                'proshop.service': '4.9‚òÖ ÏÑúÎπÑÏä§',
                'proshop.todays.sales': 'Ïò§ÎäòÏùò ÌåêÎß§',
                'proshop.search.products': 'ÏÉÅÌíà Í≤ÄÏÉâ...',
                'proshop.all.categories': 'Î™®Îì† Ïπ¥ÌÖåÍ≥†Î¶¨',
                'proshop.golf.clubs': 'Í≥®ÌîÑ ÌÅ¥ÎüΩ',
                'proshop.golf.balls': 'Í≥®ÌîÑÍ≥µ',
                'proshop.apparel': 'ÏùòÎ•ò',
                'proshop.accessories': 'Ïï°ÏÑ∏ÏÑúÎ¶¨',
                'proshop.beverages': 'ÏùåÎ£å',
                'proshop.snacks': 'Ïä§ÎÇµ',
                'proshop.shopping.cart': 'Ïû•Î∞îÍµ¨Îãà',
                'proshop.cart.empty': 'Ïû•Î∞îÍµ¨ÎãàÍ∞Ä ÎπÑÏñ¥ ÏûàÏäµÎãàÎã§',
                'proshop.add.products': 'ÌåêÎß§Î•º ÏãúÏûëÌïòÎ†§Î©¥ ÏÉÅÌíàÏùÑ Ï∂îÍ∞ÄÌïòÏÑ∏Ïöî',
                'proshop.subtotal': 'ÏÜåÍ≥Ñ:',
                'proshop.tax': 'ÏÑ∏Í∏à (7%):',
                'proshop.total': 'Ï¥ùÍ≥Ñ:',
                'proshop.cash.payment': 'ÌòÑÍ∏à Í≤∞Ï†ú',
                'proshop.card.payment': 'Ïπ¥Îìú Í≤∞Ï†ú',
                'proshop.payment.successful': 'Í≤∞Ï†ú ÏÑ±Í≥µ!',
                'proshop.print.receipt': 'ÏòÅÏàòÏ¶ù Ïù∏ÏáÑ',
                'proshop.new.sale': 'ÏÉà ÌåêÎß§',

                // Golfer Dashboard
                'golfer.title': 'Í≥®Ìçº ÎåÄÏãúÎ≥¥Îìú',
                'golfer.welcome': 'ÌôòÏòÅÌï©ÎãàÎã§',
                'golfer.overview': 'Í∞úÏöî',
                'golfer.booking': 'ÏòàÏïΩ',
                'golfer.food': 'ÏùåÏãù Î∞è ÏùåÎ£å',
                'golfer.gps': 'GPS Î∞è ÎÇ¥ÎπÑÍ≤åÏù¥ÏÖò',
                'golfer.emergency': 'ÏùëÍ∏âÏÉÅÌô©',

                // Maintenance Dashboard
                'login.maintenance': 'Ï†ïÎπÑÌåÄ Î°úÍ∑∏Ïù∏',
                'maintenance.title': 'Ï†ïÎπÑ ÎåÄÏãúÎ≥¥Îìú',
                'maintenance.welcome': 'ÌôòÏòÅÌï©ÎãàÎã§, Ï†ïÎπÑÌåÄ!',
                'maintenance.overview': 'Í∞úÏöî',
                'maintenance.course.updates': 'ÏΩîÏä§ ÏóÖÎç∞Ïù¥Ìä∏',
                'maintenance.tasks': 'ÏûëÏóÖ Í¥ÄÎ¶¨',
                'maintenance.equipment': 'Ïû•ÎπÑ',
                'maintenance.schedule': 'ÏùºÏ†ï',
                'maintenance.course.maintenance': 'ÏΩîÏä§ Í¥ÄÎ¶¨',
                'maintenance.professional.care': 'Ï†ÑÎ¨∏ Í≥®ÌîÑ ÏΩîÏä§ Í¥ÄÎ¶¨',
                'maintenance.courses.active': '4Í∞ú ÏΩîÏä§ Ïö¥ÏòÅ Ï§ë',
                'maintenance.tasks.today': 'Ïò§Îäò 12Í∞ú ÏûëÏóÖ',
                'maintenance.crew.members': '8Î™Ö ÏûëÏóÖÌåÄ',
                'maintenance.course.condition': 'ÏΩîÏä§ ÏÉÅÌÉú',
                'maintenance.excellent.rating': 'Ïö∞Ïàò Îì±Í∏â',
                'maintenance.holes.maintained': 'Í¥ÄÎ¶¨Îêú ÌôÄ',
                'maintenance.water.usage': 'Î¨º ÏÇ¨Ïö©Îüâ (ÏãúÍ∞Ñ)',
                'maintenance.optimal.level': 'ÏµúÏ†Å ÏàòÏ§Ä',
                'maintenance.equipment.issues': 'Ïû•ÎπÑ Î¨∏Ï†ú',
                'maintenance.needs.attention': 'Ï£ºÏùò ÌïÑÏöî',
                'maintenance.pending.tasks': 'ÎåÄÍ∏∞ Ï§ëÏù∏ ÏûëÏóÖ',
                'maintenance.due.today': 'Ïò§Îäò ÎßàÍ∞ê',
                'maintenance.live.updates': 'Ïã§ÏãúÍ∞Ñ ÏΩîÏä§ ÏóÖÎç∞Ïù¥Ìä∏',
                'maintenance.report.conditions': 'ÏÇ¨ÏßÑÍ≥º ÏÉÅÏÑ∏ ÏÑ§Î™ÖÏúºÎ°ú ÏΩîÏä§ ÏÉÅÌÉú Î≥¥Í≥†',
                'maintenance.submit.update': 'ÏΩîÏä§ ÏóÖÎç∞Ïù¥Ìä∏ Ï†úÏ∂ú',
                'maintenance.course.section': 'ÏΩîÏä§ ÏÑπÏÖò',
                'maintenance.select.section': 'ÏΩîÏä§ ÏÑπÏÖòÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî...',
                'maintenance.hole.number': 'ÌôÄ Î≤àÌò∏',
                'maintenance.select.hole': 'ÌôÄ Î≤àÌò∏Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî...',
                'maintenance.area.type': 'ÏßÄÏó≠ Ïú†Ìòï',
                'maintenance.select.area': 'ÏßÄÏó≠ Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî...',
                'maintenance.tee.box': 'Ìã∞ Î∞ïÏä§',
                'maintenance.fairway': 'ÌéòÏñ¥Ïõ®Ïù¥',
                'maintenance.rough': 'Îü¨ÌîÑ',
                'maintenance.fairway.bunker': 'ÌéòÏñ¥Ïõ®Ïù¥ Î≤ôÏª§',
                'maintenance.greenside.bunker': 'Í∑∏Î¶∞ÏÇ¨Ïù¥Îìú Î≤ôÏª§',
                'maintenance.green': 'Í∑∏Î¶∞',
                'maintenance.flag.cup': 'ÍπÉÎåÄÏôÄ Ïªµ',
                'maintenance.issue.priority': 'Î¨∏Ï†ú Ïö∞ÏÑ†ÏàúÏúÑ',
                'maintenance.low.routine': 'ÎÇÆÏùå - ÏùºÏÉÅ Í¥ÄÎ¶¨',
                'maintenance.medium.attention': 'Î≥¥ÌÜµ - Ï£ºÏùò ÌïÑÏöî',
                'maintenance.high.urgent': 'ÎÜíÏùå - Í∏¥Í∏â ÏàòÎ¶¨',
                'maintenance.critical.safety': 'ÏúÑÌóò - ÏïàÏ†Ñ Î¨∏Ï†ú',
                'maintenance.description': 'ÏÑ§Î™Ö',
                'maintenance.describe.issue': 'Î¨∏Ï†úÎÇò ÏÉÅÌÉúÎ•º ÏûêÏÑ∏Ìûà ÏÑ§Î™ÖÌïòÏÑ∏Ïöî...',
                'maintenance.upload.photos': 'ÏÇ¨ÏßÑ ÏóÖÎ°úÎìú',
                'maintenance.click.upload': 'ÌÅ¥Î¶≠ÌïòÏó¨ ÏÇ¨ÏßÑÏùÑ ÏóÖÎ°úÎìúÌïòÍ±∞ÎÇò ÎìúÎûòÍ∑∏ÌïòÏó¨ ÎÜìÏúºÏÑ∏Ïöî',
                'maintenance.choose.photos': 'ÏÇ¨ÏßÑ ÏÑ†ÌÉù',
                'maintenance.submit.course.update': 'ÏΩîÏä§ ÏóÖÎç∞Ïù¥Ìä∏ Ï†úÏ∂ú',
                'maintenance.recent.updates': 'ÏµúÍ∑º ÏóÖÎç∞Ïù¥Ìä∏',
                'maintenance.all.courses': 'Î™®Îì† ÏΩîÏä§',

                // Emergency & Safety
                'emergency.alert': 'ÏùëÍ∏â ÏïåÎ¶º',
                'emergency.select.type': 'ÌïÑÏöîÌïú ÏßÄÏõê Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî',
                'emergency.safety.info': 'ÏïàÏ†Ñ Ï†ïÎ≥¥',
                'emergency.course.safety': 'ÏΩîÏä§ ÏïàÏ†Ñ Ï†ïÎ≥¥',
                'emergency.alert.sent': 'ÏïåÎ¶º Ï†ÑÏÜ° ÏôÑÎ£å',

                // Profile Creation
                'profile.create': 'ÌîÑÎ°úÌïÑ ÎßåÎì§Í∏∞',
                'profile.choose.role': 'Ïó≠Ìï†ÏùÑ ÏÑ†ÌÉùÌïòÍ≥† Ï†ïÎ≥¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî',
                'profile.golfer.info': 'Í≥®Ìçº Ï†ïÎ≥¥',
                'profile.caddie.info': 'Ï∫êÎîî Ï†ïÎ≥¥',
                'profile.manager.info': 'Îß§ÎãàÏ†Ä Ï†ïÎ≥¥',
                'profile.proshop.info': 'ÌîÑÎ°úÏÉµ Ï†ïÎ≥¥',
                'profile.maintenance.info': 'Ï†ïÎπÑÌåÄ Ï†ïÎ≥¥',
                'profile.handicap': 'Ìï∏ÎîîÏ∫°',
                'profile.experience.level': 'Í≤ΩÌóò ÏàòÏ§Ä',
                'profile.select.level': 'Î†àÎ≤® ÏÑ†ÌÉù...',
                'profile.beginner': 'Ï¥àÍ∏â',
                'profile.intermediate': 'Ï§ëÍ∏â',
                'profile.advanced': 'Í≥†Í∏â',
                'profile.professional': 'ÌîÑÎ°ú',
                'profile.club.affiliation': 'ÌÅ¥ÎüΩ ÏÜåÏÜç',
                'profile.select.society': 'Î™®ÏûÑ ÏÑ†ÌÉù...',
                'profile.playing.style': 'ÌîåÎ†àÏù¥ Ïä§ÌÉÄÏùº',
                'profile.years.experience': 'Í≤ΩÌóò ÎÖÑÏàò',
                'profile.specialty': 'Ï†ÑÎ¨∏ Î∂ÑÏïº',
                'profile.select.specialty': 'Ï†ÑÎ¨∏ Î∂ÑÏïº ÏÑ†ÌÉù...',
                'profile.championship.course': 'Ï±îÌîºÏñ∏Ïã≠ ÏΩîÏä§',
                'profile.beginner.support': 'Ï¥àÍ∏âÏûê ÏßÄÏõê',
                'profile.tournament.play': 'ÌÜ†ÎÑàÎ®ºÌä∏ ÌîåÎ†àÏù¥',
                'profile.vip.service': 'VIP ÏÑúÎπÑÏä§',
                'profile.international.service': 'Íµ≠Ï†ú ÏÑúÎπÑÏä§',
                'profile.languages': 'Ïñ∏Ïñ¥ (Îã§Ï§ë ÏÑ†ÌÉù)',
                'profile.preferred.avatar': 'ÏÑ†Ìò∏ÌïòÎäî ÏïÑÎ∞îÌÉÄ',
                'profile.avatar.man': 'ÎÇ®ÏÑ±',
                'profile.avatar.woman': 'Ïó¨ÏÑ±',
                'profile.avatar.bald.man': 'ÎåÄÎ®∏Î¶¨ ÎÇ®ÏÑ±',
                'profile.avatar.bald.woman': 'ÎåÄÎ®∏Î¶¨ Ïó¨ÏÑ±',
                'profile.avatar.curly.man': 'Í≥±Ïä¨Î®∏Î¶¨ ÎÇ®ÏÑ±',
                'profile.avatar.curly.woman': 'Í≥±Ïä¨Î®∏Î¶¨ Ïó¨ÏÑ±',
                'profile.avatar.white.man': 'Î∞±Î∞ú ÎÇ®ÏÑ±',
                'profile.avatar.white.woman': 'Î∞±Î∞ú Ïó¨ÏÑ±',
                'profile.years.management': 'Í¥ÄÎ¶¨ Í≤ΩÎ†•',
                'profile.golf.professional': 'Í≥®ÌîÑ ÌîÑÎ°ú',

                // Common Form Elements
                'form.email': 'Ïù¥Î©îÏùº',
                'form.phone': 'Ï†ÑÌôîÎ≤àÌò∏',
                'form.first.name': 'Ïù¥Î¶Ñ',
                'form.last.name': 'ÏÑ±',
                'form.create.profile': 'ÌîÑÎ°úÌïÑ ÏÉùÏÑ±',
                'form.submit': 'Ï†úÏ∂ú',

                // Page Titles
                'page.title': 'MciPro - Ï†ÑÎ¨∏ Í≥®ÌîÑÏû• Í¥ÄÎ¶¨ ÌîåÎû´Ìèº',
            },

            ja: {
                // Login Screen
                'app.title': 'MciPro',
                'app.subtitle': '„Éó„É≠„Ç¥„É´„ÉïÂ†¥ÁÆ°ÁêÜ„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†',
                'login.golfer': '„Ç¥„É´„Éï„Ç°„Éº„É≠„Ç∞„Ç§„É≥',
                'login.caddie': '„Ç≠„É£„Éá„Ç£„É≠„Ç∞„Ç§„É≥',
                'login.manager': '„Éû„Éç„Éº„Ç∏„É£„Éº„É≠„Ç∞„Ç§„É≥',
                'login.proshop': '„Éó„É≠„Ç∑„Éß„ÉÉ„Éó„É≠„Ç∞„Ç§„É≥',

                // Navigation & Common
                'nav.logout': '„É≠„Ç∞„Ç¢„Ç¶„Éà',
                'nav.emergency': 'Á∑äÊÄ•Ë≠¶Â†±',
                'common.back': 'Êàª„Çã',
                'common.next': 'Ê¨°„Å∏',
                'common.save': '‰øùÂ≠ò',
                'common.cancel': '„Ç≠„É£„É≥„Çª„É´',
                'common.close': 'Èñâ„Åò„Çã',
                'common.loading': 'Ë™≠„ÅøËæº„Åø‰∏≠...',
                'common.settings': 'Ë®≠ÂÆö',

                // Manager Dashboard
                'manager.title': '„Éû„Éç„Éº„Ç∏„É£„Éº„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ',
                'manager.welcome': '„Åä„Åã„Åà„Çä„Å™„Åï„ÅÑ„ÄÅ„Éû„Éç„Éº„Ç∏„É£„ÉºÔºÅ',
                'manager.overview': 'Ê¶ÇË¶Å',
                'manager.staff': '„Çπ„Çø„ÉÉ„ÉïÁÆ°ÁêÜ',
                'manager.analytics': 'ÂàÜÊûê',
                'manager.reports': '„É¨„Éù„Éº„Éà',
                'manager.course.operations': '„Ç≥„Éº„ÇπÈÅãÂñ∂',
                'manager.managing': '„Éë„Çø„É§„Ç¥„É´„Éï„ÇØ„É©„ÉñÁÆ°ÁêÜ',
                'manager.monthly.revenue': 'ÊúàÊ¨°ÂèéÂÖ•',
                'manager.holes.active': '18„Éõ„Éº„É´Á®ºÂÉç',
                'manager.staff.members': '47Âêç„ÅÆ„Çπ„Çø„ÉÉ„Éï',
                'manager.satisfaction': '98%Ê∫ÄË∂≥Â∫¶',
                'manager.todays.rounds': 'Êú¨Êó•„ÅÆ„É©„Ç¶„É≥„Éâ',
                'manager.active.caddies': '„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Ç≠„É£„Éá„Ç£',
                'manager.course.occupancy': '„Ç≥„Éº„ÇπÂà©Áî®Áéá',
                'manager.emergency.alerts': 'Á∑äÊÄ•„Ç¢„É©„Éº„Éà',
                'manager.current.rounds': 'ÁèæÂú®„ÅÆ„É©„Ç¶„É≥„Éâ',
                'manager.staff.status': '„Çπ„Çø„ÉÉ„Éï„Çπ„ÉÜ„Éº„Çø„Çπ',

                // Caddy Dashboard
                'caddie.title': '„Ç≠„É£„Éá„Ç£„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ',
                'caddie.welcome': '„Åä„Åã„Åà„Çä„Å™„Åï„ÅÑ„ÄÅ„Ç≠„É£„Éá„Ç£ÔºÅ',
                'caddie.overview': 'Ê¶ÇË¶Å',
                'caddie.assignments': '„Ç¢„Çµ„Ç§„É≥„É°„É≥„Éà',
                'caddie.tracking': '„Éà„É©„ÉÉ„Ç≠„É≥„Ç∞',
                'caddie.reports': '„É¨„Éù„Éº„Éà',
                'caddie.earnings': 'ÂèéÂÖ•',
                'caddie.monthly.earnings': 'ÊúàÊ¨°ÂèéÂÖ•',
                'caddie.elite.status': '„Ç®„É™„Éº„Éà„Çπ„ÉÜ„Éº„Çø„Çπ',
                'caddie.current.round': 'ÁèæÂú®„ÅÆ„É©„Ç¶„É≥„Éâ',
                'caddie.performance': '„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ',

                // Pro Shop
                'proshop.title': '„Éó„É≠„Ç∑„Éß„ÉÉ„Éó„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ',
                'proshop.welcome': '„Åä„Åã„Åà„Çä„Å™„Åï„ÅÑ„ÄÅ„Éó„É≠„Ç∑„Éß„ÉÉ„ÉóÔºÅ',
                'proshop.pos': 'POS',
                'proshop.inventory': 'Âú®Â∫´',
                'proshop.sales': 'Â£≤‰∏ä„É¨„Éù„Éº„Éà',
                'proshop.customers': 'È°ßÂÆ¢',
                'proshop.pos.title': '„Éó„É≠„Ç∑„Éß„ÉÉ„ÉóPOS',
                'proshop.equipment': '„Ç¥„É´„ÉïÁî®ÂìÅ„ÉªÂïÜÂìÅ',
                'proshop.items': '450+„Ç¢„Ç§„ÉÜ„É†',
                'proshop.sales.today': 'Êú¨Êó•28‰ª∂„ÅÆÂ£≤‰∏ä',
                'proshop.service': '4.9‚òÖ„Çµ„Éº„Éì„Çπ',
                'proshop.todays.sales': 'Êú¨Êó•„ÅÆÂ£≤‰∏ä',
                'proshop.search.products': 'ÂïÜÂìÅ„ÇíÊ§úÁ¥¢...',
                'proshop.all.categories': '„Åô„Åπ„Å¶„ÅÆ„Ç´„ÉÜ„Ç¥„É™',
                'proshop.golf.clubs': '„Ç¥„É´„Éï„ÇØ„É©„Éñ',
                'proshop.golf.balls': '„Ç¥„É´„Éï„Éú„Éº„É´',
                'proshop.apparel': '„Ç¢„Éë„É¨„É´',
                'proshop.accessories': '„Ç¢„ÇØ„Çª„Çµ„É™„Éº',
                'proshop.beverages': 'È£≤„ÅøÁâ©',
                'proshop.snacks': '„Çπ„Éä„ÉÉ„ÇØ',
                'proshop.shopping.cart': '„Ç∑„Éß„ÉÉ„Éî„É≥„Ç∞„Ç´„Éº„Éà',
                'proshop.cart.empty': '„Ç´„Éº„Éà„ÅØÁ©∫„Åß„Åô',
                'proshop.add.products': 'ÂïÜÂìÅ„ÇíËøΩÂä†„Åó„Å¶Ë≤©Â£≤ÈñãÂßã',
                'proshop.subtotal': 'Â∞èË®àÔºö',
                'proshop.tax': 'Á®éÈáë(7%)Ôºö',
                'proshop.total': 'ÂêàË®àÔºö',
                'proshop.cash.payment': 'ÁèæÈáëÊâï„ÅÑ',
                'proshop.card.payment': '„Ç´„Éº„ÉâÊâï„ÅÑ',
                'proshop.payment.successful': 'ÊîØÊâï„ÅÑÂÆå‰∫ÜÔºÅ',
                'proshop.print.receipt': '„É¨„Ç∑„Éº„ÉàÂç∞Âà∑',
                'proshop.new.sale': 'Êñ∞„Åó„ÅÑË≤©Â£≤',

                // Golfer Dashboard
                'golfer.title': '„Ç¥„É´„Éï„Ç°„Éº„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ',
                'golfer.welcome': '„Åä„Åã„Åà„Çä„Å™„Åï„ÅÑ',
                'golfer.overview': 'Ê¶ÇË¶Å',
                'golfer.booking': '‰∫àÁ¥Ñ',
                'golfer.food': 'È£ü„ÅπÁâ©„ÉªÈ£≤„ÅøÁâ©',
                'golfer.gps': 'GPS„Éª„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥',
                'golfer.emergency': 'Á∑äÊÄ•',

                // Maintenance Dashboard
                'login.maintenance': '„É°„É≥„ÉÜ„Éä„É≥„Çπ„ÉÅ„Éº„É† „É≠„Ç∞„Ç§„É≥',
                'maintenance.title': '„É°„É≥„ÉÜ„Éä„É≥„Çπ „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ',
                'maintenance.welcome': '„Åä„Åã„Åà„Çä„Å™„Åï„ÅÑ„ÄÅ„É°„É≥„ÉÜ„Éä„É≥„Çπ„ÉÅ„Éº„É†ÔºÅ',
                'maintenance.overview': 'Ê¶ÇË¶Å',
                'maintenance.course.updates': '„Ç≥„Éº„ÇπÊõ¥Êñ∞',
                'maintenance.tasks': '„Çø„Çπ„ÇØÁÆ°ÁêÜ',
                'maintenance.equipment': 'Ê©üÊùê',
                'maintenance.schedule': '„Çπ„Ç±„Ç∏„É•„Éº„É´',
                'maintenance.course.maintenance': '„Ç≥„Éº„Çπ„É°„É≥„ÉÜ„Éä„É≥„Çπ',
                'maintenance.professional.care': '„Éó„É≠„Éï„Çß„ÉÉ„Ç∑„Éß„Éä„É´ „Ç¥„É´„Éï„Ç≥„Éº„Çπ „Ç±„Ç¢',
                'maintenance.courses.active': '4„Ç≥„Éº„ÇπÁ®ºÂÉç‰∏≠',
                'maintenance.tasks.today': 'Êú¨Êó•12„Çø„Çπ„ÇØ',
                'maintenance.crew.members': '8Âêç„ÅÆ„ÇØ„É´„Éº',
                'maintenance.course.condition': '„Ç≥„Éº„ÇπÁä∂ÊÖã',
                'maintenance.excellent.rating': 'ÂÑ™ÁßÄ„Å™Ë©ï‰æ°',
                'maintenance.holes.maintained': 'Êï¥ÂÇôÊ∏à„Åø„Éõ„Éº„É´',
                'maintenance.water.usage': 'Ê∞¥‰ΩøÁî®ÈáèÔºàÊôÇÈñìÔºâ',
                'maintenance.optimal.level': 'ÊúÄÈÅ©„É¨„Éô„É´',
                'maintenance.equipment.issues': 'Ê©üÊùêÂïèÈ°å',
                'maintenance.needs.attention': 'Ê≥®ÊÑè„ÅåÂøÖË¶Å',
                'maintenance.pending.tasks': '‰øùÁïô‰∏≠„ÅÆ„Çø„Çπ„ÇØ',
                'maintenance.due.today': 'Êú¨Êó•ÊúüÈôê',
                'maintenance.live.updates': '„É©„Ç§„Éñ „Ç≥„Éº„ÇπÊõ¥Êñ∞',
                'maintenance.report.conditions': 'ÂÜôÁúü„Å®Ë©≥Á¥∞Ë™¨Êòé„Åß„Ç≥„Éº„ÇπÁä∂ÊÖã„ÇíÂ†±Âëä',
                'maintenance.submit.update': '„Ç≥„Éº„ÇπÊõ¥Êñ∞„ÇíÈÄÅ‰ø°',
                'maintenance.course.section': '„Ç≥„Éº„Çπ„Çª„ÇØ„Ç∑„Éß„É≥',
                'maintenance.select.section': '„Ç≥„Éº„Çπ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÈÅ∏Êäû...',
                'maintenance.hole.number': '„Éõ„Éº„É´Áï™Âè∑',
                'maintenance.select.hole': '„Éõ„Éº„É´Áï™Âè∑„ÇíÈÅ∏Êäû...',
                'maintenance.area.type': '„Ç®„É™„Ç¢„Çø„Ç§„Éó',
                'maintenance.select.area': '„Ç®„É™„Ç¢„Çø„Ç§„Éó„ÇíÈÅ∏Êäû...',
                'maintenance.tee.box': '„ÉÜ„Ç£„Éº„Éú„ÉÉ„ÇØ„Çπ',
                'maintenance.fairway': '„Éï„Çß„Ç¢„Ç¶„Çß„Ç§',
                'maintenance.rough': '„É©„Éï',
                'maintenance.fairway.bunker': '„Éï„Çß„Ç¢„Ç¶„Çß„Ç§„Éê„É≥„Ç´„Éº',
                'maintenance.greenside.bunker': '„Ç∞„É™„Éº„É≥„Çµ„Ç§„Éâ„Éê„É≥„Ç´„Éº',
                'maintenance.green': '„Ç∞„É™„Éº„É≥',
                'maintenance.flag.cup': '„Éï„É©„ÉÉ„Ç∞„Å®„Ç´„ÉÉ„Éó',
                'maintenance.issue.priority': 'ÂïèÈ°åÂÑ™ÂÖàÂ∫¶',
                'maintenance.low.routine': '‰Ωé - ÂÆöÊúü„É°„É≥„ÉÜ„Éä„É≥„Çπ',
                'maintenance.medium.attention': '‰∏≠ - Ê≥®ÊÑè„ÅåÂøÖË¶Å',
                'maintenance.high.urgent': 'È´ò - Á∑äÊÄ•‰øÆÁêÜ',
                'maintenance.critical.safety': 'Âç±Èô∫ - ÂÆâÂÖ®‰∏ä„ÅÆÂïèÈ°å',
                'maintenance.description': 'Ë™¨Êòé',
                'maintenance.describe.issue': 'ÂïèÈ°å„ÇÑÁä∂ÊÖã„ÇíË©≥„Åó„ÅèË™¨Êòé„Åó„Å¶„Åè„Å†„Åï„ÅÑ...',
                'maintenance.upload.photos': 'ÂÜôÁúü„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ',
                'maintenance.click.upload': '„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÂÜôÁúü„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åô„Çã„Åã„ÄÅ„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó',
                'maintenance.choose.photos': 'ÂÜôÁúü„ÇíÈÅ∏Êäû',
                'maintenance.submit.course.update': '„Ç≥„Éº„ÇπÊõ¥Êñ∞„ÇíÈÄÅ‰ø°',
                'maintenance.recent.updates': 'ÊúÄËøë„ÅÆÊõ¥Êñ∞',
                'maintenance.all.courses': '„Åô„Åπ„Å¶„ÅÆ„Ç≥„Éº„Çπ',

                // Emergency & Safety
                'emergency.alert': 'Á∑äÊÄ•Ë≠¶Â†±',
                'emergency.select.type': 'ÂøÖË¶Å„Å™ÊîØÊè¥„ÅÆÁ®ÆÈ°û„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
                'emergency.safety.info': 'ÂÆâÂÖ®ÊÉÖÂ†±',
                'emergency.course.safety': '„Ç≥„Éº„ÇπÂÆâÂÖ®ÊÉÖÂ†±',
                'emergency.alert.sent': '„Ç¢„É©„Éº„ÉàÈÄÅ‰ø°ÂÆå‰∫Ü',

                // Profile Creation
                'profile.create': '„Éó„É≠„Éï„Ç£„Éº„É´‰ΩúÊàê',
                'profile.choose.role': 'ÂΩπÂâ≤„ÇíÈÅ∏Êäû„Åó„ÄÅÊÉÖÂ†±„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
                'profile.golfer.info': '„Ç¥„É´„Éï„Ç°„ÉºÊÉÖÂ†±',
                'profile.caddie.info': '„Ç≠„É£„Éá„Ç£ÊÉÖÂ†±',
                'profile.manager.info': '„Éû„Éç„Éº„Ç∏„É£„ÉºÊÉÖÂ†±',
                'profile.proshop.info': '„Éó„É≠„Ç∑„Éß„ÉÉ„ÉóÊÉÖÂ†±',
                'profile.maintenance.info': '„É°„É≥„ÉÜ„Éä„É≥„ÇπÊÉÖÂ†±',
                'profile.handicap': '„Éè„É≥„Éá„Ç£„Ç≠„É£„ÉÉ„Éó',
                'profile.experience.level': 'ÁµåÈ®ì„É¨„Éô„É´',
                'profile.select.level': '„É¨„Éô„É´„ÇíÈÅ∏Êäû...',
                'profile.beginner': 'ÂàùÁ¥ö',
                'profile.intermediate': '‰∏≠Á¥ö',
                'profile.advanced': '‰∏äÁ¥ö',
                'profile.professional': '„Éó„É≠',
                'profile.club.affiliation': '„ÇØ„É©„ÉñÊâÄÂ±û',
                'profile.select.society': 'Âõ£‰Ωì„ÇíÈÅ∏Êäû...',
                'profile.playing.style': '„Éó„É¨„Ç§„Çπ„Çø„Ç§„É´',
                'profile.years.experience': 'ÁµåÈ®ìÂπ¥Êï∞',
                'profile.specialty': 'Â∞ÇÈñÄÂàÜÈáé',
                'profile.select.specialty': 'Â∞ÇÈñÄÂàÜÈáé„ÇíÈÅ∏Êäû...',
                'profile.championship.course': '„ÉÅ„É£„É≥„Éî„Ç™„É≥„Ç∑„ÉÉ„Éó„Ç≥„Éº„Çπ',
                'profile.beginner.support': 'ÂàùÂøÉËÄÖ„Çµ„Éù„Éº„Éà',
                'profile.tournament.play': '„Éà„Éº„Éä„É°„É≥„Éà„Éó„É¨„Ç§',
                'profile.vip.service': 'VIP„Çµ„Éº„Éì„Çπ',
                'profile.international.service': 'ÂõΩÈöõ„Çµ„Éº„Éì„Çπ',
                'profile.languages': 'Ë®ÄË™ûÔºàË§áÊï∞ÈÅ∏ÊäûÂèØÔºâ',
                'profile.preferred.avatar': 'Â∏åÊúõ„Ç¢„Éê„Çø„Éº',
                'profile.avatar.man': 'Áî∑ÊÄß',
                'profile.avatar.woman': 'Â•≥ÊÄß',
                'profile.avatar.bald.man': '„ÅØ„ÅíÈ†≠Áî∑ÊÄß',
                'profile.avatar.bald.woman': '„ÅØ„ÅíÈ†≠Â•≥ÊÄß',
                'profile.avatar.curly.man': 'Â∑ª„ÅçÊØõÁî∑ÊÄß',
                'profile.avatar.curly.woman': 'Â∑ª„ÅçÊØõÂ•≥ÊÄß',
                'profile.avatar.white.man': 'ÁôΩÈ´™Áî∑ÊÄß',
                'profile.avatar.white.woman': 'ÁôΩÈ´™Â•≥ÊÄß',
                'profile.years.management': 'ÁÆ°ÁêÜÁµåÈ®ìÂπ¥Êï∞',
                'profile.golf.professional': '„Ç¥„É´„Éï„Éó„É≠',

                // Common Form Elements
                'form.email': '„É°„Éº„É´',
                'form.phone': 'ÈõªË©±Áï™Âè∑',
                'form.first.name': 'Âêç',
                'form.last.name': 'Âßì',
                'form.create.profile': '„Éó„É≠„Éï„Ç£„Éº„É´‰ΩúÊàê',
                'form.submit': 'ÈÄÅ‰ø°',

                // Page Titles
                'page.title': 'MciPro - „Éó„É≠„Ç¥„É´„ÉïÂ†¥ÁÆ°ÁêÜ„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†',
            }
        };

        // Translation function
        function t(key, lang = currentLanguage) {
            return translations[lang] && translations[lang][key] ? translations[lang][key] : key;
        }

        // Update all translatable elements
        function updateLanguage(lang) {
            currentLanguage = lang;

            // Update all elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                element.textContent = t(key);
            });

            // Update all placeholders with data-i18n-placeholder attribute
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                element.placeholder = t(key);
            });

            // Auto-translate common hardcoded text elements
            autoTranslateCommonElements();

            // Update page title
            document.title = t('page.title');

            // Save language preference
            localStorage.setItem('mci-pro-language', lang);
        }

        // Auto-translate common hardcoded text patterns
        function autoTranslateCommonElements() {
            // Common text mappings for elements that haven't been manually tagged
            const textMappings = {
                'Emergency Alert': 'emergency.alert',
                'Select the type of assistance you need': 'emergency.select.type',
                'Safety Info': 'emergency.safety.info',
                'Course Safety Information': 'emergency.course.safety',
                'Alert Sent Successfully': 'emergency.alert.sent',
                'Create Your Profile': 'profile.create',
                'Choose your role and fill in your information': 'profile.choose.role',
                'Golfer Information': 'profile.golfer.info',
                'Caddy Information': 'profile.caddie.info',
                'Manager Information': 'profile.manager.info',
                'Pro Shop Information': 'profile.proshop.info',
                'Maintenance Information': 'profile.maintenance.info',
                'Handicap': 'profile.handicap',
                'Experience Level': 'profile.experience.level',
                'Select level...': 'profile.select.level',
                'Beginner': 'profile.beginner',
                'Intermediate': 'profile.intermediate',
                'Advanced': 'profile.advanced',
                'Professional': 'profile.professional',
                'Club Affiliation': 'profile.club.affiliation',
                'Select society...': 'profile.select.society',
                'Playing Style': 'profile.playing.style',
                'Years of Experience': 'profile.years.experience',
                'Specialty': 'profile.specialty',
                'Select specialty...': 'profile.select.specialty',
                'Championship Course': 'profile.championship.course',
                'Beginner Support': 'profile.beginner.support',
                'Tournament Play': 'profile.tournament.play',
                'VIP Service': 'profile.vip.service',
                'International Service': 'profile.international.service',
                'Languages (select multiple)': 'profile.languages',
                'Preferred Avatar': 'profile.preferred.avatar',
                'Man': 'profile.avatar.man',
                'Woman': 'profile.avatar.woman',
                'Bald Man': 'profile.avatar.bald.man',
                'Bald Woman': 'profile.avatar.bald.woman',
                'Curly Hair Man': 'profile.avatar.curly.man',
                'Curly Hair Woman': 'profile.avatar.curly.woman',
                'White Hair Man': 'profile.avatar.white.man',
                'White Hair Woman': 'profile.avatar.white.woman',
                'Years in Management': 'profile.years.management',
                'Golf Professional': 'profile.golf.professional',
                'Email': 'form.email',
                'Phone': 'form.phone',
                'First Name': 'form.first.name',
                'Last Name': 'form.last.name',
                'Create Profile': 'form.create.profile',
                'Submit': 'form.submit',
                'Cancel': 'common.cancel',
                'Close': 'common.close',
                'Back': 'common.back',
                'Next': 'common.next',
                'Save': 'common.save',
                'Loading...': 'common.loading',
                'Settings': 'common.settings',
                'Logout': 'nav.logout',
                'Overview': 'golfer.overview',
                'Booking': 'golfer.booking',
                'Food & Drinks': 'golfer.food',
                'GPS & Navigation': 'golfer.gps',
                'Emergency': 'golfer.emergency'
            };

            // Update text content based on exact matches
            Object.entries(textMappings).forEach(([englishText, translationKey]) => {
                const elements = Array.from(document.querySelectorAll('*')).filter(el => {
                    return el.childNodes.length === 1 &&
                           el.childNodes[0].nodeType === Node.TEXT_NODE &&
                           el.textContent.trim() === englishText &&
                           !el.hasAttribute('data-i18n');
                });

                elements.forEach(el => {
                    el.textContent = t(translationKey);
                    el.setAttribute('data-i18n', translationKey);
                });
            });

            // Update option elements specifically
            document.querySelectorAll('option').forEach(option => {
                const text = option.textContent.trim();
                if (textMappings[text] && !option.hasAttribute('data-i18n')) {
                    option.textContent = t(textMappings[text]);
                    option.setAttribute('data-i18n', textMappings[text]);
                }
            });
        }

        // Language selector function
        function changeLanguage(lang) {
            updateLanguage(lang);

            // Update active language button
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-lang') === lang) {
                    btn.classList.add('active');
                }
            });
        }

        // Initialize language on page load
        function initializeLanguage() {
            const savedLanguage = localStorage.getItem('mci-pro-language') || 'en';
            updateLanguage(savedLanguage);

            // Set active language button
            const activeBtn = document.querySelector(`[data-lang="${savedLanguage}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }

            // Set up observer for dynamic content
            setupDynamicContentObserver();
        }

        // Setup observer to auto-translate dynamically added content
        function setupDynamicContentObserver() {
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                        // Wait a bit for content to settle, then auto-translate
                        setTimeout(() => {
                            autoTranslateCommonElements();
                        }, 100);
                    }
                });
            });

            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        }

        // Application State
        const AppState = {
            currentUser: {
                role: 'guest',
                name: 'Guest User',
                lineId: null,
                avatar: null,
                email: null,
                phone: null,
                handicap: null,
                membershipLevel: 'basic',
                joinDate: null,
                stats: {
                    totalRounds: 0,
                    averageScore: 0,
                    bestScore: 0,
                    totalEarnings: 0,
                    rating: 0
                },
                permissions: [],
                preferences: {
                    gpsTracking: true,
                    emergencyContacts: []
                }
            },

            navigation: {
                currentScreen: 'login',
                lastScreen: null,
                activeTab: '',
                breadcrumb: []
            },

            session: {
                loginTime: null,
                lastActivity: null,
                isAuthenticated: false,
                authMethod: null // 'line', 'otp', 'fallback'
            },

        };

        // LINE LIFF Configuration
        const LineConfig = {
            liffId: 'liff-v2-your-liff-id-here',
            channelId: 'your-channel-id-here',
            fallbackEnabled: true,
            debugMode: true
        };

        // ===== CORE SYSTEM FUNCTIONS =====

        // Helper functions for sync operations
        function toArray(x) {
            if (Array.isArray(x)) return x;
            if (x?.items) return x.items;                      // support {items:[...]}
            if (x && typeof x === 'object') return Object.values(x); // legacy object map
            return [];
        }

        function upsertById(list, item, key='id') {
            const a = [...(list || [])];
            const i = a.findIndex(x => x && x[key] === item[key]);
            if (i >= 0) a[i] = { ...a[i], ...item }; else a.push(item);
            return a;
        }

        // Generate stable, deterministic booking ID to prevent duplicates
        function newBookingId(booking) {
            // deterministic enough to survive retries; include seconds to avoid natural collisions
            const t = booking.teeTime || booking.date + 'T' + (booking.time || '08:00') + ':00Z';
            const course = booking.courseId || booking.course || 'unknown';
            const user = window.Auth?.currentUserId || booking.golferId || 'anon';
            const type = booking.type || 'teeTime';
            const caddieSuffix = booking.caddieId ? `_caddie_${booking.caddieId}` : '';
            const serviceSuffix = booking.serviceId ? `_service_${booking.serviceId}` : '';
            const mainSuffix = booking.isMainBooking ? '_main' : '';
            const id = `bk_${course}_${t}_${user}_${type}${caddieSuffix}${serviceSuffix}${mainSuffix}`.replace(/[^a-zA-Z0-9_]/g, '_');
            console.log('[newBookingId] Generated ID:', id, 'for booking:', booking);
            return id;
        }

        // Generate stable round groupId for schedule consolidation
        function makeRoundGroupId({ courseId, teeTime, userId }) {
            const iso = new Date(teeTime).toISOString();
            return `round_${courseId}_${iso}_${userId}`.replace(/[^\w]/g, "_");
        }

        // Guard against double-tap and duplicate handlers
        let creatingBooking = false;

        // Clean up any bad home course values from localStorage
        (function normalizeBadHomeClub() {
            try {
                const PLACEHOLDER_TEXTS = new Set([
                    'Select your home course...', 'Select your home course', 'Select home course', 'Not Selected', '‚Äî'
                ]);

                const p = JSON.parse(localStorage.getItem('mcipro_user_profile') || 'null');
                if (p && (PLACEHOLDER_TEXTS.has(p.homeClub) || !p.homeClub || p.homeClub.includes('Select'))) {
                    console.log('[ProfileSystem] Cleaning bad homeClub value:', p.homeClub);
                    p.homeClub = '';
                    localStorage.setItem('mcipro_user_profile', JSON.stringify(p));
                    localStorage.setItem('mcipro_user_profiles', JSON.stringify([p]));
                }

                // Also clean the array format
                const profiles = JSON.parse(localStorage.getItem('mcipro_user_profiles') || '[]');
                let cleaned = false;
                profiles.forEach(profile => {
                    if (profile.homeClub && (PLACEHOLDER_TEXTS.has(profile.homeClub) || profile.homeClub.includes('Select'))) {
                        console.log('[ProfileSystem] Cleaning bad homeClub in profiles array:', profile.homeClub);
                        profile.homeClub = '';
                        cleaned = true;
                    }
                });
                if (cleaned) {
                    localStorage.setItem('mcipro_user_profiles', JSON.stringify(profiles));
                }
            } catch (e) {
                console.warn('[ProfileSystem] Error cleaning bad homeClub values:', e);
            }
        })();

        // Add schedule event once for booking (prevents duplicates)
        function addScheduleEventOnceForBooking(booking) {
            // Read schedule data as object structure (not flat array)
            let scheduleData = JSON.parse(localStorage.getItem('mcipro_schedule') || '{"events":[],"caddieBookings":[],"waitlists":[]}');
            let events = scheduleData.events || [];

            const eventId = `sch_${booking.id}`;
            const evt = {
                id: eventId,
                title: `Round at ${booking.course || booking.courseName}`,
                date: booking.date,
                time: booking.time,
                type: 'golf',
                description: booking.eventName || 'Golf round',
                bookingId: booking.id,
                updatedAt: Date.now(),
                createdAt: Date.now()
            };

            // Use upsert on events array to prevent duplicates
            events = upsertById(events, evt, 'id');
            scheduleData.events = events;

            // Save back as object structure for ScheduleSystem compatibility
            localStorage.setItem('mcipro_schedule', JSON.stringify(scheduleData));
        }

        // Production Cloud Sync System - Google Cloud Firestore + Cloudflare
        class SimpleCloudSync {
            static isInitialized = false;
            static pushTimer = null;
            static DEBOUNCE_DELAY = 800; // 800ms debounce to reduce conflicts
            static FUNCTION_URL = 'https://mcipro-golf-platform.netlify.app/.netlify/functions/bookings';
            static API_KEY = 'mcipro-site-key-2024';
            static MAX_RETRIES = 5;

            static async initialize() {
                console.log('[SimpleCloudSync] Initializing Netlify Blobs sync...');
                this.isInitialized = true;

                // Load initial data from cloud
                await this.loadFromCloud();

                // Start lightweight polling
                this.startPolling();
            }

            static startPolling() {
                // Adaptive polling: Fast during emergencies, slow otherwise
                let emergencyPollCount = 0;
                let normalPollCount = 0;

                const emergencyInterval = setInterval(() => {
                    if (emergencyPollCount > 0 && emergencyPollCount <= 15) {
                        // Fast polling for 30 seconds during emergency mode
                        this.loadFromCloud().catch(err => {
                            console.log('[SimpleCloudSync] Emergency sync failed:', err.message);
                        });
                        emergencyPollCount++;

                        if (emergencyPollCount > 15) {
                            console.log('[SimpleCloudSync] Emergency mode ended, switching to normal polling');
                        }
                    }
                }, 2000);

                // Normal polling every 15 seconds (reduced from 5s to improve performance)
                const normalInterval = setInterval(() => {
                    if (emergencyPollCount === 0 || emergencyPollCount > 15) {
                        this.loadFromCloud().catch(err => {
                            console.log('[SimpleCloudSync] Background sync failed:', err.message);
                        });
                    }
                }, 15000);

                // Reset emergency mode when new alert is sent
                window.addEventListener('emergency-alert-sent', () => {
                    emergencyPollCount = 1; // Start emergency polling
                    console.log('[SimpleCloudSync] üö® Emergency mode activated - fast polling for 30s');
                });
            }

            static async loadFromCloud() {
                try {
                    const res = await fetch('/.netlify/functions/bookings', {
                        method: 'GET',
                        headers: { 'Authorization': 'Bearer mcipro-site-key-2024' }
                    });
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);

                    const cloudData = await res.json();
                    console.log('[SimpleCloudSync] Loaded from cloud:', {
                        bookings: cloudData.bookings?.length || 0,
                        profiles: cloudData.user_profiles?.length || 0,
                        schedule: (cloudData.schedule_items || cloudData.schedule || []).length,
                        updatedAt: cloudData.updatedAt
                    });

                    // Get local data timestamp
                    const localData = JSON.parse(localStorage.getItem('mcipro_data') || '{}');

                    // Only update if cloud data is newer
                    if (!localData.updatedAt || (cloudData.updatedAt && cloudData.updatedAt > localData.updatedAt)) {
                        console.log('[SimpleCloudSync] Cloud data is newer, updating local storage');

                        // Update individual localStorage items for compatibility
                        if (cloudData.bookings) {
                            localStorage.setItem('mcipro_bookings', JSON.stringify(cloudData.bookings));
                            if (typeof BookingManager !== 'undefined' && BookingManager.bookings) {
                                BookingManager.bookings = cloudData.bookings;
                                console.log('[SimpleCloudSync] Updated BookingManager with', cloudData.bookings.length, 'bookings');
                            }
                        }

                        if (cloudData.user_profiles) {
                            localStorage.setItem('mcipro_user_profiles', JSON.stringify(cloudData.user_profiles));

                            // Find current user's profile and update individual profile storage
                            const currentUserId = (window.Auth?.currentUserId) || AppState?.currentUser?.name || 'anon';
                            const userProfile = cloudData.user_profiles.find(p =>
                                p.userId === currentUserId ||
                                p.name === currentUserId ||
                                (AppState?.currentUser?.name && p.name === AppState.currentUser.name)
                            );

                            if (userProfile) {
                                localStorage.setItem('mcipro_user_profile', JSON.stringify(userProfile));
                                console.log('[SimpleCloudSync] Updated individual profile with homeClub:', userProfile.golfInfo?.homeClub || userProfile.homeClub);

                                // Pass profile to UI updater
                                try {
                                    if (typeof ProfileSystem !== 'undefined' && ProfileSystem.updateUIWithProfile) {
                                        ProfileSystem.updateUIWithProfile(userProfile);
                                    }
                                } catch (e) {
                                    console.warn('[SimpleCloudSync] ProfileSystem updateUI failed:', e);
                                }
                            }
                        }

                        if (cloudData.schedule_items) {
                            const scheduleFromServer = toArray(cloudData.schedule_items || cloudData.schedule || []);
                            // ScheduleSystem expects object with events array, not flat array
                            const scheduleWrapper = { events: scheduleFromServer, caddieBookings: [], waitlists: [] };
                            localStorage.setItem('mcipro_schedule', JSON.stringify(scheduleWrapper));
                            // Refresh stats after schedule update
                            if (typeof ScheduleSystem !== 'undefined' && ScheduleSystem.refreshStats) {
                                ScheduleSystem.refreshStats();
                            }
                        }

                        if (cloudData.emergency_alerts) {
                            localStorage.setItem('emergency_alerts', JSON.stringify(cloudData.emergency_alerts));
                            if (typeof EmergencySystem !== 'undefined') {
                                EmergencySystem.activeAlerts = cloudData.emergency_alerts;
                                // Show any new emergency alerts immediately
                                const newAlert = cloudData.emergency_alerts[cloudData.emergency_alerts.length - 1];
                                if (newAlert) {
                                    console.log('[Emergency] Displaying synced alert:', newAlert);
                                    EmergencySystem.createFullScreenEmergencyOverlay(newAlert);
                                }
                            }
                        }

                        // Store the unified data with timestamp
                        localStorage.setItem('mcipro_data', JSON.stringify(cloudData));

                        this.showSyncStatus('‚Üì Cloud Update', 'info');
                        return true;
                    }

                    return false;
                } catch (error) {
                    console.error('[SimpleCloudSync] Failed to load from cloud:', error);
                    return false;
                }
            }

            static ensureStableIds(data) {
                // Ensure all items have stable IDs and updatedAt timestamps

                // Fix bookings
                data.bookings = (data.bookings || []).map(booking => ({
                    ...booking,
                    id: booking.id || `booking_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    updatedAt: booking.updatedAt || Date.now()
                }));

                // Fix profiles with stable userId instead of name
                data.user_profiles = (data.user_profiles || []).map(profile => ({
                    ...profile,
                    userId: profile.userId || `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    updatedAt: profile.updatedAt || Date.now()
                }));

                // Fix schedule items - ensure it's an array
                let scheduleItems = data.schedule_items || [];
                if (typeof scheduleItems === 'object' && !Array.isArray(scheduleItems)) {
                    // Convert object to array if needed
                    if (scheduleItems.events) {
                        scheduleItems = scheduleItems.events || [];
                    } else {
                        scheduleItems = [];
                    }
                }
                data.schedule_items = scheduleItems.map(item => ({
                    ...item,
                    id: item.id || `schedule_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    updatedAt: item.updatedAt || Date.now()
                }));

                // Fix emergency alerts
                data.emergency_alerts = (data.emergency_alerts || []).map(alert => ({
                    ...alert,
                    id: alert.id || `alert_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    updatedAt: alert.updatedAt || Date.now()
                }));

                return data;
            }

            static async saveToCloud(retryCount = 0) {
                const MAX_RETRIES = 3;
                const BASE_DELAY = 500; // 500ms base delay

                try {
                    // Get current server version for conflict detection
                    const cloudRes = await fetch('/.netlify/functions/bookings', {
                        method: 'GET',
                        headers: { 'Authorization': 'Bearer mcipro-site-key-2024' }
                    });
                    const currentCloudData = cloudRes.ok ? await cloudRes.json() : { version: 0 };

                    // Get user profiles from both storage formats
                    let userProfiles = JSON.parse(localStorage.getItem('mcipro_user_profiles') || '[]');
                    const singleProfile = JSON.parse(localStorage.getItem('mcipro_user_profile') || 'null');

                    // If we have a single profile but no profiles array, use the single profile
                    if (singleProfile && userProfiles.length === 0) {
                        userProfiles = [singleProfile];
                    }

                    // Read from localStorage and extract events array specifically
                    let scheduleData = JSON.parse(localStorage.getItem('mcipro_schedule') || '{"events":[]}');
                    let schedule = scheduleData.events || [];

                    // Ensure stable ID and updatedAt for schedule items
                    const scheduleItems = schedule.map(evt => {
                        if (!evt.id) evt.id = (crypto.randomUUID?.() || 'sch_' + Date.now() + '_' + Math.random().toString(36).slice(2));
                        if (!evt.updatedAt) evt.updatedAt = Date.now();
                        return evt;
                    });

                    const localData = {
                        bookings: toArray(JSON.parse(localStorage.getItem('mcipro_bookings') || '[]')),
                        user_profiles: toArray(userProfiles),
                        schedule_items: scheduleItems,
                        emergency_alerts: toArray(JSON.parse(localStorage.getItem('emergency_alerts') || '[]')),
                        caddies: toArray(JSON.parse(localStorage.getItem('mcipro_caddies') || '[]')),
                        waitlist: toArray(JSON.parse(localStorage.getItem('mcipro_waitlist') || '[]')),
                        baseVersion: currentCloudData.version
                    };

                    // Ensure all items have stable IDs and timestamps
                    const dataWithIds = this.ensureStableIds(localData);

                    console.log('[SimpleCloudSync] Sending data to server for merge:', {
                        bookings: dataWithIds.bookings.length,
                        profiles: dataWithIds.user_profiles.length,
                        baseVersion: dataWithIds.baseVersion,
                        attempt: retryCount + 1
                    });

                    const res = await fetch('/.netlify/functions/bookings', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer mcipro-site-key-2024'
                        },
                        body: JSON.stringify(dataWithIds)
                    });

                    if (res.status === 409) {
                        // Conflict detected - retry with exponential backoff
                        if (retryCount < MAX_RETRIES) {
                            const conflictData = await res.json();
                            console.log('[SimpleCloudSync] Conflict detected, retrying with backoff');
                            this.updateLocalStorageFromServer(conflictData.serverData);

                            const jitter = Math.random() * 100; // 0-100ms jitter
                            const delay = BASE_DELAY * Math.pow(2, retryCount) + jitter;

                            await new Promise(resolve => setTimeout(resolve, delay));
                            return this.saveToCloud(retryCount + 1);
                        } else {
                            throw new Error('Max conflict retries exceeded');
                        }
                    }

                    if (!res.ok) {
                        // 5xx errors: retry with backoff
                        if (res.status >= 500 && retryCount < MAX_RETRIES) {
                            console.log(`[SimpleCloudSync] Server error ${res.status}, retrying with backoff`);

                            const jitter = Math.random() * 100;
                            const delay = BASE_DELAY * Math.pow(2, retryCount) + jitter;

                            await new Promise(resolve => setTimeout(resolve, delay));
                            return this.saveToCloud(retryCount + 1);
                        }
                        throw new Error(`HTTP ${res.status}`);
                    }

                    const result = await res.json();

                    // Server returns the final merged state - use it
                    this.updateLocalStorageFromServer(result.mergedData);

                    console.log('[SimpleCloudSync] Server-side merge completed, version:', result.version);

                    console.log('[SimpleCloudSync] Saved to cloud successfully');
                    this.showSyncStatus('‚òÅÔ∏è Synced', 'success');
                    return true;
                } catch (error) {
                    console.error('[SimpleCloudSync] Failed to save to cloud:', error);
                    this.showSyncStatus('üíæ Local Only', 'warning');
                    return false;
                }
            }

            static updateLocalStorageFromServer(serverData) {
                // Helper function to normalize to array
                function toArray(x) {
                    if (Array.isArray(x)) return x;
                    if (x?.items) return x.items;
                    if (x && typeof x === 'object') return Object.values(x);
                    return [];
                }

                const scheduleData = toArray(serverData.schedule_items || serverData.schedule || []);

                // Update local storage with server's authoritative state - all as arrays
                localStorage.setItem('mcipro_bookings', JSON.stringify(serverData.bookings || []));
                localStorage.setItem('mcipro_user_profiles', JSON.stringify(serverData.user_profiles || []));
                localStorage.setItem('mcipro_schedule', JSON.stringify(scheduleData));
                localStorage.setItem('emergency_alerts', JSON.stringify(serverData.emergency_alerts || []));
                localStorage.setItem('mcipro_caddies', JSON.stringify(serverData.caddies || []));
                localStorage.setItem('mcipro_waitlist', JSON.stringify(serverData.waitlist || []));
                localStorage.setItem('mcipro_data', JSON.stringify({
                    ...serverData,
                    schedule: scheduleData, // Ensure schedule is in envelope
                    lastSyncVersion: serverData.version
                }));

                // Update in-memory data structures
                if (typeof BookingManager !== 'undefined' && BookingManager.bookings) {
                    BookingManager.bookings = serverData.bookings || [];
                    console.log('[SimpleCloudSync] Updated BookingManager with server data:', BookingManager.bookings.length, 'bookings');
                }

                // Update ProfileSystem UI with synced profile data
                if (typeof ProfileSystem !== 'undefined' && ProfileSystem.updateUIWithProfile) {
                    console.log('[SimpleCloudSync] Updating ProfileSystem UI with synced data');

                    // Also update single profile format and re-apply form selection
                    const currentUserId = (window.AppState && window.AppState.currentUser && window.AppState.currentUser.id) ||
                                        (window.Auth && window.Auth.currentUserId) || 'anon';
                    const userProfile = (serverData.user_profiles || []).find(u => u.userId === currentUserId);

                    if (userProfile) {
                        localStorage.setItem('mcipro_user_profile', JSON.stringify(userProfile));
                        console.log('[SimpleCloudSync] Updated single profile format with homeClub:', userProfile.homeClub || '(none)');

                        // Re-apply home club selection to form if it exists
                        if (userProfile.homeClub && typeof ProfileSystem.applyHomeClubToForm === 'function') {
                            ProfileSystem.applyHomeClubToForm(userProfile.homeClub);
                        }
                    }

                    ProfileSystem.updateUIWithProfile();
                }

                console.log('[SimpleCloudSync] Local storage updated from server:', {
                    bookings: serverData.bookings?.length || 0,
                    profiles: serverData.user_profiles?.length || 0,
                    schedule: scheduleData.length,
                    version: serverData.version
                });
            }

            static async handleDeletion(entityType, id) {
                // Send a deletion tombstone to the server
                const deletionData = {};
                deletionData[entityType] = [{
                    id: id,
                    deleted: true,
                    updatedAt: Date.now()
                }];

                console.log(`[SimpleCloudSync] Sending deletion tombstone for ${entityType}:${id}`);

                const res = await fetch('/.netlify/functions/bookings', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer mcipro-site-key-2024'
                    },
                    body: JSON.stringify(deletionData)
                });

                if (res.ok) {
                    const result = await res.json();
                    this.updateLocalStorageFromServer(result.mergedData);
                    console.log(`[SimpleCloudSync] Deletion synced for ${entityType}:${id}`);
                }
            }

            static async saveViaCloudflare(userData) {
                const response = await fetch(`${this.cloudflareWorkerUrl}/sync/${this.getUserDocPath()}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': 'mcipro-sync-key-2024'
                    },
                    body: JSON.stringify(userData)
                });

                if (!response.ok) {
                    throw new Error(`Cloudflare sync failed: ${response.status}`);
                }

                const result = await response.json();
                console.log('[ProductionCloudSync] Data saved via Cloudflare:', result);
                this.showSyncStatus('‚ö° Edge Synced', 'success');
            }

            static async syncFromCloudflare() {
                if (!this.isInitialized) return;

                try {
                    const response = await fetch(`${this.cloudflareWorkerUrl}/sync/${this.getUserDocPath()}`, {
                        headers: { 'X-API-Key': 'mcipro-sync-key-2024' }
                    });

                    if (response.ok) {
                        const cloudData = await response.json();
                        this.handleCloudUpdate(cloudData);
                    }
                } catch (error) {
                    console.error('[ProductionCloudSync] Sync from Cloudflare failed:', error);
                }
            }

            static handleCloudUpdate(cloudData) {
                try {
                    console.log('[SYNC] Received cloud data:', {
                        user: cloudData.user_name,
                        bookings: cloudData.bookings?.length || 0,
                        profiles: cloudData.user_profiles?.length || 0
                    });

                    if (cloudData.bookings) {
                        const currentBookings = JSON.parse(localStorage.getItem('mcipro_bookings') || '[]');
                        const existingIds = new Set(currentBookings.map(b => b.id));
                        const newBookings = cloudData.bookings.filter(booking => !existingIds.has(booking.id));

                        if (newBookings.length > 0) {
                            const mergedBookings = [...currentBookings, ...newBookings];
                            localStorage.setItem('mcipro_bookings', JSON.stringify(mergedBookings));
                            if (typeof BookingManager !== 'undefined') {
                                BookingManager.bookings = mergedBookings;
                                console.log('[SYNC] Merged bookings - refreshing UI');
                                BookingManager.render();
                            }
                            this.showSyncStatus('‚Üì Real-time Update', 'info');
                        }
                    }

                    if (cloudData.user_profiles) {
                        const currentProfiles = JSON.parse(localStorage.getItem('mcipro_user_profiles') || '[]');
                        const existingNames = new Set(currentProfiles.map(p => p.name));
                        const newProfiles = cloudData.user_profiles.filter(profile => !existingNames.has(profile.name));

                        if (newProfiles.length > 0) {
                            const mergedProfiles = [...currentProfiles, ...newProfiles];
                            localStorage.setItem('mcipro_user_profiles', JSON.stringify(mergedProfiles));
                            console.log('[SYNC] Merged profiles');
                            this.showSyncStatus('‚Üì Real-time Update', 'info');
                        }
                    }

                    if (cloudData.emergency_alerts) {
                        localStorage.setItem('emergency_alerts', JSON.stringify(cloudData.emergency_alerts));
                        if (typeof EmergencySystem !== 'undefined') {
                            EmergencySystem.activeAlerts = cloudData.emergency_alerts;
                            // Show any new emergency alerts immediately
                            const newAlert = cloudData.emergency_alerts[cloudData.emergency_alerts.length - 1];
                            if (newAlert) {
                                console.log('[Emergency] Displaying synced alert from cloud:', newAlert);
                                EmergencySystem.createFullScreenEmergencyOverlay(newAlert);
                            }
                        }
                    }

                } catch (error) {
                    console.error('[ProductionCloudSync] Handle cloud update failed:', error);
                }
            }

            static async syncGlobalEmergencyAlerts() {
                try {
                    const response = await fetch(`${this.cloudflareWorkerUrl}/global/emergency-alerts`, {
                        headers: { 'X-API-Key': 'mcipro-sync-key-2024' }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.alerts && data.alerts.length > 0) {
                            localStorage.setItem('emergency_alerts', JSON.stringify(data.alerts));
                            if (typeof EmergencySystem !== 'undefined') {
                                EmergencySystem.activeAlerts = data.alerts;
                                console.log('[ProductionCloudSync] Updated global emergency alerts');
                            }
                        }
                    }
                } catch (error) {
                    console.error('[ProductionCloudSync] Emergency alerts sync failed:', error);
                }
            }

            static showSyncStatus(message, type = 'info') {
                console.log(`[ProductionCloudSync] ${message}`);

                let statusElement = document.getElementById('sync-status');
                if (!statusElement) {
                    statusElement = document.createElement('div');
                    statusElement.id = 'sync-status';
                    statusElement.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        padding: 8px 16px;
                        border-radius: 8px;
                        font-size: 12px;
                        font-weight: 600;
                        z-index: 10000;
                        transition: all 0.3s ease;
                    `;
                    document.body.appendChild(statusElement);
                }

                const colors = {
                    success: { bg: '#10b981', color: 'white' },
                    info: { bg: '#3b82f6', color: 'white' },
                    warning: { bg: '#f59e0b', color: 'white' },
                    error: { bg: '#ef4444', color: 'white' }
                };

                const color = colors[type] || colors.info;
                statusElement.style.backgroundColor = color.bg;
                statusElement.style.color = color.color;
                statusElement.textContent = message;
                statusElement.style.opacity = '1';

                setTimeout(() => {
                    if (statusElement) {
                        statusElement.style.opacity = '0';
                    }
                }, 3000);
            }

            // Backward compatibility aliases
            static async saveData() {
                return await this.saveToCloud();
            }

            static async syncFromCloudflare() {
                return await this.loadFromCloud();
            }

            // Add missing methods that are being called
            static async forceSync() {
                console.log('[ProductionCloudSync] forceSync() called');
                try {
                    await this.saveData();
                    await this.syncFromCloudflare();
                    console.log('[ProductionCloudSync] Force sync completed');
                } catch (error) {
                    console.error('[ProductionCloudSync] Force sync failed:', error);
                }
            }

            static async loadDataFromCloudflare() {
                console.log('[ProductionCloudSync] loadDataFromCloudflare() called');
                try {
                    const response = await fetch(`${this.cloudflareWorkerUrl}/sync/${this.getUserDocPath()}`, {
                        headers: { 'X-API-Key': 'mcipro-sync-key-2024' }
                    });

                    if (response.ok) {
                        const cloudData = await response.json();
                        this.handleCloudUpdate(cloudData);
                        console.log('[ProductionCloudSync] Initial data loaded from cloud');
                    } else {
                        console.log('[ProductionCloudSync] No cloud data found for initial load');
                    }
                } catch (error) {
                    console.error('[ProductionCloudSync] Failed to load initial data:', error);
                }
            }

            // Debounced sync to prevent conflict storms
            static saveToCloudSoon() {
                clearTimeout(this.pushTimer);
                this.pushTimer = setTimeout(() => {
                    console.log('[SimpleCloudSync] Debounced sync executing...');
                    this.saveToCloud();
                }, this.DEBOUNCE_DELAY);
            }
        }

        // Alias for backward compatibility
        window.CrossDeviceSync = SimpleCloudSync;
        window.ProductionCloudSync = SimpleCloudSync; // Also alias the old name
        const CrossDeviceSync = SimpleCloudSync;
        const ProductionCloudSync = SimpleCloudSync;

        // Screen Management System
        class ScreenManager {
            static showScreen(screenId, data = null) {
                try {
                    console.log(`ScreenManager: Navigating to ${screenId}`);

                    // Hide all screens
                    document.querySelectorAll('.screen').forEach(screen => {
                        screen.classList.remove('active');
                    });

                    // Show target screen
                    const targetScreen = document.getElementById(screenId);
                    if (!targetScreen) {
                        throw new Error(`Screen '${screenId}' not found`);
                    }

                    targetScreen.classList.add('active');

                    // Update navigation state
                    AppState.navigation.lastScreen = AppState.navigation.currentScreen;
                    AppState.navigation.currentScreen = screenId;
                    AppState.navigation.breadcrumb.push(screenId);

                    // Limit breadcrumb history
                    if (AppState.navigation.breadcrumb.length > 10) {
                        AppState.navigation.breadcrumb.shift();
                    }

                    // Initialize screen-specific functionality
                    this.initializeScreen(screenId, data);

                    // Update session activity
                    AppState.session.lastActivity = new Date().toISOString();

                    console.log(`ScreenManager: Successfully navigated to ${screenId}`);

                } catch (error) {
                    console.error('ScreenManager Error:', error);
                    NotificationManager.show('Navigation error occurred', 'error');
                }
            }

            static initializeScreen(screenId, data) {
                const initMap = {
                    'login': () => this.initLoginScreen(),
                    'otpScreen': () => this.initOTPScreen(),
                    'golferDashboard': () => this.initGolferDashboard(),
                    'caddieDashboard': () => this.initCaddyDashboard(),
                    'managerDashboard': () => this.initManagerDashboard(),
                    'proshopDashboard': () => this.initProshopDashboard(),
                    'maintenanceDashboard': () => this.initMaintenanceDashboard()
                };

                const initFunction = initMap[screenId];
                if (initFunction) {
                    initFunction();
                }
            }

            static initLoginScreen() {
                // Reset any authentication state
                AppState.session.isAuthenticated = false;
                AppState.session.authMethod = null;

                // Initialize LINE LIFF if available
                LineAuthentication.initializeLIFF();
            }

            static initOTPScreen() {
                // Focus first OTP input
                const firstInput = document.querySelector('.otp-input');
                if (firstInput) {
                    firstInput.focus();
                }
            }

            static initGolferDashboard() {
                TabManager.showTab('golferDashboard', 'overview');
                UserInterface.updateUserDisplays();
                ProfileSystem.initializeDashboard();

                // Initialize GPS tracking for live course status
                setTimeout(() => {
                    if (typeof startGPSTracking === 'function') {
                        startGPSTracking();
                        getCurrentLocation();
                    }
                }, 1000);
            }

            static initCaddyDashboard() {
                TabManager.showTab('caddieDashboard', 'overview');
                UserInterface.updateUserDisplays();
            }

            static initManagerDashboard() {
                TabManager.showTab('managerDashboard', 'overview');
                UserInterface.updateUserDisplays();
            }

            static initProshopDashboard() {
                TabManager.showTab('proshopDashboard', 'pos');
                UserInterface.updateUserDisplays();
            }

            static initMaintenanceDashboard() {
                TabManager.showTab('maintenanceDashboard', 'overview');
                UserInterface.updateUserDisplays();
            }

            static goBack() {
                if (AppState.navigation.lastScreen) {
                    this.showScreen(AppState.navigation.lastScreen);
                }
            }
        }

        // Tab Management System
        class TabManager {
            static showTab(dashboardId, tabName, event = null) {
                try {
                    console.log(`TabManager: Switching to ${tabName} in ${dashboardId}`);

                    // Update tab button states
                    const tabButtons = document.querySelectorAll(`#${dashboardId} .tab-button`);
                    tabButtons.forEach(btn => {
                        btn.classList.remove('active');
                    });

                    // Activate clicked tab button
                    if (event && event.target) {
                        event.target.classList.add('active');
                    } else {
                        // Find and activate tab button by onclick attribute
                        const targetBtn = document.querySelector(`#${dashboardId} .tab-button[onclick*="${tabName}"]`);
                        if (targetBtn) {
                            targetBtn.classList.add('active');
                        }
                    }

                    // Hide all tab content
                    const tabContents = document.querySelectorAll(`#${dashboardId} .tab-content`);
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                    });

                    // Show target tab content
                    const targetContent = document.getElementById(`${dashboardId.replace('Dashboard', '')}-${tabName}`);
                    if (targetContent) {
                        targetContent.classList.add('active');
                        AppState.navigation.activeTab = tabName;

                        // Load tab-specific data
                        this.loadTabData(dashboardId, tabName);
                    } else {
                        console.warn(`Tab content '${dashboardId.replace('Dashboard', '')}-${tabName}' not found`);
                    }

                } catch (error) {
                    console.error('TabManager Error:', error);
                    NotificationManager.show('Tab switching error', 'error');
                }
            }

            static loadTabData(dashboardId, tabName) {
                console.log(`Loading data for ${dashboardId}:${tabName}`);

                // Load tab-specific data
                if (dashboardId === 'golferDashboard' && tabName === 'overview') {
                    // Load promotional caddies for golf course promotion
                    setTimeout(() => {
                        loadPromotionalCaddys();

                        // Update GPS data for Live Course Status
                        if (typeof calculateDistances === 'function') {
                            calculateDistances();
                        }
                        if (typeof updateHoleDisplay === 'function') {
                            updateHoleDisplay();
                        }
                    }, 100);
                }

                // Update order status tab when shown
                if (dashboardId === 'golferDashboard' && tabName === 'status') {
                    setTimeout(() => {
                        updateOrderStatusTab();
                    }, 100);
                }

                // Initialize schedule tab when shown
                if (dashboardId === 'golferDashboard' && tabName === 'schedule') {
                    setTimeout(() => {
                        ScheduleSystem.initializeSchedule();
                        ScheduleSystem.updateScheduleTab();
                    }, 100);
                }

                // Initialize booking tab when shown
                if (dashboardId === 'golferDashboard' && tabName === 'booking') {
                    setTimeout(() => {
                        initializeBookingSystem();
                        initializeBookingCart();
                    }, 100);
                }

                // Initialize GPS tab when shown
                if (dashboardId === 'golferDashboard' && tabName === 'gps') {
                    setTimeout(() => {
                        // Ensure GPS tracking is active
                        if (typeof startGPSTracking === 'function') {
                            startGPSTracking();
                        }
                        if (typeof getCurrentLocation === 'function') {
                            getCurrentLocation();
                        }
                        // Initialize map if it exists
                        if (document.getElementById('courseMap')) {
                            if (typeof initOpenStreetMap === 'function') {
                                initOpenStreetMap();
                            }
                        }
                    }, 100);
                }

                // Update persistent emergency alerts when switching to overview or pos (proshop default) tabs
                if (tabName === 'overview' || tabName === 'pos') {
                    setTimeout(() => {
                        PersistentEmergencyAlerts.updateAllOverviewAlerts();
                    }, 100);
                }
            }
        }

        // LINE Authentication System
        class LineAuthentication {
            static async initializeLIFF() {
                if (!LineConfig.liffId || LineConfig.liffId === 'liff-v2-your-liff-id-here') {
                    console.log('LINE LIFF not configured, showing fallback login');
                    this.showFallbackLogin();
                    return;
                }

                try {
                    await liff.init({ liffId: LineConfig.liffId });
                    console.log('LIFF initialized successfully');

                    if (liff.isLoggedIn()) {
                        const profile = await liff.getProfile();
                        this.setUserFromLineProfile(profile);
                        this.redirectToDashboard();
                    } else {
                        this.showLineLogin();
                    }
                } catch (error) {
                    console.error('LIFF initialization failed:', error);
                    this.showFallbackLogin();
                }
            }

            static async loginWithLINE() {
                try {
                    LoadingManager.show('Connecting to LINE...');

                    if (!liff.isLoggedIn()) {
                        liff.login();
                    } else {
                        const profile = await liff.getProfile();
                        this.setUserFromLineProfile(profile);
                        this.redirectToDashboard();
                    }
                } catch (error) {
                    console.error('LINE login failed:', error);
                    NotificationManager.show('LINE login failed. Please try again.', 'error');
                } finally {
                    LoadingManager.hide();
                }
            }

            static setUserFromLineProfile(profile) {
                // Role mapping based on LINE user ID (this would be database-driven in production)
                const roleMap = {
                    'U1234567890': { role: 'golfer', name: 'John Mitchell', handicap: 18 },
                    'U0987654321': { role: 'caddie', name: 'Ning', rating: 4.9 },
                    'U1122334455': { role: 'manager', name: 'Sarah Wilson' },
                    'U5566778899': { role: 'proshop', name: 'Robert Chen' }
                };

                const userRole = roleMap[profile.userId] || { role: 'golfer', name: profile.displayName };

                AppState.currentUser = {
                    ...AppState.currentUser,
                    role: userRole.role,
                    name: userRole.name || profile.displayName,
                    lineId: profile.userId,
                    avatar: profile.pictureUrl,
                    handicap: userRole.handicap || null,
                    membershipLevel: userRole.role === 'golfer' ? 'premium' : 'staff',
                    joinDate: new Date().toISOString(),
                    stats: {
                        ...AppState.currentUser.stats,
                        rating: userRole.rating || 0
                    },
                    permissions: this.getPermissions(userRole.role)
                };

                AppState.session.isAuthenticated = true;
                AppState.session.authMethod = 'line';
                AppState.session.loginTime = new Date().toISOString();

                console.log('User profile set from LINE:', AppState.currentUser);
            }

            static redirectToDashboard() {
                const dashboardMap = {
                    'golfer': 'golferDashboard',
                    'caddie': 'caddieDashboard',
                    'manager': 'managerDashboard',
                    'proshop': 'proshopDashboard',
                    'society': 'societyDashboard',
                    'maintenance': 'maintenanceDashboard'
                };

                const targetDashboard = dashboardMap[AppState.currentUser.role] || 'golferDashboard';
                ScreenManager.showScreen(targetDashboard);
                NotificationManager.show(`Welcome back, ${AppState.currentUser.name}!`, 'success');

                // Load data from Cloudflare AFTER successful login (source of truth)
                if (typeof ProductionCloudSync !== 'undefined') {
                    console.log('[Login] Loading data from Cloudflare after login...');
                    SimpleCloudSync.loadFromCloud();
                    console.log('[Login] Initial production sync completed');
                }
            }

            static getPermissions(role) {
                const permissionMap = {
                    'golfer': ['book_tee_time', 'view_stats', 'order_food', 'book_caddy', 'emergency_alert'],
                    'caddie': ['view_assignments', 'update_location', 'submit_reports', 'emergency_alert'],
                    'manager': ['manage_staff', 'view_reports', 'manage_bookings', 'manage_inventory', 'emergency_broadcast'],
                    'proshop': ['manage_inventory', 'process_payments', 'view_sales', 'emergency_alert'],
                    'society': ['organize_events', 'manage_bookings', 'member_communication', 'view_reports', 'emergency_alert']
                };
                return permissionMap[role] || [];
            }

            static showLineLogin() {
                const lineContainer = document.getElementById('lineLoginContainer');
                const fallbackContainer = document.getElementById('fallbackLoginContainer');

                if (lineContainer) lineContainer.style.display = 'block';
                if (fallbackContainer) fallbackContainer.style.display = 'none';
            }

            static showFallbackLogin() {
                const lineContainer = document.getElementById('lineLoginContainer');
                const fallbackContainer = document.getElementById('fallbackLoginContainer');

                if (lineContainer) lineContainer.style.display = 'none';
                if (fallbackContainer) fallbackContainer.style.display = 'block';

                NotificationManager.show('LINE login unavailable. Using alternative authentication.', 'warning');
            }

            static logout() {
                try {
                    if (typeof liff !== 'undefined' && liff.isLoggedIn()) {
                        liff.logout();
                    }
                } catch (error) {
                    console.error('LINE logout error:', error);
                }

                // Reset application state
                AppState.currentUser = {
                    role: 'guest',
                    name: 'Guest User',
                    lineId: null,
                    avatar: null,
                    email: null,
                    phone: null,
                    handicap: null,
                    membershipLevel: 'basic',
                    joinDate: null,
                    stats: {
                        totalRounds: 0,
                        averageScore: 0,
                        bestScore: 0,
                        totalEarnings: 0,
                        rating: 0
                    },
                    permissions: [],
                    preferences: {
                            gpsTracking: true,
                        emergencyContacts: []
                    }
                };

                AppState.session.isAuthenticated = false;
                AppState.session.authMethod = null;
                AppState.session.loginTime = null;

                ScreenManager.showScreen('login');
                NotificationManager.show('Logged out successfully', 'info');
            }
        }

        // OTP Authentication System
        class OTPAuthentication {
            static currentPhoneNumber = null;
            static otpCode = null;

            static showOTPScreen() {
                ScreenManager.showScreen('otpScreen');
            }

            static async sendOTP() {
                const phoneInput = document.getElementById('phoneInput');
                const phone = phoneInput?.value;

                if (!phone || phone.length < 10) {
                    NotificationManager.show('Please enter a valid phone number', 'error');
                    return;
                }

                this.currentPhoneNumber = phone;
                LoadingManager.show('Sending OTP...');

                try {
                    // Simulate OTP sending with realistic delay
                    await new Promise(resolve => setTimeout(resolve, 2000));

                    // Generate random OTP for demo
                    this.otpCode = '123456'; // In production, this would be sent via SMS

                    NotificationManager.show(`OTP sent to ${phone}`, 'success');

                    // Show OTP input section
                    const otpSection = document.getElementById('otpInputSection');
                    if (otpSection) {
                        otpSection.classList.remove('hidden');

                        // Focus first OTP input
                        const firstInput = document.querySelector('.otp-input');
                        if (firstInput) {
                            firstInput.focus();
                        }
                    }

                    // Update button text
                    const sendBtn = document.getElementById('sendOTPBtn');
                    if (sendBtn) {
                        sendBtn.textContent = 'Resend OTP';
                    }

                } catch (error) {
                    console.error('OTP sending failed:', error);
                    NotificationManager.show('Failed to send OTP. Please try again.', 'error');
                } finally {
                    LoadingManager.hide();
                }
            }

            static async verifyOTP() {
                const otpInputs = document.querySelectorAll('.otp-input');
                const enteredOTP = Array.from(otpInputs).map(input => input.value).join('');

                if (enteredOTP.length !== 6) {
                    NotificationManager.show('Please enter complete OTP code', 'error');
                    return;
                }

                LoadingManager.show('Verifying OTP...');

                try {
                    // Simulate verification delay
                    await new Promise(resolve => setTimeout(resolve, 1500));

                    if (enteredOTP === this.otpCode) {
                        // Set user data for OTP authentication
                        AppState.currentUser = {
                            ...AppState.currentUser,
                            role: 'golfer', // Default to golfer for OTP users
                            name: 'Mobile User',
                            phone: this.currentPhoneNumber,
                            membershipLevel: 'basic',
                            joinDate: new Date().toISOString(),
                            permissions: LineAuthentication.getPermissions('golfer')
                        };

                        AppState.session.isAuthenticated = true;
                        AppState.session.authMethod = 'otp';
                        AppState.session.loginTime = new Date().toISOString();

                        NotificationManager.show('Phone verified successfully!', 'success');
                        ScreenManager.showScreen('golferDashboard');

                    } else {
                        NotificationManager.show('Invalid OTP code. Please try again.', 'error');

                        // Clear OTP inputs
                        otpInputs.forEach(input => input.value = '');
                        otpInputs[0]?.focus();
                    }

                } catch (error) {
                    console.error('OTP verification failed:', error);
                    NotificationManager.show('Verification failed. Please try again.', 'error');
                } finally {
                    LoadingManager.hide();
                }
            }

            static setupOTPInputHandlers() {
                const otpInputs = document.querySelectorAll('.otp-input');

                otpInputs.forEach((input, index) => {
                    // Auto-advance to next input
                    input.addEventListener('input', function() {
                        if (this.value.length === 1 && index < otpInputs.length - 1) {
                            otpInputs[index + 1].focus();
                        }

                        // Auto-verify when all inputs are filled
                        const allFilled = Array.from(otpInputs).every(inp => inp.value.length === 1);
                        if (allFilled) {
                            setTimeout(() => OTPAuthentication.verifyOTP(), 500);
                        }
                    });

                    // Handle backspace
                    input.addEventListener('keydown', function(e) {
                        if (e.key === 'Backspace' && this.value === '' && index > 0) {
                            otpInputs[index - 1].focus();
                        }
                    });

                    // Only allow numbers
                    input.addEventListener('input', function() {
                        this.value = this.value.replace(/[^0-9]/g, '');
                    });
                });
            }
        }

        // Fallback Authentication System
        class FallbackAuthentication {
            static login(role) {
                LoadingManager.show('Authenticating...');

                setTimeout(() => {
                    const userProfiles = {
                        'golfer': {
                            name: 'John Mitchell',
                            handicap: 18,
                            stats: { totalRounds: 0, averageScore: 0, bestScore: 0 }
                        },
                        'caddie': {
                            name: 'Ning',
                            stats: { totalRounds: 0, rating: 0, totalEarnings: 0 }
                        },
                        'manager': {
                            name: 'Sarah Wilson',
                            stats: { totalReports: 0, staffManaged: 0, revenue: 0 }
                        },
                        'proshop': {
                            name: 'Robert Chen',
                            stats: { totalSales: 0, itemsSold: 0, revenue: 0 }
                        },
                        'society': {
                            name: 'Bangkok Golf Society',
                            organizer: 'Alex Thompson',
                            members: 0,
                            stats: { eventsOrganized: 0, totalMembers: 0 }
                        },
                        'maintenance': {
                            name: 'Tom Rodriguez',
                            role: 'Head Groundskeeper',
                            team: 'Course Maintenance',
                            shift: 'Morning Crew',
                            stats: { tasksCompleted: 0, reportsSubmitted: 0 }
                        }
                    };

                    const profile = userProfiles[role];

                    AppState.currentUser = {
                        ...AppState.currentUser,
                        role: role,
                        name: profile.name,
                        handicap: profile.handicap || null,
                        membershipLevel: role === 'golfer' ? 'premium' : 'staff',
                        joinDate: new Date().toISOString(),
                        stats: {
                            ...AppState.currentUser.stats,
                            ...profile.stats
                        },
                        permissions: LineAuthentication.getPermissions(role)
                    };

                    AppState.session.isAuthenticated = true;
                    AppState.session.authMethod = 'fallback';
                    AppState.session.loginTime = new Date().toISOString();

                    LoadingManager.hide();

                    // Load actual user profile data and update UI
                    setTimeout(() => {
                        const actualProfile = ProfileSystem.getCurrentProfile(role);
                        if (actualProfile && actualProfile.personalInfo && actualProfile.personalInfo.firstName) {
                            // Use actual profile name if available
                            const actualName = `${actualProfile.personalInfo.firstName} ${actualProfile.personalInfo.lastName}`.trim();
                            if (actualName.length > 1) {
                                AppState.currentUser.name = actualName;
                            }
                        }

                        // Update UI with profile data
                        ProfileSystem.updateUIWithProfile();
                        UserInterface.updateUserDisplays();
                    }, 100);

                    // Initialize ChatSystem for the logged-in user
                    ChatSystem.initialize();

                    LineAuthentication.redirectToDashboard();

                }, 1500);
            }
        }

        // Notification Management System (Disabled - Notifications removed per user request)
        class NotificationManager {
            static show(message, type = 'info', duration = null) {
                // Notifications disabled - logging to console instead
                console.log(`[${type.toUpperCase()}] ${message}`);
            }
        }

        // Loading Management System
        class LoadingManager {
            static show(message = 'Loading...') {
                let overlay = document.getElementById('loadingOverlay');

                if (!overlay) {
                    overlay = document.createElement('div');
                    overlay.id = 'loadingOverlay';
                    overlay.className = 'loading-overlay';
                    document.body.appendChild(overlay);
                }

                overlay.innerHTML = `
                    <div class="glass-card p-8 text-center max-w-sm">
                        <div class="spinner mx-auto mb-4"></div>
                        <p class="text-gray-700 font-semibold">${message}</p>
                    </div>
                `;

                overlay.style.display = 'flex';
            }

            static hide() {
                const overlay = document.getElementById('loadingOverlay');
                if (overlay) {
                    overlay.style.display = 'none';
                }
            }
        }

        // User Interface Management
        class UserInterface {
            static updateUserDisplays() {
                // Update user name displays
                const nameElements = document.querySelectorAll('.user-name-display');
                nameElements.forEach(element => {
                    element.textContent = AppState.currentUser.name;
                });

                // Update user avatars
                const avatarElements = document.querySelectorAll('.user-avatar');
                avatarElements.forEach(element => {
                    if (AppState.currentUser.avatar) {
                        element.src = AppState.currentUser.avatar;
                        element.style.display = 'block';
                    } else {
                        element.style.display = 'none';
                    }
                });

                // Update role-specific displays
                this.updateRoleSpecificDisplays();
            }

            static updateRoleSpecificDisplays() {
                const role = AppState.currentUser.role;

                // Update handicap displays for golfers
                if (role === 'golfer' && AppState.currentUser.handicap) {
                    const handicapElements = document.querySelectorAll('.user-handicap');
                    handicapElements.forEach(element => {
                        element.textContent = AppState.currentUser.handicap;
                    });
                }

                // Update rating displays for caddies
                if (role === 'caddie' && AppState.currentUser.stats.rating) {
                    const ratingElements = document.querySelectorAll('.user-rating');
                    ratingElements.forEach(element => {
                        element.textContent = AppState.currentUser.stats.rating;
                    });
                }
            }
        }

        // Enhanced Emergency & Safety System
        class EmergencySystem {
            static emergencyTypes = {
                medical: {
                    name: 'Medical Emergency',
                    icon: 'üöë',
                    color: 'red',
                    priority: 'critical',
                    responseTime: '2-5 minutes',
                    contacts: ['Pro Shop', 'Caddy Master', 'All Management'],
                    targetRoles: ['proshop', 'manager', 'caddie']
                },
                lightning_warning: {
                    name: 'Lightning Warning',
                    icon: '‚ö°',
                    color: 'yellow',
                    priority: 'critical',
                    responseTime: 'Immediate',
                    contacts: ['All Golfers', 'All Caddies', 'All Staff Members'],
                    targetRoles: ['golfer', 'caddie', 'manager', 'proshop', 'maintenance'],
                    authorizedRoles: ['manager', 'proshop'],
                    description: 'Lightning detected - seek shelter immediately'
                },
                stop_play: {
                    name: 'STOP PLAY - Lightning Alert',
                    icon: 'üõë',
                    color: 'red',
                    priority: 'critical',
                    responseTime: 'Immediate',
                    contacts: ['All Golfers', 'All Caddies', 'All Staff Members'],
                    targetRoles: ['golfer', 'caddie', 'manager', 'proshop', 'maintenance'],
                    authorizedRoles: ['manager', 'proshop'],
                    description: 'IMMEDIATE STOP PLAY - Lightning present, evacuate to clubhouse'
                },
                resume_play: {
                    name: 'Resume Play',
                    icon: '‚úÖ',
                    color: 'green',
                    priority: 'high',
                    responseTime: 'Immediate',
                    contacts: ['All Golfers', 'All Caddies', 'All Staff Members'],
                    targetRoles: ['golfer', 'caddie', 'manager', 'proshop', 'maintenance'],
                    authorizedRoles: ['manager', 'proshop'],
                    description: 'All clear - play may resume safely'
                },
                weather: {
                    name: 'Severe Weather',
                    icon: '‚õàÔ∏è',
                    color: 'orange',
                    priority: 'high',
                    responseTime: '1-2 minutes',
                    contacts: ['Pro Shop', 'Caddy Master', 'General Manager', 'All Management'],
                    targetRoles: ['proshop', 'manager', 'caddie']
                },
                security: {
                    name: 'Security Issue',
                    icon: 'üõ°Ô∏è',
                    color: 'yellow',
                    priority: 'high',
                    responseTime: '3-5 minutes',
                    contacts: ['Pro Shop', 'Caddy Master', 'General Manager', 'All Management'],
                    targetRoles: ['proshop', 'manager', 'caddie']
                },
                equipment: {
                    name: 'Equipment/Cart Issue',
                    icon: 'üöó',
                    color: 'blue',
                    priority: 'medium',
                    responseTime: '5-10 minutes',
                    contacts: ['Cart and Mechanic Staff', 'Pro Shop', 'Caddy Master'],
                    targetRoles: ['proshop', 'caddie', 'maintenance']
                },
                lost: {
                    name: 'Lost/Assistance',
                    icon: 'üìç',
                    color: 'green',
                    priority: 'low',
                    responseTime: '5-10 minutes',
                    contacts: ['Caddy Master', 'Pro Shop'],
                    targetRoles: ['caddie', 'proshop']
                }
            };

            static activeAlerts = [];
            static emergencyContacts = {
                medical: { name: 'Emergency Medical', phone: '1669', location: 'On-site Medical Center' },
                manager: { name: 'Course Manager', phone: '+66-2-555-0001', location: 'Clubhouse Office' },
                security: { name: 'Security', phone: '+66-2-555-0002', location: 'Main Gate' },
                marshal: { name: 'Course Marshal', phone: '+66-2-555-0003', location: 'Mobile Unit' },
                proshop: { name: 'Pro Shop', phone: '+66-2-555-0004', location: 'Pro Shop Counter' },
                maintenance: { name: 'Maintenance', phone: '+66-2-555-0005', location: 'Equipment Shed' }
            };

            static safetyZones = [
                { name: 'Main Clubhouse', lat: 13.7560, lng: 100.5015, capacity: 200, facilities: ['Medical', 'Shelter', 'Food'] },
                { name: 'Halfway House', lat: 13.7625, lng: 100.5095, capacity: 50, facilities: ['Shelter', 'Refreshments'] },
                { name: 'Practice Facility', lat: 13.7555, lng: 100.5010, capacity: 30, facilities: ['Shelter'] },
                { name: 'Maintenance Building', lat: 13.7700, lng: 100.5180, capacity: 20, facilities: ['Shelter', 'Tools'] }
            ];

            static sendAlert(alertType = null) {
                if (alertType) {
                    this.sendSpecificAlert(alertType);
                } else {
                    this.showEmergencyModal();
                }
            }

            static showEmergencyModal() {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                modal.innerHTML = `
                    <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] flex flex-col">
                        <div class="text-center p-6 pb-4 flex-shrink-0">
                            <div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="material-symbols-outlined text-4xl text-red-600">emergency</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900" data-i18n="emergency.alert">Emergency Alert</h3>
                            <p class="text-gray-600 mt-2" data-i18n="emergency.select.type">Select the type of assistance you need</p>
                        </div>

                        <div class="flex-1 overflow-y-auto px-6 pb-4">
                            <div class="space-y-3">
                            ${Object.entries(this.emergencyTypes).map(([key, type]) => {
                                // Check if user is authorized to send this type of alert
                                const userRole = AppState.currentUser.role;
                                const isAuthorized = !type.authorizedRoles || type.authorizedRoles.includes(userRole);

                                if (!isAuthorized) return ''; // Don't show unauthorized alerts

                                return `
                                <div class="emergency-type p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-${type.color}-500 transition-colors"
                                     onclick="EmergencySystem.sendSpecificAlert('${key}')">
                                    <div class="flex items-center">
                                        <span class="text-2xl mr-3">${type.icon}</span>
                                        <div class="flex-1">
                                            <h5 class="font-bold text-gray-900">${type.name}</h5>
                                            <p class="text-sm text-gray-600">Response: ${type.responseTime}</p>
                                            ${type.description ? `<p class="text-xs text-gray-500 mt-1">${type.description}</p>` : ''}
                                        </div>
                                        <span class="priority-badge bg-${type.color}-100 text-${type.color}-800 px-2 py-1 rounded-full text-xs font-medium">
                                            ${type.priority}
                                        </span>
                                    </div>
                                </div>
                                `;
                            }).filter(Boolean).join('')}
                            </div>
                        </div>

                        <div class="flex space-x-3 p-6 pt-4 border-t border-gray-200 flex-shrink-0">
                            <button onclick="EmergencySystem.closeEmergencyModal()" class="btn-secondary flex-1" data-i18n="common.cancel">Cancel</button>
                            <button onclick="EmergencySystem.showSafetyInfo()" class="btn-primary flex-1" data-i18n="emergency.safety.info">Safety Info</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                window.currentEmergencyModal = modal;
            }

            static sendSpecificAlert(alertType) {
                const type = this.emergencyTypes[alertType];
                if (!type) return;

                this.closeEmergencyModal();

                // IMMEDIATE PROCESSING - NO DELAYS FOR EMERGENCIES
                const alertId = 'EMG' + Date.now().toString().slice(-6);
                const currentLocation = GPSNavigationSystem?.currentPosition;

                const alertData = {
                    id: alertId,
                    type: alertType,
                    message: `${type.name} at ${new Date().toLocaleTimeString()}`,
                    user: AppState.currentUser.name,
                    role: AppState.currentUser.role,
                    timestamp: new Date().toISOString(),
                    location: currentLocation ? {
                        lat: currentLocation.lat,
                        lng: currentLocation.lng,
                        hole: GPSNavigationSystem.currentHole
                    } : null,
                    status: 'active',
                    priority: type.priority
                };

                this.activeAlerts.push(alertData);
                console.log('[Emergency] IMMEDIATE alert created:', alertData);

                // 1. IMMEDIATE full-screen overlay with siren
                this.createFullScreenEmergencyOverlay(alertData);
                this.playEmergencySiren();

                // 2. IMMEDIATE save to localStorage
                localStorage.setItem('emergency_alerts', JSON.stringify(this.activeAlerts));

                // 3. IMMEDIATE sync to cloud - NO DELAYS
                if (typeof SimpleCloudSync !== 'undefined') {
                    SimpleCloudSync.saveToCloud()
                        .then(() => console.log('[Emergency] IMMEDIATE cloud sync completed'))
                        .catch(err => {
                            console.warn('[Emergency] Sync failed, immediate retry:', err);
                            SimpleCloudSync.saveToCloud(); // Immediate retry
                        });
                }

                // 4. Update all systems immediately
                PersistentEmergencyAlerts.updateAllOverviewAlerts();
                window.dispatchEvent(new CustomEvent('emergency-alert-sent', { detail: alertData }));

                // 5. Success notification
                NotificationManager.show(`${type.icon} ${type.name} EMERGENCY ALERT SENT!`, 'success');

                // 6. Show instructions after a brief delay
                setTimeout(() => this.showEmergencyInstructions(alertType, alertId), 1000);
            }

            static showEmergencyInstructions(alertType, alertId) {
                const type = this.emergencyTypes[alertType];
                const instructions = this.getEmergencyInstructions(alertType);

                setTimeout(() => {
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                    modal.innerHTML = `
                        <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4">
                            <div class="text-center mb-6">
                                <span class="text-4xl">${type.icon}</span>
                                <h3 class="text-xl font-bold text-gray-900 mt-2">Alert Sent Successfully</h3>
                                <p class="text-sm text-gray-600">ID: ${alertId}</p>
                            </div>

                            <div class="bg-blue-50 p-4 rounded-lg mb-4">
                                <h4 class="font-bold text-blue-900 mb-2">What to do now:</h4>
                                <ul class="text-sm text-blue-800 space-y-1">
                                    ${instructions.map(instruction => `<li>‚Ä¢ ${instruction}</li>`).join('')}
                                </ul>
                            </div>

                            <div class="text-center space-y-2">
                                <button onclick="EmergencySystem.showNearestSafetyZone()" class="btn-primary w-full">
                                    üìç Find Nearest Shelter
                                </button>
                                <button onclick="EmergencySystem.closeInstructionModal()" class="btn-secondary w-full">
                                    Understood
                                </button>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(modal);
                    window.currentInstructionModal = modal;
                }, 1000);
            }

            static getEmergencyInstructions(alertType) {
                const instructions = {
                    medical: ['Stay with the injured person if safe to do so', 'Do not move them unless in immediate danger', 'Medical team is en route to your location', 'Be prepared to provide basic information'],
                    weather: ['Move to the nearest shelter immediately', 'Stay away from trees, water, and high ground', 'Wait for weather all-clear announcement', 'Course play is temporarily suspended'],
                    security: ['Move to a safe location if possible', 'Do not confront any security threat', 'Security personnel are responding', 'Stay alert and follow staff instructions'],
                    equipment: ['Park cart safely away from play areas', 'Use hazard markers if available', 'Maintenance team will assist shortly', 'Consider walking to nearest facility'],
                    lost: ['Stay in your current location', 'Use course markers to identify your position', 'Course marshal is en route to assist', 'Check the GPS tab for navigation help']
                };
                return instructions[alertType] || ['Help is on the way', 'Stay safe and follow instructions'];
            }

            // AGGRESSIVE EMERGENCY OVERLAY SYSTEM
            static createFullScreenEmergencyOverlay(alert) {
                // Remove any existing overlays
                document.querySelectorAll('.emergency-fullscreen-overlay').forEach(el => el.remove());

                // Create full-screen emergency overlay
                const overlay = document.createElement('div');
                overlay.className = 'emergency-fullscreen-overlay';
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: rgba(220, 38, 38, 0.95);
                    color: white;
                    z-index: 99999;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    text-align: center;
                    font-family: Arial, sans-serif;
                    animation: emergency-pulse 1s ease-in-out infinite;
                `;

                overlay.innerHTML = `
                    <div style="max-width: 80%; padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">üö®</div>
                        <h1 style="font-size: 36px; margin: 20px 0; font-weight: bold;">EMERGENCY ALERT</h1>
                        <p style="font-size: 24px; margin: 20px 0; line-height: 1.4;">${alert.message}</p>
                        <p style="font-size: 18px; margin: 20px 0; opacity: 0.9;">Time: ${new Date(alert.timestamp).toLocaleTimeString()}</p>
                        <button onclick="this.closest('.emergency-fullscreen-overlay').remove()"
                                style="font-size: 18px; padding: 15px 30px; background: white; color: #dc2626; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 20px;">
                            ACKNOWLEDGE & DISMISS
                        </button>
                    </div>
                `;

                // Add CSS animation if not exists
                if (!document.querySelector('#emergency-animation-styles')) {
                    const styleSheet = document.createElement('style');
                    styleSheet.id = 'emergency-animation-styles';
                    styleSheet.textContent = `
                        @keyframes emergency-pulse {
                            0% { background: rgba(220, 38, 38, 0.95); }
                            50% { background: rgba(220, 38, 38, 1); }
                            100% { background: rgba(220, 38, 38, 0.95); }
                        }
                    `;
                    document.head.appendChild(styleSheet);
                }

                // Add overlay to body
                document.body.appendChild(overlay);

                // Also play alert sound if available
                try {
                    if (typeof AlertSoundManager !== 'undefined') {
                        AlertSoundManager.playAlert('emergency');
                    }
                } catch (e) {
                    console.log('Alert sound not available');
                }

                console.log('Full-screen emergency overlay created for alert:', alert);
                return overlay;
            },

            // EMERGENCY SIREN SYSTEM
            static playEmergencySiren() {
                try {
                    // Create audio context if needed
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    if (!AudioContext) {
                        console.log('Web Audio API not supported - using alert sound fallback');
                        this.playFallbackAlert();
                        return;
                    }

                    const audioContext = new AudioContext();

                    // Create emergency siren sound (alternating high-low tones)
                    const oscillator1 = audioContext.createOscillator();
                    const oscillator2 = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    // Connect oscillators to gain and output
                    oscillator1.connect(gainNode);
                    oscillator2.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    // Configure emergency siren frequencies
                    oscillator1.frequency.setValueAtTime(800, audioContext.currentTime);
                    oscillator2.frequency.setValueAtTime(1000, audioContext.currentTime);

                    // Create volume envelope for dramatic effect
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.1);

                    // Alternating siren pattern
                    for (let i = 0; i < 6; i++) {
                        const time = audioContext.currentTime + i * 0.5;
                        oscillator1.frequency.setValueAtTime(800 + (i % 2) * 400, time);
                        oscillator2.frequency.setValueAtTime(1000 + (i % 2) * 200, time);
                    }

                    // Start and stop oscillators
                    oscillator1.start(audioContext.currentTime);
                    oscillator2.start(audioContext.currentTime);
                    oscillator1.stop(audioContext.currentTime + 3);
                    oscillator2.stop(audioContext.currentTime + 3);

                    console.log('Emergency siren played');

                } catch (error) {
                    console.log('Emergency siren failed, using fallback:', error);
                    this.playFallbackAlert();
                }
            },

            static playFallbackAlert() {
                // Simple beep fallback
                try {
                    const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBzaH1u/PgC0GJXrG7+OZRA0PVqzn6KhVFAhEnufzvyoiCjaG1e7Ufz8OJnzG7+GVQ'" );
                    audio.play();
                } catch (e) {
                    console.log('Fallback alert sound failed');
                }
            }

            static showSafetyInfo() {
                this.closeEmergencyModal();
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-2xl p-6 max-w-lg w-full mx-4 max-h-96 overflow-y-auto">
                        <h3 class="text-xl font-bold text-gray-900 mb-4" data-i18n="emergency.course.safety">üõ°Ô∏è Course Safety Information</h3>

                        <div class="space-y-4">
                            <div class="bg-red-50 p-4 rounded-lg">
                                <h4 class="font-bold text-red-900 mb-2">Emergency Contacts</h4>
                                ${Object.entries(this.emergencyContacts).map(([key, contact]) => `
                                    <div class="flex justify-between text-sm mb-1">
                                        <span class="font-medium">${contact.name}</span>
                                        <span class="text-red-700">${contact.phone}</span>
                                    </div>
                                `).join('')}
                            </div>

                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="font-bold text-blue-900 mb-2">Safety Zones</h4>
                                ${this.safetyZones.map(zone => `
                                    <div class="text-sm mb-2">
                                        <div class="font-medium">${zone.name}</div>
                                        <div class="text-blue-700">Capacity: ${zone.capacity} | ${zone.facilities.join(', ')}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <button onclick="EmergencySystem.closeSafetyModal()" class="btn-primary w-full mt-4">
                            Close
                        </button>
                    </div>
                `;
                document.body.appendChild(modal);
                window.currentSafetyModal = modal;
            }

            static showNearestSafetyZone() {
                const currentPos = GPSNavigationSystem?.currentPosition;
                if (!currentPos) {
                    NotificationManager.show('üìç Enable GPS to find nearest shelter', 'info');
                    return;
                }

                let nearestZone = this.safetyZones[0];
                let minDistance = Infinity;

                this.safetyZones.forEach(zone => {
                    const distance = calculateDistance(currentPos.lat, currentPos.lng, zone.lat, zone.lng);
                    if (distance < minDistance) {
                        minDistance = distance;
                        nearestZone = zone;
                    }
                });

                this.closeInstructionModal();
                NotificationManager.show(
                    `üèÉ‚Äç‚ôÇÔ∏è Nearest shelter: ${nearestZone.name} (${Math.round(minDistance)} yards away)`,
                    'info'
                );
            }

            static closeEmergencyModal() {
                if (window.currentEmergencyModal) {
                    document.body.removeChild(window.currentEmergencyModal);
                    window.currentEmergencyModal = null;
                }
            }

            static closeInstructionModal() {
                if (window.currentInstructionModal) {
                    document.body.removeChild(window.currentInstructionModal);
                    window.currentInstructionModal = null;
                }
            }

            static closeSafetyModal() {
                if (window.currentSafetyModal) {
                    document.body.removeChild(window.currentSafetyModal);
                    window.currentSafetyModal = null;
                }
            }
        }

        // Persistent Emergency Alert Management System
        class PersistentEmergencyAlerts {
            static updateAllOverviewAlerts() {
                const activeAlerts = EmergencySystem.activeAlerts;

                // Update each role's overview alert display
                this.updateRoleAlerts('golfer', activeAlerts);
                this.updateRoleAlerts('caddie', activeAlerts);
                this.updateRoleAlerts('manager', activeAlerts);
                this.updateRoleAlerts('maintenance', activeAlerts);
            }

            static updateRoleAlerts(role, alerts) {
                const alertContainer = document.getElementById(`${role}-emergency-alerts`);
                const alertList = document.getElementById(`${role}-alert-list`);
                const alertCount = document.getElementById(`${role}-alert-count`);

                if (!alertContainer || !alertList || !alertCount) return;

                // Filter alerts based on target roles - only show alerts meant for this role
                const relevantAlerts = alerts.filter(alert => {
                    const alertType = EmergencySystem.emergencyTypes[alert.type];
                    return alertType && alertType.targetRoles && alertType.targetRoles.includes(role);
                });

                if (relevantAlerts.length === 0) {
                    alertContainer.style.display = 'none';
                    return;
                }

                alertContainer.style.display = 'block';
                alertCount.textContent = relevantAlerts.length;

                alertList.innerHTML = relevantAlerts.map(alert => this.createAlertHTML(alert, role)).join('');
            }

            static createAlertHTML(alert, role) {
                const alertType = EmergencySystem.emergencyTypes[alert.type];
                const timeAgo = this.getTimeAgo(alert.timestamp);

                // Special handling for lightning/safety alerts
                const isLightningSafety = ['lightning_warning', 'stop_play', 'resume_play'].includes(alert.type);
                const alertClass = isLightningSafety ? 'lightning-safety-alert' : 'alert-item';
                const bgColor = isLightningSafety ? 'bg-yellow-50' : 'bg-white';
                const borderColor = isLightningSafety ? 'border-yellow-400 border-2' : 'border-red-300';
                const animation = isLightningSafety ? 'animate-pulse' : '';

                return `
                    <div class="${alertClass} ${bgColor} border ${borderColor} rounded-lg p-3 mb-2 ${animation}">
                        <div class="flex items-start justify-between">
                            <div class="flex items-start space-x-3 flex-1">
                                <span class="text-xl ${isLightningSafety ? 'animate-bounce' : ''}">${alertType.icon}</span>
                                <div class="flex-1">
                                    <div class="flex items-center space-x-2 mb-1">
                                        <h4 class="font-bold ${isLightningSafety ? 'text-yellow-900' : 'text-red-800'}">${alertType.name}</h4>
                                        <span class="priority-badge bg-${alertType.color}-100 text-${alertType.color}-800 px-2 py-1 rounded text-xs font-medium">
                                            ${alertType.priority}
                                        </span>
                                    </div>
                                    ${alertType.description ? `
                                        <p class="text-sm font-medium ${isLightningSafety ? 'text-yellow-800' : 'text-red-700'} mb-1">${alertType.description}</p>
                                    ` : ''}
                                    <p class="text-sm ${isLightningSafety ? 'text-yellow-700' : 'text-red-700'} mb-1">Alert ID: ${alert.id}</p>
                                    <p class="text-sm ${isLightningSafety ? 'text-yellow-600' : 'text-red-600'}">From: ${alert.user} (${alert.role})</p>
                                    <p class="text-xs ${isLightningSafety ? 'text-yellow-500' : 'text-red-500'} mt-1">${timeAgo}</p>
                                    ${alert.location ? `
                                        <p class="text-xs ${isLightningSafety ? 'text-yellow-500' : 'text-red-500'}">Location: Hole ${alert.location.hole || 'Unknown'}</p>
                                    ` : ''}
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                ${!isLightningSafety ? `
                                    <button onclick="PersistentEmergencyAlerts.acknowledgeAlert('${alert.id}')"
                                            class="text-xs bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600 transition-colors">
                                        Acknowledge
                                    </button>
                                ` : ''}
                                <button onclick="PersistentEmergencyAlerts.resolveAlert('${alert.id}')"
                                        class="text-xs ${isLightningSafety ? 'bg-blue-500 hover:bg-blue-600' : 'bg-green-500 hover:bg-green-600'} text-white px-2 py-1 rounded transition-colors">
                                    ${isLightningSafety ? 'Clear' : 'Resolve'}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            static getTimeAgo(timestamp) {
                const now = new Date();
                const alertTime = new Date(timestamp);
                const diffMs = now - alertTime;
                const diffMins = Math.floor(diffMs / 60000);

                if (diffMins < 1) return 'Just now';
                if (diffMins < 60) return `${diffMins} minutes ago`;

                const diffHours = Math.floor(diffMins / 60);
                if (diffHours < 24) return `${diffHours} hours ago`;

                const diffDays = Math.floor(diffHours / 24);
                return `${diffDays} days ago`;
            }

            static acknowledgeAlert(alertId) {
                const alert = EmergencySystem.activeAlerts.find(a => a.id === alertId);
                if (alert) {
                    alert.acknowledged = true;
                    alert.acknowledgedBy = AppState.currentUser.name;
                    alert.acknowledgedAt = new Date().toISOString();

                    NotificationManager.show(`Alert ${alertId} acknowledged`, 'success');
                    this.updateAllOverviewAlerts();
                }
            }

            static resolveAlert(alertId) {
                const alertIndex = EmergencySystem.activeAlerts.findIndex(a => a.id === alertId);
                if (alertIndex > -1) {
                    const alert = EmergencySystem.activeAlerts[alertIndex];

                    // Move to resolved alerts
                    alert.status = 'resolved';
                    alert.resolvedBy = AppState.currentUser.name;
                    alert.resolvedAt = new Date().toISOString();

                    // Remove from active alerts
                    EmergencySystem.activeAlerts.splice(alertIndex, 1);

                    // Update local storage
                    localStorage.setItem('emergency_alerts', JSON.stringify(EmergencySystem.activeAlerts));

                    // Sync resolution globally so all devices see it
                    if (typeof ProductionCloudSync !== 'undefined') {
                        SimpleCloudSync.saveToCloudSoon();
                        console.log('[Emergency] Alert resolved globally:', alertId);
                    }

                    NotificationManager.show(`Alert ${alertId} resolved and removed`, 'success');
                    this.updateAllOverviewAlerts();
                }
            }
        }

        // Lightning Safety Alert System
        class LightningSafetySystem {
            static async playLightningAlert(alertType) {
                try {
                    // Request audio permissions and override silent mode
                    await this.requestAudioPermissions();

                    // Create audio context for alert sounds with silent mode override
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

                    // Resume audio context if suspended (for silent mode override)
                    if (audioContext.state === 'suspended') {
                        await audioContext.resume();
                    }

                    // Trigger vibration for physical alert
                    this.triggerVibrationAlert(alertType);

                    // Play the appropriate sound with maximum volume
                    if (alertType === 'lightning_warning') {
                        this.playWarningSound(audioContext);
                    } else if (alertType === 'stop_play') {
                        this.playStopPlaySound(audioContext);
                    } else if (alertType === 'resume_play') {
                        this.playResumeSound(audioContext);
                    }

                    // Show visual alert overlay for maximum attention
                    this.showEmergencyOverlay(alertType);

                } catch (error) {
                    console.warn('Emergency alert system error:', error);
                    // Fallback to visual alerts only
                    this.showEmergencyOverlay(alertType);
                }
            }

            static async requestAudioPermissions() {
                try {
                    // Request microphone permission to enable audio override capabilities
                    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                        const stream = await navigator.mediaDevices.getUserMedia({
                            audio: true,
                            video: false
                        });
                        // Immediately stop the stream, we just needed permission
                        stream.getTracks().forEach(track => track.stop());
                    }
                } catch (error) {
                    console.warn('Audio permission not granted:', error);
                }
            }

            static triggerVibrationAlert(alertType) {
                if ('vibrate' in navigator) {
                    // Different vibration patterns for different alert types
                    let pattern;

                    switch (alertType) {
                        case 'lightning_warning':
                            // Short warning pattern: 3 quick vibrations
                            pattern = [200, 100, 200, 100, 200];
                            break;
                        case 'stop_play':
                            // Urgent stop pattern: Long continuous vibrations
                            pattern = [1000, 500, 1000, 500, 1000, 500, 1000];
                            break;
                        case 'resume_play':
                            // Pleasant pattern: 2 gentle vibrations
                            pattern = [300, 200, 300];
                            break;
                        default:
                            pattern = [500];
                    }

                    navigator.vibrate(pattern);
                }
            }

            static showEmergencyOverlay(alertType) {
                const alertType_data = EmergencySystem.emergencyTypes[alertType];
                if (!alertType_data) return;

                // Keep screen awake during emergency
                this.requestWakeLock();

                // Create full-screen emergency overlay
                const overlay = document.createElement('div');
                overlay.className = 'fixed inset-0 z-[9999] flex items-center justify-center';
                overlay.style.cssText = `
                    background: rgba(0, 0, 0, 0.95);
                    animation: emergency-flash 1s infinite;
                `;

                overlay.innerHTML = `
                    <div class="text-center text-white p-8 max-w-md mx-auto">
                        <div class="text-8xl mb-4 animate-bounce">${alertType_data.icon}</div>
                        <h1 class="text-4xl font-bold mb-4 animate-pulse">${alertType_data.name}</h1>
                        <p class="text-2xl mb-8">${alertType_data.description}</p>
                        <button onclick="LightningSafetySystem.acknowledgeEmergency(this)"
                                class="bg-white text-black px-8 py-4 rounded-lg text-xl font-bold hover:bg-gray-200 shadow-lg">
                            ACKNOWLEDGE
                        </button>
                        <p class="text-sm mt-4 opacity-75">Auto-dismiss in <span id="countdown-${alertType}">${alertType === 'stop_play' ? '10' : '5'}</span> seconds</p>
                    </div>
                `;

                document.body.appendChild(overlay);

                // Start countdown
                this.startCountdown(alertType, overlay);

                // Auto-remove after 10 seconds for stop_play, 5 seconds for others
                const autoRemoveTime = alertType === 'stop_play' ? 10000 : 5000;
                setTimeout(() => {
                    if (overlay.parentNode) {
                        overlay.remove();
                        this.releaseWakeLock();
                    }
                }, autoRemoveTime);
            }

            static acknowledgeEmergency(button) {
                // Remove the overlay
                const overlay = button.closest('.fixed');
                if (overlay) {
                    overlay.remove();
                }
                this.releaseWakeLock();
            }

            static startCountdown(alertType, overlay) {
                const initialTime = alertType === 'stop_play' ? 10 : 5;
                let timeLeft = initialTime;

                const countdownElement = overlay.querySelector(`#countdown-${alertType}`);
                if (!countdownElement) return;

                const countdown = setInterval(() => {
                    timeLeft--;
                    countdownElement.textContent = timeLeft;

                    if (timeLeft <= 0) {
                        clearInterval(countdown);
                    }
                }, 1000);
            }

            static async requestWakeLock() {
                try {
                    if ('wakeLock' in navigator) {
                        this.wakeLock = await navigator.wakeLock.request('screen');
                        console.log('Wake lock active during emergency');
                    }
                } catch (error) {
                    console.warn('Wake lock not available:', error);
                }
            }

            static releaseWakeLock() {
                try {
                    if (this.wakeLock) {
                        this.wakeLock.release();
                        this.wakeLock = null;
                        console.log('Wake lock released');
                    }
                } catch (error) {
                    console.warn('Wake lock release error:', error);
                }
            }

            static playWarningSound(audioContext) {
                // Play warning beep pattern: 3 short beeps
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        this.playBeep(audioContext, 800, 0.3); // 800Hz, 0.3 seconds
                    }, i * 500);
                }
            }

            static playStopPlaySound(audioContext) {
                // Play urgent alarm: continuous siren-like sound
                this.playSiren(audioContext, 5); // 5 seconds of siren
            }

            static playResumeSound(audioContext) {
                // Play pleasant ascending tone
                this.playBeep(audioContext, 440, 0.5); // A note
                setTimeout(() => this.playBeep(audioContext, 554, 0.5), 250); // C# note
                setTimeout(() => this.playBeep(audioContext, 659, 0.8), 500); // E note (longer)
            }

            static playBeep(audioContext, frequency, duration) {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = frequency;
                oscillator.type = 'sine';

                // Use maximum volume for emergency alerts (1.0 instead of 0.3)
                gainNode.gain.setValueAtTime(1.0, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            }

            static playSiren(audioContext, duration) {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.5);
                oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 1);

                // Repeat the pattern
                for (let i = 1; i < duration; i++) {
                    oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + i + 0.5);
                    oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + i + 1);
                }

                // Use maximum volume for emergency siren (1.0 instead of 0.4)
                gainNode.gain.setValueAtTime(1.0, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            }
        }

        // Emergency Alert Debugging System
        class EmergencyDebugger {
            static debugAlertDelivery() {
                console.log('=== EMERGENCY ALERT DEBUG ===');
                console.log('Current User:', AppState.currentUser);
                console.log('Active Alerts:', EmergencySystem.activeAlerts);
                console.log('Current Screen:', document.querySelector('.screen.active')?.id);
                console.log('Emergency Alert Containers:');

                ['golfer', 'caddie', 'manager', 'proshop', 'maintenance'].forEach(role => {
                    const container = document.getElementById(`${role}-emergency-alerts`);
                    console.log(`${role}:`, container ? 'Found' : 'Not Found', container?.style.display);
                });

                console.log('================================');
            }

            static testAlertToAllRoles() {
                console.log('Testing alert delivery to all roles...');

                // Create a test alert manually
                const testAlert = {
                    id: 'TEST' + Date.now().toString().slice(-6),
                    type: 'lightning_warning',
                    user: AppState.currentUser.name,
                    role: AppState.currentUser.role,
                    timestamp: new Date().toISOString(),
                    status: 'active',
                    priority: 'critical'
                };

                // Add to active alerts
                EmergencySystem.activeAlerts.push(testAlert);

                // Update all overview alerts
                PersistentEmergencyAlerts.updateAllOverviewAlerts();

                console.log('Test alert sent:', testAlert);
                this.debugAlertDelivery();
            }
        }

        // Add debugging to window for console access
        window.EmergencyDebugger = EmergencyDebugger;

        // Extend EmergencySystem to update persistent alerts and handle lightning safety
        const originalSendSpecificAlert = EmergencySystem.sendSpecificAlert;
        EmergencySystem.sendSpecificAlert = function(alertType) {
            console.log('Sending emergency alert:', alertType, 'by user:', AppState.currentUser);

            originalSendSpecificAlert.call(this, alertType);

            // Play special audio for lightning safety alerts
            if (['lightning_warning', 'stop_play', 'resume_play'].includes(alertType)) {
                LightningSafetySystem.playLightningAlert(alertType);
            }

            // Update persistent alerts after sending
            setTimeout(() => {
                console.log('Updating overview alerts, active alerts:', EmergencySystem.activeAlerts);

                // Save emergency alerts to localStorage for sync
                localStorage.setItem('emergency_alerts', JSON.stringify(EmergencySystem.activeAlerts));

                // Trigger GLOBAL emergency alert sync for all users on property
                if (typeof ProductionCloudSync !== 'undefined') {
                    SimpleCloudSync.saveToCloudSoon();
                    console.log('[Emergency] Triggered GLOBAL emergency alert sync for all users on property');
                }

                PersistentEmergencyAlerts.updateAllOverviewAlerts();
                EmergencyDebugger.debugAlertDelivery();
            }, 2500); // Wait for alert to be added to activeAlerts
        };

        // Application Initialization
        document.addEventListener('DOMContentLoaded', function() {
            console.log('MciPro Enterprise Platform initializing...');

            try {
                // REMOVED: clearAllDemoData() - was wiping bookings on every startup!
                console.log('üöÄ Starting MciPro without clearing existing data...');

                // Initialize internationalization system
                initializeLanguage();

                // Initialize OTP input handlers
                OTPAuthentication.setupOTPInputHandlers();

                // Initialize production cloud synchronization system
                SimpleCloudSync.initialize();

                // Initialize booking system and load saved data
                BookingManager.initialize();

                // Initialize schedule system
                ScheduleSystem.initializeSchedule();

                // Initialize screen management
                ScreenManager.showScreen('login');

                // Initialize session tracking
                AppState.session.lastActivity = new Date().toISOString();

                // Clear ALL old emergency alerts on page load
                console.log('[INIT] Clearing ALL old emergency alerts...');
                localStorage.setItem('emergency_alerts', JSON.stringify([]));
                EmergencySystem.activeAlerts = [];
                console.log('[INIT] All old alerts cleared - starting fresh');

                // Initialize persistent emergency alerts
                PersistentEmergencyAlerts.updateAllOverviewAlerts();

                console.log('MciPro Enterprise Platform initialized successfully');

            } catch (error) {
                console.error('Initialization error:', error);
                NotificationManager.show('Application initialization error', 'error');
            }
        });

        // ===== GLOBAL HELPER FUNCTIONS =====

        // These are called directly from HTML onclick attributes
        function showScreen(screenId) {
            ScreenManager.showScreen(screenId);
        }

        function showTab(dashboardId, tabName, event) {
            TabManager.showTab(dashboardId, tabName, event);
        }

        function login(role) {
            FallbackAuthentication.login(role);
        }

        function loginWithCustomProfile(profileData) {
            LoadingManager.show('Logging in with your profile...');

            // FIRST: Clear all data immediately before any initialization
            ensureCleanSlateForNewUser(profileData);

            setTimeout(() => {
                // Set AppState to use the custom profile with clean slate
                AppState.currentUser = {
                    role: profileData.role,
                    name: `${profileData.firstName} ${profileData.lastName}`,
                    lineId: null,
                    avatar: profileData.profilePicture || profileData.roleSpecific?.avatar || null,
                    email: profileData.email,
                    phone: profileData.phone,
                    handicap: profileData.roleSpecific?.handicap || null,
                    membershipLevel: profileData.role === 'golfer' ? 'premium' : 'staff',
                    joinDate: profileData.createdAt,
                    stats: {
                        totalRounds: 0,
                        averageScore: 0,
                        bestScore: 0,
                        totalEarnings: 0,
                        rating: 0
                    },
                    permissions: LineAuthentication.getPermissions(profileData.role),
                    profileData: profileData,
                    preferences: {
                        language: 'en',
                        notifications: true,
                        theme: 'light'
                    }
                };

                AppState.session.isAuthenticated = true;
                AppState.session.authMethod = 'custom_profile';
                AppState.session.loginTime = new Date().toISOString();

                LoadingManager.hide();

                // Update UI with profile data
                ProfileSystem.updateUIWithProfile();
                UserInterface.updateUserDisplays();

                // Initialize ChatSystem for the logged-in user
                ChatSystem.initialize();

                LineAuthentication.redirectToDashboard();
            }, 1000);
        }

        function ensureCleanSlateForNewUser(profileData) {
            const userName = `${profileData.firstName} ${profileData.lastName}`;

            console.log(`Ensuring clean slate for: ${userName} (${profileData.role})`);

            // Clear ALL existing localStorage data except courses, caddies, and user profiles
            const keysToPreserve = [
                'mcipro_user_profiles',
                'mci-pro-language',
                'caddie_system_data',
                'golf_courses_data'
            ];

            // Specifically clear booking and schedule data
            const dataKeysToForceRemove = [
                'mcipro_bookings',
                'schedule_items',
                'food_orders',
                'chat_messages',
                'maintenance_reports',
                'waitlist_data',
                'cart_data',
                'order_history'
            ];

            // Get all localStorage keys
            const allKeys = [];
            for (let i = 0; i < localStorage.length; i++) {
                allKeys.push(localStorage.key(i));
            }

            // Force remove specific data keys first
            dataKeysToForceRemove.forEach(key => {
                localStorage.removeItem(key);
            });

            // Remove all keys except preserved ones
            allKeys.forEach(key => {
                if (!keysToPreserve.includes(key) && !key.startsWith('profile_')) {
                    localStorage.removeItem(key);
                }
            });

            // Reset all major system components to fresh state
            if (window.BookingManager) {
                BookingManager.bookings = [];
                BookingManager.waitlists = {};

                // Force empty state by saving empty data to localStorage
                localStorage.setItem('mcipro_bookings', JSON.stringify([]));
                BookingManager.saveToLocalStorage();
                console.log('BookingManager reset to clean state');
            }

            if (window.FoodOrderingSystem) {
                FoodOrderingSystem.orders = [];
                localStorage.setItem('food_orders', JSON.stringify([]));
                console.log('FoodOrderingSystem reset to clean state');
            }

            if (window.ScheduleManager) {
                ScheduleManager.scheduleItems = [];

                // Force empty state by saving empty schedule to localStorage
                localStorage.setItem('schedule_items', JSON.stringify([]));
                ScheduleManager.saveSchedule();
                console.log('ScheduleManager reset to clean state');
            }

            if (window.ChatSystem) {
                ChatSystem.currentUser = {
                    id: profileData.role + '_' + userName.replace(/\s+/g, '_').toLowerCase(),
                    name: userName,
                    role: profileData.role,
                    avatar: profileData.profilePicture || profileData.roleSpecific?.avatar || 'üë§'
                };
                ChatSystem.messages = [];
                ChatSystem.saveMessages();
                console.log('ChatSystem reset to clean state');
            }

            // Clear any cart data
            const cartElements = document.querySelectorAll('[data-cart-item]');
            cartElements.forEach(element => element.remove());

            // Clear any order history displays
            const orderHistoryElements = document.querySelectorAll('[data-order-history]');
            orderHistoryElements.forEach(element => element.innerHTML = '<p class="text-gray-500 text-center py-8">No orders yet</p>');

            console.log(`Clean slate completed for: ${userName} (${profileData.role})`);

            // Mark this session as a clean slate user
            window.isCleanSlateUser = true;

            // Force re-initialization of systems after clearing data
            setTimeout(() => {
                if (window.BookingManager) {
                    // Don't call initialize, just ensure empty state
                    BookingManager.bookings = [];
                    BookingManager.waitlists = {};
                }
                if (window.ScheduleManager) {
                    ScheduleManager.scheduleItems = [];
                }
                console.log('Systems re-initialized with clean data');
            }, 100);

            // Reset role-specific data displays
            resetRoleSpecificDisplays(profileData.role);

            // Force refresh dashboard content after clearing
            setTimeout(() => {
                refreshDashboardContent();
            }, 200);
        }

        function resetRoleSpecificDisplays(role) {
            // Reset stats and displays based on role
            switch (role) {
                case 'golfer':
                    // Reset golfer-specific displays
                    if (document.querySelector('.total-rounds')) {
                        document.querySelector('.total-rounds').textContent = '0';
                    }
                    if (document.querySelector('.handicap-display')) {
                        document.querySelector('.handicap-display').textContent = AppState.currentUser.handicap || 'Not Set';
                    }
                    break;

                case 'caddie':
                    // Reset caddie-specific displays
                    if (document.querySelector('.monthly-earnings')) {
                        document.querySelector('.monthly-earnings').textContent = '‡∏ø0';
                    }
                    if (document.querySelector('.total-rounds-caddie')) {
                        document.querySelector('.total-rounds-caddie').textContent = '0';
                    }
                    if (document.querySelector('.rating-display')) {
                        document.querySelector('.rating-display').textContent = '0.0';
                    }
                    break;

                case 'manager':
                    // Reset manager-specific displays
                    if (document.querySelector('.staff-count')) {
                        document.querySelector('.staff-count').textContent = '0 Staff Members';
                    }
                    break;

                case 'proshop':
                    // Reset pro shop-specific displays
                    if (document.querySelector('.daily-sales')) {
                        document.querySelector('.daily-sales').textContent = '‡∏ø0';
                    }
                    if (document.querySelector('.items-sold')) {
                        document.querySelector('.items-sold').textContent = '0 Items Sold';
                    }
                    break;

                case 'maintenance':
                    // Reset maintenance-specific displays
                    if (document.querySelector('.tasks-completed')) {
                        document.querySelector('.tasks-completed').textContent = '0 Tasks';
                    }
                    break;
            }

            // Clear any existing dashboard cards that show user-specific data
            const dashboardCards = document.querySelectorAll('.dashboard-card[data-user-specific="true"]');
            dashboardCards.forEach(card => {
                card.style.display = 'none';
            });

            console.log(`Role-specific displays reset for: ${role}`);
        }

        function refreshDashboardContent() {
            // Clear any booking cards in overview
            const bookingCards = document.querySelectorAll('.booking-card, .schedule-item-card');
            bookingCards.forEach(card => card.remove());

            // Clear schedule lists
            const scheduleContainer = document.querySelector('#scheduleItemsList');
            if (scheduleContainer) {
                scheduleContainer.innerHTML = '<p class="text-gray-500 text-center py-8">No scheduled activities yet</p>';
            }

            // Clear overview booking displays
            const overviewBookings = document.querySelector('.overview-bookings');
            if (overviewBookings) {
                overviewBookings.innerHTML = '<p class="text-gray-500 text-center py-4">No upcoming bookings</p>';
            }

            // Clear any charts or stats that might show cached data
            const statElements = document.querySelectorAll('.stat-value, .metric-value');
            statElements.forEach(element => {
                if (element.textContent && !isNaN(element.textContent)) {
                    element.textContent = '0';
                }
            });

            console.log('Dashboard content refreshed for clean slate user');
        }

        function logout() {
            LineAuthentication.logout();
        }

        // ===== PROFILE CREATION SYSTEM =====
        function showCreateProfileScreen() {
            showScreen('createProfileScreen');
        }

        function goBackToLogin() {
            showScreen('login');
        }

        // Profile Management Functions
        function showMyProfiles() {
            const profilesModal = document.createElement('div');
            profilesModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            profilesModal.id = 'profilesModal';

            const savedProfiles = JSON.parse(localStorage.getItem('mcipro_user_profiles') || '[]');

            profilesModal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 max-h-96 overflow-y-auto">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">My Profiles</h3>

                    ${savedProfiles.length === 0 ? `
                        <div class="text-center py-8">
                            <p class="text-gray-600 mb-4">No profiles created yet</p>
                            <button onclick="closeProfilesModal(); showCreateProfileScreen();" class="btn-primary">Create Profile</button>
                        </div>
                    ` : `
                        <div class="space-y-3">
                            ${savedProfiles.map(profile => `
                                <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50">
                                    <div class="flex items-center justify-between">
                                        <div class="flex-1 cursor-pointer" onclick="selectProfile('${profile.id}')">
                                            <h4 class="font-semibold text-gray-900">${profile.firstName} ${profile.lastName}</h4>
                                            <p class="text-sm text-gray-600 capitalize">${profile.role}</p>
                                            <p class="text-xs text-gray-500">${profile.email}</p>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${getRoleColor(profile.role)}-100 text-${getRoleColor(profile.role)}-800">
                                                ${profile.role}
                                            </span>
                                            <button onclick="deleteProfile('${profile.id}', event)"
                                                    class="p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded border border-red-200"
                                                    title="Delete Profile">
                                                ‚ùå
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>

                        <div class="mt-6 flex space-x-3">
                            <button onclick="closeProfilesModal()" class="btn-secondary flex-1">Cancel</button>
                            <button onclick="closeProfilesModal(); showCreateProfileScreen();" class="btn-primary flex-1">Create New</button>
                        </div>
                    `}
                </div>
            `;

            document.body.appendChild(profilesModal);
        }

        function getRoleColor(role) {
            const colors = {
                'golfer': 'blue',
                'caddie': 'green',
                'manager': 'purple',
                'proshop': 'orange',
                'maintenance': 'yellow',
                'society': 'pink'
            };
            return colors[role] || 'gray';
        }

        function closeProfilesModal() {
            const modal = document.getElementById('profilesModal');
            if (modal) {
                modal.remove();
            }
        }

        function selectProfile(profileId) {
            const savedProfiles = JSON.parse(localStorage.getItem('mcipro_user_profiles') || '[]');
            const selectedProfile = savedProfiles.find(p => p.id === profileId);

            if (selectedProfile) {
                closeProfilesModal();
                loginWithCustomProfile(selectedProfile);
            }
        }

        function deleteProfile(profileId, event) {
            event.stopPropagation(); // Prevent profile selection when clicking delete

            if (confirm('Are you sure you want to delete this profile? This action cannot be undone.')) {
                try {
                    // Remove from saved profiles
                    const savedProfiles = JSON.parse(localStorage.getItem('mcipro_user_profiles') || '[]');
                    const updatedProfiles = savedProfiles.filter(p => p.id !== profileId);
                    localStorage.setItem('mcipro_user_profiles', JSON.stringify(updatedProfiles));

                    // Find the profile to get the name for cleanup
                    const deletedProfile = savedProfiles.find(p => p.id === profileId);
                    if (deletedProfile) {
                        const profileName = `${deletedProfile.firstName} ${deletedProfile.lastName}`;

                        // Clean up associated data
                        cleanupProfileData(deletedProfile.role, profileName, profileId);
                    }

                    // Refresh the modal
                    closeProfilesModal();
                    showMyProfiles();

                    console.log('Profile deleted successfully');
                } catch (error) {
                    console.error('Error deleting profile:', error);
                    alert('Error deleting profile. Please try again.');
                }
            }
        }

        function cleanupProfileData(role, profileName, profileId) {
            try {
                // Remove profile from ProfileSystem storage
                const profileKey = `profile_${role}_${profileName}`;
                localStorage.removeItem(profileKey);

                // Clean up role-specific data
                const userDataKey = `userData_${profileId}`;
                localStorage.removeItem(userDataKey);

                // Clean up any bookings, schedules, orders associated with this profile
                const keysToClean = [
                    `bookings_${profileName}`,
                    `schedule_${profileName}`,
                    `orders_${profileName}`,
                    `waitlist_${profileName}`,
                    `cart_${profileName}`,
                    `preferences_${profileName}`,
                    `history_${profileName}`,
                    `stats_${profileName}`
                ];

                keysToClean.forEach(key => {
                    localStorage.removeItem(key);
                });

                console.log(`Cleaned up data for profile: ${profileName}`);
            } catch (error) {
                console.error('Error cleaning up profile data:', error);
            }
        }

        // Handle role selection change
        document.addEventListener('DOMContentLoaded', function() {
            const roleInputs = document.querySelectorAll('input[name="role"]');
            roleInputs.forEach(input => {
                input.addEventListener('change', function() {
                    if (this.checked) {
                        showRoleSpecificFields(this.value);
                    }
                });
            });

            // Handle profile picture upload
            const profilePictureInput = document.getElementById('profilePicture');
            if (profilePictureInput) {
                profilePictureInput.addEventListener('change', function(event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            document.getElementById('previewImg').src = e.target.result;
                            document.getElementById('uploadArea').style.display = 'none';
                            document.getElementById('imagePreview').style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            // Handle form submission
            const profileForm = document.getElementById('profileCreationForm');
            if (profileForm) {
                profileForm.addEventListener('submit', handleProfileCreation);
            }
        });

        function showRoleSpecificFields(role) {
            const container = document.getElementById('roleSpecificFields');
            container.classList.remove('hidden');

            let fieldsHTML = '';

            switch(role) {
                case 'golfer':
                    fieldsHTML = `
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="profile.golfer.info">Golfer Information</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="profile.handicap">Handicap</label>
                                <input type="number" name="handicap" min="0" max="54" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="e.g. 18">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="profile.experience.level">Experience Level</label>
                                <select name="experienceLevel" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                    <option value="" data-i18n="profile.select.level">Select level...</option>
                                    <option value="Beginner" data-i18n="profile.beginner">Beginner</option>
                                    <option value="Intermediate" data-i18n="profile.intermediate">Intermediate</option>
                                    <option value="Advanced" data-i18n="profile.advanced">Advanced</option>
                                    <option value="Professional" data-i18n="profile.professional">Professional</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Club Affiliation</label>
                                <select name="clubAffiliation" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                    <option value="">Select society...</option>
                                    <option value="Travellers Rest Group">Travellers Rest Group</option>
                                    <option value="Pattaya Sports Club">Pattaya Sports Club</option>
                                    <option value="Bunker Boys">Bunker Boys</option>
                                    <option value="Diego Dubbi Golf">Diego Dubbi Golf</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Playing Style</label>
                                <input type="text" name="playingStyle" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="e.g. Aggressive, Conservative">
                            </div>
                        </div>
                    `;
                    break;

                case 'caddie':
                    fieldsHTML = `
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Caddy Information</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Years of Experience</label>
                                <input type="number" name="experience" min="0" max="50" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="e.g. 5">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Specialty</label>
                                <select name="specialty" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                    <option value="">Select specialty...</option>
                                    <option value="Championship Course">Championship Course</option>
                                    <option value="Beginner Support">Beginner Support</option>
                                    <option value="Tournament Play">Tournament Play</option>
                                    <option value="VIP Service">VIP Service</option>
                                    <option value="International Service">International Service</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Languages (select multiple)</label>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="languages" value="Thai" class="mr-2"> Thai
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="languages" value="English" class="mr-2"> English
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="languages" value="Japanese" class="mr-2"> Japanese
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="languages" value="Chinese" class="mr-2"> Chinese
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="languages" value="Korean" class="mr-2"> Korean
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Preferred Avatar</label>
                                <select name="avatar" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                    <option value="üë®">üë® Man</option>
                                    <option value="üë©">üë© Woman</option>
                                    <option value="üë®‚Äçü¶≤">üë®‚Äçü¶≤ Bald Man</option>
                                    <option value="üë©‚Äçü¶≤">üë©‚Äçü¶≤ Bald Woman</option>
                                    <option value="üë®‚Äçü¶±">üë®‚Äçü¶± Curly Hair Man</option>
                                    <option value="üë©‚Äçü¶±">üë©‚Äçü¶± Curly Hair Woman</option>
                                    <option value="üë®‚Äçü¶≥">üë®‚Äçü¶≥ White Hair Man</option>
                                    <option value="üë©‚Äçü¶≥">üë©‚Äçü¶≥ White Hair Woman</option>
                                </select>
                            </div>
                        </div>
                    `;
                    break;

                case 'manager':
                    fieldsHTML = `
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Manager Information</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Department</label>
                                <select name="department" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                    <option value="">Select department...</option>
                                    <option value="Operations">Operations</option>
                                    <option value="Food & Beverage">Food & Beverage</option>
                                    <option value="Maintenance">Maintenance</option>
                                    <option value="Guest Services">Guest Services</option>
                                    <option value="Pro Shop">Pro Shop</option>
                                    <option value="Events">Events</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Years in Management</label>
                                <input type="number" name="managementExperience" min="0" max="50" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="e.g. 3">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Certifications</label>
                                <input type="text" name="certifications" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="e.g. PGA, GCSAA, etc.">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Emergency Contact</label>
                                <input type="tel" name="emergencyContact" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="Emergency contact number">
                            </div>
                        </div>
                    `;
                    break;

                case 'proshop':
                    fieldsHTML = `
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Pro Shop Information</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Position</label>
                                <select name="position" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                    <option value="">Select position...</option>
                                    <option value="Manager">Manager</option>
                                    <option value="Sales Associate">Sales Associate</option>
                                    <option value="Golf Professional">Golf Professional</option>
                                    <option value="Assistant Pro">Assistant Pro</option>
                                    <option value="Inventory Specialist">Inventory Specialist</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Retail Experience (years)</label>
                                <input type="number" name="retailExperience" min="0" max="50" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="e.g. 2">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Golf Knowledge Level</label>
                                <select name="golfKnowledge" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                    <option value="">Select level...</option>
                                    <option value="Basic">Basic</option>
                                    <option value="Intermediate">Intermediate</option>
                                    <option value="Advanced">Advanced</option>
                                    <option value="Expert">Expert</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Equipment Fitting Certified</label>
                                <select name="fittingCertified" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                    <option value="no">No</option>
                                    <option value="yes">Yes</option>
                                </select>
                            </div>
                        </div>
                    `;
                    break;

                case 'maintenance':
                    fieldsHTML = `
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Maintenance Information</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Specialty Area</label>
                                <select name="maintenanceSpecialty" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                    <option value="">Select specialty...</option>
                                    <option value="Greens">Greens Maintenance</option>
                                    <option value="Fairways">Fairways</option>
                                    <option value="Irrigation">Irrigation Systems</option>
                                    <option value="Equipment">Equipment Maintenance</option>
                                    <option value="Landscaping">Landscaping</option>
                                    <option value="Pest Control">Pest Control</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Years Experience</label>
                                <input type="number" name="maintenanceExperience" min="0" max="50" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="e.g. 8">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Certifications</label>
                                <input type="text" name="maintenanceCertifications" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="e.g. Pesticide License, GCSAA">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Shift Preference</label>
                                <select name="shiftPreference" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                    <option value="">Select preference...</option>
                                    <option value="Early Morning">Early Morning (5:00-13:00)</option>
                                    <option value="Day">Day (8:00-16:00)</option>
                                    <option value="Afternoon">Afternoon (13:00-21:00)</option>
                                    <option value="Flexible">Flexible</option>
                                </select>
                            </div>
                        </div>
                    `;
                    break;

                case 'society':
                    fieldsHTML = `
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Society Organizer Information</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Society/Group Name</label>
                                <input type="text" name="societyName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="e.g. Travellers Rest Group">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Role in Society</label>
                                <select name="societyRole" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                    <option value="">Select role...</option>
                                    <option value="President">President</option>
                                    <option value="Vice President">Vice President</option>
                                    <option value="Secretary">Secretary</option>
                                    <option value="Treasurer">Treasurer</option>
                                    <option value="Event Organizer">Event Organizer</option>
                                    <option value="Member">Member</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Years Organizing Events</label>
                                <input type="number" name="organizingExperience" min="0" max="50" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="e.g. 3">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Group Size</label>
                                <select name="groupSize" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                    <option value="">Select size...</option>
                                    <option value="Small (5-20)">Small (5-20 members)</option>
                                    <option value="Medium (20-50)">Medium (20-50 members)</option>
                                    <option value="Large (50-100)">Large (50-100 members)</option>
                                    <option value="Very Large (100+)">Very Large (100+ members)</option>
                                </select>
                            </div>
                        </div>
                    `;
                    break;
            }

            container.innerHTML = fieldsHTML;
        }

        function removeImage() {
            document.getElementById('profilePicture').value = '';
            document.getElementById('uploadArea').style.display = 'block';
            document.getElementById('imagePreview').style.display = 'none';
        }

        function handleProfileCreation(event) {
            event.preventDefault();

            const formData = new FormData(event.target);
            const profileData = {};

            // Get basic information
            profileData.firstName = formData.get('firstName');
            profileData.lastName = formData.get('lastName');
            profileData.email = formData.get('email');
            profileData.phone = formData.get('phone');
            profileData.role = formData.get('role');
            profileData.homeClub = formData.get('homeClub');
            profileData.additionalInfo = formData.get('additionalInfo');
            profileData.createdAt = new Date().toISOString();
            profileData.id = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

            // Get role-specific data
            const roleSpecificData = {};
            switch(profileData.role) {
                case 'golfer':
                    roleSpecificData.handicap = formData.get('handicap');
                    roleSpecificData.experienceLevel = formData.get('experienceLevel');
                    roleSpecificData.clubAffiliation = formData.get('clubAffiliation');
                    roleSpecificData.playingStyle = formData.get('playingStyle');
                    break;
                case 'caddie':
                    roleSpecificData.experience = formData.get('experience');
                    roleSpecificData.specialty = formData.get('specialty');
                    roleSpecificData.avatar = formData.get('avatar');
                    // Get selected languages
                    const languages = formData.getAll('languages');
                    roleSpecificData.languages = languages;
                    break;
                case 'manager':
                    roleSpecificData.department = formData.get('department');
                    roleSpecificData.managementExperience = formData.get('managementExperience');
                    roleSpecificData.certifications = formData.get('certifications');
                    roleSpecificData.emergencyContact = formData.get('emergencyContact');
                    break;
                case 'proshop':
                    roleSpecificData.position = formData.get('position');
                    roleSpecificData.retailExperience = formData.get('retailExperience');
                    roleSpecificData.golfKnowledge = formData.get('golfKnowledge');
                    roleSpecificData.fittingCertified = formData.get('fittingCertified');
                    break;
                case 'maintenance':
                    roleSpecificData.maintenanceSpecialty = formData.get('maintenanceSpecialty');
                    roleSpecificData.maintenanceExperience = formData.get('maintenanceExperience');
                    roleSpecificData.maintenanceCertifications = formData.get('maintenanceCertifications');
                    roleSpecificData.shiftPreference = formData.get('shiftPreference');
                    break;
                case 'society':
                    roleSpecificData.societyName = formData.get('societyName');
                    roleSpecificData.societyRole = formData.get('societyRole');
                    roleSpecificData.organizingExperience = formData.get('organizingExperience');
                    roleSpecificData.groupSize = formData.get('groupSize');
                    break;
            }

            profileData.roleSpecific = roleSpecificData;

            // Handle profile picture
            const profilePicture = formData.get('profilePicture');
            if (profilePicture && profilePicture.size > 0) {
                // In a real application, you would upload this to a server
                // For now, we'll use a data URL
                const reader = new FileReader();
                reader.onload = function(e) {
                    profileData.profilePicture = e.target.result;
                    saveProfile(profileData);
                };
                reader.readAsDataURL(profilePicture);
            } else {
                saveProfile(profileData);
            }
        }

        function saveProfile(profileData) {
            try {
                // Save to localStorage
                const existingProfiles = JSON.parse(localStorage.getItem('mcipro_user_profiles') || '[]');
                existingProfiles.push(profileData);
                localStorage.setItem('mcipro_user_profiles', JSON.stringify(existingProfiles));

                // Set current user
                currentUser = {
                    role: profileData.role,
                    name: `${profileData.firstName} ${profileData.lastName}`,
                    email: profileData.email,
                    profileData: profileData
                };

                // Also store this profile in the expected format for ProfileSystem
                const profileKey = `profile_${profileData.role}_${currentUser.name}`;
                const formattedProfile = {
                    personalInfo: {
                        firstName: profileData.firstName,
                        lastName: profileData.lastName,
                        email: profileData.email,
                        phone: profileData.phone
                    },
                    roleSpecific: profileData.roleSpecific,
                    createdAt: profileData.createdAt,
                    id: profileData.id
                };
                localStorage.setItem(profileKey, JSON.stringify(formattedProfile));

                // Trigger cloud sync after profile creation
                if (typeof ProductionCloudSync !== 'undefined') {
                    console.log('[ProfileCreation] Triggering cloud sync for new profile');
                    SimpleCloudSync.saveToCloudSoon();
                }

                NotificationManager.show(`Profile created successfully! Welcome ${currentUser.name}!`, 'success');

                // Login with the new profile
                setTimeout(() => {
                    loginWithCustomProfile(profileData);
                }, 1500);

            } catch (error) {
                console.error('Error saving profile:', error);
                NotificationManager.show('Error creating profile. Please try again.', 'error');
            }
        }

        function loginWithLINE() {
            LineAuthentication.loginWithLINE();
        }

        function showOTPScreen() {
            OTPAuthentication.showOTPScreen();
        }

        function sendOTP() {
            OTPAuthentication.sendOTP();
        }

        function verifyOTP() {
            OTPAuthentication.verifyOTP();
        }

        function sendEmergencyAlert() {
            EmergencySystem.sendAlert();
        }

        // DUPLICATE BOOKING CLEANUP FUNCTIONS
        function removeDuplicateBookings() {
            if (typeof BookingManager !== 'undefined') {
                const removed = BookingManager.removeDuplicateBookings();
                console.log(`‚úÖ Removed ${removed} duplicate bookings`);
                // Refresh UI
                if (typeof ScheduleSystem !== 'undefined') {
                    ScheduleSystem.refreshStats();
                }
                return removed;
            } else {
                console.log('‚ùå BookingManager not available');
                return 0;
            }
        }

        function clearAllBookings() {
            if (typeof BookingManager !== 'undefined') {
                const cleared = BookingManager.clearAllBookings();
                console.log(`‚úÖ Cleared ${cleared} bookings`);
                // Refresh UI
                if (typeof ScheduleSystem !== 'undefined') {
                    ScheduleSystem.refreshStats();
                }
                return cleared;
            } else {
                console.log('‚ùå BookingManager not available');
                return 0;
            }
        }

        // Tab-specific functions (will be expanded in later phases)
        function showGolferTab(tabName, event) {
            TabManager.showTab('golferDashboard', tabName, event);
        }

        function showCaddyTab(tabName, event) {
            TabManager.showTab('caddieDashboard', tabName, event);
        }

        function showManagerTab(tabName, event) {
            TabManager.showTab('managerDashboard', tabName, event);
        }

        function showProshopTab(tabName, event) {
            TabManager.showTab('proshopDashboard', tabName, event);
        }

        function showMaintenanceTab(tabName, event) {
            TabManager.showTab('maintenanceDashboard', tabName, event);
        }

        // ===== GOLFER DASHBOARD FUNCTIONS =====

        // Enhanced Food Ordering System
        let foodCart = [];
        let currentFoodCategory = 'all';
        let activeOrderId = null;

        const FoodOrderingSystem = {
            // Comprehensive Menu Database
            menuItems: {
                // Appetizers & Starters
                1: { name: 'Caesar Salad', price: 280, category: 'appetizers', emoji: 'ü•ó', description: 'Fresh romaine lettuce with parmesan and croutons', prepTime: 10, available: true, popular: true },
                2: { name: 'Shrimp Cocktail', price: 420, category: 'appetizers', emoji: 'üç§', description: 'Premium shrimp with cocktail sauce', prepTime: 5, available: true, popular: false },
                3: { name: 'Tom Yum Soup', price: 240, category: 'appetizers', emoji: 'üç≤', description: 'Authentic Thai hot and sour soup', prepTime: 15, available: true, popular: true },
                4: { name: 'Spring Rolls', price: 180, category: 'appetizers', emoji: 'ü•ñ', description: 'Fresh vegetables wrapped in rice paper', prepTime: 8, available: true, popular: false },
                5: { name: 'Chicken Satay', price: 320, category: 'appetizers', emoji: 'üçó', description: 'Grilled chicken skewers with peanut sauce', prepTime: 12, available: true, popular: true },

                // Main Courses
                6: { name: 'Wagyu Steak', price: 1680, category: 'mains', emoji: 'ü•©', description: 'Premium A5 Wagyu beef with vegetables', prepTime: 25, available: true, popular: true },
                7: { name: 'Grilled Salmon', price: 680, category: 'mains', emoji: 'üêü', description: 'Norwegian salmon with lemon butter sauce', prepTime: 18, available: true, popular: true },
                8: { name: 'Club Sandwich', price: 380, category: 'mains', emoji: 'ü•™', description: 'Triple-deck sandwich with fries', prepTime: 12, available: true, popular: false },
                9: { name: 'Thai Green Curry', price: 320, category: 'mains', emoji: 'üçõ', description: 'Authentic green curry with jasmine rice', prepTime: 20, available: true, popular: true },
                10: { name: 'Pad Thai', price: 280, category: 'mains', emoji: 'üçú', description: 'Classic stir-fried rice noodles', prepTime: 15, available: true, popular: true },
                11: { name: 'Fish & Chips', price: 420, category: 'mains', emoji: 'üçü', description: 'Beer-battered fish with crispy fries', prepTime: 16, available: true, popular: false },
                12: { name: 'Massaman Curry', price: 340, category: 'mains', emoji: 'ü•ò', description: 'Rich Thai curry with potatoes', prepTime: 22, available: true, popular: false },

                // Beverages
                13: { name: 'Fresh Orange Juice', price: 120, category: 'beverages', emoji: 'üçä', description: 'Freshly squeezed orange juice', prepTime: 3, available: true, popular: true },
                14: { name: 'Premium Coffee', price: 150, category: 'beverages', emoji: '‚òï', description: 'Arabica coffee beans', prepTime: 5, available: true, popular: true },
                15: { name: 'Sparkling Water', price: 80, category: 'beverages', emoji: 'üíß', description: 'San Pellegrino sparkling water', prepTime: 1, available: true, popular: false },
                16: { name: 'House Wine', price: 280, category: 'beverages', emoji: 'üç∑', description: 'Selection of red or white wine', prepTime: 2, available: true, popular: false },
                17: { name: 'Thai Iced Tea', price: 100, category: 'beverages', emoji: 'üßã', description: 'Traditional Thai tea with condensed milk', prepTime: 4, available: true, popular: true },
                18: { name: 'Coconut Water', price: 90, category: 'beverages', emoji: 'ü••', description: 'Fresh young coconut water', prepTime: 2, available: true, popular: true },
                19: { name: 'Heineken Small', price: 120, category: 'beverages', emoji: 'üç∫', description: 'Premium Dutch beer (330ml)', prepTime: 1, available: true, popular: true },
                20: { name: 'Heineken Large', price: 180, category: 'beverages', emoji: 'üç∫', description: 'Premium Dutch beer (640ml)', prepTime: 1, available: true, popular: true },
                21: { name: 'Chang Beer Small', price: 100, category: 'beverages', emoji: 'üç∫', description: 'Local Thai beer (330ml)', prepTime: 1, available: true, popular: false },
                22: { name: 'Chang Beer Large', price: 150, category: 'beverages', emoji: 'üç∫', description: 'Local Thai beer (640ml)', prepTime: 1, available: true, popular: false },
                23: { name: 'Singha Beer Small', price: 110, category: 'beverages', emoji: 'üç∫', description: 'Classic Thai beer (330ml)', prepTime: 1, available: true, popular: false },
                24: { name: 'Singha Beer Large', price: 160, category: 'beverages', emoji: 'üç∫', description: 'Classic Thai beer (640ml)', prepTime: 1, available: true, popular: false },
                25: { name: 'Smoothie Bowl', price: 220, category: 'beverages', emoji: 'ü•§', description: 'Tropical fruit smoothie', prepTime: 6, available: true, popular: false },

                // Desserts
                26: { name: 'Mango Sticky Rice', price: 180, category: 'desserts', emoji: 'ü•≠', description: 'Traditional Thai dessert', prepTime: 8, available: true, popular: true },
                27: { name: 'Chocolate Cake', price: 240, category: 'desserts', emoji: 'üç∞', description: 'Rich dark chocolate cake', prepTime: 5, available: true, popular: true },
                28: { name: 'Ice Cream Selection', price: 120, category: 'desserts', emoji: 'üç®', description: 'Vanilla, chocolate, or strawberry', prepTime: 3, available: true, popular: false },
                29: { name: 'Fruit Platter', price: 200, category: 'desserts', emoji: 'üçì', description: 'Seasonal fresh fruits', prepTime: 6, available: true, popular: false },

                // Snacks & Light Bites
                30: { name: 'Chicken Wings', price: 280, category: 'snacks', emoji: 'üçó', description: 'Buffalo or BBQ style wings', prepTime: 15, available: true, popular: true },
                31: { name: 'Nachos Supreme', price: 320, category: 'snacks', emoji: 'üßÄ', description: 'Loaded nachos with cheese and jalape√±os', prepTime: 10, available: true, popular: false },
                32: { name: 'Golf Course Mix', price: 150, category: 'snacks', emoji: 'ü•ú', description: 'Premium nuts and dried fruits', prepTime: 1, available: true, popular: false },
                33: { name: 'Energy Bar', price: 80, category: 'snacks', emoji: 'üç´', description: 'Protein and energy bar', prepTime: 1, available: true, popular: false }
            },

            categories: {
                all: { name: 'All Items', icon: 'üçΩÔ∏è' },
                appetizers: { name: 'Appetizers', icon: 'ü•ó' },
                mains: { name: 'Main Courses', icon: 'üçΩÔ∏è' },
                beverages: { name: 'Beverages', icon: 'ü•§' },
                desserts: { name: 'Desserts', icon: 'üç∞' },
                snacks: { name: 'Snacks', icon: 'üçø' }
            },

            orderHistory: [
                { id: 'FO001', date: '2024-01-15', items: ['Caesar Salad', 'Grilled Salmon'], total: 960, status: 'delivered' },
                { id: 'FO002', date: '2024-01-10', items: ['Wagyu Steak', 'House Wine'], total: 1960, status: 'delivered' },
                { id: 'FO003', date: '2024-01-08', items: ['Thai Green Curry', 'Thai Iced Tea'], total: 420, status: 'delivered' }
            ],

            deliveryOptions: {
                'course-delivery': {
                    name: 'Course Delivery',
                    fee: 50,
                    time: '20-30 min',
                    icon: 'üöó',
                    description: 'Delivered to your location on the course',
                    baseTime: 5
                },
                'clubhouse-pickup': {
                    name: 'Clubhouse Pickup',
                    fee: 0,
                    time: '15-20 min',
                    icon: 'üè¢',
                    description: 'Ready for pickup at the clubhouse',
                    baseTime: 0
                },
                'cart-service': {
                    name: 'Cart Service',
                    fee: 30,
                    time: '25-35 min',
                    icon: 'üõí',
                    description: 'Brought to you by golf cart',
                    baseTime: 10
                },
                'restaurant-dining': {
                    name: 'Restaurant Dining',
                    fee: 0,
                    time: 'Reserve table after round',
                    icon: 'üçΩÔ∏è',
                    description: 'Dine in our restaurant with reserved table',
                    baseTime: 0,
                    requiresReservation: true
                },
                'post-round-ready': {
                    name: 'Post-Round Ready',
                    fee: 0,
                    time: 'Ready when you finish',
                    icon: '‚è∞',
                    description: 'Food ready when you complete your round',
                    baseTime: 0,
                    requiresTimeEstimate: true
                }
            }
        };

        // Enhanced Food Cart Functions
        function addToFoodCart(itemId) {
            const item = FoodOrderingSystem.menuItems[itemId];
            if (!item || !item.available) {
                NotificationManager.show('Item is currently unavailable', 'error');
                return;
            }

            const existingItem = foodCart.find(cartItem => cartItem.id === itemId);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                foodCart.push({
                    id: itemId,
                    name: item.name,
                    price: item.price,
                    emoji: item.emoji,
                    description: item.description,
                    prepTime: item.prepTime,
                    quantity: 1
                });
            }

            updateFoodCartDisplay();
            NotificationManager.show(`${item.emoji} ${item.name} added to cart`, 'success');
        }

        function removeFromFoodCart(itemId) {
            foodCart = foodCart.filter(item => item.id !== itemId);
            updateFoodCartDisplay();
            NotificationManager.show('Item removed from cart', 'info');
        }

        function updateFoodCartQuantity(itemId, change) {
            const item = foodCart.find(cartItem => cartItem.id === itemId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromFoodCart(itemId);
                } else {
                    updateFoodCartDisplay();
                }
            }
        }

        function updateFoodCartDisplay() {
            const cartContainer = document.getElementById('foodCartContainer');
            const cartItemCount = document.getElementById('cartItemCount');
            const cartSubtotal = document.getElementById('cartSubtotal');
            const serviceCharge = document.getElementById('serviceCharge');
            const cartTotal = document.getElementById('cartTotal');
            const placeOrderBtn = document.getElementById('placeOrderBtn');

            if (!cartContainer) return;

            let subtotal = 0;
            let itemCount = 0;

            if (foodCart.length === 0) {
                cartContainer.innerHTML = '<p class="text-gray-600 text-sm text-center py-8">Your cart is empty</p>';
            } else {
                cartContainer.innerHTML = '';

                foodCart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    subtotal += itemTotal;
                    itemCount += item.quantity;

                    const cartItem = document.createElement('div');
                    cartItem.className = 'bg-white p-3 rounded-lg border border-gray-200';
                    cartItem.innerHTML = `
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center space-x-2">
                                <span class="text-lg">${item.emoji}</span>
                                <div>
                                    <h5 class="font-semibold text-sm text-gray-900">${item.name}</h5>
                                    <p class="text-xs text-gray-600">‡∏ø${item.price} each</p>
                                </div>
                            </div>
                            <button onclick="removeFromFoodCart(${item.id})" class="text-red-600 hover:text-red-700">
                                <span class="material-symbols-outlined text-sm">delete</span>
                            </button>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <button onclick="updateFoodCartQuantity(${item.id}, -1)" class="w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300">
                                    <span class="material-symbols-outlined text-xs">remove</span>
                                </button>
                                <span class="font-semibold text-sm">${item.quantity}</span>
                                <button onclick="updateFoodCartQuantity(${item.id}, 1)" class="w-6 h-6 bg-primary-600 text-white rounded-full flex items-center justify-center hover:bg-primary-700">
                                    <span class="material-symbols-outlined text-xs">add</span>
                                </button>
                            </div>
                            <span class="font-semibold text-sm text-gray-900">‡∏ø${itemTotal}</span>
                        </div>
                    `;
                    cartContainer.appendChild(cartItem);
                });
            }

            const serviceChargeAmount = Math.round(subtotal * 0.1);
            const total = subtotal + serviceChargeAmount;

            if (cartItemCount) cartItemCount.textContent = itemCount;
            if (cartSubtotal) cartSubtotal.textContent = `‡∏ø${subtotal}`;
            if (serviceCharge) serviceCharge.textContent = `‡∏ø${serviceChargeAmount}`;
            if (cartTotal) cartTotal.textContent = `‡∏ø${total}`;

            if (placeOrderBtn) {
                placeOrderBtn.disabled = foodCart.length === 0;
                if (foodCart.length === 0) {
                    placeOrderBtn.classList.add('opacity-50', 'cursor-not-allowed');
                } else {
                    placeOrderBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }
        }

        function placeOrder() {
            if (foodCart.length === 0) {
                NotificationManager.show('Your cart is empty', 'error');
                return;
            }

            // Show delivery options modal
            showDeliveryOptionsModal();
        }

        function filterFoodMenu(category) {
            currentFoodCategory = category;
            renderFoodMenu();

            // Update category button styles
            document.querySelectorAll('.food-category-btn').forEach(btn => {
                btn.classList.remove('bg-primary-500', 'text-white');
                btn.classList.add('bg-gray-100', 'text-gray-700');
            });

            const activeBtn = document.querySelector(`[data-category="${category}"]`);
            if (activeBtn) {
                activeBtn.classList.remove('bg-gray-100', 'text-gray-700');
                activeBtn.classList.add('bg-primary-500', 'text-white');
            }
        }

        function renderFoodMenu() {
            const menuContainer = document.getElementById('foodMenuItems');
            if (!menuContainer) return;

            const items = Object.entries(FoodOrderingSystem.menuItems)
                .filter(([id, item]) => currentFoodCategory === 'all' || item.category === currentFoodCategory)
                .sort(([a, itemA], [b, itemB]) => {
                    // Sort popular items first, then by price
                    if (itemA.popular && !itemB.popular) return -1;
                    if (!itemA.popular && itemB.popular) return 1;
                    return itemA.price - itemB.price;
                });

            menuContainer.innerHTML = items.map(([id, item]) => `
                <div class="menu-item-card p-4 border-2 border-gray-200 rounded-xl hover:border-primary-500 transition-all duration-200 ${!item.available ? 'opacity-50' : ''}">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center">
                            <span class="text-3xl mr-3">${item.emoji}</span>
                            <div>
                                <h5 class="font-bold text-gray-900 flex items-center">
                                    ${item.name}
                                    ${item.popular ? '<span class="ml-2 bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full">Popular</span>' : ''}
                                </h5>
                                <p class="text-sm text-gray-600 mt-1">${item.description}</p>
                                <div class="flex items-center space-x-4 mt-2 text-xs text-gray-500">
                                    <span class="flex items-center">
                                        <span class="material-symbols-outlined text-sm mr-1">schedule</span>
                                        ${item.prepTime} min
                                    </span>
                                    ${item.available ? '<span class="text-green-600">Available</span>' : '<span class="text-red-600">Unavailable</span>'}
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-lg font-bold text-primary-600">‡∏ø${item.price.toLocaleString()}</span>
                        </div>
                    </div>
                    <button
                        onclick="addToFoodCart(${id})"
                        class="w-full btn-primary py-2 text-sm ${!item.available ? 'opacity-50 cursor-not-allowed' : ''}"
                        ${!item.available ? 'disabled' : ''}
                    >
                        <span class="material-symbols-outlined text-sm mr-1">add_shopping_cart</span>
                        Add to Cart
                    </button>
                </div>
            `).join('');
        }

        function showDeliveryOptionsModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-lg w-full max-h-[90vh] overflow-y-auto">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="material-symbols-outlined text-3xl text-green-600">restaurant</span>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-2">Choose Your Dining Option</h3>
                        <p class="text-sm text-gray-600">Select how you'd like to receive your order</p>
                    </div>
                    <div class="space-y-3">
                        ${Object.entries(FoodOrderingSystem.deliveryOptions).map(([key, option]) => `
                            <div class="delivery-option p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-green-500 hover:bg-green-50 transition-all"
                                 onclick="selectDeliveryOption('${key}')">
                                <div class="flex items-start justify-between">
                                    <div class="flex items-start space-x-3">
                                        <span class="text-3xl">${option.icon}</span>
                                        <div class="flex-1">
                                            <h5 class="font-bold text-gray-900">${option.name}</h5>
                                            <p class="text-sm text-gray-600 mb-1">${option.description}</p>
                                            <div class="flex items-center space-x-2">
                                                <span class="material-symbols-outlined text-sm text-blue-600">schedule</span>
                                                <span class="text-sm text-blue-600 font-medium">${option.time}</span>
                                            </div>
                                            ${option.requiresReservation ? `
                                                <div class="mt-2 px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full inline-block">
                                                    Table reservation required
                                                </div>
                                            ` : ''}
                                            ${option.requiresTimeEstimate ? `
                                                <div class="mt-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full inline-block">
                                                    Round completion time needed
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <span class="text-lg font-bold ${option.fee > 0 ? 'text-orange-600' : 'text-green-600'}">
                                            ${option.fee > 0 ? `+‡∏ø${option.fee}` : 'FREE'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="flex space-x-3 mt-6">
                        <button onclick="closeDeliveryModal()" class="btn-secondary flex-1">Cancel</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            window.currentDeliveryModal = modal;
        }

        function selectDeliveryOption(optionKey) {
            console.log('selectDeliveryOption called with:', optionKey);
            const option = FoodOrderingSystem.deliveryOptions[optionKey];

            if (!option) {
                console.error('Option not found:', optionKey);
                NotificationManager.show('Invalid delivery option selected', 'error');
                return;
            }

            console.log('Selected option:', option);

            try {
                if (option.requiresReservation) {
                    console.log('Showing table reservation modal');
                    closeDeliveryModal();
                    showTableReservationModal(optionKey, option);
                } else if (option.requiresTimeEstimate) {
                    console.log('Showing round time modal');
                    closeDeliveryModal();
                    showRoundTimeModal(optionKey, option);
                } else {
                    console.log('Processing direct order');
                    closeDeliveryModal();
                    confirmFoodOrder(optionKey, option);
                }
            } catch (error) {
                console.error('Error in selectDeliveryOption:', error);
                closeDeliveryModal();
                NotificationManager.show('Error processing selection. Please try again.', 'error');
            }
        }

        function showTableReservationModal(optionKey, option) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-md w-full">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="material-symbols-outlined text-3xl text-orange-600">table_restaurant</span>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900">Reserve Your Table</h3>
                        <p class="text-sm text-gray-600 mt-2">Select your preferred dining time after your round</p>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Estimated Round Completion</label>
                            <select id="roundCompletionTime" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500">
                                <option value="">Select estimated time</option>
                                <option value="12:00">12:00 PM</option>
                                <option value="12:30">12:30 PM</option>
                                <option value="13:00">1:00 PM</option>
                                <option value="13:30">1:30 PM</option>
                                <option value="14:00">2:00 PM</option>
                                <option value="14:30">2:30 PM</option>
                                <option value="15:00">3:00 PM</option>
                                <option value="15:30">3:30 PM</option>
                                <option value="16:00">4:00 PM</option>
                                <option value="16:30">4:30 PM</option>
                                <option value="17:00">5:00 PM</option>
                                <option value="17:30">5:30 PM</option>
                                <option value="18:00">6:00 PM</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Party Size</label>
                            <select id="partySize" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500">
                                <option value="1">1 person</option>
                                <option value="2" selected>2 people</option>
                                <option value="3">3 people</option>
                                <option value="4">4 people</option>
                                <option value="5">5 people</option>
                                <option value="6">6 people</option>
                                <option value="8">8 people</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Seating Preference</label>
                            <select id="seatingPreference" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500">
                                <option value="indoor">Indoor dining</option>
                                <option value="outdoor">Outdoor terrace</option>
                                <option value="private">Private dining room</option>
                                <option value="bar">Bar seating</option>
                            </select>
                        </div>

                        <div class="bg-green-50 rounded-lg p-4">
                            <div class="flex items-center space-x-2 text-green-800">
                                <span class="material-symbols-outlined text-sm">info</span>
                                <span class="text-sm font-medium">Your food will be prepared fresh upon your arrival</span>
                            </div>
                        </div>
                    </div>

                    <div class="flex space-x-3 mt-6">
                        <button onclick="closeTableReservationModal()" class="btn-secondary flex-1">Back</button>
                        <button onclick="confirmTableReservation('${optionKey}')" class="btn-primary flex-1">
                            Reserve Table
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            window.currentTableReservationModal = modal;
        }

        function showRoundTimeModal(optionKey, option) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-md w-full">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="material-symbols-outlined text-3xl text-blue-600">schedule</span>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900">When Will You Finish?</h3>
                        <p class="text-sm text-gray-600 mt-2">Help us time your order perfectly</p>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Expected Completion Time</label>
                            <select id="expectedCompletionTime" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select estimated time</option>
                                <option value="30">30 minutes</option>
                                <option value="45">45 minutes</option>
                                <option value="60">1 hour</option>
                                <option value="75">1 hour 15 minutes</option>
                                <option value="90">1 hour 30 minutes</option>
                                <option value="105">1 hour 45 minutes</option>
                                <option value="120">2 hours</option>
                                <option value="135">2 hours 15 minutes</option>
                                <option value="150">2 hours 30 minutes</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Current Hole</label>
                            <select id="currentHole" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                <option value="1">Hole 1</option>
                                <option value="2">Hole 2</option>
                                <option value="3">Hole 3</option>
                                <option value="4">Hole 4</option>
                                <option value="5">Hole 5</option>
                                <option value="6">Hole 6</option>
                                <option value="7">Hole 7</option>
                                <option value="8">Hole 8</option>
                                <option value="9">Hole 9</option>
                                <option value="10">Hole 10</option>
                                <option value="11">Hole 11</option>
                                <option value="12">Hole 12</option>
                                <option value="13">Hole 13</option>
                                <option value="14">Hole 14</option>
                                <option value="15">Hole 15</option>
                                <option value="16">Hole 16</option>
                                <option value="17">Hole 17</option>
                                <option value="18">Hole 18</option>
                            </select>
                        </div>

                        <div class="bg-blue-50 rounded-lg p-4">
                            <div class="flex items-center space-x-2 text-blue-800">
                                <span class="material-symbols-outlined text-sm">timer</span>
                                <span class="text-sm font-medium">Your food will be ready when you arrive</span>
                            </div>
                        </div>
                    </div>

                    <div class="flex space-x-3 mt-6">
                        <button onclick="closeRoundTimeModal()" class="btn-secondary flex-1">Back</button>
                        <button onclick="confirmRoundTiming('${optionKey}')" class="btn-primary flex-1">
                            Confirm Timing
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            window.currentRoundTimeModal = modal;
        }

        function confirmTableReservation(optionKey) {
            console.log('confirmTableReservation called for:', optionKey);

            const completionTime = document.getElementById('roundCompletionTime').value;
            const partySize = document.getElementById('partySize').value;
            const seatingPreference = document.getElementById('seatingPreference').value;

            console.log('Reservation details:', { completionTime, partySize, seatingPreference });

            if (!completionTime) {
                NotificationManager.show('Please select your estimated completion time', 'error');
                return;
            }

            try {
                const option = FoodOrderingSystem.deliveryOptions[optionKey];
                const enhancedOption = {
                    ...option,
                    reservationDetails: {
                        time: completionTime,
                        partySize: parseInt(partySize),
                        seating: seatingPreference,
                        tableNumber: `T${Math.floor(Math.random() * 20) + 1}`
                    }
                };

                console.log('Enhanced option for reservation:', enhancedOption);
                closeTableReservationModal();
                confirmFoodOrder(optionKey, enhancedOption);
            } catch (error) {
                console.error('Error in confirmTableReservation:', error);
                closeTableReservationModal();
                NotificationManager.show('Error processing reservation. Please try again.', 'error');
            }
        }

        function confirmRoundTiming(optionKey) {
            console.log('confirmRoundTiming called for:', optionKey);

            const completionTime = document.getElementById('expectedCompletionTime').value;
            const currentHole = document.getElementById('currentHole').value;

            console.log('Round timing details:', { completionTime, currentHole });

            if (!completionTime || !currentHole) {
                NotificationManager.show('Please select both completion time and current hole', 'error');
                return;
            }

            try {
                const option = FoodOrderingSystem.deliveryOptions[optionKey];
                const enhancedOption = {
                    ...option,
                    timingDetails: {
                        estimatedMinutes: parseInt(completionTime),
                        currentHole: parseInt(currentHole),
                        readyTime: new Date(Date.now() + parseInt(completionTime) * 60000)
                    }
                };

                console.log('Enhanced option for timing:', enhancedOption);
                closeRoundTimeModal();
                confirmFoodOrder(optionKey, enhancedOption);
            } catch (error) {
                console.error('Error in confirmRoundTiming:', error);
                closeRoundTimeModal();
                NotificationManager.show('Error processing timing. Please try again.', 'error');
            }
        }

        function closeTableReservationModal() {
            if (window.currentTableReservationModal) {
                document.body.removeChild(window.currentTableReservationModal);
                window.currentTableReservationModal = null;
            }
        }

        function closeRoundTimeModal() {
            if (window.currentRoundTimeModal) {
                document.body.removeChild(window.currentRoundTimeModal);
                window.currentRoundTimeModal = null;
            }
        }

        function closeDeliveryModal() {
            if (window.currentDeliveryModal) {
                document.body.removeChild(window.currentDeliveryModal);
                window.currentDeliveryModal = null;
            }
        }

        function confirmFoodOrder(deliveryType, deliveryOption) {
            console.log('confirmFoodOrder called with:', { deliveryType, deliveryOption });
            LoadingManager.show('Processing your order...');

            try {
                setTimeout(() => {
                    try {
                        console.log('Processing order, cart:', foodCart);

                        const subtotal = foodCart.reduce((total, item) => total + (item.price * item.quantity), 0);
                        const serviceCharge = Math.round(subtotal * 0.1);
                        const deliveryFee = deliveryOption.fee || 0;
                        const total = subtotal + serviceCharge + deliveryFee;

                        const orderId = 'FO' + Date.now().toString().slice(-6);
                        const orderTime = new Date();

                        // Create comprehensive order object
                        const orderDetails = {
                            id: orderId,
                            orderTime: orderTime.toISOString(),
                            customerName: AppState.currentUser?.name || 'Guest',
                            customerType: AppState.currentUser?.role || 'guest',
                            tableNumber: getTableNumber(),
                            items: foodCart.map(item => ({
                                name: item.name,
                                quantity: item.quantity,
                                unitPrice: item.price,
                                totalPrice: item.price * item.quantity,
                                emoji: item.emoji,
                                prepTime: item.prepTime || 15
                            })),
                            subtotal: subtotal,
                            serviceCharge: serviceCharge,
                            deliveryFee: deliveryFee,
                            total: total,
                            status: 'confirmed',
                            deliveryType: deliveryType,
                            deliveryOption: deliveryOption,
                            estimatedTime: calculateEstimatedTime(foodCart, deliveryOption),
                            progress: {
                                confirmed: { time: orderTime.toISOString(), completed: true },
                                preparing: { time: null, completed: false },
                                cooking: { time: null, completed: false },
                                ready: { time: null, completed: false },
                                delivered: { time: null, completed: false }
                            },
                            paymentMethod: 'Room Charge'
                        };

                        // Initialize order history if needed
                        if (!FoodOrderingSystem.orderHistory) {
                            FoodOrderingSystem.orderHistory = [];
                        }

                        // Add to order history
                        FoodOrderingSystem.orderHistory.unshift(orderDetails);

                        console.log('Order created:', orderDetails);

                        // Show receipt and start order tracking
                        try {
                            console.log('Showing order receipt...');
                            showOrderReceipt(orderDetails);
                            console.log('Starting order tracking...');
                            startOrderTracking(orderId);
                        } catch (receiptError) {
                            console.error('Error showing receipt or starting tracking:', receiptError);
                            // Still continue with clearing cart and hiding loader
                            NotificationManager.show(`Order ${orderId} placed successfully! Total: ‡∏ø${orderDetails.total}`, 'success');
                        }

                        // Clear cart
                        foodCart = [];
                        updateFoodCartDisplay();
                        LoadingManager.hide();

                        // Update status tab if it exists
                        setTimeout(() => {
                            updateOrderStatusTab();
                        }, 100);

                        console.log('Order processing completed successfully');
                    } catch (innerError) {
                        console.error('Error in order processing:', innerError);
                        LoadingManager.hide();
                        NotificationManager.show('Error processing order. Please try again.', 'error');
                    }
                }, 2000);
            } catch (error) {
                console.error('Error in confirmFoodOrder:', error);
                LoadingManager.hide();
                NotificationManager.show('Error processing order. Please try again.', 'error');
            }
        }

        function getTableNumber() {
            try {
                // Generate table number based on user or location
                if (AppState.currentUser && AppState.currentUser.role === 'golfer') {
                    return 'Table ' + (Math.floor(Math.random() * 20) + 1);
                }
                return 'Mobile Order';
            } catch (error) {
                console.error('Error generating table number:', error);
                return 'Table ' + (Math.floor(Math.random() * 20) + 1);
            }
        }

        function calculateEstimatedTime(cartItems, deliveryOption) {
            try {
                if (!cartItems || cartItems.length === 0) {
                    console.log('No cart items, using default time');
                    return 20; // Default 20 minutes
                }

                const prepTimes = cartItems.map(item => item.prepTime || 15);
                const maxPrepTime = Math.max(...prepTimes);
                const baseTime = maxPrepTime + (deliveryOption.baseTime || 0);
                const estimatedTime = baseTime + Math.floor(Math.random() * 10);

                console.log('Calculated estimated time:', {
                    cartItems: cartItems.length,
                    maxPrepTime,
                    baseTime: deliveryOption.baseTime || 0,
                    estimatedTime
                });

                return estimatedTime;
            } catch (error) {
                console.error('Error calculating estimated time:', error);
                return 25; // Fallback time
            }
        }

        function showOrderReceipt(order) {
            // Close any existing modals first
            closeReceiptModal();

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.onclick = (e) => {
                if (e.target === modal) closeReceiptModal();
            };
            modal.innerHTML = `
                <div class="bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
                    <!-- Receipt Header -->
                    <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-t-2xl relative">
                        <button onclick="closeReceiptModal()" class="absolute top-4 right-4 text-white hover:text-gray-200 w-8 h-8 flex items-center justify-center rounded-full hover:bg-white hover:bg-opacity-20">
                            <span class="material-symbols-outlined">close</span>
                        </button>
                        <div class="text-center">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-3">
                                <span class="material-symbols-outlined text-3xl">receipt</span>
                            </div>
                            <h3 class="text-xl font-bold">Order Receipt</h3>
                            <p class="text-green-100">Order #${order.id}</p>
                        </div>
                    </div>

                    <!-- Receipt Body -->
                    <div class="p-6">
                        <!-- Order Details -->
                        <div class="mb-6">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-gray-600">Customer:</span>
                                <span class="font-semibold">${order.customerName}</span>
                            </div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-gray-600">Table:</span>
                                <span class="font-semibold">${order.tableNumber}</span>
                            </div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-gray-600">Date & Time:</span>
                                <span class="font-semibold">${new Date(order.orderTime).toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-gray-600">Delivery:</span>
                                <span class="font-semibold">${order.deliveryOption.name}</span>
                            </div>
                        </div>

                        <!-- Order Items -->
                        <div class="border-t border-b py-4 mb-4">
                            <h4 class="font-bold text-gray-900 mb-3">Order Items</h4>
                            <div class="space-y-2">
                                ${order.items.map(item => `
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-2">
                                            <span>${item.emoji}</span>
                                            <span class="font-medium">${item.name}</span>
                                            <span class="text-gray-500">√ó${item.quantity}</span>
                                        </div>
                                        <span class="font-semibold">‡∏ø${item.totalPrice}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Order Summary -->
                        <div class="space-y-2 mb-6">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Subtotal:</span>
                                <span class="font-semibold">‡∏ø${order.subtotal}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Service Charge (10%):</span>
                                <span class="font-semibold">‡∏ø${order.serviceCharge}</span>
                            </div>
                            ${order.deliveryFee > 0 ? `
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Delivery Fee:</span>
                                    <span class="font-semibold">‡∏ø${order.deliveryFee}</span>
                                </div>
                            ` : ''}
                            <div class="flex justify-between text-lg font-bold border-t pt-2">
                                <span>Total Amount:</span>
                                <span class="text-green-600">‡∏ø${order.total}</span>
                            </div>
                        </div>

                        <!-- Estimated Time -->
                        <div class="bg-blue-50 rounded-lg p-4 mb-6">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="material-symbols-outlined text-blue-600">schedule</span>
                                <span class="font-semibold text-blue-800">Estimated Preparation Time</span>
                            </div>
                            <p class="text-blue-700 font-bold text-lg">${order.estimatedTime} minutes</p>
                            <p class="text-blue-600 text-sm">${order.deliveryOption.time}</p>
                        </div>

                        <!-- Action Buttons -->
                        <div class="space-y-3">
                            <button onclick="trackOrder('${order.id}')" class="w-full btn-primary">
                                <span class="material-symbols-outlined text-sm mr-2">track_changes</span>
                                Track Order Status
                            </button>
                            <button onclick="printReceipt('${order.id}')" class="w-full btn-secondary">
                                <span class="material-symbols-outlined text-sm mr-2">print</span>
                                Print Receipt
                            </button>
                            <button onclick="closeReceiptModal()" class="w-full btn-outline">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;

            // Add ESC key handler
            const handleEscKey = (e) => {
                if (e.key === 'Escape') {
                    closeReceiptModal();
                    document.removeEventListener('keydown', handleEscKey);
                }
            };
            document.addEventListener('keydown', handleEscKey);

            document.body.appendChild(modal);
            window.currentReceiptModal = modal;

            console.log('Order receipt modal opened');
        }

        function closeReceiptModal() {
            try {
                // Find and remove modal by class name as backup
                const modals = document.querySelectorAll('.fixed.inset-0');
                modals.forEach(modal => {
                    if (modal.innerHTML.includes('Order Receipt') || modal.innerHTML.includes('receipt')) {
                        modal.remove();
                    }
                });

                // Also use the window reference if it exists
                if (window.currentReceiptModal) {
                    if (window.currentReceiptModal.parentNode) {
                        window.currentReceiptModal.parentNode.removeChild(window.currentReceiptModal);
                    }
                    window.currentReceiptModal = null;
                }

                console.log('Receipt modal closed successfully');
            } catch (error) {
                console.error('Error closing receipt modal:', error);
                // Force remove any receipt modals
                document.querySelectorAll('[class*="fixed"][class*="inset-0"]').forEach(el => {
                    if (el.innerHTML.includes('Order Receipt')) {
                        el.remove();
                    }
                });
            }
        }

        // Emergency modal closer - can be called from console
        window.forceCloseAllModals = function() {
            console.log('Force closing all modals...');

            // Remove all fixed positioned elements that look like modals
            const possibleModals = document.querySelectorAll('.fixed');
            possibleModals.forEach(el => {
                if (el.classList.contains('inset-0') ||
                    el.style.position === 'fixed' ||
                    el.innerHTML.includes('modal') ||
                    el.innerHTML.includes('Modal') ||
                    el.innerHTML.includes('Order Receipt')) {
                    console.log('Removing modal:', el);
                    el.remove();
                }
            });

            // Clear modal references
            window.currentReceiptModal = null;
            window.currentTrackingModal = null;
            window.currentOrderHistoryModal = null;

            console.log('All modals force closed');
        };

        function startOrderTracking(orderId) {
            // Simulate order progress
            const order = FoodOrderingSystem.orderHistory.find(o => o.id === orderId);
            if (!order) return;

            // Start preparing after 2 minutes
            setTimeout(() => {
                order.status = 'preparing';
                order.progress.preparing = { time: new Date().toISOString(), completed: true };
                NotificationManager.show(`Order ${orderId}: Kitchen has started preparing your order`, 'info');
                updateOrderTrackingUI(orderId);
            }, 2 * 60 * 1000);

            // Start cooking after 5 minutes
            setTimeout(() => {
                order.status = 'cooking';
                order.progress.cooking = { time: new Date().toISOString(), completed: true };
                NotificationManager.show(`Order ${orderId}: Your order is now being cooked`, 'info');
                updateOrderTrackingUI(orderId);
            }, 5 * 60 * 1000);

            // Ready after estimated time
            setTimeout(() => {
                order.status = 'ready';
                order.progress.ready = { time: new Date().toISOString(), completed: true };
                NotificationManager.show(`Order ${orderId}: Your order is ready for ${order.deliveryType}!`, 'success');
                updateOrderTrackingUI(orderId);
            }, order.estimatedTime * 60 * 1000);

            // Delivered/Complete after additional time
            setTimeout(() => {
                order.status = 'delivered';
                order.progress.delivered = { time: new Date().toISOString(), completed: true };
                NotificationManager.show(`Order ${orderId}: Order completed! Enjoy your meal!`, 'success');
                updateOrderTrackingUI(orderId);
            }, (order.estimatedTime + 5) * 60 * 1000);
        }

        function trackOrder(orderId) {
            closeReceiptModal();
            const order = FoodOrderingSystem.orderHistory.find(o => o.id === orderId);
            if (!order) {
                NotificationManager.show('Order not found', 'error');
                return;
            }

            showOrderTrackingModal(order);
        }

        function showOrderTrackingModal(order) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';

            const progressSteps = [
                { key: 'confirmed', label: 'Order Confirmed', icon: 'check_circle' },
                { key: 'preparing', label: 'Preparing', icon: 'restaurant' },
                { key: 'cooking', label: 'Cooking', icon: 'local_fire_department' },
                { key: 'ready', label: 'Ready', icon: 'done_all' },
                { key: 'delivered', label: 'Delivered', icon: 'delivery_dining' }
            ];

            modal.innerHTML = `
                <div class="bg-white rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto">
                    <!-- Header -->
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-t-2xl">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-3">
                                <span class="material-symbols-outlined text-3xl">track_changes</span>
                            </div>
                            <h3 class="text-xl font-bold">Track Your Order</h3>
                            <p class="text-blue-100">Order #${order.id}</p>
                        </div>
                    </div>

                    <!-- Order Details -->
                    <div class="p-6">
                        <div class="bg-gray-50 rounded-lg p-4 mb-6">
                            <h4 class="font-bold text-gray-900 mb-2">Order Summary</h4>
                            <div class="text-sm text-gray-600 space-y-1">
                                <p><strong>Customer:</strong> ${order.customerName}</p>
                                <p><strong>Table:</strong> ${order.tableNumber}</p>
                                <p><strong>Total:</strong> <span class="font-bold text-green-600">‡∏ø${order.total}</span></p>
                                <p><strong>Estimated Time:</strong> ${order.estimatedTime} minutes</p>
                            </div>
                        </div>

                        <!-- Progress Tracking -->
                        <div class="mb-6">
                            <h4 class="font-bold text-gray-900 mb-4">Order Progress</h4>
                            <div class="space-y-4">
                                ${progressSteps.map((step, index) => {
                                    const isCompleted = order.progress[step.key].completed;
                                    const isActive = !isCompleted &&
                                        (index === 0 || order.progress[progressSteps[index - 1].key].completed);
                                    const time = order.progress[step.key].time;

                                    return `
                                        <div class="flex items-center space-x-4 ${isCompleted ? 'text-green-600' : isActive ? 'text-blue-600' : 'text-gray-400'}">
                                            <div class="w-10 h-10 rounded-full flex items-center justify-center ${
                                                isCompleted ? 'bg-green-100' : isActive ? 'bg-blue-100 animate-pulse' : 'bg-gray-100'
                                            }">
                                                <span class="material-symbols-outlined text-lg">${step.icon}</span>
                                            </div>
                                            <div class="flex-1">
                                                <p class="font-semibold">${step.label}</p>
                                                ${time ? `<p class="text-xs opacity-70">${new Date(time).toLocaleTimeString()}</p>` :
                                                  isActive ? '<p class="text-xs opacity-70">In progress...</p>' :
                                                  '<p class="text-xs opacity-70">Pending</p>'}
                                            </div>
                                            ${isCompleted ? '<span class="material-symbols-outlined text-green-500">check</span>' : ''}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>

                        <!-- Estimated Completion -->
                        ${order.status !== 'delivered' ? `
                            <div class="bg-orange-50 rounded-lg p-4 mb-6">
                                <div class="flex items-center space-x-2 mb-2">
                                    <span class="material-symbols-outlined text-orange-600">schedule</span>
                                    <span class="font-semibold text-orange-800">Estimated Completion</span>
                                </div>
                                <p class="text-orange-700 font-bold">${getRemainingTime(order)} remaining</p>
                            </div>
                        ` : `
                            <div class="bg-green-50 rounded-lg p-4 mb-6">
                                <div class="flex items-center space-x-2 mb-2">
                                    <span class="material-symbols-outlined text-green-600">check_circle</span>
                                    <span class="font-semibold text-green-800">Order Complete</span>
                                </div>
                                <p class="text-green-700">Enjoy your meal!</p>
                            </div>
                        `}

                        <!-- Order Items -->
                        <div class="border-t pt-4">
                            <h4 class="font-bold text-gray-900 mb-3">Your Items</h4>
                            <div class="space-y-2">
                                ${order.items.map(item => `
                                    <div class="flex items-center justify-between py-2">
                                        <div class="flex items-center space-x-2">
                                            <span>${item.emoji}</span>
                                            <span class="font-medium text-sm">${item.name}</span>
                                            <span class="text-gray-500 text-sm">√ó${item.quantity}</span>
                                        </div>
                                        <span class="font-semibold text-sm">‡∏ø${item.totalPrice}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="mt-6 space-y-3">
                            <button onclick="refreshOrderStatus('${order.id}')" class="w-full btn-primary">
                                <span class="material-symbols-outlined text-sm mr-2">refresh</span>
                                Refresh Status
                            </button>
                            <button onclick="viewOrderHistory()" class="w-full btn-secondary">
                                <span class="material-symbols-outlined text-sm mr-2">history</span>
                                View Order History
                            </button>
                            <button onclick="closeTrackingModal()" class="w-full btn-outline">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            window.currentTrackingModal = modal;

            // Auto-refresh every 30 seconds
            window.trackingInterval = setInterval(() => {
                refreshOrderStatus(order.id, false);
            }, 30000);
        }

        function getRemainingTime(order) {
            const orderTime = new Date(order.orderTime);
            const estimatedCompletionTime = new Date(orderTime.getTime() + order.estimatedTime * 60000);
            const now = new Date();
            const remainingMs = estimatedCompletionTime - now;

            if (remainingMs <= 0) return "Any moment now";

            const remainingMinutes = Math.ceil(remainingMs / 60000);
            return `${remainingMinutes} minute${remainingMinutes !== 1 ? 's' : ''}`;
        }

        function refreshOrderStatus(orderId, showNotification = true) {
            const order = FoodOrderingSystem.orderHistory.find(o => o.id === orderId);
            if (!order) return;

            if (showNotification) {
                NotificationManager.show('Refreshing order status...', 'info');
            }

            // If tracking modal is open, refresh it
            if (window.currentTrackingModal) {
                closeTrackingModal();
                setTimeout(() => showOrderTrackingModal(order), 100);
            }
        }

        function closeTrackingModal() {
            if (window.currentTrackingModal) {
                document.body.removeChild(window.currentTrackingModal);
                window.currentTrackingModal = null;
            }
            if (window.trackingInterval) {
                clearInterval(window.trackingInterval);
                window.trackingInterval = null;
            }
        }

        function updateOrderTrackingUI(orderId) {
            // Update any tracking UI if visible
            if (window.currentTrackingModal) {
                const order = FoodOrderingSystem.orderHistory.find(o => o.id === orderId);
                if (order) {
                    refreshOrderStatus(orderId, false);
                }
            }

            // Always update the status tab when order tracking changes
            setTimeout(() => {
                updateOrderStatusTab();
            }, 100);
        }

        function printReceipt(orderId) {
            const order = FoodOrderingSystem.orderHistory.find(o => o.id === orderId);
            if (!order) return;

            // Create printable receipt
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Receipt - Order #${order.id}</title>
                    <style>
                        body { font-family: 'Courier New', monospace; max-width: 300px; margin: 0 auto; padding: 20px; }
                        .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px; }
                        .line-item { display: flex; justify-content: space-between; margin: 5px 0; }
                        .total { border-top: 1px solid #000; padding-top: 10px; margin-top: 10px; font-weight: bold; }
                        .footer { text-align: center; margin-top: 20px; font-size: 12px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h2>MciPro Golf Course</h2>
                        <p>Order Receipt</p>
                        <p>Order #${order.id}</p>
                        <p>${new Date(order.orderTime).toLocaleString()}</p>
                    </div>

                    <div class="line-item">
                        <span>Customer:</span>
                        <span>${order.customerName}</span>
                    </div>
                    <div class="line-item">
                        <span>Table:</span>
                        <span>${order.tableNumber}</span>
                    </div>
                    <hr>

                    ${order.items.map(item => `
                        <div class="line-item">
                            <span>${item.name} x${item.quantity}</span>
                            <span>‡∏ø${item.totalPrice}</span>
                        </div>
                    `).join('')}

                    <div class="total">
                        <div class="line-item">
                            <span>Subtotal:</span>
                            <span>‡∏ø${order.subtotal}</span>
                        </div>
                        <div class="line-item">
                            <span>Service Charge:</span>
                            <span>‡∏ø${order.serviceCharge}</span>
                        </div>
                        ${order.deliveryFee > 0 ? `
                            <div class="line-item">
                                <span>Delivery Fee:</span>
                                <span>‡∏ø${order.deliveryFee}</span>
                            </div>
                        ` : ''}
                        <div class="line-item" style="font-size: 18px;">
                            <span>TOTAL:</span>
                            <span>‡∏ø${order.total}</span>
                        </div>
                    </div>

                    <div class="footer">
                        <p>Thank you for dining with us!</p>
                        <p>MciPro Golf Course Restaurant</p>
                        <p>Est. completion: ${order.estimatedTime} minutes</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function viewOrderHistory() {
            closeTrackingModal();
            showOrderHistoryModal();
        }

        function showOrderHistoryModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col">
                    <!-- Header -->
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 flex-shrink-0">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-xl font-bold">Order History</h3>
                                <p class="text-purple-100">Your recent food orders</p>
                            </div>
                            <button onclick="closeOrderHistoryModal()" class="text-white hover:text-purple-200">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                        </div>
                    </div>

                    <!-- Order History List -->
                    <div class="flex-1 overflow-y-auto p-6">
                        ${FoodOrderingSystem.orderHistory.length > 0 ? `
                            <div class="space-y-4">
                                ${FoodOrderingSystem.orderHistory.map(order => `
                                    <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                                        <div class="flex items-center justify-between mb-3">
                                            <div>
                                                <h4 class="font-bold text-gray-900">Order #${order.id}</h4>
                                                <p class="text-sm text-gray-600">${new Date(order.orderTime).toLocaleString()}</p>
                                            </div>
                                            <div class="text-right">
                                                <span class="text-lg font-bold text-green-600">‡∏ø${order.total}</span>
                                                <div class="mt-1">
                                                    <span class="px-2 py-1 text-xs rounded-full ${getStatusBadgeClass(order.status)}">
                                                        ${order.status.charAt(0).toUpperCase() + order.status.slice(1)}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="text-sm text-gray-600 mb-3">
                                            <p><strong>Items:</strong> ${order.items.map(item => `${item.name} (√ó${item.quantity})`).join(', ')}</p>
                                            <p><strong>Delivery:</strong> ${order.deliveryOption.name}</p>
                                        </div>

                                        <div class="flex space-x-2">
                                            <button onclick="trackOrder('${order.id}')" class="btn-sm btn-primary">
                                                <span class="material-symbols-outlined text-sm mr-1">track_changes</span>
                                                Track
                                            </button>
                                            <button onclick="printReceipt('${order.id}')" class="btn-sm btn-secondary">
                                                <span class="material-symbols-outlined text-sm mr-1">print</span>
                                                Receipt
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="text-center py-12 text-gray-500">
                                <span class="material-symbols-outlined text-6xl mb-4 block">restaurant</span>
                                <p class="text-lg mb-2">No orders yet</p>
                                <p class="text-sm">Your food orders will appear here</p>
                            </div>
                        `}
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            window.currentOrderHistoryModal = modal;
        }

        function getStatusBadgeClass(status) {
            const classes = {
                'confirmed': 'bg-blue-100 text-blue-800',
                'preparing': 'bg-yellow-100 text-yellow-800',
                'cooking': 'bg-orange-100 text-orange-800',
                'ready': 'bg-green-100 text-green-800',
                'delivered': 'bg-gray-100 text-gray-800'
            };
            return classes[status] || 'bg-gray-100 text-gray-800';
        }

        // Alias for order status tab compatibility
        function getStatusClass(status) {
            return getStatusBadgeClass(status);
        }

        function closeOrderHistoryModal() {
            if (window.currentOrderHistoryModal) {
                document.body.removeChild(window.currentOrderHistoryModal);
                window.currentOrderHistoryModal = null;
            }
        }

        function showOrderHistory() {
            const historyContainer = document.getElementById('orderHistoryContainer');
            if (!historyContainer) return;

            historyContainer.innerHTML = FoodOrderingSystem.orderHistory.map(order => `
                <div class="order-history-item p-4 border border-gray-200 rounded-xl">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h5 class="font-bold text-gray-900">Order ${order.id}</h5>
                            <p class="text-sm text-gray-600">${order.date}</p>
                        </div>
                        <span class="order-status ${order.status === 'delivered' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'} px-2 py-1 rounded-full text-xs font-medium">
                            ${order.status}
                        </span>
                    </div>
                    <div class="text-sm text-gray-600 mb-2">
                        ${order.items.join(', ')}
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="font-bold text-primary-600">‡∏ø${order.total.toLocaleString()}</span>
                        ${order.status === 'preparing' ? '<button class="btn-secondary text-xs px-3 py-1">Track Order</button>' : ''}
                    </div>
                </div>
            `).join('');
        }

        // Golf Course Database for Caddy Promotions
        const GolfCourseDatabase = {
            courses: [
                {
                    id: 'pattaya-golf',
                    name: 'Pattaya Golf Club',
                    location: 'Pattaya, Thailand',
                    rating: 4.8,
                    holes: 18,
                    type: 'Championship',
                    description: 'Premier championship golf course with ocean views',
                    amenities: ['Pro Shop', 'Restaurant', 'Driving Range', 'Club House'],
                    greenFees: { weekday: 2500, weekend: 3200 },
                    image: 'üèåÔ∏è‚Äç‚ôÇÔ∏è',
                    featured: true
                },
                {
                    id: 'thai-country-club',
                    name: 'Thai Country Club',
                    location: 'Bangkok, Thailand',
                    rating: 4.9,
                    holes: 18,
                    type: 'Luxury',
                    description: 'Exclusive luxury golf experience in Bangkok',
                    amenities: ['Spa', 'Fine Dining', 'Caddy Academy', 'VIP Lounge'],
                    greenFees: { weekday: 4500, weekend: 5800 },
                    image: '‚õ≥',
                    featured: true
                },
                {
                    id: 'siam-plantation',
                    name: 'Siam Plantation Golf',
                    location: 'Pattaya, Thailand',
                    rating: 4.6,
                    holes: 27,
                    type: 'Resort',
                    description: 'Beautiful resort course with tropical landscape',
                    amenities: ['Resort', 'Pool', 'Spa', 'Multiple Restaurants'],
                    greenFees: { weekday: 3200, weekend: 4000 },
                    image: 'üå¥',
                    featured: false
                },
                {
                    id: 'royal-garden',
                    name: 'Royal Garden Golf Club',
                    location: 'Hua Hin, Thailand',
                    rating: 4.7,
                    holes: 18,
                    type: 'Royal',
                    description: 'Royal golf course with traditional Thai design',
                    amenities: ['Royal Clubhouse', 'Traditional Cuisine', 'Cultural Tours'],
                    greenFees: { weekday: 3800, weekend: 4600 },
                    image: 'üëë',
                    featured: true
                }
            ],

            getRandomCourse() {
                const featuredCourses = this.courses.filter(c => c.featured);
                return featuredCourses[Math.floor(Math.random() * featuredCourses.length)];
            },

            getCourseById(id) {
                return this.courses.find(c => c.id === id);
            }
        };

        // ===== ORDER STATUS TAB FUNCTIONS =====

        function updateOrderStatusTab() {
            const activeOrdersList = document.getElementById('activeOrdersList');
            const orderHistoryList = document.getElementById('orderHistoryList');
            const activeOrdersCount = document.getElementById('activeOrdersCount');

            if (!FoodOrderingSystem.orderHistory) {
                FoodOrderingSystem.orderHistory = [];
            }

            // Filter active orders (not delivered)
            const activeOrders = FoodOrderingSystem.orderHistory.filter(order =>
                order.status !== 'delivered' && order.status !== 'cancelled'
            );

            // Update active orders count
            if (activeOrdersCount) {
                activeOrdersCount.textContent = `${activeOrders.length} active order${activeOrders.length !== 1 ? 's' : ''}`;
            }

            // Update badges
            const activeOrdersBadge = document.getElementById('activeOrdersBadge');
            const orderStatusTabBadge = document.getElementById('orderStatusTabBadge');

            if (activeOrdersBadge) {
                if (activeOrders.length > 0) {
                    activeOrdersBadge.textContent = activeOrders.length;
                    activeOrdersBadge.style.display = 'inline';
                } else {
                    activeOrdersBadge.style.display = 'none';
                }
            }

            if (orderStatusTabBadge) {
                if (activeOrders.length > 0) {
                    orderStatusTabBadge.textContent = activeOrders.length;
                    orderStatusTabBadge.style.display = 'flex';
                } else {
                    orderStatusTabBadge.style.display = 'none';
                }
            }

            // Update active orders list
            if (activeOrdersList) {
                if (activeOrders.length === 0) {
                    activeOrdersList.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <span class="material-symbols-outlined text-4xl mb-2 opacity-50">receipt_long</span>
                            <p>No active orders</p>
                            <button onclick="showGolferTab('food', event)" class="mt-4 bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700">
                                Order Food & Drinks
                            </button>
                        </div>
                    `;
                } else {
                    activeOrdersList.innerHTML = activeOrders.map(order => createOrderCard(order, true)).join('');
                }
            }

            // Update order history (last 10 orders)
            if (orderHistoryList) {
                const recentHistory = FoodOrderingSystem.orderHistory.slice(0, 10);
                if (recentHistory.length === 0) {
                    orderHistoryList.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <span class="material-symbols-outlined text-4xl mb-2 opacity-50">history</span>
                            <p>No order history</p>
                        </div>
                    `;
                } else {
                    orderHistoryList.innerHTML = recentHistory.map(order => createOrderCard(order, false)).join('');
                }

                // Update order history badge
                const orderHistoryBadge = document.getElementById('orderHistoryBadge');
                if (orderHistoryBadge) {
                    if (recentHistory.length > 0) {
                        orderHistoryBadge.textContent = recentHistory.length;
                        orderHistoryBadge.style.display = 'inline';
                    } else {
                        orderHistoryBadge.style.display = 'none';
                    }
                }
            }
        }

        function createOrderCard(order, isActive) {
            const statusColor = getStatusClass(order.status);
            const progress = getOrderProgress(order);

            return `
                <div class="border border-gray-200 rounded-xl p-4 ${isActive ? 'bg-blue-50' : 'bg-white'} hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center">
                                <span class="material-symbols-outlined text-primary-600">restaurant</span>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">Order #${order.id}</h4>
                                <p class="text-sm text-gray-500">${new Date(order.orderTime).toLocaleString()}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusColor}">
                                ${order.status.toUpperCase()}
                            </span>
                            <p class="text-sm font-semibold text-gray-900 mt-1">‡∏ø${order.total}</p>
                        </div>
                    </div>

                    <!-- Order Items -->
                    <div class="mb-3">
                        <div class="text-sm text-gray-600 space-y-1">
                            ${order.items.slice(0, 2).map(item =>
                                `<div class="flex justify-between">
                                    <span>${item.emoji} ${item.name} x${item.quantity}</span>
                                    <span>‡∏ø${item.totalPrice}</span>
                                </div>`
                            ).join('')}
                            ${order.items.length > 2 ? `<p class="text-xs text-gray-500">+${order.items.length - 2} more items</p>` : ''}
                        </div>
                    </div>

                    ${isActive ? `
                        <!-- Progress Bar -->
                        <div class="mb-3">
                            <div class="flex items-center justify-between text-xs text-gray-600 mb-1">
                                <span>Progress</span>
                                <span>${progress}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-primary-600 h-2 rounded-full transition-all duration-300" style="width: ${progress}%"></div>
                            </div>
                        </div>

                        <!-- Estimated Time -->
                        <div class="text-sm text-gray-600 mb-3">
                            <span class="material-symbols-outlined text-xs">schedule</span>
                            ${order.deliveryOption?.name || 'Course Delivery'} ‚Ä¢ ${order.estimatedTime || '15-20 min'}
                        </div>
                    ` : ''}

                    <!-- Actions -->
                    <div class="flex space-x-2">
                        <button onclick="showOrderDetails('${order.id}')" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-lg text-sm font-medium">
                            View Details
                        </button>
                        ${isActive ? `
                            <button onclick="trackOrder('${order.id}')" class="flex-1 bg-primary-600 hover:bg-primary-700 text-white px-3 py-2 rounded-lg text-sm font-medium">
                                Track Order
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function getOrderProgress(order) {
            if (!order.progress) return 0;

            const stages = ['confirmed', 'preparing', 'cooking', 'ready', 'delivered'];
            let completed = 0;

            stages.forEach(stage => {
                if (order.progress[stage]?.completed) {
                    completed++;
                }
            });

            return Math.round((completed / stages.length) * 100);
        }

        function showOrderDetails(orderId) {
            const order = FoodOrderingSystem.orderHistory.find(o => o.id === orderId);
            if (!order) return;

            // Show the existing order receipt modal
            showOrderReceipt(order);
        }

        function trackOrder(orderId) {
            const order = FoodOrderingSystem.orderHistory.find(o => o.id === orderId);
            if (!order) return;

            // Show the existing order tracking UI
            showOrderReceipt(order);

            // Automatically scroll to tracking section
            setTimeout(() => {
                const trackingElement = document.querySelector('.order-tracking-status');
                if (trackingElement) {
                    trackingElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 300);
        }

        function clearOrderHistory() {
            if (confirm('Are you sure you want to clear your order history? This action cannot be undone.')) {
                FoodOrderingSystem.orderHistory = [];
                updateOrderStatusTab();
                NotificationManager.show('Order history cleared', 'info');
            }
        }

        function contactKitchen() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 w-full max-w-md mx-4">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">Contact Kitchen</h3>
                    <div class="space-y-4">
                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                            <div class="flex items-center space-x-3">
                                <span class="material-symbols-outlined text-orange-600">restaurant</span>
                                <div>
                                    <p class="font-semibold text-orange-800">Kitchen Direct Line</p>
                                    <p class="text-orange-700">+66-2-555-0101</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-center space-x-3">
                                <span class="material-symbols-outlined text-blue-600">headset_mic</span>
                                <div>
                                    <p class="font-semibold text-blue-800">Food Service Manager</p>
                                    <p class="text-blue-700">+66-2-555-0102</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <div class="flex items-center space-x-3">
                                <span class="material-symbols-outlined text-green-600">chat</span>
                                <div>
                                    <p class="font-semibold text-green-800">Send Message</p>
                                    <button onclick="openKitchenChat()" class="text-green-700 hover:text-green-800 text-sm underline">
                                        Chat with kitchen staff
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex space-x-3 mt-6">
                        <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-medium">
                            Close
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        function openKitchenChat() {
            // Close contact modal
            document.querySelector('.fixed.inset-0').remove();

            // Switch to chat and open kitchen room
            showGolferTab('overview', event);
            setTimeout(() => {
                if (typeof ChatSystem !== 'undefined') {
                    ChatSystem.showChatInterface();
                    // Try to open kitchen/food chat room
                    const kitchenRoom = Object.keys(ChatSystem.chatRooms).find(room =>
                        room.includes('kitchen') || room.includes('food')
                    );
                    if (kitchenRoom) {
                        ChatSystem.openChatRoom(kitchenRoom);
                    }
                }
            }, 500);
        }

        // Profile Management System
        const ProfileSystem = {
            profiles: {
                golfer: {
                    template: {
                        personalInfo: {
                            firstName: '',
                            lastName: '',
                            nickname: '',
                            dateOfBirth: '',
                            nationality: 'Thai',
                            phone: '',
                            email: '',
                            address: '',
                            emergencyContact: ''
                        },
                        golfInfo: {
                            handicap: '18',
                            memberSince: new Date().toISOString().split('T')[0],
                            homeClub: '',
                            clubAffiliation: '',
                            playingStyle: '',
                            favoriteClubs: [],
                            golfGoals: '',
                            experienceLevel: 'Intermediate'
                        },
                        preferences: {
                            preferredTeeTime: 'Morning',
                            preferredCaddyType: 'Professional',
                            dietaryRestrictions: '',
                            specialRequests: '',
                            communicationLanguage: 'English',
                            notifications: true
                        },
                        media: {
                            profilePhoto: '',
                            golfPhotos: [],
                            achievements: []
                        },
                        privacy: {
                            profileVisibility: 'members',
                            showHandicap: true,
                            showStats: true,
                            allowMessages: true
                        }
                    }
                },
                caddie: {
                    template: {
                        personalInfo: {
                            firstName: '',
                            lastName: '',
                            nickname: '',
                            dateOfBirth: '',
                            nationality: '',
                            phone: '',
                            email: '',
                            address: '',
                            emergencyContact: ''
                        },
                        professionalInfo: {
                            licenseNumber: '',
                            experience: '',
                            homeClub: '',
                            specialties: [],
                            languages: [],
                            certifications: [],
                            workingHours: '',
                            availability: 'available'
                        },
                        skills: {
                            courseKnowledge: '',
                            clubSelection: '',
                            readingGreens: '',
                            mentalCoaching: '',
                            customerService: '',
                            additionalSkills: []
                        },
                        media: {
                            profilePhoto: '',
                            workPhotos: [],
                            certificates: [],
                            testimonials: []
                        },
                        preferences: {
                            preferredGroupSize: '',
                            workingStyle: '',
                            communicationStyle: '',
                            specialAccommodations: ''
                        }
                    }
                },
                manager: {
                    template: {
                        personalInfo: {
                            firstName: '',
                            lastName: '',
                            title: '',
                            department: '',
                            phone: '',
                            email: '',
                            address: '',
                            emergencyContact: ''
                        },
                        professionalInfo: {
                            employeeId: '',
                            startDate: '',
                            position: '',
                            responsibilities: [],
                            managementLevel: '',
                            reportingTo: '',
                            directReports: []
                        },
                        qualifications: {
                            education: '',
                            certifications: [],
                            experience: '',
                            specializations: [],
                            languages: []
                        },
                        media: {
                            profilePhoto: '',
                            teamPhotos: [],
                            achievements: [],
                            presentations: []
                        }
                    }
                },
                proshop: {
                    template: {
                        personalInfo: {
                            firstName: '',
                            lastName: '',
                            title: '',
                            phone: '',
                            email: '',
                            address: '',
                            emergencyContact: ''
                        },
                        professionalInfo: {
                            employeeId: '',
                            startDate: '',
                            position: '',
                            departments: [],
                            shiftSchedule: '',
                            expertise: []
                        },
                        skills: {
                            salesExperience: '',
                            productKnowledge: '',
                            customerService: '',
                            languages: [],
                            technicalSkills: [],
                            specializations: []
                        },
                        media: {
                            profilePhoto: '',
                            workPhotos: [],
                            certifications: [],
                            achievements: []
                        }
                    }
                },
                society: {
                    template: {
                        organizationInfo: {
                            societyName: '',
                            organizerName: '',
                            title: '',
                            establishedDate: '',
                            memberCount: '',
                            phone: '',
                            email: '',
                            website: '',
                            address: ''
                        },
                        golfInfo: {
                            societyType: '',
                            playingLevel: '',
                            meetingFrequency: '',
                            homeClubs: [],
                            tournaments: [],
                            handicapRange: '',
                            specialEvents: []
                        },
                        preferences: {
                            preferredCourses: [],
                            groupSize: '',
                            budgetRange: '',
                            cateringNeeds: '',
                            specialRequirements: '',
                            communicationMethod: ''
                        },
                        media: {
                            societyLogo: '',
                            eventPhotos: [],
                            trophies: [],
                            certificates: [],
                            promotional: []
                        },
                        contact: {
                            primaryContact: '',
                            secondaryContact: '',
                            bookingContact: '',
                            financialContact: '',
                            emergencyContact: ''
                        }
                    }
                }
            },

            getCurrentProfile(userType) {
                try {
                    const profileKey = `profile_${userType}_${AppState.currentUser.name}`;
                    const saved = localStorage.getItem(profileKey);

                    if (saved) {
                        const profile = JSON.parse(saved);
                        console.log('[ProfileSystem] Loading existing profile - homeClub:', profile.golfInfo?.homeClub);
                        return profile;
                    } else {
                        // Safe template access with fallback
                        const template = this.profiles && this.profiles[userType] && this.profiles[userType].template
                            ? JSON.parse(JSON.stringify(this.profiles[userType].template))
                            : {
                                personalInfo: { firstName: '', lastName: '' },
                                golfInfo: { homeClub: '', handicap: '18' },
                                preferences: {},
                                media: {},
                                privacy: {}
                            };

                        if (template.personalInfo) {
                            const nameParts = (AppState.currentUser?.name || '').split(' ');
                            template.personalInfo.firstName = nameParts[0] || '';
                            template.personalInfo.lastName = nameParts.slice(1).join(' ') || '';
                        }
                        if (template.organizationInfo) {
                            template.organizationInfo.organizerName = AppState.currentUser?.name || '';
                        }
                        console.log('[ProfileSystem] Using template profile - homeClub:', template.golfInfo?.homeClub);
                        return template;
                    }
                } catch (e) {
                    console.warn('[ProfileSystem] getCurrentProfile error, using fallback:', e);
                    return {
                        personalInfo: { firstName: '', lastName: '' },
                        golfInfo: { homeClub: '', handicap: '18' },
                        preferences: {},
                        media: {},
                        privacy: {}
                    };
                }
            },

            saveProfile(userType, profileData) {
                const profileKey = `profile_${userType}_${AppState.currentUser.name}`;
                console.log('[ProfileSystem] Saving profile - BEFORE save:', {
                    key: profileKey,
                    homeClub: profileData.golfInfo?.homeClub,
                    fullGolfInfo: profileData.golfInfo,
                    userType: userType,
                    userName: AppState.currentUser.name
                });
                localStorage.setItem(profileKey, JSON.stringify(profileData));

                // Verify it was saved correctly
                const savedCheck = localStorage.getItem(profileKey);
                const parsedCheck = JSON.parse(savedCheck);
                console.log('[ProfileSystem] Saving profile - AFTER save verification:', {
                    key: profileKey,
                    savedHomeClub: parsedCheck.golfInfo?.homeClub,
                    savedCorrectly: parsedCheck.golfInfo?.homeClub === profileData.golfInfo?.homeClub
                });

                // Update current user name if changed
                if (profileData.personalInfo?.firstName && profileData.personalInfo?.lastName) {
                    AppState.currentUser.name = `${profileData.personalInfo.firstName} ${profileData.personalInfo.lastName}`;
                } else if (profileData.organizationInfo?.organizerName) {
                    AppState.currentUser.name = profileData.organizationInfo.organizerName;
                }

                this.updateUIWithProfile();
                console.log(`[SUCCESS] Profile saved for ${userType}`, profileData.golfInfo?.homeClub ? `- homeClub: ${profileData.golfInfo.homeClub}` : '- no homeClub');
            },

            updateUIWithProfile(incoming) {
                try {
                    // Use incoming profile or get current profile safely
                    const profile = (incoming && typeof incoming === 'object')
                        ? incoming
                        : this.getCurrentProfile(AppState.currentUser?.role || 'golfer');

                    // Update all user name displays
                    const userName = AppState.currentUser?.name || '';
                    document.querySelectorAll('.user-name-display').forEach(el => {
                        el.textContent = userName;
                    });

                    // Update user avatar if available
                    const avatarUrl = profile.media?.profilePhoto || profile.media?.societyLogo;
                    if (avatarUrl) {
                        document.querySelectorAll('.user-avatar').forEach(el => {
                            el.src = avatarUrl;
                            el.style.display = 'block';
                        });
                    }

                    // Update home club displays
                    const homeClub = profile.golfInfo?.homeClub || 'Not Selected';
                    console.log('[ProfileSystem] updateUIWithProfile - homeClub debug:', {
                        profile: profile,
                        golfInfo: profile.golfInfo,
                        homeClub: profile.golfInfo?.homeClub,
                        finalDisplay: homeClub,
                        homeClubElements: document.querySelectorAll('.home-club').length
                    });
                    document.querySelectorAll('.home-club').forEach(el => {
                        el.textContent = homeClub;
                    });
                    console.log('[ProfileSystem] Updated UI with homeClub:', homeClub);

                    // Also update the form field if it exists
                    this.applyHomeClubToForm(profile.golfInfo?.homeClub);
                } catch (e) {
                    console.warn('[ProfileSystem] updateUIWithProfile error:', e);
                    // Continue gracefully, just don't update UI
                }
            },

            applyHomeClubToForm(slug) {
                if (!slug) return;

                // Target the profile modal specifically
                const el = document.querySelector('#profileModal #homeClub') ||
                          document.querySelector('#homeClub, #homeCourse, [name="homeClub"], [name="homeCourse"]');
                if (!el) return;

                const opts = Array.from(el.options || []);
                const byValue = opts.find(o => (o.value || '').trim() === slug);
                const byData  = opts.find(o => (o.dataset.courseId || o.dataset.value || '').trim() === slug);
                const pick = byValue || byData;
                if (pick) {
                    el.value = pick.value; // select it
                    console.log('[ProfileSystem] Applied homeClub to form:', slug, '-> option value:', pick.value, 'in modal:', !!el.closest('#profileModal'));
                } else {
                    console.log('[ProfileSystem] Could not find matching option for homeClub:', slug, 'in element:', el.id);
                }
            },

            // Wait for dropdown options to load
            waitForOptions(selector, min = 2) {
                return new Promise(resolve => {
                    const el = document.querySelector(selector);
                    if (el && el.options && el.options.length >= min) return resolve();
                    const obs = new MutationObserver(() => {
                        if (el && el.options && el.options.length >= min) {
                            obs.disconnect();
                            resolve();
                        }
                    });
                    obs.observe(el || document.body, { childList: true, subtree: true });
                    // Timeout after 3 seconds
                    setTimeout(() => { obs.disconnect(); resolve(); }, 3000);
                });
            },

            async showProfileModal() {
                const userType = AppState.currentUser.role;
                const profile = this.getCurrentProfile(userType);

                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                modal.id = 'profileModal';
                modal.onclick = (e) => {
                    if (e.target === modal) this.closeProfileModal();
                };

                modal.innerHTML = `
                    <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-screen overflow-hidden">
                        <div class="flex items-center justify-between p-6 border-b border-gray-200">
                            <h3 class="text-2xl font-bold text-gray-900">My Profile</h3>
                            <button onclick="ProfileSystem.closeProfileModal()" class="text-gray-400 hover:text-gray-600">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                        </div>

                        <div class="overflow-y-auto" style="max-height: calc(100vh - 200px);">
                            <div class="p-6">
                                ${this.generateProfileForm(userType, profile)}
                            </div>
                        </div>

                        <div class="flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50">
                            <div class="flex space-x-3">
                                <button onclick="ProfileSystem.closeProfileModal()"
                                        class="px-6 py-3 bg-gray-300 text-gray-700 rounded-xl font-semibold hover:bg-gray-400 transition-colors">
                                    Cancel
                                </button>
                                <button onclick="ProfileSystem.resetToDefaults('${userType}')"
                                        class="px-6 py-3 bg-orange-600 text-white rounded-xl font-semibold hover:bg-orange-700 transition-colors">
                                    Reset to Defaults
                                </button>
                            </div>
                            <button onclick="ProfileSystem.saveProfileFromForm('${userType}')"
                                    class="px-6 py-3 bg-primary-600 text-white rounded-xl font-semibold hover:bg-primary-700 transition-colors">
                                Save Profile
                            </button>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
                window.currentProfileModal = modal;

                // Wait for home course options to load, then apply current selection
                setTimeout(async () => {
                    try {
                        await this.waitForOptions('#homeClub, #homeCourse, [name="homeClub"], [name="homeCourse"]', 2);
                        const currentProfile = this.getCurrentProfile(userType);
                        if (currentProfile.golfInfo?.homeClub) {
                            this.applyHomeClubToForm(currentProfile.golfInfo.homeClub);
                            console.log('[ProfileSystem] Applied existing homeClub after options loaded:', currentProfile.golfInfo.homeClub);
                        }
                    } catch (error) {
                        console.log('[ProfileSystem] Options loading timeout or error:', error);
                    }
                }, 100);
            },

            closeProfileModal() {
                try {
                    if (window.currentProfileModal) {
                        window.currentProfileModal.remove();
                        window.currentProfileModal = null;
                    }
                    // Fallback - remove any profile modals
                    document.querySelectorAll('#profileModal').forEach(modal => modal.remove());
                } catch (error) {
                    console.error('Error closing profile modal:', error);
                }
            },

            generateProfileForm(userType, profile) {
                switch(userType) {
                    case 'golfer':
                        return this.generateGolferForm(profile);
                    case 'caddie':
                        return this.generateCaddyForm(profile);
                    case 'manager':
                        return this.generateManagerForm(profile);
                    case 'proshop':
                        return this.generateProshopForm(profile);
                    case 'society':
                        return this.generateSocietyForm(profile);
                    default:
                        return '<p>Profile type not supported</p>';
                }
            },

            generateGolferForm(profile) {
                return `
                    <div class="space-y-8">
                        <!-- Photo Upload Section -->
                        <div class="text-center">
                            <div class="relative inline-block">
                                <img id="profilePhotoPreview" src="${profile.media.profilePhoto || '/api/placeholder/120/120'}"
                                     class="w-24 h-24 rounded-full object-cover border-4 border-primary-200"
                                     alt="Profile Photo">
                                <input type="file" id="profilePhotoInput" accept="image/*" class="hidden"
                                       onchange="ProfileSystem.handlePhotoUpload(this, 'profilePhotoPreview')">
                                <button onclick="document.getElementById('profilePhotoInput').click()"
                                        class="absolute bottom-0 right-0 bg-primary-600 text-white rounded-full p-2 hover:bg-primary-700">
                                    <span class="material-symbols-outlined text-sm">camera_alt</span>
                                </button>
                            </div>
                            <p class="text-sm text-gray-500 mt-2">Click to upload profile photo</p>
                        </div>

                        <!-- Personal Information -->
                        <div class="bg-gray-50 rounded-xl p-6">
                            <h4 class="text-lg font-bold text-gray-900 mb-4">Personal Information</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                                    <input type="text" id="firstName" value="${profile.personalInfo.firstName}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                                    <input type="text" id="lastName" value="${profile.personalInfo.lastName}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nickname</label>
                                    <input type="text" id="nickname" value="${profile.personalInfo.nickname}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nationality</label>
                                    <select id="nationality" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                        <option value="">Select nationality</option>
                                        <option value="Thai" ${profile.personalInfo.nationality === 'Thai' ? 'selected' : ''}>Thai</option>
                                        <option value="American" ${profile.personalInfo.nationality === 'American' ? 'selected' : ''}>American</option>
                                        <option value="British" ${profile.personalInfo.nationality === 'British' ? 'selected' : ''}>British</option>
                                        <option value="Japanese" ${profile.personalInfo.nationality === 'Japanese' ? 'selected' : ''}>Japanese</option>
                                        <option value="Korean" ${profile.personalInfo.nationality === 'Korean' ? 'selected' : ''}>Korean</option>
                                        <option value="Chinese" ${profile.personalInfo.nationality === 'Chinese' ? 'selected' : ''}>Chinese</option>
                                        <option value="Australian" ${profile.personalInfo.nationality === 'Australian' ? 'selected' : ''}>Australian</option>
                                        <option value="German" ${profile.personalInfo.nationality === 'German' ? 'selected' : ''}>German</option>
                                        <option value="Other" ${profile.personalInfo.nationality === 'Other' ? 'selected' : ''}>Other</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                                    <input type="tel" id="phone" value="${profile.personalInfo.phone}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input type="email" id="email" value="${profile.personalInfo.email}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                </div>
                            </div>
                        </div>

                        <!-- Golf Information -->
                        <div class="bg-green-50 rounded-xl p-6">
                            <h4 class="text-lg font-bold text-gray-900 mb-4">Golf Information</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Current Handicap</label>
                                    <input type="number" id="handicap" value="${profile.golfInfo.handicap}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Member Since</label>
                                    <input type="date" id="memberSince" value="${profile.golfInfo.memberSince}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Home Course</label>
                                    <select id="homeClub" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                        <option value="">Select home course</option>
                                        <option value="Pattana Golf Resort & Spa" ${profile.golfInfo.homeClub === 'Pattana Golf Resort & Spa' ? 'selected' : ''}>Pattana Golf Resort & Spa</option>
                                        <option value="Crystal Bay Golf Club" ${profile.golfInfo.homeClub === 'Crystal Bay Golf Club' ? 'selected' : ''}>Crystal Bay Golf Club</option>
                                        <option value="Phoenix Gold Golf Club" ${profile.golfInfo.homeClub === 'Phoenix Gold Golf Club' ? 'selected' : ''}>Phoenix Gold Golf Club</option>
                                        <option value="Pattaya Country Club" ${profile.golfInfo.homeClub === 'Pattaya Country Club' ? 'selected' : ''}>Pattaya Country Club</option>
                                        <option value="Burapha Golf Club" ${profile.golfInfo.homeClub === 'Burapha Golf Club' ? 'selected' : ''}>Burapha Golf Club</option>
                                        <option value="Siam Country Club" ${profile.golfInfo.homeClub === 'Siam Country Club' ? 'selected' : ''}>Siam Country Club</option>
                                        <option value="Laem Chabang International Country Club" ${profile.golfInfo.homeClub === 'Laem Chabang International Country Club' ? 'selected' : ''}>Laem Chabang International Country Club</option>
                                        <option value="Royal Garden Golf Club" ${profile.golfInfo.homeClub === 'Royal Garden Golf Club' ? 'selected' : ''}>Royal Garden Golf Club</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Club Affiliation / Society</label>
                                    <select id="clubAffiliation" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                        <option value="">Select club affiliation</option>
                                        <option value="Travellers Rest Group" ${profile.golfInfo.clubAffiliation === 'Travellers Rest Group' ? 'selected' : ''}>Travellers Rest Group</option>
                                        <option value="Pattaya Sports Club" ${profile.golfInfo.clubAffiliation === 'Pattaya Sports Club' ? 'selected' : ''}>Pattaya Sports Club</option>
                                        <option value="Bunker Boys" ${profile.golfInfo.clubAffiliation === 'Bunker Boys' ? 'selected' : ''}>Bunker Boys</option>
                                        <option value="Diego Dubbi Golf" ${profile.golfInfo.clubAffiliation === 'Diego Dubbi Golf' ? 'selected' : ''}>Diego Dubbi Golf</option>
                                        <option value="Independent" ${profile.golfInfo.clubAffiliation === 'Independent' ? 'selected' : ''}>Independent (No Affiliation)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Experience Level</label>
                                    <select id="experienceLevel" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                        <option value="">Select experience</option>
                                        <option value="Beginner" ${profile.golfInfo.experienceLevel === 'Beginner' ? 'selected' : ''}>Beginner (0-2 years)</option>
                                        <option value="Intermediate" ${profile.golfInfo.experienceLevel === 'Intermediate' ? 'selected' : ''}>Intermediate (3-10 years)</option>
                                        <option value="Advanced" ${profile.golfInfo.experienceLevel === 'Advanced' ? 'selected' : ''}>Advanced (10+ years)</option>
                                        <option value="Professional" ${profile.golfInfo.experienceLevel === 'Professional' ? 'selected' : ''}>Professional</option>
                                    </select>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Playing Style</label>
                                    <textarea id="playingStyle" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">${profile.golfInfo.playingStyle}</textarea>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Golf Goals</label>
                                    <textarea id="golfGoals" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">${profile.golfInfo.golfGoals}</textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Preferences -->
                        <div class="bg-blue-50 rounded-xl p-6">
                            <h4 class="text-lg font-bold text-gray-900 mb-4">Preferences</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Preferred Tee Time</label>
                                    <select id="preferredTeeTime" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                        <option value="">No preference</option>
                                        <option value="Early Morning" ${profile.preferences.preferredTeeTime === 'Early Morning' ? 'selected' : ''}>Early Morning (6:00-8:00)</option>
                                        <option value="Morning" ${profile.preferences.preferredTeeTime === 'Morning' ? 'selected' : ''}>Morning (8:00-11:00)</option>
                                        <option value="Afternoon" ${profile.preferences.preferredTeeTime === 'Afternoon' ? 'selected' : ''}>Afternoon (11:00-15:00)</option>
                                        <option value="Late Afternoon" ${profile.preferences.preferredTeeTime === 'Late Afternoon' ? 'selected' : ''}>Late Afternoon (15:00-18:00)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Preferred Caddy Type</label>
                                    <select id="preferredCaddyType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                        <option value="">No preference</option>
                                        <option value="Professional" ${profile.preferences.preferredCaddyType === 'Professional' ? 'selected' : ''}>Professional & Strategic</option>
                                        <option value="Friendly" ${profile.preferences.preferredCaddyType === 'Friendly' ? 'selected' : ''}>Friendly & Encouraging</option>
                                        <option value="Quiet" ${profile.preferences.preferredCaddyType === 'Quiet' ? 'selected' : ''}>Quiet & Focused</option>
                                        <option value="Teaching" ${profile.preferences.preferredCaddyType === 'Teaching' ? 'selected' : ''}>Teaching & Instructional</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Communication Language</label>
                                    <select id="communicationLanguage" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                        <option value="English" ${profile.preferences.communicationLanguage === 'English' ? 'selected' : ''}>English</option>
                                        <option value="Thai" ${profile.preferences.communicationLanguage === 'Thai' ? 'selected' : ''}>Thai</option>
                                        <option value="Japanese" ${profile.preferences.communicationLanguage === 'Japanese' ? 'selected' : ''}>Japanese</option>
                                        <option value="Korean" ${profile.preferences.communicationLanguage === 'Korean' ? 'selected' : ''}>Korean</option>
                                        <option value="Chinese" ${profile.preferences.communicationLanguage === 'Chinese' ? 'selected' : ''}>Chinese</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="notifications" ${profile.preferences.notifications ? 'checked' : ''}
                                               class="rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                                        <span class="text-sm font-medium text-gray-700">Enable notifications</span>
                                    </label>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Dietary Restrictions / Special Requests</label>
                                    <textarea id="dietaryRestrictions" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">${profile.preferences.dietaryRestrictions}</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            },

            generateSocietyForm(profile) {
                return `
                    <div class="space-y-8">
                        <!-- Logo Upload Section -->
                        <div class="text-center">
                            <div class="relative inline-block">
                                <img id="profilePhotoPreview" src="${profile.media.societyLogo || '/api/placeholder/120/120'}"
                                     class="w-24 h-24 rounded-lg object-cover border-4 border-primary-200"
                                     alt="Society Logo">
                                <input type="file" id="profilePhotoInput" accept="image/*" class="hidden"
                                       onchange="ProfileSystem.handlePhotoUpload(this, 'profilePhotoPreview')">
                                <button onclick="document.getElementById('profilePhotoInput').click()"
                                        class="absolute bottom-0 right-0 bg-primary-600 text-white rounded-full p-2 hover:bg-primary-700">
                                    <span class="material-symbols-outlined text-sm">camera_alt</span>
                                </button>
                            </div>
                            <p class="text-sm text-gray-500 mt-2">Click to upload society logo</p>
                        </div>

                        <!-- Organization Information -->
                        <div class="bg-gray-50 rounded-xl p-6">
                            <h4 class="text-lg font-bold text-gray-900 mb-4">Organization Information</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Society Name</label>
                                    <input type="text" id="societyName" value="${profile.organizationInfo.societyName}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Organizer Name</label>
                                    <input type="text" id="organizerName" value="${profile.organizationInfo.organizerName}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Title/Position</label>
                                    <input type="text" id="title" value="${profile.organizationInfo.title}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Established Date</label>
                                    <input type="date" id="establishedDate" value="${profile.organizationInfo.establishedDate}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Member Count</label>
                                    <input type="number" id="memberCount" value="${profile.organizationInfo.memberCount}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                                    <input type="tel" id="phone" value="${profile.organizationInfo.phone}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input type="email" id="email" value="${profile.organizationInfo.email}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Website</label>
                                    <input type="url" id="website" value="${profile.organizationInfo.website}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                </div>
                            </div>
                        </div>

                        <!-- Golf Information -->
                        <div class="bg-green-50 rounded-xl p-6">
                            <h4 class="text-lg font-bold text-gray-900 mb-4">Golf Society Details</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Society Type</label>
                                    <select id="societyType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                        <option value="">Select type</option>
                                        <option value="Corporate" ${profile.golfInfo.societyType === 'Corporate' ? 'selected' : ''}>Corporate</option>
                                        <option value="Social Club" ${profile.golfInfo.societyType === 'Social Club' ? 'selected' : ''}>Social Club</option>
                                        <option value="Amateur League" ${profile.golfInfo.societyType === 'Amateur League' ? 'selected' : ''}>Amateur League</option>
                                        <option value="Professional" ${profile.golfInfo.societyType === 'Professional' ? 'selected' : ''}>Professional</option>
                                        <option value="Charity" ${profile.golfInfo.societyType === 'Charity' ? 'selected' : ''}>Charity Organization</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Playing Level</label>
                                    <select id="playingLevel" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                        <option value="">Select level</option>
                                        <option value="Beginner" ${profile.golfInfo.playingLevel === 'Beginner' ? 'selected' : ''}>Beginner (25+ handicap)</option>
                                        <option value="Intermediate" ${profile.golfInfo.playingLevel === 'Intermediate' ? 'selected' : ''}>Intermediate (10-25 handicap)</option>
                                        <option value="Advanced" ${profile.golfInfo.playingLevel === 'Advanced' ? 'selected' : ''}>Advanced (0-10 handicap)</option>
                                        <option value="Mixed" ${profile.golfInfo.playingLevel === 'Mixed' ? 'selected' : ''}>Mixed levels</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Meeting Frequency</label>
                                    <select id="meetingFrequency" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                        <option value="">Select frequency</option>
                                        <option value="Weekly" ${profile.golfInfo.meetingFrequency === 'Weekly' ? 'selected' : ''}>Weekly</option>
                                        <option value="Bi-weekly" ${profile.golfInfo.meetingFrequency === 'Bi-weekly' ? 'selected' : ''}>Bi-weekly</option>
                                        <option value="Monthly" ${profile.golfInfo.meetingFrequency === 'Monthly' ? 'selected' : ''}>Monthly</option>
                                        <option value="Quarterly" ${profile.golfInfo.meetingFrequency === 'Quarterly' ? 'selected' : ''}>Quarterly</option>
                                        <option value="Special Events" ${profile.golfInfo.meetingFrequency === 'Special Events' ? 'selected' : ''}>Special Events Only</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Typical Group Size</label>
                                    <select id="groupSize" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                        <option value="">Select size</option>
                                        <option value="Small (4-12)" ${profile.preferences.groupSize === 'Small (4-12)' ? 'selected' : ''}>Small (4-12 people)</option>
                                        <option value="Medium (12-24)" ${profile.preferences.groupSize === 'Medium (12-24)' ? 'selected' : ''}>Medium (12-24 people)</option>
                                        <option value="Large (24-48)" ${profile.preferences.groupSize === 'Large (24-48)' ? 'selected' : ''}>Large (24-48 people)</option>
                                        <option value="Very Large (48+)" ${profile.preferences.groupSize === 'Very Large (48+)' ? 'selected' : ''}>Very Large (48+ people)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Preferences -->
                        <div class="bg-blue-50 rounded-xl p-6">
                            <h4 class="text-lg font-bold text-gray-900 mb-4">Event Preferences</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Budget Range</label>
                                    <select id="budgetRange" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                        <option value="">Select budget</option>
                                        <option value="Budget (‡∏ø1,000-2,500)" ${profile.preferences.budgetRange === 'Budget (‡∏ø1,000-2,500)' ? 'selected' : ''}>Budget (‡∏ø1,000-2,500 per person)</option>
                                        <option value="Standard (‡∏ø2,500-5,000)" ${profile.preferences.budgetRange === 'Standard (‡∏ø2,500-5,000)' ? 'selected' : ''}>Standard (‡∏ø2,500-5,000 per person)</option>
                                        <option value="Premium (‡∏ø5,000-10,000)" ${profile.preferences.budgetRange === 'Premium (‡∏ø5,000-10,000)' ? 'selected' : ''}>Premium (‡∏ø5,000-10,000 per person)</option>
                                        <option value="Luxury (‡∏ø10,000+)" ${profile.preferences.budgetRange === 'Luxury (‡∏ø10,000+)' ? 'selected' : ''}>Luxury (‡∏ø10,000+ per person)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Communication Method</label>
                                    <select id="communicationMethod" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                        <option value="Line" ${profile.preferences.communicationMethod === 'Line' ? 'selected' : ''}>Line</option>
                                        <option value="WhatsApp" ${profile.preferences.communicationMethod === 'WhatsApp' ? 'selected' : ''}>WhatsApp</option>
                                        <option value="Email" ${profile.preferences.communicationMethod === 'Email' ? 'selected' : ''}>Email</option>
                                        <option value="Phone" ${profile.preferences.communicationMethod === 'Phone' ? 'selected' : ''}>Phone</option>
                                    </select>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Catering Needs</label>
                                    <textarea id="cateringNeeds" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">${profile.preferences.cateringNeeds}</textarea>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Special Requirements</label>
                                    <textarea id="specialRequirements" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">${profile.preferences.specialRequirements}</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            },

            updateDashboardData() {
                try {
                    // Update all UI elements with current user data
                    UserInterface.updateUserDisplays();
                    UserInterface.updateRoleSpecificDisplays();

                    // Get current profile with fallback to defaults
                    const profile = this.getCurrentProfile(AppState.currentUser.role);

                    // Update handicap displays (show default if empty)
                    const handicap = profile.golfInfo?.handicap || '18';
                    AppState.currentUser.handicap = handicap;
                    document.querySelectorAll('.user-handicap').forEach(el => {
                        el.textContent = handicap;
                    });

                    // Update member since displays (show current year if empty)
                    const memberSince = profile.golfInfo?.memberSince || new Date().toISOString().split('T')[0];
                    document.querySelectorAll('.member-since').forEach(el => {
                        const year = new Date(memberSince).getFullYear();
                        el.textContent = year || new Date().getFullYear();
                    });

                    // Update home club displays (show default if empty)
                    const homeClub = profile.golfInfo?.homeClub || 'Not Selected';
                    document.querySelectorAll('.home-club').forEach(el => {
                        el.textContent = homeClub;
                    });

                    // Update club affiliation displays
                    const clubAffiliation = profile.golfInfo?.clubAffiliation;
                    const affiliationContainers = document.querySelectorAll('.club-affiliation-container, .club-affiliation-stats-container');
                    const affiliationElements = document.querySelectorAll('.club-affiliation');

                    if (clubAffiliation && clubAffiliation !== '') {
                        affiliationElements.forEach(el => {
                            el.textContent = clubAffiliation;
                        });
                        affiliationContainers.forEach(container => {
                            container.style.display = 'flex';
                        });
                    } else {
                        affiliationContainers.forEach(container => {
                            container.style.display = 'none';
                        });
                    }

                    // Update experience level displays (show default if empty)
                    const experienceLevel = profile.golfInfo?.experienceLevel || 'Intermediate';
                    document.querySelectorAll('.experience-level').forEach(el => {
                        el.textContent = experienceLevel;
                    });

                    // Update profile photo if available
                    if (profile.media?.profilePhoto) {
                        document.querySelectorAll('.user-avatar').forEach(el => {
                            el.src = profile.media.profilePhoto;
                            el.style.display = 'block';
                        });
                    }

                    console.log('Dashboard data updated successfully with profile:', {
                        handicap,
                        homeClub,
                        experienceLevel,
                        memberSince: new Date(memberSince).getFullYear()
                    });
                } catch (error) {
                    console.error('Error updating dashboard data:', error);
                }
            },

            // Initialize dashboard with profile data on load
            initializeDashboard() {
                setTimeout(() => {
                    this.updateDashboardData();
                }, 100);
            },

            resetToDefaults(userType) {
                if (confirm('Are you sure you want to reset your profile to default values? This will clear all your current information.')) {
                    // Clear the saved profile
                    const profileKey = `profile_${userType}_${AppState.currentUser.name}`;
                    localStorage.removeItem(profileKey);

                    // Close and reopen the modal with fresh defaults
                    this.closeProfileModal();
                    setTimeout(() => {
                        this.showProfileModal();
                    }, 100);

                    console.log('Profile reset to defaults');
                }
            },

            handlePhotoUpload(input, previewId) {
                const file = input.files[0];
                if (file) {
                    // Validate file type
                    if (!file.type.startsWith('image/')) {
                        alert('Please select a valid image file.');
                        input.value = '';
                        return;
                    }

                    // Validate file size (max 5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        alert('Please select an image smaller than 5MB.');
                        input.value = '';
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const preview = document.getElementById(previewId);
                        if (preview) {
                            preview.src = e.target.result;
                            console.log('Profile photo uploaded successfully');
                        }
                    };
                    reader.onerror = function() {
                        alert('Error reading the image file. Please try again.');
                    };
                    reader.readAsDataURL(file);
                }
            },

            saveProfileFromForm(userType) {
                const profile = this.getCurrentProfile(userType);

                try {
                    if (userType === 'golfer') {
                        // Get current form values
                        const firstName = document.getElementById('firstName')?.value?.trim() || '';
                        const lastName = document.getElementById('lastName')?.value?.trim() || '';

                        // Check if we have either form values OR existing profile values
                        const hasFirstName = firstName || profile.personalInfo?.firstName;
                        const hasLastName = lastName || profile.personalInfo?.lastName;

                        if (!hasFirstName || !hasLastName) {
                            alert('Please enter both first name and last name.');
                            return;
                        }

                        // Personal Info - preserve existing values if form is empty
                        profile.personalInfo.firstName = firstName || profile.personalInfo.firstName;
                        profile.personalInfo.lastName = lastName || profile.personalInfo.lastName;
                        profile.personalInfo.nickname = document.getElementById('nickname')?.value?.trim() || '';
                        profile.personalInfo.nationality = document.getElementById('nationality')?.value || '';
                        profile.personalInfo.phone = document.getElementById('phone')?.value?.trim() || '';
                        profile.personalInfo.email = document.getElementById('email')?.value?.trim() || '';

                        // Golf Info with validation
                        const handicap = document.getElementById('handicap')?.value?.trim() || '';
                        const memberSince = document.getElementById('memberSince')?.value || '';
                        // Strict home course extraction - only accepts real slugs, never placeholders
                        const PLACEHOLDER_TEXTS = new Set([
                            'Select your home course...', 'Select your home course', 'Select home course', 'Not Selected', '‚Äî'
                        ]);

                        function getHomeClubFromFormStrict() {
                            const el = document.querySelector('#profileModal #homeClub') ||
                                      document.querySelector('#homeClub, #homeCourse, [name="homeClub"], [name="homeCourse"]');

                            if (!el) {
                                console.log('[HomeClub Debug] No element found');
                                return '';
                            }

                            // If still on the first option (placeholder), treat as empty
                            if (el.selectedIndex === 0) {
                                console.log('[HomeClub Debug] Still on placeholder option (index 0)');
                                return '';
                            }

                            const opt  = el.selectedOptions && el.selectedOptions[0];
                            const val  = (opt?.value || '').trim();
                            const data = (opt?.dataset?.courseId || opt?.dataset?.value || '').trim();
                            const text = (opt?.textContent || '').trim();

                            console.log('[HomeClub Debug] Reading from selectedIndex:', el.selectedIndex, 'value:', val, 'text:', text);

                            // Ignore placeholder-like text entirely
                            if (PLACEHOLDER_TEXTS.has(text)) {
                                console.log('[HomeClub Debug] Rejecting placeholder text:', text);
                                return '';
                            }

                            // Only accept a real slug (prefer value, then data-*)
                            const result = val || data || '';
                            console.log('[HomeClub Debug] Final strict result:', result);
                            return result;
                        }

                        const homeClub = getHomeClubFromFormStrict();
                        console.log('[ProfileSystem] Form homeClub debugging:', {
                            element: document.getElementById('homeClub'),
                            exists: !!document.getElementById('homeClub'),
                            value: document.getElementById('homeClub')?.value,
                            strictResult: homeClub,
                            selectedIndex: document.getElementById('homeClub')?.selectedIndex,
                            selectedOption: document.getElementById('homeClub')?.selectedOptions?.[0]?.text
                        });

                        // Block saving if no valid home course selected
                        if (!homeClub) {
                            const el = document.querySelector('#profileModal #homeClub') ||
                                      document.querySelector('#homeClub, #homeCourse, [name="homeClub"], [name="homeCourse"]');
                            if (el) {
                                el.setCustomValidity('Please select your home course');
                                el.reportValidity();
                            }
                            alert('Please select a home course before saving your profile.');
                            console.warn('[ProfileSystem] Blocked save: no valid homeClub selected');
                            return;
                        }

                        console.log('[ProfileSystem] Saving golfer profile - homeClub value:', homeClub);

                        // Validate handicap
                        if (handicap && (isNaN(handicap) || handicap < 0 || handicap > 54)) {
                            alert('Please enter a valid handicap between 0 and 54.');
                            return;
                        }

                        profile.golfInfo.handicap = handicap;
                        profile.golfInfo.memberSince = memberSince;
                        profile.golfInfo.homeClub = homeClub;
                        console.log('[ProfileSystem] Profile after setting homeClub:', profile.golfInfo.homeClub);

                        // Force update the profile data with sync
                        const profilesArray = JSON.parse(localStorage.getItem('mcipro_user_profiles') || '[]');
                        const existingIndex = profilesArray.findIndex(p => p.name === `${profile.personalInfo.firstName} ${profile.personalInfo.lastName}`);
                        const profileForSync = {
                            name: `${profile.personalInfo.firstName} ${profile.personalInfo.lastName}`,
                            role: 'golfer',
                            golfInfo: profile.golfInfo,
                            personalInfo: profile.personalInfo,
                            timestamp: new Date().toISOString()
                        };

                        if (existingIndex >= 0) {
                            profilesArray[existingIndex] = profileForSync;
                        } else {
                            profilesArray.push(profileForSync);
                        }
                        localStorage.setItem('mcipro_user_profiles', JSON.stringify(profilesArray));
                        console.log('[ProfileSystem] Updated mcipro_user_profiles with homeClub:', homeClub);
                        profile.golfInfo.clubAffiliation = document.getElementById('clubAffiliation')?.value || '';
                        profile.golfInfo.experienceLevel = document.getElementById('experienceLevel')?.value || '';
                        profile.golfInfo.playingStyle = document.getElementById('playingStyle')?.value?.trim() || '';
                        profile.golfInfo.golfGoals = document.getElementById('golfGoals')?.value?.trim() || '';

                        // Preferences
                        profile.preferences.preferredTeeTime = document.getElementById('preferredTeeTime')?.value || '';
                        profile.preferences.preferredCaddyType = document.getElementById('preferredCaddyType')?.value || '';
                        profile.preferences.communicationLanguage = document.getElementById('communicationLanguage')?.value || '';
                        profile.preferences.notifications = document.getElementById('notifications')?.checked || false;
                        profile.preferences.dietaryRestrictions = document.getElementById('dietaryRestrictions')?.value || '';

                        // Media
                        const profilePhoto = document.getElementById('profilePhotoPreview')?.src;
                        if (profilePhoto && !profilePhoto.includes('/api/placeholder/')) {
                            profile.media.profilePhoto = profilePhoto;
                        }
                    } else if (userType === 'society') {
                        // Organization Info
                        profile.organizationInfo.societyName = document.getElementById('societyName')?.value || '';
                        profile.organizationInfo.organizerName = document.getElementById('organizerName')?.value || '';
                        profile.organizationInfo.title = document.getElementById('title')?.value || '';
                        profile.organizationInfo.establishedDate = document.getElementById('establishedDate')?.value || '';
                        profile.organizationInfo.memberCount = document.getElementById('memberCount')?.value || '';
                        profile.organizationInfo.phone = document.getElementById('phone')?.value || '';
                        profile.organizationInfo.email = document.getElementById('email')?.value || '';
                        profile.organizationInfo.website = document.getElementById('website')?.value || '';

                        // Golf Info
                        profile.golfInfo.societyType = document.getElementById('societyType')?.value || '';
                        profile.golfInfo.playingLevel = document.getElementById('playingLevel')?.value || '';
                        profile.golfInfo.meetingFrequency = document.getElementById('meetingFrequency')?.value || '';

                        // Preferences
                        profile.preferences.groupSize = document.getElementById('groupSize')?.value || '';
                        profile.preferences.budgetRange = document.getElementById('budgetRange')?.value || '';
                        profile.preferences.communicationMethod = document.getElementById('communicationMethod')?.value || '';
                        profile.preferences.cateringNeeds = document.getElementById('cateringNeeds')?.value || '';
                        profile.preferences.specialRequirements = document.getElementById('specialRequirements')?.value || '';

                        // Media
                        const societyLogo = document.getElementById('profilePhotoPreview')?.src;
                        if (societyLogo && !societyLogo.includes('/api/placeholder/')) {
                            profile.media.societyLogo = societyLogo;
                        }
                    }

                    this.saveProfile(userType, profile);

                    // Close modal properly
                    this.closeProfileModal();

                    // Update dashboard data immediately
                    this.updateDashboardData();

                    // Debounced cloud sync for profile data
                    console.log('[ProfileSystem] PROFILE SAVED - SCHEDULING CLOUD SYNC');
                    SimpleCloudSync.saveToCloudSoon();

                    // Show success message
                    const successModal = document.createElement('div');
                    successModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                    successModal.innerHTML = `
                        <div class="bg-white rounded-2xl p-8 max-w-md mx-4 shadow-2xl">
                            <div class="text-center">
                                <div class="text-6xl mb-4">‚úÖ</div>
                                <h3 class="text-2xl font-bold text-gray-900 mb-2">Profile Saved!</h3>
                                <p class="text-gray-600 mb-6">Your profile has been updated successfully.</p>
                                <button onclick="this.closest('.fixed').remove()"
                                        class="bg-primary-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-primary-700 transition-colors">
                                    Great!
                                </button>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(successModal);

                    setTimeout(() => {
                        if (successModal.parentNode) {
                            successModal.remove();
                        }
                    }, 3000);

                } catch (error) {
                    console.error('Error saving profile:', error);
                }
            }
        };

        // ===== SCHEDULE MANAGEMENT SYSTEM =====
        const ScheduleSystem = {
            scheduleData: {
                events: [],
                caddieBookings: [],
                waitlists: [],
                foodOrders: []
            },

            currentFilter: 'all',

            initializeSchedule() {
                this.loadFromStorage();
                this.updateScheduleTab();
            },

            loadFromStorage() {
                try {
                    const savedSchedule = localStorage.getItem('mcipro_schedule');
                    if (savedSchedule) {
                        this.scheduleData = JSON.parse(savedSchedule);
                        console.log('[ScheduleSystem] Loaded schedule from localStorage');
                        return;
                    }
                } catch (error) {
                    console.error('[ScheduleSystem] Failed to load from localStorage:', error);
                }
                // Always start with empty schedule (no demo data)
                console.log('[ScheduleSystem] Starting with clean schedule (no demo data)');
                this.scheduleData = {
                    events: [],
                    caddieBookings: [],
                    waitlists: []
                };
                this.saveToStorage();
            },

            saveToStorage() {
                try {
                    localStorage.setItem('mcipro_schedule', JSON.stringify(this.scheduleData));
                    console.log('[ScheduleSystem] Saved schedule to localStorage');

                    // DEBOUNCED CLOUD SYNC after schedule changes
                    console.log('[ScheduleSystem] SCHEDULE CHANGED - SCHEDULING CLOUD SYNC');
                    SimpleCloudSync.saveToCloudSoon();
                    this.refreshStats();
                } catch (error) {
                    console.error('[ScheduleSystem] Failed to save to localStorage:', error);
                }
            },

            getList() {
                const raw = localStorage.getItem("mcipro_schedule") || "[]";
                const list = JSON.parse(raw);
                return Array.isArray(list) ? list : Object.values(list || {});
            },

            saveList(list) {
                // dedupe by id before saving
                const m = new Map();
                for (const e of list) if (e?.id) m.set(e.id, { ...(m.get(e.id) || {}), ...e });
                const out = [...m.values()];
                localStorage.setItem("mcipro_schedule", JSON.stringify(out));
                // kick the cloud sync & refresh counters
                console.log("[ScheduleSystem] SCHEDULE CHANGED - TRIGGERING CLOUD SYNC");
                SimpleCloudSync.saveToCloudSoon();
                this.refreshStats();
            },

            upsertFromBooking(bk) {
                const id = `sch_${bk.groupId}`;         // one event per round
                const list = this.getList();
                let evt = list.find(x => x.id === id);

                if (!evt) {
                    evt = {
                        id,
                        groupId: bk.groupId,
                        title: `Round at ${bk.courseName || bk.course}`,
                        start: bk.teeTime || bk.date,
                        courseId: bk.courseId || bk.course,
                        courseName: bk.courseName || bk.course,
                        status: "confirmed",
                        caddies: [],
                        services: [],
                        updatedAt: Date.now(),
                        type: "round"
                    };
                    list.push(evt);
                }

                // fold children into the one event
                if (bk.kind === "teeTime" || bk.type === "teeTime") {
                    evt.start = bk.teeTime || bk.date;
                    evt.players = bk.players ?? evt.players;
                    evt.status = bk.status ?? evt.status;
                } else if (bk.kind === "caddie" || bk.type === "caddie") {
                    if (!evt.caddies.some(c => c.id === bk.caddieId)) {
                        evt.caddies.push({ id: bk.caddieId, name: bk.caddieName });
                    }
                } else if (bk.kind === "service" || bk.type === "service") {
                    const serviceName = bk.service || bk.serviceName || "service";
                    if (!evt.services.includes(serviceName)) evt.services.push(serviceName);
                }

                evt.updatedAt = Date.now();
                this.saveList(list);
            },

            refreshStats() {
                // Count from actual bookings instead of schedule
                const bookings = JSON.parse(localStorage.getItem('mcipro_bookings') || '[]');
                console.log('[ScheduleSystem] refreshStats - counting from', bookings.length, 'bookings');

                const now = Date.now();

                // Parse booking dates
                const parseBookingDate = (booking) => {
                    const dateStr = booking.teeTime || booking.date;
                    if (!dateStr) return null;
                    let parsed;

                    if (booking.date && booking.time) {
                        parsed = new Date(booking.date + 'T' + booking.time + ':00');
                    } else {
                        parsed = new Date(dateStr);
                    }

                    return isNaN(parsed.getTime()) ? null : parsed.getTime();
                };

                // Count upcoming tee times only
                const upcomingBookings = bookings.filter(b => {
                    if (b.type !== 'teeTime') return false;
                    const bookingTime = parseBookingDate(b);
                    return bookingTime && bookingTime >= now;
                });

                const thisWeekBookings = upcomingBookings.filter(b => {
                    const bookingTime = parseBookingDate(b);
                    if (!bookingTime) return false;
                    const nowD = new Date();
                    const startOfWeek = new Date(nowD); startOfWeek.setDate(nowD.getDate() - nowD.getDay());
                    const endOfWeek = new Date(startOfWeek); endOfWeek.setDate(startOfWeek.getDate() + 7);
                    return bookingTime >= +startOfWeek && bookingTime < +endOfWeek;
                });

                // Count confirmed caddies from caddie bookings
                const caddieBookings = bookings.filter(b => b.type === 'caddie' && b.status === 'confirmed');

                const upcoming = upcomingBookings.length;
                const thisWeek = thisWeekBookings.length;
                const confirmedCaddies = caddieBookings.length;

                console.log('[ScheduleSystem] Booking stats - upcoming teeTime bookings:', upcoming);
                console.log('[ScheduleSystem] Booking stats - thisWeek teeTime bookings:', thisWeek);
                console.log('[ScheduleSystem] Booking stats - confirmed caddie bookings:', confirmedCaddies);

                // write to UI counters
                const upcomingEl = document.getElementById('upcomingCount');
                const thisWeekEl = document.getElementById('thisWeekCount');
                const caddyEl = document.getElementById('caddyCount');

                if (upcomingEl) upcomingEl.textContent = upcoming;
                if (thisWeekEl) thisWeekEl.textContent = thisWeek;
                if (caddyEl) caddyEl.textContent = confirmedCaddies;

                console.log('[ScheduleSystem] Stats refreshed - upcoming:', upcoming, 'thisWeek:', thisWeek, 'caddies:', confirmedCaddies);
            },

            loadSampleData() {
                // Sample events for demonstration
                this.scheduleData.events = [
                    {
                        id: 'event_001',
                        type: 'teeTime',
                        title: 'Round at Pattaya Golf Club',
                        date: new Date(Date.now() + 24 * 60 * 60 * 1000), // Tomorrow
                        time: '14:00',
                        duration: 240, // 4 hours
                        course: 'Pattaya Golf Club',
                        status: 'confirmed',
                        players: 1,
                        notes: 'Afternoon round',
                        canEdit: true,
                        canCancel: true
                    },
                    {
                        id: 'event_002',
                        type: 'tournament',
                        title: 'Monthly Club Championship',
                        date: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), // Next week
                        time: '08:00',
                        duration: 300, // 5 hours
                        course: 'Championship Course',
                        status: 'registered',
                        players: 4,
                        notes: 'Tournament entry fee paid',
                        canEdit: false,
                        canCancel: true
                    }
                ];

                this.scheduleData.caddieBookings = [
                    {
                        id: 'caddie_001',
                        type: 'caddieBooking',
                        title: 'Caddy: Ning (Professional)',
                        eventId: 'event_001',
                        caddieName: 'Ning',
                        caddieId: 'c002',
                        date: new Date(Date.now() + 24 * 60 * 60 * 1000),
                        time: '14:00',
                        status: 'confirmed',
                        rate: '‡∏ø1,200',
                        canEdit: true,
                        canCancel: true
                    }
                ];

                this.scheduleData.waitlists = [
                    {
                        id: 'waitlist_001',
                        type: 'waitlist',
                        title: 'Waitlist: Alex Chen (VIP)',
                        caddieName: 'Alex Chen',
                        caddieId: 'c001',
                        position: 2,
                        requestedDate: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000),
                        status: 'waiting',
                        canEdit: true,
                        canCancel: true
                    }
                ];
            },

            // Check if event exists for booking (idempotent)
            hasEventForBooking(bookingId) {
                return this.scheduleData.events.some(event =>
                    event.bookingId === bookingId
                );
            },

            // Add event only if it doesn't already exist for the booking
            addEventForBooking(eventData, bookingId) {
                if (this.hasEventForBooking(bookingId)) {
                    console.log('[ScheduleSystem] Event already exists for booking:', bookingId);
                    return null;
                }

                const event = {
                    id: 'event_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    bookingId: bookingId, // Link to booking
                    ...eventData,
                    createdAt: new Date()
                };
                this.scheduleData.events.push(event);
                this.saveToStorage();
                this.updateScheduleTab();
                console.log('[ScheduleSystem] Added event for booking:', bookingId, event.title);
                return event;
            },

            addEvent(eventData) {
                const event = {
                    id: 'event_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    ...eventData,
                    createdAt: new Date()
                };
                this.scheduleData.events.push(event);
                this.saveToStorage();
                this.updateScheduleTab();
                console.log('[ScheduleSystem] Added event:', event.title);
                return event;
            },

            addCaddyBooking(bookingData) {
                const booking = {
                    id: 'caddie_' + Date.now(),
                    type: 'caddieBooking',
                    ...bookingData,
                    createdAt: new Date()
                };
                this.scheduleData.caddieBookings.push(booking);
                this.saveToStorage();
                this.updateScheduleTab();
                console.log('[ScheduleSystem] Added caddie booking:', booking.caddieName);
                return booking;
            },

            addToWaitlist(waitlistData) {
                const waitlist = {
                    id: 'waitlist_' + Date.now(),
                    type: 'waitlist',
                    ...waitlistData,
                    createdAt: new Date()
                };
                this.scheduleData.waitlists.push(waitlist);
                this.saveToStorage();
                this.updateScheduleTab();
                console.log('[ScheduleSystem] Added waitlist entry:', waitlist.caddieName);
                return waitlist;
            },

            updateScheduleTab() {
                console.log('ScheduleSystem.updateScheduleTab called');
                console.log('Schedule data:', this.scheduleData);
                this.updateStats();
                this.renderScheduleList();
            },

            updateStats() {
                // Ensure all required arrays exist
                if (!this.scheduleData.events) this.scheduleData.events = [];
                if (!this.scheduleData.caddieBookings) this.scheduleData.caddieBookings = [];
                if (!this.scheduleData.waitlists) this.scheduleData.waitlists = [];

                const now = new Date();
                const thisWeekEnd = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);

                const upcomingEvents = this.scheduleData.events.filter(e => new Date(e.date) > now).length;
                const confirmedCaddys = this.scheduleData.caddieBookings.filter(c => c.status === 'confirmed').length;
                const waitlistCount = this.scheduleData.waitlists.length;
                const thisWeekEvents = this.scheduleData.events.filter(e => {
                    const eventDate = new Date(e.date);
                    return eventDate > now && eventDate <= thisWeekEnd;
                }).length;

                document.getElementById('upcomingEventsCount').textContent = upcomingEvents;
                document.getElementById('confirmedCaddysCount').textContent = confirmedCaddys;
                document.getElementById('waitlistCount').textContent = waitlistCount;
                document.getElementById('thisWeekCount').textContent = thisWeekEvents;
            },

            renderScheduleList() {
                console.log('ScheduleSystem.renderScheduleList called');
                const container = document.getElementById('scheduleList');
                const emptyState = document.getElementById('emptySchedule');

                if (!container) {
                    console.error('scheduleList container not found!');
                    return;
                }

                // Handle both array and object formats
                let allItems = [];
                if (Array.isArray(this.scheduleData)) {
                    allItems = this.scheduleData.map(e => ({...e, type: e.type || 'event'}));
                } else {
                    allItems = [
                        ...(this.scheduleData.events || []).map(e => ({...e, type: 'event'})),
                        ...(this.scheduleData.caddieBookings || []),
                        ...(this.scheduleData.waitlists || [])
                    ];
                }

                let filteredItems = this.filterItems(allItems);
                console.log('All items:', allItems);
                console.log('Filtered items:', filteredItems);
                console.log('Current filter:', this.currentFilter);

                if (filteredItems.length === 0) {
                    container.style.display = 'none';
                    emptyState.style.display = 'block';
                    return;
                }

                container.style.display = 'block';
                emptyState.style.display = 'none';

                // Sort by date
                filteredItems.sort((a, b) => new Date(a.date || a.requestedDate) - new Date(b.date || b.requestedDate));

                container.innerHTML = filteredItems.map(item => this.createScheduleItem(item)).join('');
            },

            filterItems(items) {
                const now = new Date();

                switch (this.currentFilter) {
                    case 'today':
                        return items.filter(item => {
                            const itemDate = new Date(item.date || item.start || item.requestedDate || item.createdAt);
                            return itemDate.toDateString() === now.toDateString();
                        });
                    case 'upcoming':
                        return items.filter(item => {
                            const itemDate = new Date(item.date || item.start || item.requestedDate || item.createdAt);
                            return itemDate > now;
                        });
                    case 'caddies':
                        return items.filter(item => item.type === 'caddieBooking');
                    case 'waitlist':
                        return items.filter(item => item.type === 'waitlist');
                    case 'all':
                    default:
                        return items; // Show everything for 'all' filter
                }
            },

            createScheduleItem(item) {
                const date = new Date(item.date || item.start || item.requestedDate || item.createdAt);
                const isToday = date.toDateString() === new Date().toDateString();
                const isPast = date < new Date();

                return `
                    <div class="schedule-item ${item.editing ? 'editing' : ''}" data-id="${item.id}">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-2">
                                    <div class="w-10 h-10 rounded-full flex items-center justify-center ${this.getTypeColor(item.type)}">
                                        <span class="material-symbols-outlined text-white">${this.getTypeIcon(item.type)}</span>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-gray-900">${item.title}</h4>
                                        <div class="flex items-center space-x-4 text-sm text-gray-600">
                                            <span>${date.toLocaleDateString()}</span>
                                            ${item.time ? `<span>${item.time}</span>` : ''}
                                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${this.getStatusColor(item.status)}">
                                                ${item.status}
                                            </span>
                                            ${isToday ? '<span class="text-blue-600 font-medium">Today</span>' : ''}
                                            ${isPast ? '<span class="text-gray-500">Past</span>' : ''}
                                        </div>
                                    </div>
                                </div>

                                ${this.renderItemDetails(item)}
                            </div>

                            <div class="flex space-x-2 ml-4">
                                ${item.canEdit ? `<button onclick="editScheduleItem('${item.id}')" class="text-blue-600 hover:text-blue-700 p-2 rounded-lg hover:bg-blue-50">
                                    <span class="material-symbols-outlined text-sm">edit</span>
                                </button>` : ''}
                                ${item.canCancel ? `<button onclick="cancelScheduleItem('${item.id}')" class="text-red-600 hover:text-red-700 p-2 rounded-lg hover:bg-red-50">
                                    <span class="material-symbols-outlined text-sm">cancel</span>
                                </button>` : ''}
                                <button onclick="saveScheduleItem('${item.id}')" class="text-green-600 hover:text-green-700 p-2 rounded-lg hover:bg-green-50" style="display: none;">
                                    <span class="material-symbols-outlined text-sm">save</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            },

            renderItemDetails(item) {
                switch (item.type) {
                    case 'round':
                        const caddiesHtml = item.caddies && item.caddies.length > 0
                            ? `<div><span class="text-gray-500">Caddies:</span> ${item.caddies.map(c => c.name).join(', ')}</div>`
                            : '';
                        const servicesHtml = item.services && item.services.length > 0
                            ? `<div><span class="text-gray-500">Services:</span> ${item.services.join(', ')}</div>`
                            : '';
                        return `
                            <div class="mt-3 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                <div><span class="text-gray-500">Course:</span> ${item.courseName || item.course}</div>
                                <div><span class="text-gray-500">Players:</span> ${item.players || 1}</div>
                                ${caddiesHtml}
                                ${servicesHtml}
                            </div>
                        `;
                    case 'event':
                        return `
                            <div class="mt-3 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                <div><span class="text-gray-500">Course:</span> ${item.course}</div>
                                <div><span class="text-gray-500">Players:</span> ${item.players}</div>
                                <div><span class="text-gray-500">Duration:</span> ${item.duration} min</div>
                                ${item.notes ? `<div><span class="text-gray-500">Notes:</span> ${item.notes}</div>` : ''}
                            </div>
                        `;
                    case 'caddieBooking':
                        return `
                            <div class="mt-3 grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
                                <div><span class="text-gray-500">Caddy:</span> ${item.caddieName}</div>
                                <div><span class="text-gray-500">Rate:</span> ${item.rate}</div>
                                <div><span class="text-gray-500">Event:</span> ${item.eventId || 'Standalone'}</div>
                            </div>
                        `;
                    case 'waitlist':
                        return `
                            <div class="mt-3 grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
                                <div><span class="text-gray-500">Position:</span> #${item.position}</div>
                                <div><span class="text-gray-500">Requested:</span> ${new Date(item.requestedDate).toLocaleDateString()}</div>
                                <div><span class="text-gray-500">Caddy:</span> ${item.caddieName}</div>
                            </div>
                        `;
                    default:
                        return '';
                }
            },

            getTypeIcon(type) {
                const icons = {
                    'event': 'golf_course',
                    'caddieBooking': 'person',
                    'waitlist': 'hourglass_empty'
                };
                return icons[type] || 'event';
            },

            getTypeColor(type) {
                const colors = {
                    'event': 'bg-blue-500',
                    'caddieBooking': 'bg-green-500',
                    'waitlist': 'bg-orange-500'
                };
                return colors[type] || 'bg-gray-500';
            },

            getStatusColor(status) {
                const colors = {
                    'confirmed': 'bg-green-100 text-green-800',
                    'registered': 'bg-blue-100 text-blue-800',
                    'waiting': 'bg-orange-100 text-orange-800',
                    'cancelled': 'bg-red-100 text-red-800',
                    'completed': 'bg-gray-100 text-gray-800'
                };
                return colors[status] || 'bg-gray-100 text-gray-800';
            }
        };

        // Schedule Functions
        function filterSchedule(filter) {
            ScheduleSystem.currentFilter = filter;

            // Update filter button states
            document.querySelectorAll('.schedule-filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.filter === filter) {
                    btn.classList.add('active');
                }
            });

            ScheduleSystem.renderScheduleList();
        }

        function refreshSchedule() {
            LoadingManager.show('Refreshing and syncing...');

            // Force sync to get latest data
            if (typeof ProductionCloudSync !== 'undefined') {
                SimpleCloudSync.saveToCloudSoon();
            }

            setTimeout(() => {
                ScheduleSystem.updateScheduleTab();
                LoadingManager.hide();
                NotificationManager.show('Schedule refreshed and synced', 'success');
            }, 1000);
        }

        function editScheduleItem(itemId) {
            // Find the item in the schedule data
            let item = null;
            let itemType = null;

            // Check events
            item = ScheduleSystem.scheduleData.events.find(e => e.id === itemId);
            if (item) itemType = 'event';

            // Check caddie bookings
            if (!item) {
                item = ScheduleSystem.scheduleData.caddieBookings.find(c => c.id === itemId);
                if (item) itemType = 'caddieBooking';
            }

            // Check waitlists
            if (!item) {
                item = ScheduleSystem.scheduleData.waitlists.find(w => w.id === itemId);
                if (item) itemType = 'waitlist';
            }

            if (!item) {
                NotificationManager.show('Item not found', 'error');
                return;
            }

            // Create edit modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-2xl w-full mx-4 max-h-90vh overflow-y-auto">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-2xl font-bold text-gray-900">
                            ${itemType === 'event' ? 'Edit Tee Time' : itemType === 'caddieBooking' ? 'Edit Caddy Booking' : 'Edit Waitlist Entry'}
                        </h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <span class="material-symbols-outlined">close</span>
                        </button>
                    </div>

                    <div class="space-y-6">
                        ${itemType === 'event' ? `
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Event Title</label>
                                    <input type="text" id="editTitle" value="${item.title || item.eventName || ''}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Course</label>
                                    <input type="text" id="editCourse" value="${item.course || ''}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                                    <input type="date" id="editDate" value="${item.date instanceof Date ? item.date.toISOString().split('T')[0] : item.date}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Time</label>
                                    <input type="time" id="editTime" value="${item.time || ''}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Players</label>
                                    <input type="number" id="editPlayers" value="${item.players || 1}" min="1" max="8"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                                    <select id="editStatus" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                        <option value="confirmed" ${item.status === 'confirmed' ? 'selected' : ''}>Confirmed</option>
                                        <option value="pending" ${item.status === 'pending' ? 'selected' : ''}>Pending</option>
                                        <option value="cancelled" ${item.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                                <textarea id="editNotes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg">${item.notes || ''}</textarea>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-2">Booking Details</h4>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div><span class="text-gray-600">Total Cost:</span> ‡∏ø${item.totalCost ? item.totalCost.toLocaleString() : 'N/A'}</div>
                                    <div><span class="text-gray-600">Payment Method:</span> ${item.paymentMethod || 'N/A'}</div>
                                    <div><span class="text-gray-600">Booked:</span> ${item.createdAt ? new Date(item.createdAt).toLocaleString() : 'N/A'}</div>
                                    <div><span class="text-gray-600">Booking ID:</span> ${item.id}</div>
                                </div>
                            </div>
                        ` : itemType === 'caddieBooking' ? `
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Caddy Name</label>
                                    <input type="text" id="editCaddyName" value="${item.caddieName || ''}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                                    <input type="date" id="editDate" value="${item.date instanceof Date ? item.date.toISOString().split('T')[0] : item.date}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Time</label>
                                    <input type="time" id="editTime" value="${item.time || ''}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                                    <select id="editStatus" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                        <option value="confirmed" ${item.status === 'confirmed' ? 'selected' : ''}>Confirmed</option>
                                        <option value="pending" ${item.status === 'pending' ? 'selected' : ''}>Pending</option>
                                        <option value="cancelled" ${item.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                                    </select>
                                </div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-2">Caddy Details</h4>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div><span class="text-gray-600">Rate:</span> ‡∏ø${item.rate ? item.rate.toLocaleString() : 'N/A'}</div>
                                    <div><span class="text-gray-600">Caddy ID:</span> ${item.caddieId || 'N/A'}</div>
                                    <div><span class="text-gray-600">Booked:</span> ${item.createdAt ? new Date(item.createdAt).toLocaleString() : 'N/A'}</div>
                                    <div><span class="text-gray-600">Booking ID:</span> ${item.id}</div>
                                </div>
                            </div>
                        ` : `
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Caddy Name</label>
                                    <input type="text" id="editCaddyName" value="${item.caddieName || ''}" readonly
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Position</label>
                                    <input type="text" value="#${item.position || 'N/A'}" readonly
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Requested Date</label>
                                    <input type="date" value="${item.requestedDate ? new Date(item.requestedDate).toISOString().split('T')[0] : ''}" readonly
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                                    <input type="text" value="${item.status || 'Waiting'}" readonly
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50">
                                </div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-2">Waitlist Details</h4>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div><span class="text-gray-600">Caddy ID:</span> ${item.caddieId || 'N/A'}</div>
                                    <div><span class="text-gray-600">Joined:</span> ${item.createdAt ? new Date(item.createdAt).toLocaleString() : 'N/A'}</div>
                                    <div><span class="text-gray-600">Entry ID:</span> ${item.id}</div>
                                </div>
                            </div>
                        `}
                    </div>

                    <div class="flex space-x-3 mt-6">
                        <button onclick="saveScheduleItemChanges('${itemId}', '${itemType}', this.closest('.fixed'))" class="btn-primary flex-1">
                            Save Changes
                        </button>
                        <button onclick="this.closest('.fixed').remove()" class="btn-secondary flex-1">
                            Cancel
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        function cancelScheduleItem(itemId) {
            if (confirm('Are you sure you want to cancel this item? This action cannot be undone.')) {
                // Remove from appropriate array
                ScheduleSystem.scheduleData.events = ScheduleSystem.scheduleData.events.filter(e => e.id !== itemId);
                ScheduleSystem.scheduleData.caddieBookings = ScheduleSystem.scheduleData.caddieBookings.filter(c => c.id !== itemId);
                ScheduleSystem.scheduleData.waitlists = ScheduleSystem.scheduleData.waitlists.filter(w => w.id !== itemId);

                ScheduleSystem.updateScheduleTab();
                NotificationManager.show('Item cancelled successfully', 'success');
            }
        }

        function saveScheduleItemChanges(itemId, itemType, modal) {
            let item = null;
            let itemArray = null;

            // Find the item and its array
            if (itemType === 'event') {
                item = ScheduleSystem.scheduleData.events.find(e => e.id === itemId);
                itemArray = ScheduleSystem.scheduleData.events;
            } else if (itemType === 'caddieBooking') {
                item = ScheduleSystem.scheduleData.caddieBookings.find(c => c.id === itemId);
                itemArray = ScheduleSystem.scheduleData.caddieBookings;
            } else if (itemType === 'waitlist') {
                item = ScheduleSystem.scheduleData.waitlists.find(w => w.id === itemId);
                itemArray = ScheduleSystem.scheduleData.waitlists;
            }

            if (!item) {
                NotificationManager.show('Item not found', 'error');
                return;
            }

            // Update item with form data
            if (itemType === 'event') {
                item.title = document.getElementById('editTitle')?.value || item.title;
                item.course = document.getElementById('editCourse')?.value || item.course;
                item.date = document.getElementById('editDate')?.value || item.date;
                item.time = document.getElementById('editTime')?.value || item.time;
                item.players = parseInt(document.getElementById('editPlayers')?.value) || item.players;
                item.status = document.getElementById('editStatus')?.value || item.status;
                item.notes = document.getElementById('editNotes')?.value || item.notes;
            } else if (itemType === 'caddieBooking') {
                item.caddieName = document.getElementById('editCaddyName')?.value || item.caddieName;
                item.date = document.getElementById('editDate')?.value || item.date;
                item.time = document.getElementById('editTime')?.value || item.time;
                item.status = document.getElementById('editStatus')?.value || item.status;
            }
            // Waitlist items are read-only, so no updates needed

            // Save to localStorage
            ScheduleSystem.saveToStorage();

            // Update the display
            ScheduleSystem.updateScheduleTab();

            // Close modal
            modal.remove();

            NotificationManager.show('Changes saved successfully', 'success');
        }

        function saveScheduleItem(itemId) {
            const item = document.querySelector(`[data-id="${itemId}"]`);
            if (item) {
                item.classList.remove('editing');
                const saveBtn = item.querySelector('button[onclick*="save"]');
                if (saveBtn) saveBtn.style.display = 'none';

                NotificationManager.show('Changes saved successfully', 'success');
            }
        }

        function refreshSchedule() {
            try {
                console.log('Refreshing schedule and syncing...');

                // Force sync to get latest data
                if (typeof ProductionCloudSync !== 'undefined') {
                    SimpleCloudSync.saveToCloudSoon();
                }

                // Update schedule display
                ScheduleSystem.updateScheduleTab();
                NotificationManager.show('Schedule refreshed and synced', 'success');
            } catch (error) {
                console.error('Error refreshing schedule:', error);
                NotificationManager.show('Failed to refresh schedule', 'error');
            }
        }

        // Booking and Waitlist Management System
        const BookingManager = {
            bookings: [],
            waitlists: {},

            // Load bookings from localStorage
            loadFromStorage() {
                try {
                    const savedBookings = localStorage.getItem('mcipro_bookings');
                    if (savedBookings) {
                        this.bookings = JSON.parse(savedBookings);
                        console.log('[BookingManager] Loaded', this.bookings.length, 'bookings from localStorage');

                        // Add saved bookings to ScheduleSystem (idempotent)
                        this.bookings.forEach(booking => {
                            if (booking.type === 'teeTime') {
                                ScheduleSystem.addEventForBooking({
                                    type: 'teeTime',
                                    title: `Round at ${booking.course}`,
                                    date: new Date(booking.date),
                                    time: booking.time,
                                    duration: 240,
                                    course: booking.course,
                                    status: booking.status || 'confirmed',
                                    players: booking.players || 1,
                                    notes: booking.eventName || 'Golf round',
                                    canEdit: true,
                                    canCancel: true
                                }, booking.id);
                            }
                        });
                        return true;
                    }
                } catch (error) {
                    console.error('[BookingManager] Failed to load from localStorage:', error);
                }
                return false;
            },

            // Initialize - load existing bookings instead of clearing
            initialize() {
                console.log('[BookingManager] Initializing - loading existing bookings');

                // Load existing bookings first
                const loaded = this.loadFromStorage();
                if (!loaded) {
                    // Only start empty if no data exists
                    this.bookings = [];
                    this.waitlists = {};
                }

                console.log('[BookingManager] Initialized with', this.bookings.length, 'existing bookings');
                return;
                // Sample golf event bookings for golfers
                this.bookings = [
                    {
                        id: 'booking_001',
                        golferId: 'golfer_john_mitchell',
                        eventName: 'Weekend Championship Round',
                        course: 'Pattaya Golf Club',
                        date: '2024-10-15',
                        time: '08:00',
                        players: 4,
                        status: 'confirmed',
                        caddieId: 'pat001',
                        caddieName: 'Ning Prasert',
                        totalCost: 3200,
                        createdAt: '2024-10-01T10:30:00Z'
                    },
                    {
                        id: 'booking_ning_current',
                        golferId: 'golfer_sarah_johnson',
                        eventName: 'Private Golf Lesson',
                        course: 'Pattana Golf Resort & Spa',
                        date: '2025-01-15',
                        time: '09:00',
                        players: 1,
                        status: 'active',
                        caddieId: 'pat001',
                        caddieName: 'Ning Prasert',
                        totalCost: 2500,
                        createdAt: '2025-01-15T08:00:00Z',
                        endTime: '13:00',
                        notes: 'Championship course coaching session'
                    },
                    {
                        id: 'booking_002',
                        golferId: 'golfer_john_mitchell',
                        eventName: 'Corporate Golf Day',
                        course: 'Thai Country Club',
                        date: '2024-10-22',
                        time: '14:00',
                        players: 8,
                        status: 'pending',
                        caddieId: 'c002',
                        caddieName: 'Somchai Jaidee',
                        totalCost: 8500,
                        createdAt: '2024-10-05T14:15:00Z'
                    },
                    {
                        id: 'booking_003',
                        golferId: 'golfer_john_mitchell',
                        eventName: 'Monthly Society Round',
                        course: 'Siam Plantation Golf',
                        date: '2024-11-03',
                        time: '10:30',
                        players: 2,
                        status: 'completed',
                        caddieId: 'c003',
                        caddieName: 'Apinya Thaworn',
                        totalCost: 2100,
                        createdAt: '2024-09-28T16:45:00Z'
                    }
                ];

                // Initialize waitlists with current user data
                this.waitlists = {
                    'c002': [
                        {
                            golferId: 'golfer_john_mitchell',
                            golferName: 'John Mitchell',
                            position: 1,
                            requestDate: '2024-10-08T09:30:00Z',
                            priority: 'high',
                            event: 'VIP Tournament Round'
                        }
                    ],
                    'c004': [
                        {
                            golferId: 'golfer_john_mitchell',
                            golferName: 'John Mitchell',
                            position: 3,
                            requestDate: '2024-10-10T11:20:00Z',
                            priority: 'normal',
                            event: 'Luxury Weekend Package'
                        }
                    ]
                };
            },

            getGolferBookings(golferId) {
                return this.bookings.filter(booking => booking.golferId === golferId);
            },

            getGolferWaitlists(golferId) {
                const waitlists = [];
                Object.entries(this.waitlists).forEach(([caddieId, list]) => {
                    const entry = list.find(w => w.golferId === golferId);
                    if (entry) {
                        const caddie = CaddySystem.allCaddys.find(c => c.id === caddieId);
                        waitlists.push({
                            ...entry,
                            caddieId,
                            caddieName: caddie?.name || 'Unknown',
                            caddieRating: caddie?.rating || 0,
                            caddieAvatar: caddie?.avatar || 'üë®'
                        });
                    }
                });
                return waitlists.sort((a, b) => a.position - b.position);
            },

            addToWaitlist(caddieId, golferData) {
                if (!this.waitlists[caddieId]) {
                    this.waitlists[caddieId] = [];
                }

                const position = this.waitlists[caddieId].length + 1;
                const waitlistEntry = {
                    ...golferData,
                    position,
                    requestDate: new Date().toISOString(),
                    priority: 'normal'
                };

                this.waitlists[caddieId].push(waitlistEntry);

                // Add to Schedule System
                const caddie = CaddySystem.allCaddys.find(c => c.id === caddieId);
                ScheduleSystem.addToWaitlist({
                    title: `Waitlist: ${caddie?.name || 'Unknown Caddy'}`,
                    caddieName: caddie?.name || 'Unknown',
                    caddieId: caddieId,
                    position: position,
                    requestedDate: new Date(),
                    status: 'waiting',
                    canEdit: true,
                    canCancel: true
                });

                return waitlistEntry;
            },

            getCaddyBookings(caddieId) {
                return this.bookings.filter(booking => booking.caddieId === caddieId);
            },

            getCaddyWaitlists(caddieId) {
                return this.waitlists[caddieId] || [];
            },

            addBooking(bookingData) {
                console.log('[BookingManager.addBooking] Input data:', bookingData);

                // Generate stable ID to prevent duplicates
                const bookingId = newBookingId(bookingData);

                const booking = {
                    id: bookingId,
                    ...bookingData,
                    updatedAt: Date.now(),
                    createdAt: bookingData.createdAt || new Date().toISOString()
                };

                console.log('[BookingManager.addBooking] Created booking object:', booking);
                console.log('[BookingManager.addBooking] Current bookings before upsert:', this.bookings.length);

                // Use upsert to prevent duplicates
                this.bookings = upsertById(this.bookings, booking, 'id');

                console.log('[BookingManager.addBooking] Current bookings after upsert:', this.bookings.length);
                console.log('[BookingManager.addBooking] Latest booking:', this.bookings[this.bookings.length - 1]);

                // Schedule events are now handled by ScheduleSystem.upsertFromBooking

                if (bookingData.caddieId) {
                    ScheduleSystem.addCaddyBooking({
                        title: `Caddy: ${bookingData.caddieName}`,
                        eventId: booking.id,
                        caddieName: bookingData.caddieName,
                        caddieId: bookingData.caddieId,
                        date: new Date(bookingData.date),
                        time: bookingData.time,
                        status: bookingData.status || 'confirmed',
                        rate: `‡∏ø${bookingData.totalCost || 1200}`,
                        canEdit: true,
                        canCancel: true
                    });
                }

                // CRITICAL FIX: Save to localStorage and trigger debounced cloud sync
                console.log('[BookingManager] BOOKING ADDED - SAVING AND SYNCING');
                this.saveToLocalStorage();

                return booking;
            },

            updateBookingStatus(bookingId, status) {
                const booking = this.bookings.find(b => b.id === bookingId);
                if (booking) {
                    booking.status = status;
                    booking.updatedAt = new Date().toISOString();

                    // Save to localStorage and trigger cloud sync
                    console.log('[BookingManager] BOOKING STATUS UPDATED - SAVING AND SYNCING');
                    this.saveToLocalStorage();
                }
                return booking;
            },

            removeFromWaitlist(caddieId, golferId) {
                if (this.waitlists[caddieId]) {
                    this.waitlists[caddieId] = this.waitlists[caddieId].filter(w => w.golferId !== golferId);
                    // Update positions
                    this.waitlists[caddieId].forEach((entry, index) => {
                        entry.position = index + 1;
                    });
                }
            },

            saveToLocalStorage() {
                try {
                    localStorage.setItem('mcipro_bookings', JSON.stringify(this.bookings));
                    localStorage.setItem('mcipro_waitlists', JSON.stringify(this.waitlists));
                    localStorage.setItem('last_local_update', new Date().toISOString());
                    console.log('[BookingManager] Data saved to localStorage');

                    // DEBOUNCED SYNC TO PREVENT CONFLICTS
                    console.log('[BookingManager] BOOKING SAVED - SCHEDULING SYNC');
                    SimpleCloudSync.saveToCloudSoon();
                } catch (error) {
                    console.error('[BookingManager] Failed to save to localStorage:', error);
                }
            },

            // BULK DELETE DUPLICATE BOOKINGS
            removeDuplicateBookings() {
                console.log('[BookingManager] Starting duplicate removal, current bookings:', this.bookings.length);

                const uniqueBookings = [];
                const seenKeys = new Set();

                this.bookings.forEach(booking => {
                    // Create unique key from essential booking data
                    const key = `${booking.type}-${booking.course}-${booking.date}-${booking.time}-${booking.golferId}`;

                    if (!seenKeys.has(key)) {
                        seenKeys.add(key);
                        uniqueBookings.push(booking);
                    } else {
                        console.log('[BookingManager] Removing duplicate:', booking);
                    }
                });

                const removedCount = this.bookings.length - uniqueBookings.length;
                this.bookings = uniqueBookings;

                console.log(`[BookingManager] Removed ${removedCount} duplicate bookings, ${this.bookings.length} remaining`);

                // Save cleaned data
                this.saveToLocalStorage();

                return removedCount;
            },

            // CLEAR ALL BOOKINGS (for testing)
            clearAllBookings() {
                const count = this.bookings.length;
                this.bookings = [];
                this.saveToLocalStorage();
                console.log(`[BookingManager] Cleared ${count} bookings`);
                return count;
            }
        };

        // Caddy Booking Functions for Featured Caddys
        function bookCaddyFromFeature(caddieId, caddieName) {
            try {
                console.log(`Featured caddie booking: ${caddieId} - ${caddieName}`);

                // Find the caddie in the system
                const caddie = CaddySystem.allCaddys.find(c => c.id === caddieId);
                if (!caddie) {
                    NotificationManager.show('Caddy not found', 'error');
                    return;
                }

                // Find the course this caddie works at
                const course = GolfCoursesDatabase.courses.find(c => c.homeClub === caddie.homeClub);
                if (!course) {
                    NotificationManager.show('Course not found for this caddie', 'error');
                    return;
                }

                // Switch to booking tab
                showGolferTab('booking', null);

                // Wait for tab to load, then pre-select the course and add caddie to cart
                setTimeout(() => {
                    // Pre-select the course (this will auto-add to cart)
                    selectCourse(course.id);

                    // Wait a bit more, then add the caddie to cart
                    setTimeout(() => {
                        addCaddyToCart(caddie, 'booking');

                        // Show success message
                        NotificationManager.show(`${caddieName} added to cart at ${course.name}`, 'success');

                        // Scroll to cart to show the items
                        const cartSection = document.getElementById('bookingCartContainer');
                        if (cartSection) {
                            cartSection.scrollIntoView({ behavior: 'smooth' });
                        }
                    }, 300);

                }, 500);

            } catch (error) {
                console.error('Error in featured caddie booking:', error);
                NotificationManager.show('Failed to open booking page', 'error');
            }
        }

        function joinWaitlistFromFeature(caddieId, caddieName) {
            try {
                // Get current user info
                const currentUser = AppState.currentUser;
                if (!currentUser || !currentUser.name) {
                    NotificationManager.show('Please log in to join waitlist', 'error');
                    return;
                }

                const golferData = {
                    golferId: currentUser.name.toLowerCase().replace(' ', '_'),
                    golferName: currentUser.name,
                    event: 'Future Golf Round'
                };

                // Add to waitlist through BookingManager (which will auto-add to Schedule)
                const waitlistEntry = BookingManager.addToWaitlist(caddieId, golferData);

                NotificationManager.show(`Successfully joined waitlist for ${caddieName} (Position #${waitlistEntry.position})`, 'success');

                // Switch to schedule tab to show the waitlist entry
                setTimeout(() => {
                    showGolferTab('schedule', null);
                }, 1500);

            } catch (error) {
                console.error('Error joining waitlist:', error);
                NotificationManager.show('Failed to join waitlist', 'error');
            }
        }

        // ===== ENHANCED GOLF COURSE & CADDIE BOOKING SYSTEM =====

        // Golf Courses Database - Pattaya Area
        const GolfCoursesDatabase = {
            courses: [
                {
                    id: 'pattana-golf-resort',
                    name: 'Pattana Golf Resort & Spa',
                    location: 'Na Jomtien, Sattahip',
                    type: 'Championship',
                    holes: 18,
                    par: 72,
                    price: 3200,
                    rating: 4.8,
                    image: 'üèåÔ∏è‚Äç‚ôÇÔ∏è',
                    features: ['Championship Course', 'Spa', 'Resort', 'Ocean Views'],
                    homeClub: 'pattana-golf-resort',
                    description: 'Premier championship course with stunning ocean views'
                },
                {
                    id: 'pattaya-golf-club',
                    name: 'Pattaya Golf Club',
                    location: 'Central Pattaya',
                    type: 'Championship',
                    holes: 18,
                    par: 72,
                    price: 2500,
                    rating: 4.6,
                    image: '‚õ≥',
                    features: ['City Course', 'Pro Shop', 'Restaurant'],
                    homeClub: 'pattaya-golf',
                    description: 'Classic championship course in the heart of Pattaya'
                },
                {
                    id: 'thai-country-club',
                    name: 'Thai Country Club',
                    location: 'Chonburi',
                    type: 'Championship',
                    holes: 18,
                    par: 72,
                    price: 3500,
                    rating: 4.9,
                    image: 'üèÜ',
                    features: ['Tournament Course', 'VIP Service', 'Luxury Facilities'],
                    homeClub: 'thai-country-club',
                    description: 'World-class tournament venue with premium facilities'
                },
                {
                    id: 'siam-plantation',
                    name: 'Siam Plantation Golf Club',
                    location: 'Pattaya',
                    type: 'Resort',
                    holes: 18,
                    par: 71,
                    price: 2800,
                    rating: 4.7,
                    image: 'üå¥',
                    features: ['Resort Course', 'Tropical Setting', 'Family Friendly'],
                    homeClub: 'siam-plantation',
                    description: 'Beautiful resort course with tropical landscaping'
                },
                {
                    id: 'royal-garden',
                    name: 'Royal Garden Golf Club',
                    location: 'Jomtien',
                    type: 'Executive',
                    holes: 18,
                    par: 65,
                    price: 1800,
                    rating: 4.4,
                    image: 'üëë',
                    features: ['Executive Course', 'Quick Play', 'Beginner Friendly'],
                    homeClub: 'royal-garden',
                    description: 'Executive course perfect for quick rounds'
                },
                {
                    id: 'bangpra-international',
                    name: 'Bangpra International Golf Club',
                    location: 'Sriracha',
                    type: 'Championship',
                    holes: 18,
                    par: 72,
                    price: 2200,
                    rating: 4.5,
                    image: 'üåä',
                    features: ['Seaside Course', 'Wind Challenge', 'Scenic Views'],
                    homeClub: 'bangpra-international',
                    description: 'Challenging seaside course with ocean breezes'
                },
                {
                    id: 'crystal-bay',
                    name: 'Crystal Bay Golf Club',
                    location: 'Pattaya',
                    type: 'Resort',
                    holes: 18,
                    par: 70,
                    price: 2400,
                    rating: 4.3,
                    image: 'üíé',
                    features: ['Bay Views', 'Resort Amenities', 'Practice Facilities'],
                    homeClub: 'crystal-bay',
                    description: 'Scenic course overlooking Crystal Bay'
                },
                {
                    id: 'laem-chabang',
                    name: 'Laem Chabang International Country Club',
                    location: 'Chonburi',
                    type: 'Championship',
                    holes: 27,
                    par: 72,
                    price: 3000,
                    rating: 4.6,
                    image: 'üö¢',
                    features: ['27 Holes', 'International Standard', 'Corporate Events'],
                    homeClub: 'laem-chabang',
                    description: '27-hole championship complex near the port'
                }
            ],

            searchCourses(query) {
                if (!query) return this.courses;
                return this.courses.filter(course =>
                    course.name.toLowerCase().includes(query.toLowerCase()) ||
                    course.location.toLowerCase().includes(query.toLowerCase()) ||
                    course.type.toLowerCase().includes(query.toLowerCase()) ||
                    course.features.some(f => f.toLowerCase().includes(query.toLowerCase()))
                );
            },

            getCourseById(id) {
                return this.courses.find(course => course.id === id);
            }
        };

        // Enhanced Booking System State
        let selectedCourse = null;
        let selectedCaddys = [];
        let filteredCaddys = [];

        // Initialize courses on page load
        function initializeBookingSystem() {
            loadAllCourses();

            // Set minimum date for booking
            const dateInput = document.getElementById('bookingDate');
            if (dateInput) {
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                dateInput.min = tomorrow.toISOString().split('T')[0];

                // Set default date to tomorrow if no date is selected
                if (!dateInput.value) {
                    dateInput.value = tomorrow.toISOString().split('T')[0];
                }
            }

            // Set default time if none selected
            const timeInput = document.getElementById('bookingTime');
            if (timeInput && !timeInput.value) {
                timeInput.value = '08:00'; // Default to 8:00 AM
            }
        }

        function loadAllCourses() {
            const courseGrid = document.getElementById('courseGrid');
            const courseGridMobile = document.getElementById('courseGridMobile');

            const courses = GolfCoursesDatabase.courses;

            // Desktop grid
            if (courseGrid) {
                courseGrid.innerHTML = courses.map(course => createCourseCard(course)).join('');
            }

            // Mobile horizontal scroll
            if (courseGridMobile) {
                courseGridMobile.innerHTML = courses.map(course => createMobileCourseCard(course)).join('');
            }
        }

        function createMobileCourseCard(course) {
            return `
                <div class="flex-shrink-0 w-72 bg-white border-2 border-gray-200 rounded-xl cursor-pointer hover:border-primary-500 transition-all p-4"
                     data-course="${course.id}" onclick="selectCourse('${course.id}')">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-2">
                            <span class="text-2xl">${course.image}</span>
                            <div>
                                <h4 class="font-bold text-gray-900 text-sm">${course.name}</h4>
                                <p class="text-xs text-gray-600">${course.location}</p>
                            </div>
                        </div>
                        <span class="text-primary-600 font-bold text-sm">‡∏ø${course.price.toLocaleString()}</span>
                    </div>

                    <div class="mb-3">
                        <div class="flex items-center space-x-3 text-xs text-gray-600 mb-1">
                            <span>${course.holes} holes ‚Ä¢ Par ${course.par}</span>
                            <span class="flex items-center">
                                <span class="material-symbols-outlined text-yellow-500 text-xs mr-1">star</span>
                                ${course.rating}
                            </span>
                        </div>
                        <p class="text-xs text-gray-600">${course.description}</p>
                    </div>

                    <div class="flex flex-wrap gap-1">
                        ${course.features.slice(0, 2).map(feature =>
                            `<span class="bg-primary-100 text-primary-800 text-xs px-2 py-1 rounded">${feature}</span>`
                        ).join('')}
                        ${course.features.length > 2 ? `<span class="text-xs text-gray-500">+${course.features.length - 2} more</span>` : ''}
                    </div>
                </div>
            `;
        }

        function createCourseCard(course) {
            return `
                <div class="course-card p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-primary-500 transition-all"
                     data-course="${course.id}" onclick="selectCourse('${course.id}')">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-2">
                            <span class="text-2xl">${course.image}</span>
                            <div>
                                <h4 class="font-bold text-gray-900 text-sm">${course.name}</h4>
                                <p class="text-xs text-gray-600">${course.location}</p>
                            </div>
                        </div>
                        <span class="text-primary-600 font-bold text-sm">‡∏ø${course.price.toLocaleString()}</span>
                    </div>

                    <div class="mb-3">
                        <div class="flex items-center space-x-3 text-xs text-gray-600 mb-1">
                            <span>${course.holes} holes ‚Ä¢ Par ${course.par}</span>
                            <span class="flex items-center">
                                <span class="material-symbols-outlined text-yellow-500 text-xs mr-1">star</span>
                                ${course.rating}
                            </span>
                        </div>
                        <p class="text-xs text-gray-600">${course.description}</p>
                    </div>

                    <div class="flex flex-wrap gap-1">
                        ${course.features.slice(0, 2).map(feature =>
                            `<span class="bg-primary-100 text-primary-800 text-xs px-2 py-1 rounded">${feature}</span>`
                        ).join('')}
                        ${course.features.length > 2 ? `<span class="text-xs text-gray-500">+${course.features.length - 2} more</span>` : ''}
                    </div>
                </div>
            `;
        }

        function filterCourses(query) {
            const courseGrid = document.getElementById('courseGrid');
            const courseGridMobile = document.getElementById('courseGridMobile');

            const courses = GolfCoursesDatabase.searchCourses(query);

            if (courses.length === 0) {
                if (courseGrid) {
                    courseGrid.innerHTML = `
                        <div class="col-span-3 text-center text-gray-600 py-8">
                            <span class="material-symbols-outlined text-4xl text-gray-400 mb-2">search_off</span>
                            <p>No courses found for "${query}"</p>
                            <p class="text-sm">Try searching for Pattana, Championship, or Resort</p>
                        </div>
                    `;
                }
                if (courseGridMobile) {
                    courseGridMobile.innerHTML = `
                        <div class="flex-shrink-0 w-72 text-center text-gray-600 py-8">
                            <span class="material-symbols-outlined text-4xl text-gray-400 mb-2">search_off</span>
                            <p>No courses found</p>
                        </div>
                    `;
                }
            } else {
                if (courseGrid) {
                    courseGrid.innerHTML = courses.map(course => createCourseCard(course)).join('');
                }
                if (courseGridMobile) {
                    courseGridMobile.innerHTML = courses.map(course => createMobileCourseCard(course)).join('');
                }
            }
        }

        function selectCourse(courseId) {
            console.log('selectCourse called with:', courseId);
            selectedCourse = GolfCoursesDatabase.getCourseById(courseId);
            console.log('Selected course:', selectedCourse);

            if (!selectedCourse) {
                console.error('Course not found:', courseId);
                NotificationManager.show('Course not found', 'error');
                return;
            }

            // Update UI to show selected course
            updateSelectedCourseDisplay();

            // Load caddies for this course
            console.log('Loading caddies for homeClub:', selectedCourse.homeClub);
            loadCaddysForCourse(selectedCourse.homeClub);

            // Update course card styles
            document.querySelectorAll('.course-card').forEach(card => {
                card.classList.remove('border-primary-500', 'bg-primary-50');
                card.classList.add('border-gray-200');
            });

            const selectedCard = document.querySelector(`[data-course=\"${courseId}\"]`);
            if (selectedCard) {
                selectedCard.classList.remove('border-gray-200');
                selectedCard.classList.add('border-primary-500', 'bg-primary-50');
            } else {
                console.warn('Selected course card not found:', courseId);
            }

            // Show caddie selection section
            const caddieSection = document.getElementById('caddieSelectionSection');
            if (caddieSection) {
                caddieSection.style.display = 'block';
                console.log('Caddy selection section shown');
            } else {
                console.error('Caddy selection section not found');
            }

            // Add course to cart
            addCourseToCart(selectedCourse);
        }

        function updateSelectedCourseDisplay() {
            const selectedCourseInfo = document.getElementById('selectedCourseInfo');
            const selectedCourseName = document.getElementById('selectedCourseName');

            if (selectedCourse && selectedCourseInfo && selectedCourseName) {
                selectedCourseName.textContent = `${selectedCourse.name} - ‡∏ø${selectedCourse.price.toLocaleString()}`;
                selectedCourseInfo.classList.remove('hidden');
            }
        }

        function loadCaddysForCourse(homeClub) {
            console.log('loadCaddysForCourse called with homeClub:', homeClub);
            console.log('Available caddies:', CaddySystem.allCaddys);

            // Filter caddies by their home club
            const courseCaddys = CaddySystem.allCaddys.filter(caddie => {
                console.log(`Checking caddie ${caddie.name}: ${caddie.homeClub} === ${homeClub}?`, caddie.homeClub === homeClub);
                return caddie.homeClub === homeClub;
            });

            console.log('Filtered caddies for course:', courseCaddys);

            filteredCaddys = courseCaddys;
            renderCaddys(courseCaddys);
            updateCaddyStats(courseCaddys);
        }

        function renderCaddys(caddies) {
            const caddieGrid = document.getElementById('caddieGrid');
            const caddieGridMobile = document.getElementById('caddieGridMobile');

            if (caddies.length === 0) {
                if (caddieGrid) {
                    caddieGrid.innerHTML = `
                        <div class="col-span-2 text-center text-gray-600 py-8">
                            <span class="material-symbols-outlined text-4xl text-gray-400 mb-2">person_off</span>
                            <p>No caddies available at this course</p>
                        </div>
                    `;
                }
                if (caddieGridMobile) {
                    caddieGridMobile.innerHTML = `
                        <div class="flex-shrink-0 w-72 text-center text-gray-600 py-8">
                            <span class="material-symbols-outlined text-4xl text-gray-400 mb-2">person_off</span>
                            <p class="text-sm">No caddies available at this course</p>
                        </div>
                    `;
                }
                return;
            }

            // Desktop grid
            if (caddieGrid) {
                caddieGrid.innerHTML = caddies.map(caddie => createCaddyCard(caddie)).join('');
            }

            // Mobile horizontal scroll
            if (caddieGridMobile) {
                caddieGridMobile.innerHTML = caddies.map(caddie => createMobileCaddyCard(caddie)).join('');
            }
        }

        function createMobileCaddyCard(caddie) {
            const isAvailable = caddie.availability === 'available';
            const isBooked = caddie.availability === 'booked';

            return `
                <div class="flex-shrink-0 w-72 caddie-card p-4 border-2 ${isAvailable ? 'border-green-200 bg-green-50' : isBooked ? 'border-red-200 bg-red-50' : 'border-yellow-200 bg-yellow-50'} rounded-xl transition-all"
                     data-caddie="${caddie.id}">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl">${caddie.avatar}</span>
                            <div>
                                <h4 class="font-bold text-gray-900 text-sm">${caddie.name}</h4>
                                <p class="text-xs text-gray-600">${caddie.specialty}</p>
                                <div class="flex items-center space-x-1 mt-1">
                                    <span class="text-yellow-400 text-xs">‚òÖ</span>
                                    <span class="text-xs text-gray-600">${caddie.rating}</span>
                                    <span class="text-xs text-gray-500">(${caddie.reviews})</span>
                                </div>
                            </div>
                        </div>
                        <span class="text-xs font-semibold px-2 py-1 rounded-full ${isAvailable ? 'bg-green-100 text-green-800' : isBooked ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'}">
                            ${caddie.availability}
                        </span>
                    </div>

                    <div class="mb-3">
                        <div class="flex items-center justify-between text-xs text-gray-600 mb-2">
                            <span>Exp: ${caddie.experience} years</span>
                            <span>Rate: ‡∏ø1,200</span>
                        </div>
                        <div class="flex flex-wrap gap-1">
                            ${caddie.languages.slice(0, 2).map(lang =>
                                `<span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">${lang}</span>`
                            ).join('')}
                        </div>
                    </div>

                    <div class="space-y-2">
                        ${isAvailable ?
                            `<button onclick="addCaddyToCart(${JSON.stringify(caddie).replace(/"/g, '&quot;')}, 'booking')" class="w-full bg-green-600 text-white py-2 px-3 rounded-lg text-xs font-semibold hover:bg-green-700 transition-colors">
                                Book Now - ‡∏ø1,200
                            </button>` :
                            `<button onclick="addCaddyToCart(${JSON.stringify(caddie).replace(/"/g, '&quot;')}, 'waitlist')" class="w-full bg-orange-600 text-white py-2 px-3 rounded-lg text-xs font-semibold hover:bg-orange-700 transition-colors">
                                Join Waitlist
                            </button>`
                        }
                    </div>
                </div>
            `;
        }

        function createCaddyCard(caddie) {
            const isAvailable = caddie.availability === 'available';
            const isBooked = caddie.availability === 'booked';

            return `
                <div class="caddie-card p-4 border-2 ${isAvailable ? 'border-green-200 bg-green-50' : isBooked ? 'border-red-200 bg-red-50' : 'border-yellow-200 bg-yellow-50'} rounded-xl transition-all"
                     data-caddie="${caddie.id}">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl">${caddie.avatar}</span>
                            <div class="flex-1">
                                <div class="flex items-center space-x-2 mb-1">
                                    <h5 class="font-bold text-gray-900">${caddie.name}</h5>
                                    <span class="text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded">#${caddie.id.replace('c', '')}</span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600">
                                    <span class="material-symbols-outlined text-yellow-500 text-sm mr-1">star</span>
                                    <span>${caddie.rating} ‚Ä¢ ${caddie.experience} years exp</span>
                                </div>
                                <p class="text-xs text-gray-600 mt-1">${caddie.specialty}</p>
                            </div>
                        </div>

                        <div class="text-right">
                            <div class="mb-2">
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${
                                    isAvailable ? 'bg-green-100 text-green-800' :
                                    isBooked ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'
                                }">
                                    ${isAvailable ? '‚úÖ Available' : isBooked ? 'üî¥ Booked' : 'üü° Busy'}
                                </span>
                            </div>

                            ${isAvailable ?
                                `<button onclick="bookCaddyFromBooking('${caddie.id}', '${caddie.name}')"
                                        class="bg-green-600 text-white text-xs py-2 px-3 rounded-lg hover:bg-green-700 transition-colors w-full mb-1">
                                    <span class="material-symbols-outlined text-xs mr-1">event_available</span>
                                    Book Now
                                </button>` :
                                `<button onclick="joinWaitlistFromBooking('${caddie.id}', '${caddie.name}')"
                                        class="bg-orange-500 text-white text-xs py-2 px-3 rounded-lg hover:bg-orange-600 transition-colors w-full mb-1">
                                    <span class="material-symbols-outlined text-xs mr-1">schedule</span>
                                    Join Waitlist
                                </button>`
                            }

                            <button onclick="selectCaddy('${caddie.id}', false)"
                                    class="bg-gray-100 text-gray-700 text-xs py-1 px-3 rounded-lg hover:bg-gray-200 transition-colors w-full">
                                <span class="material-symbols-outlined text-xs mr-1">info</span>
                                Details
                            </button>
                        </div>
                    </div>

                    <div class="border-t pt-3">
                        <div class="flex flex-wrap gap-1 mb-2">
                            ${caddie.languages.map(lang =>
                                `<span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">${lang}</span>`
                            ).join('')}
                        </div>

                        <div class="text-xs text-gray-600">
                            <span class="font-medium">${caddie.totalRounds.toLocaleString()}</span> rounds ‚Ä¢
                            <span class="font-medium">${caddie.reviews}</span> reviews
                        </div>
                    </div>
                </div>
            `;
        }

        function filterCaddys(query) {
            if (!filteredCaddys.length) return;

            const filtered = filteredCaddys.filter(caddie =>
                caddie.name.toLowerCase().includes(query.toLowerCase()) ||
                caddie.id.toLowerCase().includes(query.toLowerCase()) ||
                caddie.specialty.toLowerCase().includes(query.toLowerCase()) ||
                caddie.languages.some(lang => lang.toLowerCase().includes(query.toLowerCase()))
            );

            renderCaddys(filtered);
        }

        function updateCaddyStats(caddies) {
            const availableCount = caddies.filter(c => c.availability === 'available').length;
            const waitlistCount = caddies.filter(c => c.availability === 'booked').length;

            const availableElement = document.getElementById('availableCaddyCount');
            const waitlistElement = document.getElementById('waitlistCaddyCount');

            if (availableElement) availableElement.textContent = availableCount;
            if (waitlistElement) waitlistElement.textContent = waitlistCount;
        }

        function bookCaddyFromBooking(caddieId, caddieName) {
            if (!selectedCourse) {
                NotificationManager.show('Please select a course first', 'error');
                return;
            }

            // Add to selected caddies
            if (!selectedCaddys.includes(caddieId)) {
                selectedCaddys.push(caddieId);
            }

            NotificationManager.show(`${caddieName} added to your booking`, 'success');

            // Update card to show selected state
            const caddieCard = document.querySelector(`[data-caddie="${caddieId}"]`);
            if (caddieCard) {
                caddieCard.classList.add('border-primary-500', 'bg-primary-50');
            }
        }

        function joinWaitlistFromBooking(caddieId, caddieName) {
            joinWaitlistFromFeature(caddieId, caddieName);
        }

        // ===== BOOKING CART SYSTEM =====
        let bookingCart = {
            course: null,
            date: null,
            time: null,
            players: 1,
            caddies: [],
            waitlists: [],
            services: [],
            totals: {
                courseTotal: 0,
                caddieTotal: 0,
                servicesTotal: 0,
                serviceCharge: 0,
                grandTotal: 0
            }
        };

        function initializeBookingCart() {
            updateBookingCartDisplay();
        }

        function addCourseToCart(course) {
            bookingCart.course = course;
            updateBookingCartDisplay();
            NotificationManager.show(`${course.name} added to cart`, 'success');
        }

        function addCaddyToCart(caddie, type = 'booking') {
            const cartItem = {
                id: caddie.id,
                name: caddie.name,
                type: type, // 'booking' or 'waitlist'
                rate: type === 'booking' ? 1200 : 0, // Standard caddie rate
                specialty: caddie.specialty,
                rating: caddie.rating,
                avatar: caddie.avatar
            };

            if (type === 'booking') {
                // Check if already in cart
                const existing = bookingCart.caddies.find(c => c.id === caddie.id);
                if (existing) {
                    NotificationManager.show(`${caddie.name} is already in your cart`, 'warning');
                    return;
                }
                bookingCart.caddies.push(cartItem);
            } else {
                // Add to waitlist
                const existing = bookingCart.waitlists.find(w => w.id === caddie.id);
                if (existing) {
                    NotificationManager.show(`You're already on ${caddie.name}'s waitlist`, 'warning');
                    return;
                }
                bookingCart.waitlists.push(cartItem);
            }

            updateBookingCartDisplay();
            NotificationManager.show(`${caddie.name} ${type === 'booking' ? 'booked' : 'added to waitlist'}`, 'success');
        }

        function toggleServiceNew(serviceId) {
            const serviceOptions = [
                { id: 'cart', name: 'Golf Cart Rental', price: 600, icon: 'üöó', description: 'Electric golf cart for 2 players' },
                { id: 'clubs', name: 'Club Rental Set', price: 400, icon: '‚õ≥', description: 'Premium club set with bag' },
                { id: 'shoes', name: 'Golf Shoes Rental', price: 200, icon: 'üëü', description: 'Professional golf shoes' },
                { id: 'insurance', name: 'Play Insurance', price: 150, icon: 'üõ°Ô∏è', description: 'Covers medical & equipment' },
                { id: 'lesson', name: 'Pro Lesson (30min)', price: 800, icon: 'üéØ', description: 'One-on-one instruction' }
            ];

            const service = serviceOptions.find(s => s.id === serviceId);
            if (!service) return;

            // Initialize services array if it doesn't exist
            if (!bookingCart.services) {
                bookingCart.services = [];
            }

            const existingIndex = bookingCart.services.findIndex(s => s.id === serviceId);
            const serviceElements = document.querySelectorAll(`[data-service="${serviceId}"]`);

            if (existingIndex >= 0) {
                // Remove service
                bookingCart.services.splice(existingIndex, 1);
                serviceElements.forEach(el => {
                    el.classList.remove('border-primary-500', 'bg-primary-50');
                    el.classList.add('border-gray-200');
                });
                NotificationManager.show(`${service.name} removed from cart`, 'info');
            } else {
                // Add service
                bookingCart.services.push(service);
                serviceElements.forEach(el => {
                    el.classList.remove('border-gray-200');
                    el.classList.add('border-primary-500', 'bg-primary-50');
                });
                NotificationManager.show(`${service.name} added to cart`, 'success');
            }

            updateBookingCartDisplay();
        }

        function removeCaddyFromCart(caddieId, type = 'booking') {
            if (type === 'booking') {
                bookingCart.caddies = bookingCart.caddies.filter(c => c.id !== caddieId);
            } else {
                bookingCart.waitlists = bookingCart.waitlists.filter(w => w.id !== caddieId);
            }
            updateBookingCartDisplay();
        }

        function updateBookingCartDisplay() {
            const container = document.getElementById('bookingCartContainer');
            const itemCount = document.getElementById('cartItemCount');
            const confirmBtn = document.getElementById('confirmBookingBtn');

            if (!container) return;

            const totalItems = bookingCart.caddies.length + bookingCart.waitlists.length + (bookingCart.course ? 1 : 0) + (bookingCart.services ? bookingCart.services.length : 0);

            // Update item count
            if (itemCount) itemCount.textContent = totalItems;

            // Calculate totals
            calculateCartTotals();

            // Update cart display
            if (totalItems === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-600 py-8">
                        <span class="material-symbols-outlined text-4xl text-gray-400 mb-2">shopping_cart</span>
                        <p class="text-sm">Your cart is empty</p>
                        <p class="text-xs">Select a course and caddies to start</p>
                    </div>
                `;
                if (confirmBtn) {
                    confirmBtn.disabled = true;
                    confirmBtn.classList.add('opacity-50', 'cursor-not-allowed');
                }
            } else {
                let cartHTML = '';

                // Course item
                if (bookingCart.course) {
                    cartHTML += `
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <span class="text-lg">${bookingCart.course.image}</span>
                                    <div>
                                        <h5 class="font-semibold text-sm text-gray-900">${bookingCart.course.name}</h5>
                                        <p class="text-xs text-gray-600">${bookingCart.course.holes} holes ‚Ä¢ Par ${bookingCart.course.par}</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span class="font-semibold text-sm text-blue-600">‡∏ø${bookingCart.course.price.toLocaleString()}</span>
                                    <button onclick="removeCourseFromCart()" class="block mt-1 text-red-600 hover:text-red-700">
                                        <span class="material-symbols-outlined text-xs">delete</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }

                // Enable confirm button when we have course, booking details, and payment method
                const date = document.getElementById('bookingDate')?.value;
                const time = document.getElementById('bookingTime')?.value;

                if (confirmBtn && bookingCart.course && date && time && bookingCart.paymentMethod) {
                    confirmBtn.disabled = false;
                    confirmBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                } else if (confirmBtn) {
                    confirmBtn.disabled = true;
                    confirmBtn.classList.add('opacity-50', 'cursor-not-allowed');
                }

                // Caddy bookings
                bookingCart.caddies.forEach(caddie => {
                    cartHTML += `
                        <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <span class="text-lg">${caddie.avatar}</span>
                                    <div>
                                        <h5 class="font-semibold text-sm text-gray-900">${caddie.name}</h5>
                                        <p class="text-xs text-gray-600">${caddie.specialty} ‚Ä¢ ‚òÖ${caddie.rating}</p>
                                        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Booked</span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span class="font-semibold text-sm text-green-600">‡∏ø${caddie.rate.toLocaleString()}</span>
                                    <button onclick="removeCaddyFromCart('${caddie.id}', 'booking')" class="block mt-1 text-red-600 hover:text-red-700">
                                        <span class="material-symbols-outlined text-xs">delete</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });

                // Waitlists
                bookingCart.waitlists.forEach(waitlist => {
                    cartHTML += `
                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-3">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <span class="text-lg">${waitlist.avatar}</span>
                                    <div>
                                        <h5 class="font-semibold text-sm text-gray-900">${waitlist.name}</h5>
                                        <p class="text-xs text-gray-600">${waitlist.specialty} ‚Ä¢ ‚òÖ${waitlist.rating}</p>
                                        <span class="text-xs bg-orange-100 text-orange-800 px-2 py-1 rounded">Waitlist</span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span class="font-semibold text-sm text-orange-600">Pending</span>
                                    <button onclick="removeCaddyFromCart('${waitlist.id}', 'waitlist')" class="block mt-1 text-red-600 hover:text-red-700">
                                        <span class="material-symbols-outlined text-xs">delete</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });

                // Services
                if (bookingCart.services && bookingCart.services.length > 0) {
                    bookingCart.services.forEach(service => {
                        cartHTML += `
                            <div class="bg-purple-50 border border-purple-200 rounded-lg p-3">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <span class="text-lg">${service.icon}</span>
                                        <div>
                                            <h5 class="font-semibold text-sm text-gray-900">${service.name}</h5>
                                            <p class="text-xs text-gray-600">${service.description}</p>
                                            <span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded">Service</span>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <span class="font-semibold text-sm text-purple-600">‡∏ø${service.price.toLocaleString()}</span>
                                        <button onclick="toggleServiceNew('${service.id}')" class="block mt-1 text-red-600 hover:text-red-700">
                                            <span class="material-symbols-outlined text-xs">delete</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                }

                container.innerHTML = cartHTML;

                if (confirmBtn) {
                    confirmBtn.disabled = !bookingCart.course;
                    if (bookingCart.course) {
                        confirmBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    } else {
                        confirmBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    }
                }
            }
        }

        function calculateCartTotals() {
            const courseTotal = bookingCart.course ? bookingCart.course.price : 0;
            const caddieTotal = bookingCart.caddies.reduce((total, caddie) => total + caddie.rate, 0);
            const servicesTotal = bookingCart.services ? bookingCart.services.reduce((total, service) => total + service.price, 0) : 0;
            const subtotal = courseTotal + caddieTotal + servicesTotal;
            const serviceCharge = Math.round(subtotal * 0.1);
            const grandTotal = subtotal + serviceCharge;

            bookingCart.totals = {
                courseTotal,
                caddieTotal,
                servicesTotal,
                serviceCharge,
                grandTotal
            };

            // Update display
            document.getElementById('cartCourseTotal').textContent = `‡∏ø${courseTotal.toLocaleString()}`;
            document.getElementById('cartCaddyTotal').textContent = `‡∏ø${caddieTotal.toLocaleString()}`;
            document.getElementById('cartServicesTotal').textContent = `‡∏ø${servicesTotal.toLocaleString()}`;
            document.getElementById('cartServiceCharge').textContent = `‡∏ø${serviceCharge.toLocaleString()}`;
            document.getElementById('cartGrandTotal').textContent = `‡∏ø${grandTotal.toLocaleString()}`;
        }

        function removeCourseFromCart() {
            bookingCart.course = null;
            selectedCourse = null;

            // Hide caddie selection
            const caddieSection = document.getElementById('caddieSelectionSection');
            if (caddieSection) {
                caddieSection.style.display = 'none';
            }

            // Clear course selection UI
            document.querySelectorAll('.course-card').forEach(card => {
                card.classList.remove('border-primary-500', 'bg-primary-50');
                card.classList.add('border-gray-200');
            });

            const selectedCourseInfo = document.getElementById('selectedCourseInfo');
            if (selectedCourseInfo) {
                selectedCourseInfo.classList.add('hidden');
            }

            updateBookingCartDisplay();
            NotificationManager.show('Course removed from cart', 'info');
        }

        function clearBookingCart() {
            if (confirm('Are you sure you want to clear your entire cart?')) {
                bookingCart = {
                    course: null,
                    date: null,
                    time: null,
                    players: 1,
                    caddies: [],
                    waitlists: [],
                    services: [],
                    totals: { courseTotal: 0, caddieTotal: 0, servicesTotal: 0, serviceCharge: 0, grandTotal: 0 }
                };
                selectedCourse = null;
                selectedCaddys = [];

                // Reset UI
                removeCourseFromCart();
                updateBookingCartDisplay();
                NotificationManager.show('Cart cleared', 'success');
            }
        }

        function confirmBooking() {
            console.log('[confirmBooking] *** BOOKING STARTED ***');
            console.log('[confirmBooking] AppState:', AppState);
            console.log('[confirmBooking] bookingCart:', bookingCart);

            // Guard against double-tap & duplicate handlers
            if (creatingBooking) {
                console.log('[confirmBooking] Already creating booking, ignoring duplicate call');
                return;
            }
            creatingBooking = true;

            if (!bookingCart.course) {
                NotificationManager.show('Please select a course first', 'error');
                creatingBooking = false;
                return;
            }

            // Get booking details from form
            const date = document.getElementById('bookingDate')?.value;
            const time = document.getElementById('bookingTime')?.value;
            const players = document.getElementById('playerCount')?.value || 1;

            if (!date || !time) {
                NotificationManager.show('Please select date and time', 'error');
                creatingBooking = false;
                return;
            }

            // Create comprehensive booking
            let currentUser = AppState.currentUser;

            // Desktop fallback: create temporary user if not authenticated
            if (!currentUser?.name) {
                console.log('[confirmBooking] No authenticated user found, creating desktop fallback user');
                currentUser = {
                    name: 'Desktop User',
                    role: 'golfer',
                    lineId: 'desktop_user_' + Date.now()
                };
                // Set this so subsequent bookings work
                AppState.currentUser = currentUser;
            }

            try {
                // Generate groupId for this round
                const teeTime = new Date(date + 'T' + time + ':00').toISOString();
                const groupId = makeRoundGroupId({
                    courseId: bookingCart.course.slug || bookingCart.course.name,
                    teeTime: teeTime,
                    userId: currentUser.name.toLowerCase().replace(' ', '_')
                });

                // Check for duplicate booking
                const existingBookings = JSON.parse(localStorage.getItem('mcipro_bookings') || '[]');
                const isDuplicate = existingBookings.some(booking =>
                    booking.type === 'teeTime' &&
                    booking.course === bookingCart.course.name &&
                    booking.date === date &&
                    booking.time === time &&
                    booking.golferId === currentUser.name.toLowerCase().replace(' ', '_')
                );

                if (isDuplicate) {
                    NotificationManager.show('You already have a booking for this time slot', 'error');
                    creatingBooking = false;
                    return;
                }

                // Add main tee time booking
                const mainBooking = {
                    golferId: currentUser.name.toLowerCase().replace(' ', '_'),
                    golferName: currentUser.name,
                    eventName: `Round at ${bookingCart.course.name}`,
                    course: bookingCart.course.name,
                    courseName: bookingCart.course.name,
                    courseId: bookingCart.course.slug || bookingCart.course.name,
                    date: date,
                    time: time,
                    teeTime: teeTime,
                    players: parseInt(players),
                    status: 'confirmed',
                    totalCost: bookingCart.totals.grandTotal,
                    type: 'teeTime',
                    kind: 'teeTime',
                    groupId: groupId,
                    isMainBooking: true
                };

                console.log('[confirmBooking] Adding main booking with groupId:', groupId, mainBooking);
                BookingManager.addBooking(mainBooking);
                ScheduleSystem.upsertFromBooking(mainBooking);
                ScheduleSystem.refreshStats(); // Update counters immediately
                console.log('[confirmBooking] Main booking added successfully');

                // Add caddie bookings
                bookingCart.caddies.forEach(caddie => {
                    const caddieBooking = {
                        ...mainBooking,
                        caddieId: caddie.id,
                        caddieName: caddie.name,
                        eventName: `Caddy: ${caddie.name}`,
                        totalCost: caddie.rate,
                        type: 'caddie',
                        kind: 'caddie',
                        groupId: groupId,
                        isMainBooking: false
                    };
                    BookingManager.addBooking(caddieBooking);
                    ScheduleSystem.upsertFromBooking(caddieBooking);
                    ScheduleSystem.refreshStats(); // Update counters after each caddie
                });

                // Add service bookings
                if (bookingCart.services && bookingCart.services.length > 0) {
                    bookingCart.services.forEach(service => {
                        const serviceBooking = {
                            ...mainBooking,
                            serviceId: service.id,
                            serviceName: service.name,
                            service: service.name,
                            eventName: `Service: ${service.name}`,
                            totalCost: service.price,
                            type: 'service',
                            kind: 'service',
                            groupId: groupId,
                            isMainBooking: false
                        };
                        BookingManager.addBooking(serviceBooking);
                        ScheduleSystem.upsertFromBooking(serviceBooking);
                        ScheduleSystem.refreshStats(); // Update counters after each service
                    });
                }

                // Add waitlist entries
                bookingCart.waitlists.forEach(waitlist => {
                    BookingManager.addToWaitlist(waitlist.id, {
                        golferId: currentUser.name.toLowerCase().replace(' ', '_'),
                        golferName: currentUser.name,
                        event: `Round at ${bookingCart.course.name}`
                    });
                });

                NotificationManager.show(`Booking confirmed! Total: ‡∏ø${bookingCart.totals.grandTotal.toLocaleString()}`, 'success');

                // Clear cart and switch to schedule (no confirmation needed after successful booking)
                bookingCart = {
                    course: null,
                    caddies: [],
                    waitlists: [],
                    services: [],
                    paymentMethod: null,
                    totals: { courseTotal: 0, caddieTotal: 0, servicesTotal: 0, serviceCharge: 0, grandTotal: 0 }
                };
                updateBookingCartDisplay();

                setTimeout(() => {
                    showGolferTab('schedule', null);
                }, 2000);

                // Reset cooldown after successful booking
                setTimeout(() => creatingBooking = false, 800);

            } catch (error) {
                console.error('Booking error:', error);
                NotificationManager.show('Booking failed. Please try again.', 'error');
                // Reset cooldown on error too
                setTimeout(() => creatingBooking = false, 800);
            }
        }

        // Update existing functions to integrate with cart
        function bookCaddyFromBooking(caddieId, caddieName) {
            const caddie = CaddySystem.allCaddys.find(c => c.id === caddieId);
            if (caddie) {
                addCaddyToCart(caddie, 'booking');
            }
        }

        function joinWaitlistFromBooking(caddieId, caddieName) {
            const caddie = CaddySystem.allCaddys.find(c => c.id === caddieId);
            if (caddie) {
                addCaddyToCart(caddie, 'waitlist');
            }
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                initializeBookingSystem();
            }, 500);
        });

        // Advanced Chat System - LINE Style with Multi-Language Support
        const ChatSystem = {
            chatRooms: {},
            currentRoom: null,
            currentUser: null,
            translations: {
                en: {
                    'chat.title': 'MciPro Chat',
                    'chat.search': 'Search conversations...',
                    'chat.newGroup': 'New Group',
                    'chat.settings': 'Chat Settings',
                    'chat.typeMessage': 'Type a message...',
                    'chat.send': 'Send',
                    'chat.online': 'Online',
                    'chat.offline': 'Offline',
                    'chat.typing': 'is typing...',
                    'chat.translate': 'Translate',
                    'chat.original': 'Show Original',
                    'chat.members': 'members',
                    'chat.admin': 'Admin',
                    'chat.moderator': 'Moderator',
                    'chat.addMembers': 'Add Members',
                    'chat.leaveGroup': 'Leave Group',
                    'chat.groupInfo': 'Group Info'
                },
                th: {
                    'chat.title': '‡πÅ‡∏ä‡∏ó MciPro',
                    'chat.search': '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤...',
                    'chat.newGroup': '‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà',
                    'chat.settings': '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ä‡∏ó',
                    'chat.typeMessage': '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...',
                    'chat.send': '‡∏™‡πà‡∏á',
                    'chat.online': '‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå',
                    'chat.offline': '‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå',
                    'chat.typing': '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå...',
                    'chat.translate': '‡πÅ‡∏õ‡∏•',
                    'chat.original': '‡πÅ‡∏™‡∏î‡∏á‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö',
                    'chat.members': '‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å',
                    'chat.admin': '‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô',
                    'chat.moderator': '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•',
                    'chat.addMembers': '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å',
                    'chat.leaveGroup': '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°',
                    'chat.groupInfo': '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°'
                },
                ko: {
                    'chat.title': 'MciPro Ï±ÑÌåÖ',
                    'chat.search': 'ÎåÄÌôî Í≤ÄÏÉâ...',
                    'chat.newGroup': 'ÏÉà Í∑∏Î£π',
                    'chat.settings': 'Ï±ÑÌåÖ ÏÑ§Ï†ï',
                    'chat.typeMessage': 'Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî...',
                    'chat.send': 'Ï†ÑÏÜ°',
                    'chat.online': 'Ïò®ÎùºÏù∏',
                    'chat.offline': 'Ïò§ÌîÑÎùºÏù∏',
                    'chat.typing': 'ÏûÖÎ†• Ï§ë...',
                    'chat.translate': 'Î≤àÏó≠',
                    'chat.original': 'ÏõêÎ≥∏ Î≥¥Í∏∞',
                    'chat.members': 'Î©§Î≤Ñ',
                    'chat.admin': 'Í¥ÄÎ¶¨Ïûê',
                    'chat.moderator': 'Ïö¥ÏòÅÏûê',
                    'chat.addMembers': 'Î©§Î≤Ñ Ï∂îÍ∞Ä',
                    'chat.leaveGroup': 'Í∑∏Î£π ÎÇòÍ∞ÄÍ∏∞',
                    'chat.groupInfo': 'Í∑∏Î£π Ï†ïÎ≥¥'
                },
                ja: {
                    'chat.title': 'MciPro„ÉÅ„É£„ÉÉ„Éà',
                    'chat.search': '‰ºöË©±„ÇíÊ§úÁ¥¢...',
                    'chat.newGroup': 'Êñ∞„Åó„ÅÑ„Ç∞„É´„Éº„Éó',
                    'chat.settings': '„ÉÅ„É£„ÉÉ„ÉàË®≠ÂÆö',
                    'chat.typeMessage': '„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ...',
                    'chat.send': 'ÈÄÅ‰ø°',
                    'chat.online': '„Ç™„É≥„É©„Ç§„É≥',
                    'chat.offline': '„Ç™„Éï„É©„Ç§„É≥',
                    'chat.typing': 'ÂÖ•Âäõ‰∏≠...',
                    'chat.translate': 'ÁøªË®≥',
                    'chat.original': 'ÂéüÊñá„ÇíË°®Á§∫',
                    'chat.members': '„É°„É≥„Éê„Éº',
                    'chat.admin': 'ÁÆ°ÁêÜËÄÖ',
                    'chat.moderator': '„É¢„Éá„É¨„Éº„Çø„Éº',
                    'chat.addMembers': '„É°„É≥„Éê„Éº„ÇíËøΩÂä†',
                    'chat.leaveGroup': '„Ç∞„É´„Éº„Éó„ÇíÈÄÄÂá∫',
                    'chat.groupInfo': '„Ç∞„É´„Éº„ÉóÊÉÖÂ†±'
                }
            },

            initialize() {
                this.currentUser = {
                    id: AppState.currentUser.role + '_' + AppState.currentUser.name.replace(/\s+/g, '_').toLowerCase(),
                    name: AppState.currentUser.name,
                    role: AppState.currentUser.role,
                    avatar: 'üë§',
                    language: currentLanguage || 'en',
                    status: 'online'
                };

                this.initializeChatRooms();
                this.loadSampleMessages();

                // Update badge with initial unread count
                setTimeout(() => this.updateBadge(), 100);
            },

            initializeChatRooms() {
                this.chatRooms = {
                    // Course-specific groups
                    'pattaya_golf_general': {
                        id: 'pattaya_golf_general',
                        name: 'Pattaya Golf - General',
                        category: 'course',
                        type: 'group',
                        avatar: 'üèåÔ∏è‚Äç‚ôÇÔ∏è',
                        description: 'General discussion for Pattaya Golf Club',
                        members: ['golfer_john_mitchell', 'caddie_ning', 'manager_sarah', 'golfer_mike_chen', 'caddie_somchai'],
                        admins: ['manager_sarah'],
                        moderators: ['caddie_ning'],
                        language: 'mixed',
                        messages: []
                    },
                    'thai_country_club': {
                        id: 'thai_country_club',
                        name: 'Thai Country Club VIP',
                        category: 'course',
                        type: 'group',
                        avatar: '‚õ≥',
                        description: 'VIP members and premium services',
                        members: ['golfer_john_mitchell', 'caddie_somchai', 'manager_sarah', 'proshop_robert'],
                        admins: ['manager_sarah'],
                        moderators: ['proshop_robert'],
                        language: 'mixed',
                        messages: []
                    },

                    // Role-based groups
                    'golfers_lounge': {
                        id: 'golfers_lounge',
                        name: 'Golfers Lounge',
                        category: 'golfers',
                        type: 'group',
                        avatar: 'üèÜ',
                        description: 'Chat for golfers to share tips and experiences',
                        members: ['golfer_john_mitchell', 'golfer_mike_chen', 'golfer_sarah_kim', 'golfer_david_wong'],
                        admins: ['golfer_mike_chen'],
                        moderators: [],
                        language: 'mixed',
                        messages: []
                    },
                    'caddie_network': {
                        id: 'caddie_network',
                        name: 'Caddy Professional Network',
                        category: 'caddies',
                        type: 'group',
                        avatar: 'üë®‚Äçüíº',
                        description: 'Professional network for caddies to share knowledge',
                        members: ['caddie_ning', 'caddie_somchai', 'caddie_apinya', 'caddie_chaiwat', 'caddie_malee'],
                        admins: ['caddie_somchai'],
                        moderators: ['caddie_ning'],
                        language: 'mixed',
                        messages: []
                    },
                    'staff_coordination': {
                        id: 'staff_coordination',
                        name: 'Staff Coordination',
                        category: 'staff',
                        type: 'group',
                        avatar: 'üë•',
                        description: 'Internal staff communication and coordination',
                        members: ['manager_sarah', 'proshop_robert', 'caddie_ning', 'staff_maintenance', 'staff_security'],
                        admins: ['manager_sarah'],
                        moderators: ['proshop_robert'],
                        language: 'mixed',
                        messages: []
                    },

                    // Society and tournament groups
                    'bangkok_golf_society': {
                        id: 'bangkok_golf_society',
                        name: 'Bangkok Golf Society',
                        category: 'societies',
                        type: 'group',
                        avatar: 'üèÖ',
                        description: 'Bangkok Golf Society members and events',
                        members: ['society_alex', 'golfer_john_mitchell', 'golfer_mike_chen', 'society_organizer_bangkok'],
                        admins: ['society_alex'],
                        moderators: ['society_organizer_bangkok'],
                        language: 'mixed',
                        messages: []
                    },
                    'monthly_tournaments': {
                        id: 'monthly_tournaments',
                        name: 'Monthly Tournaments',
                        category: 'tournaments',
                        type: 'group',
                        avatar: 'üèÜ',
                        description: 'Updates and discussions about monthly tournaments',
                        members: ['golfer_john_mitchell', 'manager_sarah', 'tournament_director', 'golfer_mike_chen'],
                        admins: ['tournament_director'],
                        moderators: ['manager_sarah'],
                        language: 'mixed',
                        messages: []
                    },

                    // Support and services
                    'customer_support': {
                        id: 'customer_support',
                        name: 'Customer Support',
                        category: 'support',
                        type: 'group',
                        avatar: 'üÜò',
                        description: '24/7 customer support and assistance',
                        members: ['golfer_john_mitchell', 'support_team', 'manager_sarah', 'support_thai', 'support_english'],
                        admins: ['support_team'],
                        moderators: ['manager_sarah'],
                        language: 'mixed',
                        messages: []
                    },

                    // Direct messages (samples)
                    'dm_ning_prasert': {
                        id: 'dm_ning_prasert',
                        name: 'Ning Prasert',
                        category: 'direct',
                        type: 'direct',
                        avatar: 'üë®‚Äçü¶≤',
                        description: 'Direct message with Ning Prasert',
                        members: ['golfer_john_mitchell', 'caddie_ning'],
                        admins: [],
                        moderators: [],
                        language: 'mixed',
                        messages: []
                    }
                };
            },

            loadSampleMessages() {
                // Add sample messages to demonstrate the system
                this.addMessage('pattaya_golf_general', {
                    senderId: 'manager_sarah',
                    senderName: 'Sarah Wilson',
                    senderRole: 'manager',
                    text: 'Good morning everyone! Weather looks perfect for golf today. Course conditions are excellent.',
                    language: 'en',
                    timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString()
                });

                this.addMessage('pattaya_golf_general', {
                    senderId: 'caddie_ning',
                    senderName: 'Ning Prasert',
                    senderRole: 'caddie',
                    text: '‡∏™‡∏†‡∏≤‡∏û‡∏™‡∏ô‡∏≤‡∏°‡∏î‡∏µ‡∏°‡∏≤‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏∏‡∏Å‡∏ó‡πà‡∏≤‡∏ô',
                    language: 'th',
                    timestamp: new Date(Date.now() - 1.5 * 60 * 60 * 1000).toISOString(),
                    translation: {
                        en: 'Course conditions are excellent. Ready to serve everyone.',
                        ko: 'ÏΩîÏä§ ÏÉÅÌÉúÍ∞Ä Îß§Ïö∞ Ï¢ãÏäµÎãàÎã§. Î™®Îì† Î∂ÑÎì§Íªò ÏÑúÎπÑÏä§Ìï† Ï§ÄÎπÑÍ∞Ä ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.',
                        ja: '„Ç≥„Éº„Çπ„ÅÆ„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥„ÅØÊúÄÈ´ò„Åß„Åô„ÄÇÁöÜÊßò„Å´„Çµ„Éº„Éì„Çπ„Åô„ÇãÊ∫ñÂÇô„Åå„Åß„Åç„Å¶„ÅÑ„Åæ„Åô„ÄÇ'
                    }
                });

                this.addMessage('golfers_lounge', {
                    senderId: 'golfer_mike_chen',
                    senderName: 'Mike Chen',
                    senderRole: 'golfer',
                    text: 'Ïò§Îäò ÏïÑÏπ® ÎùºÏö¥Îìú Ïñ¥Îñ†ÏÖ®ÎÇòÏöî? Ï†ÄÎäî 7Î≤à ÌôÄÏóêÏÑú Ïù¥Í∏Ä ÌñàÏñ¥Ïöî! ü¶Ö',
                    language: 'ko',
                    timestamp: new Date(Date.now() - 30 * 60 * 1000).toISOString(),
                    translation: {
                        en: 'How was your morning round? I got an eagle on hole 7! ü¶Ö',
                        th: '‡∏£‡∏≠‡∏ö‡πÄ‡∏ä‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡∏ö? ‡∏ú‡∏°‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡πÄ‡∏Å‡∏¥‡∏•‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏∏‡∏° 7! ü¶Ö',
                        ja: '‰ªäÊúù„ÅÆ„É©„Ç¶„É≥„Éâ„ÅØ„ÅÑ„Åã„Åå„Åß„Åó„Åü„ÅãÔºü7Áï™„Éõ„Éº„É´„Åß„Ç§„Éº„Ç∞„É´„ÇíÂèñ„Çä„Åæ„Åó„ÅüÔºÅü¶Ö'
                    }
                });

                this.addMessage('caddie_network', {
                    senderId: 'caddie_somchai',
                    senderName: 'Somchai Jaidee',
                    senderRole: 'caddie',
                    text: 'Êñ∞„Åó„ÅÑ„ÇØ„É©„ÉñÈÅ∏Êäû„ÅÆ„ÉÜ„ÇØ„Éã„ÉÉ„ÇØ„ÇíÂ≠¶„Å≥„Åæ„Åó„Åü„ÄÇÈ¢®„ÅÆË™≠„ÅøÊñπ„ÅåÈáçË¶Å„Åß„Åô„Å≠„ÄÇ',
                    language: 'ja',
                    timestamp: new Date(Date.now() - 15 * 60 * 1000).toISOString(),
                    translation: {
                        en: 'I learned new club selection techniques. Reading the wind is crucial.',
                        th: '‡∏ú‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡πÉ‡∏´‡∏°‡πà ‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏•‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å',
                        ko: 'ÏÉàÎ°úÏö¥ ÌÅ¥ÎüΩ ÏÑ†ÌÉù Í∏∞Ïà†ÏùÑ Î∞∞Ïõ†ÏäµÎãàÎã§. Î∞îÎûåÏùÑ ÏùΩÎäî Í≤ÉÏù¥ Ï§ëÏöîÌïòÎÑ§Ïöî.'
                    }
                });

                this.addMessage('dm_ning_prasert', {
                    senderId: 'caddie_ning',
                    senderName: 'Ning Prasert',
                    senderRole: 'caddie',
                    text: 'Hello John! Ready for our round tomorrow at 8 AM? I have some tips for the back nine.',
                    language: 'en',
                    timestamp: new Date(Date.now() - 5 * 60 * 1000).toISOString()
                });
            },

            addMessage(roomId, messageData) {
                if (!this.chatRooms[roomId]) return;

                const message = {
                    id: 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    ...messageData,
                    timestamp: messageData.timestamp || new Date().toISOString(),
                    reactions: {},
                    replies: []
                };

                this.chatRooms[roomId].messages.push(message);
                this.chatRooms[roomId].lastMessage = message;
                this.chatRooms[roomId].lastActivity = message.timestamp;

                // Update unread count for other users
                if (messageData.senderId !== this.currentUser.id) {
                    this.chatRooms[roomId].unreadCount = (this.chatRooms[roomId].unreadCount || 0) + 1;
                }

                return message;
            },

            sendMessage(roomId, text, language = null) {
                const message = {
                    senderId: this.currentUser.id,
                    senderName: this.currentUser.name,
                    senderRole: this.currentUser.role,
                    text: text,
                    language: language || this.currentUser.language,
                    timestamp: new Date().toISOString()
                };

                return this.addMessage(roomId, message);
            },

            translateMessage(messageId, targetLanguage) {
                // Simulate translation - in real app would call translation API
                const translations = {
                    'Hello everyone!': {
                        th: '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô!',
                        ko: 'ÏïàÎÖïÌïòÏÑ∏Ïöî Ïó¨Îü¨Î∂Ñ!',
                        ja: 'ÁöÜ„Åï„Çì„Åì„Çì„Å´„Å°„ÅØÔºÅ'
                    },
                    'Good morning': {
                        th: '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏ï‡∏≠‡∏ô‡πÄ‡∏ä‡πâ‡∏≤',
                        ko: 'Ï¢ãÏùÄ ÏïÑÏπ®ÏûÖÎãàÎã§',
                        ja: '„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô'
                    }
                };

                // Return mock translation for demo
                return `[${targetLanguage.toUpperCase()}] Translated: Mock translation for demo`;
            },

            getChatRoomsByCategory(category) {
                return Object.values(this.chatRooms).filter(room => room.category === category);
            },

            getUserChatRooms() {
                return Object.values(this.chatRooms).filter(room =>
                    room.members.includes(this.currentUser.id)
                ).sort((a, b) => {
                    // Sort by last activity
                    const aTime = new Date(a.lastActivity || 0);
                    const bTime = new Date(b.lastActivity || 0);
                    return bTime - aTime;
                });
            },

            showChatInterface() {
                // Initialize chat system first
                if (!this.currentUser) {
                    this.initializeChatSystem();
                }

                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.id = 'chatModal';

                // Detect mobile device
                const isMobile = window.innerWidth <= 768;

                modal.innerHTML = `
                    <div class="bg-white ${isMobile ? 'w-full h-full' : 'rounded-2xl shadow-2xl w-full max-w-6xl h-5/6 max-h-screen'} overflow-hidden flex chat-modal-container">
                        <!-- Mobile Chat List View -->
                        <div id="chatListView" class="w-full ${isMobile ? 'block' : 'hidden'} bg-white flex flex-col">
                            <!-- Mobile Header -->
                            <div class="p-4 bg-green-500 text-white flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <button onclick="ChatSystem.closeChatInterface()" class="text-white hover:text-gray-200 p-1">
                                        <span class="material-symbols-outlined">arrow_back</span>
                                    </button>
                                    <h3 class="text-lg font-bold">${this.t('chat.title')}</h3>
                                </div>
                                <button class="text-white hover:text-gray-200 p-1" onclick="ChatSystem.showChatSettings()">
                                    <span class="material-symbols-outlined">settings</span>
                                </button>
                            </div>

                            <!-- Mobile Search -->
                            <div class="p-4 bg-gray-50 border-b">
                                <div class="relative">
                                    <input type="text" placeholder="${this.t('chat.search')}" id="mobileSearchInput"
                                           oninput="ChatSystem.searchContacts(this.value)"
                                           class="w-full pl-10 pr-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 text-base">
                                    <span class="material-symbols-outlined absolute left-3 top-3 text-gray-400">search</span>
                                </div>
                                <button onclick="ChatSystem.showNewChatModal()" class="mt-3 w-full bg-green-500 text-white py-2 px-4 rounded-lg font-semibold">
                                    <span class="material-symbols-outlined text-sm mr-2">add</span>
                                    Start New Chat
                                </button>
                            </div>

                            <!-- Mobile Chat Categories -->
                            <div class="flex-1 overflow-y-auto bg-white">
                                ${this.generateMobileChatSidebar()}
                            </div>
                        </div>

                        <!-- Desktop Sidebar -->
                        <div class="w-1/3 bg-gray-50 border-r border-gray-200 flex-col ${isMobile ? 'hidden' : 'flex'}">
                            <!-- Header -->
                            <div class="p-4 border-b border-gray-200">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-xl font-bold text-gray-900">${this.t('chat.title')}</h3>
                                    <button onclick="ChatSystem.closeChatInterface()" class="text-gray-400 hover:text-gray-600">
                                        <span class="material-symbols-outlined">close</span>
                                    </button>
                                </div>
                                <div class="relative">
                                    <input type="text" placeholder="${this.t('chat.search')}" id="desktopSearchInput"
                                           oninput="ChatSystem.searchContacts(this.value)"
                                           class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                                    <span class="material-symbols-outlined absolute left-3 top-2.5 text-gray-400">search</span>
                                </div>
                                <button onclick="ChatSystem.showNewChatModal()" class="mt-3 w-full bg-primary-500 text-white py-2 px-4 rounded-lg font-semibold">
                                    <span class="material-symbols-outlined text-sm mr-2">add</span>
                                    Start New Chat
                                </button>
                            </div>

                            <!-- Chat Categories -->
                            <div class="flex-1 overflow-y-auto">
                                <div class="p-2">
                                    ${this.generateChatSidebar()}
                                </div>
                            </div>

                            <!-- User Info -->
                            <div class="p-4 border-t border-gray-200">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center">
                                        <span class="text-primary-600">${this.currentUser.avatar}</span>
                                    </div>
                                    <div>
                                        <p class="font-semibold text-gray-900">${this.currentUser.name}</p>
                                        <p class="text-sm text-green-600">${this.t('chat.online')}</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Desktop Dual Chat Area -->
                        <div id="desktopChatArea" class="flex-1 ${isMobile ? 'hidden' : 'flex'} bg-gray-100">
                            <!-- Chat Window 1 -->
                            <div id="chatWindow1" class="flex-1 flex flex-col bg-white border-r border-gray-200">
                                <div class="p-4 bg-gray-50 border-b border-gray-200">
                                    <div class="flex items-center justify-between">
                                        <h4 class="font-semibold text-gray-600">Chat Window 1</h4>
                                        <button onclick="ChatSystem.closeChatWindow(1)" class="text-gray-400 hover:text-gray-600">
                                            <span class="material-symbols-outlined text-sm">close</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="flex-1 flex items-center justify-center text-gray-500">
                                    <div class="text-center">
                                        <span class="material-symbols-outlined text-4xl text-gray-300 mb-2 block">forum</span>
                                        <p class="text-sm">Select a chat to start messaging</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Chat Window 2 -->
                            <div id="chatWindow2" class="flex-1 flex flex-col bg-white">
                                <div class="p-4 bg-gray-50 border-b border-gray-200">
                                    <div class="flex items-center justify-between">
                                        <h4 class="font-semibold text-gray-600">Chat Window 2</h4>
                                        <button onclick="ChatSystem.closeChatWindow(2)" class="text-gray-400 hover:text-gray-600">
                                            <span class="material-symbols-outlined text-sm">close</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="flex-1 flex items-center justify-center text-gray-500">
                                    <div class="text-center">
                                        <span class="material-symbols-outlined text-4xl text-gray-300 mb-2 block">forum</span>
                                        <p class="text-sm">Select another chat for dual conversations</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Mobile Chat Room View -->
                        <div id="chatRoomView" class="w-full ${isMobile ? 'hidden' : 'hidden'} bg-white flex flex-col">
                            <!-- Mobile Chat Header -->
                            <div id="mobileChatHeader" class="p-3 bg-white border-b border-gray-200 flex items-center">
                                <button onclick="ChatSystem.backToChatList()" class="mr-3 text-gray-600 hover:text-gray-800 p-1">
                                    <span class="material-symbols-outlined">arrow_back</span>
                                </button>
                                <div class="flex items-center flex-1">
                                    <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                        <span class="text-green-600 text-sm font-semibold">üë•</span>
                                    </div>
                                    <div class="flex-1">
                                        <h3 class="font-semibold text-gray-900 text-sm" id="mobileChatRoomName">Chat Room</h3>
                                        <p class="text-xs text-gray-500" id="mobileChatRoomMembers">2 members</p>
                                    </div>
                                </div>
                                <button class="text-gray-500 hover:text-gray-700 p-1" onclick="ChatSystem.showMobileChatMenu()">
                                    <span class="material-symbols-outlined">more_vert</span>
                                </button>
                            </div>

                            <!-- Mobile Messages -->
                            <div id="mobileChatMessages" class="flex-1 overflow-y-auto bg-gray-50 p-4">
                                <div class="text-center text-gray-500 mt-20">
                                    <span class="material-symbols-outlined text-6xl mb-4 block">chat</span>
                                    <p>Loading messages...</p>
                                </div>
                            </div>

                            <!-- Mobile Input -->
                            <div class="p-3 bg-white border-t border-gray-200">
                                <div class="flex items-end space-x-3">
                                    <button class="text-gray-500 hover:text-green-600 p-2" onclick="ChatSystem.showMobileAttachMenu()">
                                        <span class="material-symbols-outlined">add_circle</span>
                                    </button>
                                    <div class="flex-1">
                                        <textarea id="mobileMessageInput" placeholder="${this.t('chat.typeMessage')}"
                                               class="w-full px-4 py-3 border border-gray-300 rounded-2xl focus:ring-green-500 focus:border-green-500 resize-none text-base"
                                               rows="1"
                                               style="max-height: 120px;"
                                               onkeypress="ChatSystem.handleMobileInputKeypress(event)"
                                               oninput="ChatSystem.autoResizeTextarea(this)"></textarea>
                                    </div>
                                    <button onclick="ChatSystem.sendMobileMessage()"
                                            class="bg-green-500 text-white p-2 rounded-full hover:bg-green-600 transition-colors flex-shrink-0"
                                            id="mobileSendButton">
                                        <span class="material-symbols-outlined">send</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                // Apply mobile-specific styles
                if (isMobile) {
                    modal.style.padding = '0';
                    const container = modal.querySelector('.chat-modal-container');
                    container.style.borderRadius = '0';
                }

                // Initialize mobile chat
                this.initializeMobileChat();
            },

            generateChatSidebar() {
                const categories = {
                    direct: { name: 'Direct Messages', icon: 'üí¨' },
                    custom: { name: 'My Groups', icon: 'üë•' },
                    course: { name: 'Golf Courses', icon: 'üèåÔ∏è‚Äç‚ôÇÔ∏è' },
                    golfers: { name: 'Golfers', icon: 'üèÜ' },
                    caddies: { name: 'Caddys', icon: 'üë®‚Äçüíº' },
                    staff: { name: 'Staff', icon: 'üë•' },
                    societies: { name: 'Societies', icon: 'üèÖ' },
                    tournaments: { name: 'Tournaments', icon: 'üèÜ' },
                    support: { name: 'Support', icon: 'üÜò' }
                };

                let html = '';

                Object.entries(categories).forEach(([categoryKey, category]) => {
                    const rooms = this.getChatRoomsByCategory(categoryKey).filter(room =>
                        room.members.includes(this.currentUser.id)
                    );

                    if (rooms.length > 0) {
                        html += `
                            <div class="mb-4">
                                <h4 class="text-sm font-semibold text-gray-700 mb-2 px-2">
                                    <span class="mr-2">${category.icon}</span>
                                    ${category.name}
                                </h4>
                                ${rooms.map(room => {
                                    const lastMessage = room.messages && room.messages.length > 0
                                        ? room.messages[room.messages.length - 1]
                                        : null;
                                    const messagePreview = lastMessage && lastMessage.content
                                        ? (lastMessage.content.length > 30
                                            ? lastMessage.content.substring(0, 30) + '...'
                                            : lastMessage.content)
                                        : 'No messages yet';

                                    return `
                                    <div onclick="ChatSystem.selectChatRoomSmart('${room.id}')"
                                         oncontextmenu="ChatSystem.showChatWindowMenu(event, '${room.id}'); return false;"
                                         class="flex items-center space-x-3 p-3 rounded-lg hover:bg-white cursor-pointer transition-colors ${room.unreadCount ? 'bg-blue-50' : ''}">
                                        <div class="w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center">
                                            <span class="text-primary-600">${room.avatar}</span>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <p class="font-medium text-gray-900 truncate">${room.name}</p>
                                            <p class="text-sm text-gray-500 truncate">${messagePreview}</p>
                                        </div>
                                        ${room.unreadCount ? `
                                            <div class="bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                                                ${room.unreadCount}
                                            </div>
                                        ` : ''}
                                    </div>
                                `;}).join('')}
                            </div>
                        `;
                    }
                });

                return html;
            },

            // Refresh the chat sidebar
            refreshChatSidebar() {
                // Update desktop sidebar
                const desktopSidebar = document.querySelector('.chat-modal-container .flex-1 .p-2');
                if (desktopSidebar) {
                    desktopSidebar.innerHTML = this.generateChatSidebar();
                }

                // Update mobile sidebar
                const mobileSidebar = document.querySelector('#chatListView .flex-1');
                if (mobileSidebar) {
                    mobileSidebar.innerHTML = this.generateMobileChatSidebar();
                }
            },

            openChatRoom(roomId) {
                this.currentRoom = roomId;
                const room = this.chatRooms[roomId];
                if (!room) return;

                // Clear unread count
                room.unreadCount = 0;

                // Update header
                const header = document.getElementById('chatHeader');
                header.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center">
                                <span class="text-primary-600">${room.avatar}</span>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">${room.name}</h4>
                                <p class="text-sm text-gray-500">
                                    ${room.type === 'group' ? `${room.members.length} ${this.t('chat.members')}` : this.t('chat.online')}
                                </p>
                            </div>
                        </div>
                        <button onclick="ChatSystem.showRoomInfo('${roomId}')" class="text-gray-400 hover:text-gray-600">
                            <span class="material-symbols-outlined">info</span>
                        </button>
                    </div>
                `;

                // Show messages
                this.displayMessages(roomId);

                // Show input
                document.getElementById('chatInput').style.display = 'block';
            },

            displayMessages(roomId) {
                const room = this.chatRooms[roomId];
                const messagesContainer = document.getElementById('chatMessages');

                if (!room || !room.messages.length) {
                    messagesContainer.innerHTML = `
                        <div class="text-center text-gray-500 mt-20">
                            <span class="material-symbols-outlined text-6xl mb-4 block">chat_bubble_outline</span>
                            <p>No messages yet. Start the conversation!</p>
                        </div>
                    `;
                    return;
                }

                messagesContainer.innerHTML = room.messages.map(message => `
                    <div class="mb-4 ${message.senderId === this.currentUser.id ? 'flex justify-end' : 'flex justify-start'}">
                        <div class="max-w-xs lg:max-w-md ${message.senderId === this.currentUser.id ? 'bg-primary-600 text-white' : 'bg-white'} rounded-lg p-3 shadow">
                            ${message.senderId !== this.currentUser.id ? `
                                <p class="text-xs text-gray-500 mb-1">${message.senderName}</p>
                            ` : ''}
                            <p class="text-sm">${message.text}</p>
                            ${message.language !== this.currentUser.language && message.translation ? `
                                <div class="mt-2 pt-2 border-t border-gray-200">
                                    <button onclick="ChatSystem.toggleTranslation('${message.id}')"
                                            class="text-xs text-blue-200 hover:text-blue-100">
                                        ${this.t('chat.translate')}
                                    </button>
                                    <div id="translation_${message.id}" style="display: none;" class="text-xs text-blue-400 mt-1">
                                        ${message.translation[this.currentUser.language] || 'Translation not available'}
                                    </div>
                                </div>
                            ` : ''}
                            <p class="text-xs ${message.senderId === this.currentUser.id ? 'text-primary-200' : 'text-gray-400'} mt-2">
                                ${new Date(message.timestamp).toLocaleTimeString()}
                            </p>
                        </div>
                    </div>
                `).join('');

                // Scroll to bottom
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            },

            sendCurrentMessage() {
                const input = document.getElementById('messageInput');
                const text = input.value.trim();

                if (!text || !this.currentRoom) return;

                this.sendMessage(this.currentRoom, text);
                input.value = '';

                // Refresh display
                this.displayMessages(this.currentRoom);
            },

            toggleTranslation(messageId) {
                // Handle both desktop and mobile translation elements
                const desktopTranslationDiv = document.getElementById(`translation_${messageId}`);
                if (desktopTranslationDiv) {
                    desktopTranslationDiv.style.display = desktopTranslationDiv.style.display === 'none' ? 'block' : 'none';
                    return;
                }

                // Handle mobile translation
                const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
                if (!messageElement) return;

                const originalText = messageElement.querySelector('.original-text');
                const translatedText = messageElement.querySelector('.translated-text');
                const translateBtn = messageElement.querySelector('.translate-btn');

                if (!originalText || !translatedText || !translateBtn) return;

                if (translatedText.style.display === 'none') {
                    // Show translation - simulate translation for demo
                    const originalTextContent = originalText.textContent;
                    const currentLang = currentLanguage || 'en';

                    // Simple translation simulation based on current language
                    let translation = '';
                    if (currentLang === 'th') {
                        translation = this.simulateTranslation(originalTextContent, 'th');
                    } else if (currentLang === 'ko') {
                        translation = this.simulateTranslation(originalTextContent, 'ko');
                    } else if (currentLang === 'ja') {
                        translation = this.simulateTranslation(originalTextContent, 'ja');
                    } else {
                        translation = originalTextContent; // Already in English
                    }

                    translatedText.textContent = translation;
                    translatedText.style.display = 'block';
                    originalText.style.display = 'none';
                    translateBtn.textContent = this.t('chat.original');
                } else {
                    // Show original
                    translatedText.style.display = 'none';
                    originalText.style.display = 'block';
                    translateBtn.textContent = this.t('chat.translate');
                }
            },

            simulateTranslation(text, targetLang) {
                // Enhanced translation with more comprehensive vocabulary and phrases
                const translations = {
                    th: {
                        // Greetings and common phrases
                        'Hello': '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ',
                        'Hi': '‡∏´‡∏ß‡∏±‡∏î‡∏î‡∏µ',
                        'Good morning': '‡∏≠‡∏£‡∏∏‡∏ì‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡πå',
                        'Good afternoon': '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏ï‡∏≠‡∏ô‡∏ö‡πà‡∏≤‡∏¢',
                        'Good evening': '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏ï‡∏≠‡∏ô‡πÄ‡∏¢‡πá‡∏ô',
                        'How are you': '‡∏™‡∏ö‡∏≤‡∏¢‡∏î‡∏µ‡πÑ‡∏´‡∏°',
                        'Thank you': '‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì',
                        'Thanks': '‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì',
                        'You\'re welcome': '‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£',
                        'Yes': '‡πÉ‡∏ä‡πà',
                        'No': '‡πÑ‡∏°‡πà',
                        'Okay': '‡πÇ‡∏≠‡πÄ‡∏Ñ',
                        'Sure': '‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô',

                        // Golf-related terms
                        'Ready': '‡∏û‡∏£‡πâ‡∏≠‡∏°',
                        'On the way': '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏°‡∏≤',
                        'At tee': '‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡∏≠‡∏≠‡∏ü',
                        'Finished': '‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß',
                        'Golf': '‡∏Å‡∏≠‡∏•‡πå‡∏ü',
                        'Caddy': '‡πÅ‡∏Ñ‡∏î‡∏î‡∏µ‡πâ',
                        'Tee time': '‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏µ‡∏ö‡∏≠‡∏•',
                        'Course': '‡∏™‡∏ô‡∏≤‡∏°',
                        'Hole': '‡∏´‡∏•‡∏∏‡∏°',
                        'Par': '‡∏û‡∏≤‡∏£‡πå',
                        'Birdie': '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏µ‡πâ',
                        'Eagle': '‡∏≠‡∏µ‡πÄ‡∏Å‡∏¥‡πâ‡∏•',
                        'Score': '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô',
                        'Driver': '‡πÑ‡∏î‡∏£‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå',
                        'Iron': '‡πÑ‡∏≠‡∏£‡∏≠‡∏ô',
                        'Putter': '‡∏û‡∏±‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡πå',
                        'Ball': '‡∏•‡∏π‡∏Å',
                        'Green': '‡∏Å‡∏£‡∏µ‡∏ô',
                        'Fairway': '‡πÅ‡∏ü‡∏£‡πå‡πÄ‡∏ß‡∏¢‡πå',

                        // Time and status
                        'Now': '‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ',
                        'Later': '‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á',
                        'Today': '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ',
                        'Tomorrow': '‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ',
                        'Yesterday': '‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô',
                        'Wait': '‡∏£‡∏≠',
                        'Come': '‡∏°‡∏≤',
                        'Go': '‡πÑ‡∏õ',
                        'Stop': '‡∏´‡∏¢‡∏∏‡∏î',
                        'Start': '‡πÄ‡∏£‡∏¥‡πà‡∏°',
                        'End': '‡∏à‡∏ö',

                        // Common sentences
                        'I am ready': '‡∏â‡∏±‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß',
                        'Let\'s go': '‡πÑ‡∏õ‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞',
                        'See you': '‡πÅ‡∏•‡πâ‡∏ß‡∏û‡∏ö‡∏Å‡∏±‡∏ô',
                        'Good luck': '‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ',
                        'Well done': '‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ',
                        'Nice shot': '‡∏ï‡∏µ‡πÑ‡∏î‡πâ‡∏î‡∏µ',
                        'Great game': '‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°'
                    },
                    ko: {
                        // Greetings and common phrases
                        'Hello': 'ÏïàÎÖïÌïòÏÑ∏Ïöî',
                        'Hi': 'ÏïàÎÖï',
                        'Good morning': 'Ï¢ãÏùÄ ÏïÑÏπ®ÏûÖÎãàÎã§',
                        'Good afternoon': 'Ï¢ãÏùÄ Ïò§ÌõÑÏûÖÎãàÎã§',
                        'Good evening': 'Ï¢ãÏùÄ Ï†ÄÎÖÅÏûÖÎãàÎã§',
                        'How are you': 'Ïñ¥ÎñªÍ≤å ÏßÄÎÇ¥ÏÑ∏Ïöî',
                        'Thank you': 'Í∞êÏÇ¨Ìï©ÎãàÎã§',
                        'Thanks': 'Í≥†ÎßàÏõåÏöî',
                        'You\'re welcome': 'Ï≤úÎßåÏóêÏöî',
                        'Yes': 'ÎÑ§',
                        'No': 'ÏïÑÎãàÏò§',
                        'Okay': 'Í¥úÏ∞ÆÏïÑÏöî',
                        'Sure': 'Î¨ºÎ°†Ïù¥Ï£†',

                        // Golf-related terms
                        'Ready': 'Ï§ÄÎπÑÎê®',
                        'On the way': 'Í∞ÄÎäî Ï§ë',
                        'At tee': 'Ìã∞ÏóêÏÑú',
                        'Finished': 'ÏôÑÎ£å',
                        'Golf': 'Í≥®ÌîÑ',
                        'Caddy': 'Ï∫êÎîî',
                        'Tee time': 'Ìã∞ÌÉÄÏûÑ',
                        'Course': 'ÏΩîÏä§',
                        'Hole': 'ÌôÄ',
                        'Par': 'Ìåå',
                        'Birdie': 'Î≤ÑÎîî',
                        'Eagle': 'Ïù¥Í∏Ä',
                        'Score': 'Ï†êÏàò',
                        'Driver': 'ÎìúÎùºÏù¥Î≤Ñ',
                        'Iron': 'ÏïÑÏù¥Ïñ∏',
                        'Putter': 'ÌçºÌÑ∞',
                        'Ball': 'Í≥µ',
                        'Green': 'Í∑∏Î¶∞',
                        'Fairway': 'ÌéòÏñ¥Ïõ®Ïù¥',

                        // Time and status
                        'Now': 'ÏßÄÍ∏à',
                        'Later': 'ÎÇòÏ§ëÏóê',
                        'Today': 'Ïò§Îäò',
                        'Tomorrow': 'ÎÇ¥Ïùº',
                        'Yesterday': 'Ïñ¥Ï†ú',
                        'Wait': 'Í∏∞Îã§Î†§',
                        'Come': 'ÏôÄ',
                        'Go': 'Í∞Ä',
                        'Stop': 'Î©àÏ∂∞',
                        'Start': 'ÏãúÏûë',
                        'End': 'ÎÅù',

                        // Common sentences
                        'I am ready': 'Ï§ÄÎπÑÎêêÏäµÎãàÎã§',
                        'Let\'s go': 'Í∞ÄÏûê',
                        'See you': 'Îòê Î≥¥Ïûê',
                        'Good luck': 'ÌñâÏö¥ÏùÑ ÎπïÎãàÎã§',
                        'Well done': 'ÏûòÌñàÏñ¥Ïöî',
                        'Nice shot': 'Ï¢ãÏùÄ ÏÉ∑Ïù¥ÎÑ§Ïöî',
                        'Great game': 'ÌõåÎ•≠Ìïú Í≤ΩÍ∏∞ÏòÄÏñ¥Ïöî'
                    },
                    ja: {
                        // Greetings and common phrases
                        'Hello': '„Åì„Çì„Å´„Å°„ÅØ',
                        'Hi': '„Åì„Çì„Å´„Å°„ÅØ',
                        'Good morning': '„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô',
                        'Good afternoon': '„Åì„Çì„Å´„Å°„ÅØ',
                        'Good evening': '„Åì„Çì„Å∞„Çì„ÅØ',
                        'How are you': '„ÅäÂÖÉÊ∞ó„Åß„Åô„Åã',
                        'Thank you': '„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô',
                        'Thanks': '„ÅÇ„Çä„Åå„Å®„ÅÜ',
                        'You\'re welcome': '„Å©„ÅÜ„ÅÑ„Åü„Åó„Åæ„Åó„Å¶',
                        'Yes': '„ÅØ„ÅÑ',
                        'No': '„ÅÑ„ÅÑ„Åà',
                        'Okay': '„ÅØ„ÅÑ',
                        'Sure': '„ÇÇ„Å°„Çç„Çì',

                        // Golf-related terms
                        'Ready': 'Ê∫ñÂÇôÂÆå‰∫Ü',
                        'On the way': 'Âêë„Åã„Å£„Å¶„ÅÑ„Åæ„Åô',
                        'At tee': '„ÉÜ„Ç£„Éº„Å´„ÅÑ„Åæ„Åô',
                        'Finished': 'ÂÆå‰∫Ü',
                        'Golf': '„Ç¥„É´„Éï',
                        'Caddy': '„Ç≠„É£„Éá„Ç£„Éº',
                        'Tee time': '„ÉÜ„Ç£„Éº„Çø„Ç§„É†',
                        'Course': '„Ç≥„Éº„Çπ',
                        'Hole': '„Éõ„Éº„É´',
                        'Par': '„Éë„Éº',
                        'Birdie': '„Éê„Éº„Éá„Ç£„Éº',
                        'Eagle': '„Ç§„Éº„Ç∞„É´',
                        'Score': '„Çπ„Ç≥„Ç¢',
                        'Driver': '„Éâ„É©„Ç§„Éê„Éº',
                        'Iron': '„Ç¢„Ç§„Ç¢„É≥',
                        'Putter': '„Éë„Çø„Éº',
                        'Ball': '„Éú„Éº„É´',
                        'Green': '„Ç∞„É™„Éº„É≥',
                        'Fairway': '„Éï„Çß„Ç¢„Ç¶„Çß„Ç§',

                        // Time and status
                        'Now': '‰ªä',
                        'Later': 'Âæå„Åß',
                        'Today': '‰ªäÊó•',
                        'Tomorrow': 'ÊòéÊó•',
                        'Yesterday': 'Êò®Êó•',
                        'Wait': 'ÂæÖ„Å£„Å¶',
                        'Come': 'Êù•„Å¶',
                        'Go': 'Ë°å„Åè',
                        'Stop': 'Ê≠¢„Åæ„Å£„Å¶',
                        'Start': 'Âßã„ÇÅ„Çã',
                        'End': 'ÁµÇ„Çè„Çã',

                        // Common sentences
                        'I am ready': 'Ê∫ñÂÇô„Åß„Åç„Å¶„ÅÑ„Åæ„Åô',
                        'Let\'s go': 'Ë°å„Åç„Åæ„Åó„Çá„ÅÜ',
                        'See you': '„Åæ„Åü‰ºö„ÅÑ„Åæ„Åó„Çá„ÅÜ',
                        'Good luck': '„Åå„Çì„Å∞„Å£„Å¶',
                        'Well done': '„Çà„Åè„ÇÑ„Çä„Åæ„Åó„Åü',
                        'Nice shot': '„Éä„Ç§„Çπ„Ç∑„Éß„ÉÉ„Éà',
                        'Great game': 'Á¥†Êô¥„Çâ„Åó„ÅÑ„Ç≤„Éº„É†„Åß„Åó„Åü'
                    }
                };

                let translated = text.toLowerCase();
                const langTranslations = translations[targetLang] || {};

                // First, try exact phrase matches (case-insensitive)
                for (const [english, foreign] of Object.entries(langTranslations)) {
                    const regex = new RegExp(`\\b${english.toLowerCase()}\\b`, 'gi');
                    translated = translated.replace(regex, foreign);
                }

                // If no translation found, provide a clear indication
                if (translated === text.toLowerCase()) {
                    return `[${targetLang.toUpperCase()}] ${text}`;
                }

                return translated;
            },

            // Initialize chat system with sample data
            initializeChatSystem() {
                // Set current user based on the logged-in user
                this.currentUser = {
                    id: AppState.currentUser.role || 'guest',
                    name: AppState.currentUser.name || 'Guest User',
                    avatar: AppState.currentUser.role === 'golfer' ? 'üèåÔ∏è‚Äç‚ôÇÔ∏è' :
                           AppState.currentUser.role === 'caddie' ? 'üë®‚Äçüíº' :
                           AppState.currentUser.role === 'manager' ? 'üëî' : 'üë§',
                    language: currentLanguage || 'en'
                };

                // Initialize sample chat rooms with messages for testing
                this.chatRooms = {
                    'golf_general': {
                        id: 'golf_general',
                        name: 'Golf General',
                        type: 'group',
                        category: 'course',
                        avatar: 'üèåÔ∏è‚Äç‚ôÇÔ∏è',
                        members: ['golfer', 'caddie', 'manager'],
                        messages: [
                            {
                                id: 'msg_1',
                                text: 'Good morning everyone!',
                                userId: 'manager',
                                userName: 'Course Manager',
                                timestamp: Date.now() - 3600000
                            },
                            {
                                id: 'msg_2',
                                text: 'Hello! Ready for today\'s round.',
                                userId: 'golfer',
                                userName: 'John Mitchell',
                                timestamp: Date.now() - 1800000
                            },
                            {
                                id: 'msg_3',
                                text: 'Yes, I am ready. On the way to first tee.',
                                userId: 'caddie',
                                userName: 'Ning',
                                timestamp: Date.now() - 900000
                            }
                        ],
                        unreadCount: 0,
                        lastActivity: Date.now() - 900000,
                        lastMessage: {
                            text: 'Yes, I am ready. On the way to first tee.',
                            timestamp: Date.now() - 900000
                        }
                    },
                    'caddie_support': {
                        id: 'caddie_support',
                        name: 'Caddy Support',
                        type: 'group',
                        category: 'caddies',
                        avatar: 'üë®‚Äçüíº',
                        members: ['caddie', 'manager'],
                        messages: [
                            {
                                id: 'msg_4',
                                text: 'Thank you for the excellent service today!',
                                userId: 'manager',
                                userName: 'Pro Shop Manager',
                                timestamp: Date.now() - 7200000
                            },
                            {
                                id: 'msg_5',
                                text: 'Thanks! Great game with the golfers.',
                                userId: 'caddie',
                                userName: 'Ning',
                                timestamp: Date.now() - 3600000
                            }
                        ],
                        unreadCount: 1,
                        lastActivity: Date.now() - 3600000,
                        lastMessage: {
                            text: 'Thanks! Great game with the golfers.',
                            timestamp: Date.now() - 3600000
                        }
                    },
                    'direct_manager': {
                        id: 'direct_manager',
                        name: 'Course Manager',
                        type: 'direct',
                        category: 'direct',
                        avatar: 'üëî',
                        members: [this.currentUser.id, 'manager'],
                        messages: [
                            {
                                id: 'msg_6',
                                text: 'Nice shot on hole 7! Well done.',
                                userId: 'manager',
                                userName: 'Course Manager',
                                timestamp: Date.now() - 1800000
                            }
                        ],
                        unreadCount: 0,
                        lastActivity: Date.now() - 1800000,
                        lastMessage: {
                            text: 'Nice shot on hole 7! Well done.',
                            timestamp: Date.now() - 1800000
                        }
                    }
                };

                console.log('Chat system initialized with current user:', this.currentUser);
            },

            // Mobile-specific methods
            generateMobileChatSidebar() {
                const categories = {
                    direct: { name: 'Direct Messages', icon: 'üí¨' },
                    custom: { name: 'My Groups', icon: 'üë•' },
                    course: { name: 'Golf Courses', icon: 'üèåÔ∏è‚Äç‚ôÇÔ∏è' },
                    golfers: { name: 'Golfers', icon: 'üèÜ' },
                    caddies: { name: 'Caddys', icon: 'üë®‚Äçüíº' },
                    staff: { name: 'Staff', icon: 'üë•' },
                    societies: { name: 'Societies', icon: 'üèÖ' },
                    tournaments: { name: 'Tournaments', icon: 'üèÜ' },
                    support: { name: 'Support', icon: 'üÜò' }
                };

                let html = '';

                Object.entries(categories).forEach(([categoryKey, category]) => {
                    const rooms = this.getChatRoomsByCategory(categoryKey).filter(room =>
                        room.members.includes(this.currentUser.id)
                    );

                    if (rooms.length > 0) {
                        html += `
                            <div class="mb-2">
                                <div class="px-4 py-2 bg-gray-50 border-b">
                                    <h4 class="text-sm font-semibold text-gray-600">
                                        <span class="mr-2">${category.icon}</span>
                                        ${category.name}
                                    </h4>
                                </div>
                                ${rooms.map(room => {
                                    const lastMessage = room.messages && room.messages.length > 0
                                        ? room.messages[room.messages.length - 1]
                                        : null;
                                    const messagePreview = lastMessage && lastMessage.content
                                        ? (lastMessage.content.length > 35
                                            ? lastMessage.content.substring(0, 35) + '...'
                                            : lastMessage.content)
                                        : 'No messages yet';

                                    return `
                                    <div onclick="ChatSystem.selectChatRoomSmart('${room.id}')"
                                         class="flex items-center space-x-3 p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer active:bg-gray-100 ${room.unreadCount ? 'bg-blue-50' : ''}">
                                        <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center">
                                            <span class="text-lg">${room.avatar}</span>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <div class="flex items-center justify-between">
                                                <p class="font-medium text-gray-900 truncate">${room.name}</p>
                                                ${lastMessage ? `<span class="text-xs text-gray-400">${new Date(lastMessage.timestamp).toLocaleTimeString()}</span>` : ''}
                                            </div>
                                            <p class="text-sm text-gray-500 truncate mt-1">${messagePreview}</p>
                                        </div>
                                        ${room.unreadCount ? `
                                            <div class="bg-green-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center font-medium">
                                                ${room.unreadCount > 99 ? '99+' : room.unreadCount}
                                            </div>
                                        ` : ''}
                                    </div>
                                `;}).join('')}
                            </div>
                        `;
                    }
                });

                if (html === '') {
                    html = `
                        <div class="text-center p-8 text-gray-500">
                            <span class="material-symbols-outlined text-4xl mb-3 block">chat</span>
                            <p>No conversations yet</p>
                        </div>
                    `;
                }

                return html;
            },

            openMobileChatRoom(roomId) {
                this.currentRoom = roomId;
                const room = this.chatRooms[roomId];
                if (!room) return;

                // Clear unread count
                room.unreadCount = 0;

                // Show chat room view and hide list view
                const chatListView = document.getElementById('chatListView');
                const chatRoomView = document.getElementById('chatRoomView');

                if (chatListView) chatListView.classList.add('hidden');
                if (chatRoomView) {
                    chatRoomView.classList.remove('hidden');
                    chatRoomView.classList.add('flex');
                }

                // Update mobile chat header
                const roomName = document.getElementById('mobileChatRoomName');
                const roomMembers = document.getElementById('mobileChatRoomMembers');

                if (roomName) roomName.textContent = room.name;
                if (roomMembers) {
                    roomMembers.textContent = room.type === 'group' ? `${room.members.length} members` : 'Online';
                }

                // Load messages
                this.renderMobileChatMessages(roomId);

                // Show input and focus
                const input = document.getElementById('mobileMessageInput');
                if (input) {
                    setTimeout(() => input.focus(), 300);
                }

                // Update badge
                this.updateBadge();
            },

            backToChatList() {
                const chatListView = document.getElementById('chatListView');
                const chatRoomView = document.getElementById('chatRoomView');

                if (chatListView) chatListView.classList.remove('hidden');
                if (chatRoomView) {
                    chatRoomView.classList.add('hidden');
                    chatRoomView.classList.remove('flex');
                }

                this.currentRoom = null;
            },

            renderMobileChatMessages(roomId) {
                const room = this.chatRooms[roomId];
                if (!room) return;

                const messagesContainer = document.getElementById('mobileChatMessages');
                if (!messagesContainer) return;

                if (room.messages && room.messages.length > 0) {
                    messagesContainer.innerHTML = room.messages.map(message => `
                        <div class="mb-4 ${message.userId === this.currentUser.id ? 'text-right' : ''}">
                            <div class="flex ${message.userId === this.currentUser.id ? 'justify-end' : 'justify-start'}">
                                <div class="max-w-xs lg:max-w-md px-4 py-2 rounded-2xl ${
                                    message.userId === this.currentUser.id ?
                                    'bg-green-500 text-white rounded-br-md' :
                                    'bg-white border border-gray-200 rounded-bl-md'
                                }" data-message-id="${message.id}">
                                    ${message.userId !== this.currentUser.id ? `<p class="text-xs font-semibold text-gray-600 mb-1">${message.userName}</p>` : ''}
                                    <p class="text-sm original-text">${message.text}</p>
                                    <div class="translated-text text-sm text-blue-500" style="display: none;"></div>
                                    <div class="flex items-center justify-between mt-2">
                                        <p class="text-xs opacity-70">${this.formatTime(message.timestamp)}</p>
                                        <button onclick="ChatSystem.toggleTranslation('${message.id}')"
                                                class="text-xs ${message.userId === this.currentUser.id ? 'text-green-100 hover:text-white' : 'text-gray-500 hover:text-gray-700'} ml-2 translate-btn">
                                            ${this.t('chat.translate')}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    messagesContainer.innerHTML = `
                        <div class="text-center text-gray-500 mt-20">
                            <span class="material-symbols-outlined text-4xl mb-3 block">chat</span>
                            <p>Start the conversation!</p>
                        </div>
                    `;
                }

                // Scroll to bottom
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            },

            initializeMobileChat() {
                // Set up proper viewport height handling for mobile browsers
                this.setViewportHeight();

                // Initialize auto-resize for textarea
                const textarea = document.getElementById('mobileMessageInput');
                if (textarea) {
                    textarea.style.height = 'auto';
                    textarea.addEventListener('input', () => this.autoResizeTextarea(textarea));

                    // Handle keyboard appearance on mobile
                    textarea.addEventListener('focus', () => {
                        if (window.innerWidth <= 768) {
                            const chatRoomView = document.getElementById('chatRoomView');
                            if (chatRoomView) {
                                chatRoomView.classList.add('keyboard-open');
                            }

                            setTimeout(() => {
                                const chatMessages = document.getElementById('mobileChatMessages');
                                if (chatMessages) {
                                    chatMessages.scrollTop = chatMessages.scrollHeight;
                                }
                            }, 300);
                        }
                    });

                    // Handle keyboard disappearing
                    textarea.addEventListener('blur', () => {
                        if (window.innerWidth <= 768) {
                            setTimeout(() => {
                                const chatRoomView = document.getElementById('chatRoomView');
                                if (chatRoomView) {
                                    chatRoomView.classList.remove('keyboard-open');
                                }
                            }, 100);
                        }
                    });
                }

                // Detect if mobile device and add touch-friendly interactions
                if (window.innerWidth <= 768) {
                    this.addMobileTouchInteractions();
                }

                // Handle window resize for responsive behavior and viewport changes
                window.addEventListener('resize', () => {
                    this.setViewportHeight();

                    const modal = document.getElementById('chatModal');
                    if (modal) {
                        const isMobile = window.innerWidth <= 768;
                        const container = modal.querySelector('.chat-modal-container');

                        if (isMobile) {
                            container.className = container.className.replace(/rounded-2xl|shadow-2xl|max-w-6xl|h-5\/6|max-h-screen/g, '');
                            container.classList.add('w-full', 'h-full');
                            modal.style.padding = '0';
                            container.style.borderRadius = '0';
                        } else {
                            container.classList.remove('w-full', 'h-full');
                            container.classList.add('rounded-2xl', 'shadow-2xl', 'max-w-6xl', 'h-5/6', 'max-h-screen');
                            modal.style.padding = '';
                            container.style.borderRadius = '';
                        }
                    }
                });

                // Handle visual viewport changes (for mobile keyboard)
                if (window.visualViewport) {
                    window.visualViewport.addEventListener('resize', () => {
                        this.handleVisualViewportChange();
                    });
                }
            },

            setViewportHeight() {
                // Set custom viewport height property to handle mobile browser UI
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            },

            handleVisualViewportChange() {
                // Adjust layout when mobile keyboard appears/disappears
                const vh = window.visualViewport.height * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            },

            addMobileTouchInteractions() {
                // Add swipe gestures for mobile navigation
                let touchStartY = 0;
                let touchStartX = 0;

                const chatRoomView = document.getElementById('chatRoomView');
                if (chatRoomView) {
                    chatRoomView.addEventListener('touchstart', (e) => {
                        touchStartY = e.touches[0].clientY;
                        touchStartX = e.touches[0].clientX;
                    });

                    chatRoomView.addEventListener('touchend', (e) => {
                        const touchEndY = e.changedTouches[0].clientY;
                        const touchEndX = e.changedTouches[0].clientX;
                        const diffY = touchStartY - touchEndY;
                        const diffX = touchStartX - touchEndX;

                        // Swipe right to go back (if swipe is more horizontal than vertical)
                        if (Math.abs(diffX) > Math.abs(diffY) && diffX < -50) {
                            this.backToChatList();
                        }
                    });
                }

                // Add haptic feedback for button presses on mobile (if supported)
                const buttons = document.querySelectorAll('#chatRoomView button, #chatListView [onclick]');
                buttons.forEach(button => {
                    button.addEventListener('click', () => {
                        if (navigator.vibrate) {
                            navigator.vibrate(10); // Short vibration for feedback
                        }
                    });
                });
            },

            autoResizeTextarea(textarea) {
                textarea.style.height = 'auto';
                textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
            },

            handleMobileInputKeypress(event) {
                if (event.key === 'Enter' && !event.shiftKey) {
                    event.preventDefault();
                    this.sendMobileMessage();
                }
            },

            sendMobileMessage() {
                const input = document.getElementById('mobileMessageInput');
                if (!input || !this.currentRoom) return;

                const messageText = input.value.trim();
                if (!messageText) return;

                const room = this.chatRooms[this.currentRoom];
                if (!room) return;

                // Add message to room
                const message = {
                    id: Date.now(),
                    text: messageText,
                    userId: this.currentUser.id,
                    userName: this.currentUser.name,
                    timestamp: Date.now()
                };

                if (!room.messages) room.messages = [];
                room.messages.push(message);

                // Update last message
                room.lastMessage = message;
                room.lastActivity = Date.now();

                // Clear input and reset height
                input.value = '';
                input.style.height = 'auto';

                // Re-render messages
                this.renderMobileChatMessages(this.currentRoom);

                // Focus back on input
                input.focus();
            },

            formatTime(timestamp) {
                const date = new Date(timestamp);
                const now = new Date();
                const diffInMinutes = Math.floor((now - date) / (1000 * 60));

                if (diffInMinutes < 1) return 'now';
                if (diffInMinutes < 60) return `${diffInMinutes}m`;
                if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}h`;
                return date.toLocaleDateString();
            },

            showChatSettings() {
                // Placeholder for chat settings
                console.log('Chat settings');
            },

            showMobileChatMenu() {
                // Placeholder for mobile chat menu
                console.log('Mobile chat menu');
            },

            showMobileAttachMenu() {
                // Placeholder for mobile attach menu
                console.log('Mobile attach menu');
            },

            // Search for contacts and groups
            searchContacts(query) {
                if (!query || query.trim() === '') {
                    // Show all chats if no search query
                    this.displaySearchResults(Object.values(this.chatRooms));
                    return;
                }

                const lowerQuery = query.toLowerCase();
                const results = Object.values(this.chatRooms).filter(room => {
                    return room.name.toLowerCase().includes(lowerQuery) ||
                           room.description.toLowerCase().includes(lowerQuery) ||
                           room.category.toLowerCase().includes(lowerQuery);
                });

                this.displaySearchResults(results);
            },

            // Display search results
            displaySearchResults(results) {
                const sidebarContainer = document.querySelector('.chat-modal-container .w-1/3 .flex-1 .p-2');
                const mobileSidebarContainer = document.querySelector('#chatListView .flex-1');

                const generateResultsHTML = (results) => {
                    if (results.length === 0) {
                        return '<div class="p-4 text-center text-gray-500">No chats found</div>';
                    }

                    return results.map(room => {
                        const unreadCount = room.unreadCount || 0;
                        const lastMessage = room.messages && room.messages.length > 0
                            ? room.messages[room.messages.length - 1]
                            : null;

                        return `
                            <div class="p-3 hover:bg-gray-100 cursor-pointer border-b border-gray-100"
                                 onclick="ChatSystem.selectChatRoom('${room.id}')">
                                <div class="flex items-center space-x-3">
                                    <div class="w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center">
                                        <span class="text-xl">${room.avatar}</span>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center justify-between">
                                            <h4 class="font-semibold text-gray-900 truncate">${room.name}</h4>
                                            ${unreadCount > 0 ? `<span class="bg-red-500 text-white text-xs rounded-full px-2 py-1">${unreadCount}</span>` : ''}
                                        </div>
                                        <p class="text-sm text-gray-600 truncate">${room.description}</p>
                                        ${lastMessage ? `<p class="text-xs text-gray-400 truncate">${lastMessage.content}</p>` : ''}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                };

                // Update desktop sidebar
                if (sidebarContainer) {
                    sidebarContainer.innerHTML = generateResultsHTML(results);
                }

                // Update mobile sidebar
                if (mobileSidebarContainer) {
                    mobileSidebarContainer.innerHTML = generateResultsHTML(results);
                }
            },

            // Show new chat modal with contact list
            showNewChatModal() {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.id = 'newChatModal';

                const isMobile = window.innerWidth <= 768;

                modal.innerHTML = `
                    <div class="bg-white ${isMobile ? 'w-full h-full' : 'rounded-2xl shadow-2xl w-full max-w-6xl h-5/6'} overflow-hidden flex flex-col">
                        <!-- Header -->
                        <div class="p-4 bg-green-500 text-white">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-lg font-bold">Start New Chat</h3>
                                <button onclick="ChatSystem.closeNewChatModal()" class="text-white hover:text-gray-200">
                                    <span class="material-symbols-outlined">close</span>
                                </button>
                            </div>

                            <!-- Chat Type Tabs -->
                            <div class="flex space-x-1 bg-green-400 rounded-lg p-1">
                                <button onclick="ChatSystem.switchChatMode('direct')" id="directChatBtn"
                                        class="flex-1 py-2 px-4 rounded-md text-sm font-medium bg-white text-green-600 transition-colors">
                                    Direct Message
                                </button>
                                <button onclick="ChatSystem.switchChatMode('group')" id="groupChatBtn"
                                        class="flex-1 py-2 px-4 rounded-md text-sm font-medium text-white hover:bg-green-300 transition-colors">
                                    Group Chat
                                </button>
                            </div>
                        </div>

                        <!-- Selected Contacts (Group Mode) -->
                        <div id="selectedContactsArea" class="hidden p-4 bg-gray-50 border-b">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-medium text-gray-700">Selected contacts (<span id="selectedCount">0</span>)</span>
                                <button onclick="ChatSystem.clearSelectedContacts()" class="text-sm text-red-500 hover:text-red-700">Clear all</button>
                            </div>
                            <div id="selectedContactsList" class="flex flex-wrap gap-2"></div>
                        </div>

                        <!-- Group Name Input (Group Mode) -->
                        <div id="groupNameArea" class="hidden p-4 border-b">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Group Name</label>
                            <input type="text" id="groupNameInput" placeholder="Enter group name..."
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500">
                        </div>

                        <!-- Search -->
                        <div class="p-4 border-b">
                            <div class="relative">
                                <input type="text" placeholder="Search contacts..." id="newChatSearchInput"
                                       oninput="ChatSystem.filterNewChatContacts(this.value)"
                                       class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500">
                                <span class="material-symbols-outlined absolute left-3 top-3 text-gray-400">search</span>
                            </div>
                        </div>

                        <!-- Contacts List -->
                        <div class="flex-1 overflow-y-auto p-4" id="newChatContactsList">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                ${this.generateContactsList()}
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="p-4 border-t bg-gray-50">
                            <div class="flex space-x-3 mb-3">
                                <button onclick="ChatSystem.showBrowseGroupsModal()"
                                        class="w-full py-2 px-4 border border-green-500 text-green-600 rounded-lg hover:bg-green-50">
                                    <span class="material-symbols-outlined text-sm mr-2">search</span>
                                    Browse & Join Groups
                                </button>
                            </div>
                            <div class="flex space-x-3">
                                <button onclick="ChatSystem.closeNewChatModal()"
                                        class="flex-1 py-2 px-4 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100">
                                    Cancel
                                </button>
                                <button onclick="ChatSystem.createSelectedChat()" id="createChatBtn"
                                        class="flex-1 py-2 px-4 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed"
                                        disabled>
                                    <span id="createChatBtnText">Select a contact</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
                this.selectedContacts = [];
                this.chatMode = 'direct';
            },

            // Generate contacts list for new chat
            generateContactsList() {
                const allContacts = [
                    // Golfers
                    { id: 'golfer_mike_chen', name: 'Mike Chen', role: 'Golfer', avatar: '‚õ≥', status: 'online' },
                    { id: 'golfer_sarah_kim', name: 'Sarah Kim', role: 'Golfer', avatar: 'üèåÔ∏è‚Äç‚ôÄÔ∏è', status: 'online' },
                    { id: 'golfer_david_wong', name: 'David Wong', role: 'Golfer', avatar: 'üèåÔ∏è‚Äç‚ôÇÔ∏è', status: 'offline' },

                    // Caddies
                    { id: 'caddie_somchai', name: 'Somchai', role: 'Caddy', avatar: 'üë®‚Äçüíº', status: 'online' },
                    { id: 'caddie_apinya', name: 'Apinya', role: 'Caddy', avatar: 'üë©‚Äçüíº', status: 'online' },
                    { id: 'caddie_chaiwat', name: 'Chaiwat', role: 'Caddy', avatar: 'üë®‚Äçüíº', status: 'offline' },
                    { id: 'caddie_malee', name: 'Malee', role: 'Caddy', avatar: 'üë©‚Äçüíº', status: 'online' },

                    // Staff
                    { id: 'manager_sarah', name: 'Sarah Wilson', role: 'Manager', avatar: 'üë•', status: 'online' },
                    { id: 'proshop_robert', name: 'Robert Chen', role: 'Pro Shop', avatar: 'üè™', status: 'online' },
                    { id: 'staff_maintenance', name: 'Maintenance Team', role: 'Staff', avatar: 'üîß', status: 'online' },
                    { id: 'staff_security', name: 'Security Team', role: 'Staff', avatar: 'üõ°Ô∏è', status: 'online' },

                    // Society/Tournament
                    { id: 'society_alex', name: 'Alex Thompson', role: 'Society Admin', avatar: 'üèÖ', status: 'online' },
                    { id: 'tournament_director', name: 'Tournament Director', role: 'Tournament', avatar: 'üèÜ', status: 'online' },
                    { id: 'society_organizer_bangkok', name: 'Bangkok Organizer', role: 'Society', avatar: 'üèÖ', status: 'online' }
                ];

                return allContacts.map(contact => `
                    <div class="p-3 hover:bg-gray-100 cursor-pointer rounded-lg contact-item border border-gray-200 hover:border-green-300 transition-colors"
                         data-contact-id="${contact.id}"
                         data-contact-name="${contact.name.toLowerCase()}"
                         data-contact-role="${contact.role.toLowerCase()}"
                         onclick="ChatSystem.handleContactSelection('${contact.id}', '${contact.name}', '${contact.avatar}', '${contact.role}')">
                        <div class="flex flex-col items-center text-center space-y-2">
                            <div class="relative">
                                <!-- Checkbox for group mode -->
                                <div class="contact-checkbox hidden absolute -top-2 -left-2 z-10">
                                    <input type="checkbox" id="contact_${contact.id}"
                                           class="w-5 h-5 text-green-500 bg-white border-2 border-gray-300 rounded focus:ring-green-500"
                                           onchange="ChatSystem.toggleContactSelection('${contact.id}', '${contact.name}', '${contact.avatar}', '${contact.role}', this.checked)">
                                </div>
                                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center">
                                    <span class="text-2xl">${contact.avatar}</span>
                                </div>
                                <div class="absolute -bottom-1 -right-1 w-5 h-5 rounded-full border-2 border-white ${contact.status === 'online' ? 'bg-green-500' : 'bg-gray-400'}"></div>
                            </div>
                            <div class="w-full">
                                <h4 class="font-semibold text-gray-900 text-sm truncate">${contact.name}</h4>
                                <p class="text-xs text-gray-600">${contact.role}</p>
                                <p class="text-xs ${contact.status === 'online' ? 'text-green-600' : 'text-gray-400'}">${contact.status}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            },

            // Switch between direct and group chat modes
            switchChatMode(mode) {
                this.chatMode = mode;
                const directBtn = document.getElementById('directChatBtn');
                const groupBtn = document.getElementById('groupChatBtn');
                const selectedArea = document.getElementById('selectedContactsArea');
                const groupNameArea = document.getElementById('groupNameArea');
                const checkboxes = document.querySelectorAll('.contact-checkbox');

                if (mode === 'direct') {
                    directBtn.className = 'flex-1 py-2 px-4 rounded-md text-sm font-medium bg-white text-green-600 transition-colors';
                    groupBtn.className = 'flex-1 py-2 px-4 rounded-md text-sm font-medium text-white hover:bg-green-300 transition-colors';
                    selectedArea.classList.add('hidden');
                    groupNameArea.classList.add('hidden');
                    checkboxes.forEach(cb => cb.classList.add('hidden'));
                    this.clearSelectedContacts();
                } else {
                    directBtn.className = 'flex-1 py-2 px-4 rounded-md text-sm font-medium text-white hover:bg-green-300 transition-colors';
                    groupBtn.className = 'flex-1 py-2 px-4 rounded-md text-sm font-medium bg-white text-green-600 transition-colors';
                    selectedArea.classList.remove('hidden');
                    groupNameArea.classList.remove('hidden');
                    checkboxes.forEach(cb => cb.classList.remove('hidden'));
                }

                this.updateCreateButton();
            },

            // Handle contact selection (direct mode)
            handleContactSelection(contactId, contactName, avatar, role) {
                if (this.chatMode === 'direct') {
                    this.startNewChatWith(contactId, contactName);
                }
                // For group mode, checkbox handling is done separately
            },

            // Toggle contact selection (group mode)
            toggleContactSelection(contactId, contactName, avatar, role, isSelected) {
                if (!this.selectedContacts) this.selectedContacts = [];

                if (isSelected) {
                    if (!this.selectedContacts.find(c => c.id === contactId)) {
                        this.selectedContacts.push({ id: contactId, name: contactName, avatar, role });
                    }
                } else {
                    this.selectedContacts = this.selectedContacts.filter(c => c.id !== contactId);
                }

                this.updateSelectedContactsDisplay();
                this.updateCreateButton();
            },

            // Update selected contacts display
            updateSelectedContactsDisplay() {
                const selectedList = document.getElementById('selectedContactsList');
                const selectedCount = document.getElementById('selectedCount');

                if (!selectedList || !selectedCount) return;

                selectedCount.textContent = this.selectedContacts.length;

                selectedList.innerHTML = this.selectedContacts.map(contact => `
                    <div class="flex items-center space-x-2 bg-green-100 px-3 py-1 rounded-full">
                        <span class="text-sm">${contact.avatar}</span>
                        <span class="text-sm font-medium">${contact.name}</span>
                        <button onclick="ChatSystem.removeSelectedContact('${contact.id}')" class="text-red-500 hover:text-red-700">
                            <span class="material-symbols-outlined text-sm">close</span>
                        </button>
                    </div>
                `).join('');
            },

            // Remove selected contact
            removeSelectedContact(contactId) {
                this.selectedContacts = this.selectedContacts.filter(c => c.id !== contactId);

                // Uncheck the checkbox
                const checkbox = document.getElementById(`contact_${contactId}`);
                if (checkbox) checkbox.checked = false;

                this.updateSelectedContactsDisplay();
                this.updateCreateButton();
            },

            // Clear all selected contacts
            clearSelectedContacts() {
                this.selectedContacts = [];

                // Uncheck all checkboxes
                document.querySelectorAll('.contact-item input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                });

                this.updateSelectedContactsDisplay();
                this.updateCreateButton();
            },

            // Update create button state
            updateCreateButton() {
                const createBtn = document.getElementById('createChatBtn');
                const createBtnText = document.getElementById('createChatBtnText');

                if (!createBtn || !createBtnText) return;

                if (this.chatMode === 'direct') {
                    createBtnText.textContent = 'Select a contact';
                    createBtn.disabled = true;
                } else {
                    if (this.selectedContacts.length === 0) {
                        createBtnText.textContent = 'Select contacts';
                        createBtn.disabled = true;
                    } else if (this.selectedContacts.length === 1) {
                        createBtnText.textContent = 'Create Direct Message';
                        createBtn.disabled = false;
                    } else {
                        createBtnText.textContent = `Create Group (${this.selectedContacts.length} members)`;
                        createBtn.disabled = false;
                    }
                }
            },

            // Create selected chat
            createSelectedChat() {
                if (this.selectedContacts.length === 0) return;

                if (this.selectedContacts.length === 1) {
                    // Create direct message
                    const contact = this.selectedContacts[0];
                    this.startNewChatWith(contact.id, contact.name);
                } else {
                    // Create group chat
                    this.createGroupChat();
                }
            },

            // Create group chat
            createGroupChat() {
                const groupName = document.getElementById('groupNameInput')?.value?.trim();

                if (!groupName) {
                    alert('Please enter a group name');
                    return;
                }

                if (this.selectedContacts.length < 2) {
                    alert('Please select at least 2 contacts for a group');
                    return;
                }

                // Create group room ID
                const roomId = `group_${Date.now()}`;
                const members = [this.currentUser.id, ...this.selectedContacts.map(c => c.id)];

                // Create group room
                this.chatRooms[roomId] = {
                    id: roomId,
                    name: groupName,
                    type: 'group',
                    category: 'custom',
                    avatar: 'üë•',
                    description: `Custom group with ${members.length} members`,
                    members: members,
                    admins: [this.currentUser.id],
                    moderators: [],
                    language: 'mixed',
                    messages: [{
                        id: Date.now(),
                        content: `${this.currentUser.name} created the group "${groupName}"`,
                        senderId: 'system',
                        senderName: 'System',
                        timestamp: new Date().toISOString(),
                        type: 'system'
                    }],
                    unreadCount: 0,
                    lastActivity: new Date().toISOString(),
                    joinRequests: [] // For future join request functionality
                };

                // Close modal and open the new group
                this.closeNewChatModal();

                // Refresh sidebar to show new group
                this.refreshChatSidebar();

                // Select the new room
                this.selectChatRoom(roomId);
            },

            // Request to join a group
            requestToJoinGroup(roomId) {
                const room = this.chatRooms[roomId];
                if (!room || room.type !== 'group') {
                    alert('Group not found');
                    return;
                }

                // Check if already a member
                if (room.members.includes(this.currentUser.id)) {
                    alert('You are already a member of this group');
                    return;
                }

                // Check if request already exists
                if (room.joinRequests && room.joinRequests.find(req => req.userId === this.currentUser.id)) {
                    alert('You have already requested to join this group');
                    return;
                }

                // Initialize joinRequests if not exists
                if (!room.joinRequests) {
                    room.joinRequests = [];
                }

                // Add join request
                room.joinRequests.push({
                    id: Date.now(),
                    userId: this.currentUser.id,
                    userName: this.currentUser.name,
                    userRole: this.currentUser.role,
                    timestamp: new Date().toISOString(),
                    status: 'pending'
                });

                // Add system message to group
                if (!room.messages) room.messages = [];
                room.messages.push({
                    id: Date.now() + 1,
                    content: `${this.currentUser.name} requested to join the group`,
                    senderId: 'system',
                    senderName: 'System',
                    timestamp: new Date().toISOString(),
                    type: 'system'
                });

                alert('Join request sent successfully!');
            },

            // Approve join request
            approveJoinRequest(roomId, requestId) {
                const room = this.chatRooms[roomId];
                if (!room || !room.joinRequests) return;

                const request = room.joinRequests.find(req => req.id === requestId);
                if (!request) return;

                // Check if current user is admin
                if (!room.admins.includes(this.currentUser.id)) {
                    alert('Only group admins can approve join requests');
                    return;
                }

                // Add user to members
                room.members.push(request.userId);

                // Update request status
                request.status = 'approved';

                // Add system message
                room.messages.push({
                    id: Date.now(),
                    content: `${request.userName} joined the group`,
                    senderId: 'system',
                    senderName: 'System',
                    timestamp: new Date().toISOString(),
                    type: 'system'
                });

                // Remove from pending requests
                room.joinRequests = room.joinRequests.filter(req => req.id !== requestId);

                alert(`${request.userName} has been added to the group`);

                // Refresh chat if currently viewing this room
                if (this.currentRoom === roomId) {
                    this.selectChatRoom(roomId);
                }
            },

            // Reject join request
            rejectJoinRequest(roomId, requestId) {
                const room = this.chatRooms[roomId];
                if (!room || !room.joinRequests) return;

                const request = room.joinRequests.find(req => req.id === requestId);
                if (!request) return;

                // Check if current user is admin
                if (!room.admins.includes(this.currentUser.id)) {
                    alert('Only group admins can reject join requests');
                    return;
                }

                // Remove request
                room.joinRequests = room.joinRequests.filter(req => req.id !== requestId);

                alert(`Join request from ${request.userName} has been rejected`);
            },

            // Show group join requests (for admins)
            showJoinRequests(roomId) {
                const room = this.chatRooms[roomId];
                if (!room || !room.joinRequests || room.joinRequests.length === 0) {
                    alert('No pending join requests');
                    return;
                }

                // Check if current user is admin
                if (!room.admins.includes(this.currentUser.id)) {
                    alert('Only group admins can view join requests');
                    return;
                }

                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.id = 'joinRequestsModal';

                modal.innerHTML = `
                    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-96 overflow-hidden flex flex-col">
                        <div class="p-4 bg-green-500 text-white">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold">Join Requests</h3>
                                <button onclick="ChatSystem.closeJoinRequestsModal()" class="text-white hover:text-gray-200">
                                    <span class="material-symbols-outlined">close</span>
                                </button>
                            </div>
                            <p class="text-sm text-green-100">${room.name}</p>
                        </div>

                        <div class="flex-1 overflow-y-auto p-4">
                            ${room.joinRequests.map(request => `
                                <div class="flex items-center justify-between p-3 border-b border-gray-200 last:border-b-0">
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-gray-900">${request.userName}</h4>
                                        <p class="text-sm text-gray-600">${request.userRole}</p>
                                        <p class="text-xs text-gray-400">${new Date(request.timestamp).toLocaleString()}</p>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button onclick="ChatSystem.approveJoinRequest('${roomId}', ${request.id})"
                                                class="px-3 py-1 bg-green-500 text-white text-sm rounded hover:bg-green-600">
                                            Approve
                                        </button>
                                        <button onclick="ChatSystem.rejectJoinRequest('${roomId}', ${request.id})"
                                                class="px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600">
                                            Reject
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
            },

            // Close join requests modal
            closeJoinRequestsModal() {
                document.getElementById('joinRequestsModal')?.remove();
            },

            // Add "Browse Groups" functionality to find and request to join groups
            showBrowseGroupsModal() {
                const availableGroups = Object.values(this.chatRooms).filter(room =>
                    room.type === 'group' &&
                    !room.members.includes(this.currentUser.id) &&
                    room.category !== 'direct'
                );

                if (availableGroups.length === 0) {
                    alert('No groups available to join');
                    return;
                }

                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.id = 'browseGroupsModal';

                modal.innerHTML = `
                    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl h-3/4 overflow-hidden flex flex-col">
                        <div class="p-4 bg-green-500 text-white">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold">Browse Groups</h3>
                                <button onclick="ChatSystem.closeBrowseGroupsModal()" class="text-white hover:text-gray-200">
                                    <span class="material-symbols-outlined">close</span>
                                </button>
                            </div>
                            <p class="text-sm text-green-100">Find and request to join groups</p>
                        </div>

                        <div class="p-4 border-b">
                            <input type="text" placeholder="Search groups..." id="browseGroupsSearch"
                                   oninput="ChatSystem.filterBrowseGroups(this.value)"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500">
                        </div>

                        <div class="flex-1 overflow-y-auto p-4" id="browseGroupsList">
                            ${availableGroups.map(group => {
                                const hasRequest = group.joinRequests && group.joinRequests.find(req => req.userId === this.currentUser.id);
                                return `
                                    <div class="group-item p-4 border border-gray-200 rounded-lg mb-3 hover:bg-gray-50"
                                         data-group-name="${group.name.toLowerCase()}"
                                         data-group-description="${group.description.toLowerCase()}">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-3">
                                                <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center">
                                                    <span class="text-xl">${group.avatar}</span>
                                                </div>
                                                <div>
                                                    <h4 class="font-semibold text-gray-900">${group.name}</h4>
                                                    <p class="text-sm text-gray-600">${group.description}</p>
                                                    <p class="text-xs text-gray-400">${group.members.length} members</p>
                                                </div>
                                            </div>
                                            <div>
                                                ${hasRequest ?
                                                    '<span class="px-3 py-1 bg-yellow-100 text-yellow-800 text-sm rounded">Request Pending</span>' :
                                                    `<button onclick="ChatSystem.requestToJoinGroup('${group.id}')"
                                                            class="px-4 py-2 bg-green-500 text-white text-sm rounded hover:bg-green-600">
                                                        Request to Join
                                                    </button>`
                                                }
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
            },

            // Filter browse groups
            filterBrowseGroups(query) {
                const groupItems = document.querySelectorAll('.group-item');
                const lowerQuery = query.toLowerCase();

                groupItems.forEach(item => {
                    const name = item.dataset.groupName;
                    const description = item.dataset.groupDescription;

                    if (name.includes(lowerQuery) || description.includes(lowerQuery)) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            },

            // Close browse groups modal
            closeBrowseGroupsModal() {
                document.getElementById('browseGroupsModal')?.remove();
            },

            // Show chat options menu
            showChatOptions(roomId) {
                const room = this.chatRooms[roomId];
                if (!room) return;

                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.id = 'chatOptionsModal';

                const isGroupAdmin = room.type === 'group' && room.admins && room.admins.includes(this.currentUser.id);
                const isGroupMember = room.type === 'group' && room.members && room.members.includes(this.currentUser.id);

                modal.innerHTML = `
                    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden">
                        <div class="p-4 bg-green-500 text-white">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-bold">Chat Options</h3>
                                <button onclick="ChatSystem.closeChatOptionsModal()" class="text-white hover:text-gray-200">
                                    <span class="material-symbols-outlined">close</span>
                                </button>
                            </div>
                            <p class="text-sm text-green-100">${room.name}</p>
                        </div>

                        <div class="p-4">
                            <div class="space-y-2">
                                <!-- Chat Info -->
                                <button onclick="ChatSystem.showChatInfo('${roomId}')" class="w-full text-left p-3 hover:bg-gray-100 rounded-lg flex items-center space-x-3">
                                    <span class="material-symbols-outlined text-gray-500">info</span>
                                    <span>Chat Info</span>
                                </button>

                                ${room.type === 'group' ? `
                                    <!-- View Members -->
                                    <button onclick="ChatSystem.showGroupMembers('${roomId}')" class="w-full text-left p-3 hover:bg-gray-100 rounded-lg flex items-center space-x-3">
                                        <span class="material-symbols-outlined text-gray-500">group</span>
                                        <span>View Members (${room.members ? room.members.length : 0})</span>
                                    </button>

                                    ${isGroupAdmin ? `
                                        <!-- Admin Options -->
                                        <button onclick="ChatSystem.showJoinRequests('${roomId}')" class="w-full text-left p-3 hover:bg-gray-100 rounded-lg flex items-center space-x-3">
                                            <span class="material-symbols-outlined text-gray-500">group_add</span>
                                            <span>Manage Join Requests ${room.joinRequests && room.joinRequests.length > 0 ? `(${room.joinRequests.length})` : ''}</span>
                                        </button>
                                        <button onclick="ChatSystem.addMembersToGroup('${roomId}')" class="w-full text-left p-3 hover:bg-gray-100 rounded-lg flex items-center space-x-3">
                                            <span class="material-symbols-outlined text-gray-500">person_add</span>
                                            <span>Add Members</span>
                                        </button>
                                    ` : ''}

                                    ${isGroupMember && !isGroupAdmin ? `
                                        <!-- Leave Group -->
                                        <button onclick="ChatSystem.leaveGroup('${roomId}')" class="w-full text-left p-3 hover:bg-red-100 text-red-600 rounded-lg flex items-center space-x-3">
                                            <span class="material-symbols-outlined">exit_to_app</span>
                                            <span>Leave Group</span>
                                        </button>
                                    ` : ''}
                                ` : ''}

                                <!-- Clear Chat -->
                                <button onclick="ChatSystem.clearChatHistory('${roomId}')" class="w-full text-left p-3 hover:bg-gray-100 rounded-lg flex items-center space-x-3">
                                    <span class="material-symbols-outlined text-gray-500">delete_sweep</span>
                                    <span>Clear Chat History</span>
                                </button>

                                <!-- Mute/Unmute -->
                                <button onclick="ChatSystem.toggleChatMute('${roomId}')" class="w-full text-left p-3 hover:bg-gray-100 rounded-lg flex items-center space-x-3">
                                    <span class="material-symbols-outlined text-gray-500">${room.muted ? 'notifications' : 'notifications_off'}</span>
                                    <span>${room.muted ? 'Unmute' : 'Mute'} Notifications</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
            },

            // Close chat options modal
            closeChatOptionsModal() {
                document.getElementById('chatOptionsModal')?.remove();
            },

            // Show chat info
            showChatInfo(roomId) {
                const room = this.chatRooms[roomId];
                if (!room) return;

                this.closeChatOptionsModal();

                alert(`Chat: ${room.name}\nType: ${room.type}\nMembers: ${room.members ? room.members.length : 0}\nDescription: ${room.description}`);
            },

            // Show group members
            showGroupMembers(roomId) {
                const room = this.chatRooms[roomId];
                if (!room) return;

                this.closeChatOptionsModal();

                const membersList = room.members ? room.members.join(', ') : 'No members';
                alert(`Group Members:\n${membersList}`);
            },

            // Clear chat history
            clearChatHistory(roomId) {
                const room = this.chatRooms[roomId];
                if (!room) return;

                this.closeChatOptionsModal();

                if (confirm('Are you sure you want to clear all chat history? This cannot be undone.')) {
                    room.messages = [];
                    this.selectChatRoom(roomId);
                    alert('Chat history cleared.');
                }
            },

            // Toggle chat mute
            toggleChatMute(roomId) {
                const room = this.chatRooms[roomId];
                if (!room) return;

                this.closeChatOptionsModal();

                room.muted = !room.muted;
                alert(`Chat ${room.muted ? 'muted' : 'unmuted'}.`);
            },

            // Leave group
            leaveGroup(roomId) {
                const room = this.chatRooms[roomId];
                if (!room) return;

                this.closeChatOptionsModal();

                if (confirm(`Are you sure you want to leave "${room.name}"?`)) {
                    // Remove user from members
                    room.members = room.members.filter(id => id !== this.currentUser.id);

                    // Add system message
                    room.messages.push({
                        id: Date.now(),
                        content: `${this.currentUser.name} left the group`,
                        senderId: 'system',
                        senderName: 'System',
                        timestamp: new Date().toISOString(),
                        type: 'system'
                    });

                    // Close chat and return to main chat interface
                    this.closeChatInterface();
                    this.showChatInterface();
                }
            },

            // Filter contacts in new chat modal
            filterNewChatContacts(query) {
                const contactItems = document.querySelectorAll('.contact-item');
                const lowerQuery = query.toLowerCase();

                contactItems.forEach(item => {
                    const name = item.dataset.contactName;
                    const role = item.dataset.contactRole;

                    if (name.includes(lowerQuery) || role.includes(lowerQuery)) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            },

            // Start new chat with selected contact
            startNewChatWith(contactId, contactName) {
                // Create a new direct message room
                const roomId = `dm_${this.currentUser.id}_${contactId}`;

                if (!this.chatRooms[roomId]) {
                    this.chatRooms[roomId] = {
                        id: roomId,
                        name: contactName,
                        type: 'direct',
                        category: 'direct',
                        avatar: 'üí¨',
                        description: `Direct message with ${contactName}`,
                        members: [this.currentUser.id, contactId],
                        admins: [],
                        moderators: [],
                        language: 'mixed',
                        messages: [],
                        unreadCount: 0,
                        lastActivity: new Date().toISOString()
                    };
                }

                // Close new chat modal
                this.closeNewChatModal();

                // Refresh sidebar to show new chat
                this.refreshChatSidebar();

                // Select the new room
                this.selectChatRoom(roomId);
            },

            // Smart chat room selection - chooses best available window
            selectChatRoomSmart(roomId) {
                const isMobile = window.innerWidth <= 768;

                if (isMobile) {
                    // Mobile always uses single view
                    this.selectChatRoom(roomId, 1);
                    return;
                }

                // Desktop: Choose next available window intelligently
                if (!this.currentRoom1) {
                    // Window 1 is empty, use it
                    this.selectChatRoom(roomId, 1);
                } else if (!this.currentRoom2) {
                    // Window 1 occupied, Window 2 empty, use Window 2
                    this.selectChatRoom(roomId, 2);
                } else if (this.currentRoom1 === roomId) {
                    // Chat is already in Window 1, keep it there
                    this.selectChatRoom(roomId, 1);
                } else if (this.currentRoom2 === roomId) {
                    // Chat is already in Window 2, keep it there
                    this.selectChatRoom(roomId, 2);
                } else {
                    // Both windows occupied with different chats, replace Window 1
                    this.selectChatRoom(roomId, 1);
                }
            },

            // Select and open a chat room in specified window (1 or 2)
            selectChatRoom(roomId, windowNumber = 1) {
                const room = this.chatRooms[roomId];

                if (!room) {
                    console.error('Room not found:', roomId);
                    return;
                }

                // Mark messages as read
                if (room.unreadCount > 0) {
                    room.unreadCount = 0;
                    this.updateBadge();
                }

                // Close new chat modal if open
                this.closeNewChatModal();

                // Update the chat interface to show this room
                const isMobile = window.innerWidth <= 768;

                if (isMobile) {
                    // Mobile still uses single chat view
                    this.currentRoom = roomId;
                    document.getElementById('chatListView').style.display = 'none';
                    let chatView = document.getElementById('mobileChatView');
                    if (!chatView) {
                        chatView = document.createElement('div');
                        chatView.id = 'mobileChatView';
                        chatView.className = 'w-full h-full bg-white flex flex-col';
                        document.querySelector('.chat-modal-container').appendChild(chatView);
                    }
                    chatView.style.display = 'flex';
                    chatView.innerHTML = this.generateMobileChatView(room);
                } else {
                    // Desktop dual window support
                    if (windowNumber === 1) {
                        this.currentRoom1 = roomId;
                    } else {
                        this.currentRoom2 = roomId;
                    }

                    const chatWindow = document.getElementById(`chatWindow${windowNumber}`);
                    if (chatWindow) {
                        chatWindow.innerHTML = this.generateDesktopChatView(room, windowNumber);
                    }
                }
            },

            // Show context menu for chat window selection
            showChatWindowMenu(event, roomId) {
                event.preventDefault();

                // Remove existing menu
                document.getElementById('chatWindowMenu')?.remove();

                const menu = document.createElement('div');
                menu.id = 'chatWindowMenu';
                menu.className = 'fixed bg-white border border-gray-200 rounded-lg shadow-lg z-50 py-2 min-w-48';
                menu.style.left = event.pageX + 'px';
                menu.style.top = event.pageY + 'px';

                const window1Room = this.currentRoom1 ? this.chatRooms[this.currentRoom1]?.name || 'Unknown' : 'Empty';
                const window2Room = this.currentRoom2 ? this.chatRooms[this.currentRoom2]?.name || 'Unknown' : 'Empty';

                menu.innerHTML = `
                    <button onclick="ChatSystem.selectChatRoom('${roomId}', 1); ChatSystem.closeChatWindowMenu();"
                            class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <span class="material-symbols-outlined text-sm">chat</span>
                            <span>Window 1</span>
                        </div>
                        <span class="text-xs text-gray-500 truncate max-w-20">${window1Room}</span>
                    </button>
                    <button onclick="ChatSystem.selectChatRoom('${roomId}', 2); ChatSystem.closeChatWindowMenu();"
                            class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <span class="material-symbols-outlined text-sm">chat</span>
                            <span>Window 2</span>
                        </div>
                        <span class="text-xs text-gray-500 truncate max-w-20">${window2Room}</span>
                    </button>
                `;

                document.body.appendChild(menu);

                // Close menu when clicking elsewhere
                setTimeout(() => {
                    document.addEventListener('click', this.closeChatWindowMenu, { once: true });
                }, 100);
            },

            // Close chat window menu
            closeChatWindowMenu() {
                document.getElementById('chatWindowMenu')?.remove();
            },

            // Close a specific chat window
            closeChatWindow(windowNumber) {
                if (windowNumber === 1) {
                    this.currentRoom1 = null;
                } else {
                    this.currentRoom2 = null;
                }

                const chatWindow = document.getElementById(`chatWindow${windowNumber}`);
                if (chatWindow) {
                    chatWindow.innerHTML = `
                        <div class="p-4 bg-gray-50 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <h4 class="font-semibold text-gray-600">Chat Window ${windowNumber}</h4>
                                <button onclick="ChatSystem.closeChatWindow(${windowNumber})" class="text-gray-400 hover:text-gray-600">
                                    <span class="material-symbols-outlined text-sm">close</span>
                                </button>
                            </div>
                        </div>
                        <div class="flex-1 flex items-center justify-center text-gray-500">
                            <div class="text-center">
                                <span class="material-symbols-outlined text-4xl text-gray-300 mb-2 block">forum</span>
                                <p class="text-sm">${windowNumber === 1 ? 'Select a chat to start messaging' : 'Select another chat for dual conversations'}</p>
                            </div>
                        </div>
                    `;
                }
            },

            // Generate mobile chat view
            generateMobileChatView(room) {
                const messages = room.messages || [];
                return `
                    <!-- Mobile Chat Header -->
                    <div class="p-4 bg-green-500 text-white flex items-center space-x-3">
                        <button onclick="ChatSystem.showMobileChatList()" class="text-white hover:text-gray-200">
                            <span class="material-symbols-outlined">arrow_back</span>
                        </button>
                        <div class="w-10 h-10 bg-green-400 rounded-full flex items-center justify-center">
                            <span class="text-xl">${room.avatar}</span>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-bold">${room.name}</h3>
                            <p class="text-sm text-green-100">${room.members ? room.members.length + ' members' : 'Direct message'}</p>
                        </div>
                        <div class="flex space-x-2">
                            ${room.type === 'group' && room.admins && room.admins.includes(this.currentUser.id) && room.joinRequests && room.joinRequests.length > 0 ?
                                `<button onclick="ChatSystem.showJoinRequests('${room.id}')" class="text-white hover:text-gray-200 relative">
                                    <span class="material-symbols-outlined">group_add</span>
                                    <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">${room.joinRequests.length}</span>
                                </button>` : ''
                            }
                            <button onclick="ChatSystem.showChatOptions('${room.id}')" class="text-white hover:text-gray-200">
                                <span class="material-symbols-outlined">more_vert</span>
                            </button>
                        </div>
                    </div>

                    <!-- Messages Area -->
                    <div class="flex-1 overflow-y-auto p-4 space-y-4" id="mobileMessagesArea">
                        ${messages.length > 0 ? messages.map(msg => this.generateMessageHTML(msg)).join('') : '<div class="text-center text-gray-500 py-8">No messages yet. Start the conversation!</div>'}
                    </div>

                    <!-- Message Input -->
                    <div class="p-4 border-t bg-gray-50">
                        <div class="flex space-x-2">
                            <input type="text" placeholder="Type a message..." id="mobileMessageInput_${room.id}"
                                   class="flex-1 px-4 py-2 border border-gray-300 rounded-full focus:ring-green-500 focus:border-green-500"
                                   onkeypress="if(event.key==='Enter') ChatSystem.sendMessageFromInput('mobileMessageInput_${room.id}', '${room.id}');">
                            <button onclick="ChatSystem.sendMessageFromInput('mobileMessageInput_${room.id}', '${room.id}')"
                                    class="bg-green-500 text-white px-4 py-2 rounded-full">
                                <span class="material-symbols-outlined">send</span>
                            </button>
                        </div>
                    </div>
                `;
            },

            // Generate desktop chat view
            generateDesktopChatView(room, windowNumber = 1) {
                const messages = room.messages || [];
                return `
                    <!-- Desktop Chat Header -->
                    <div class="p-4 border-b border-gray-200 bg-white">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center">
                                <span class="text-xl">${room.avatar}</span>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-bold text-gray-900">${room.name}</h3>
                                <p class="text-sm text-gray-600">${room.members ? room.members.length + ' members' : 'Direct message'}</p>
                            </div>
                            <div class="flex space-x-2">
                                ${room.type === 'group' && room.admins && room.admins.includes(this.currentUser.id) && room.joinRequests && room.joinRequests.length > 0 ?
                                    `<button onclick="ChatSystem.showJoinRequests('${room.id}')" class="text-gray-400 hover:text-gray-600 relative">
                                        <span class="material-symbols-outlined">group_add</span>
                                        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">${room.joinRequests.length}</span>
                                    </button>` : ''
                                }
                                <button onclick="ChatSystem.showChatOptions('${room.id}')" class="text-gray-400 hover:text-gray-600">
                                    <span class="material-symbols-outlined">more_vert</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Messages Area -->
                    <div class="flex-1 overflow-y-auto p-4 space-y-4" id="desktopMessagesArea_${windowNumber}">
                        ${messages.length > 0 ? messages.map(msg => this.generateMessageHTML(msg)).join('') : '<div class="text-center text-gray-500 py-8">No messages yet. Start the conversation!</div>'}
                    </div>

                    <!-- Message Input -->
                    <div class="p-4 border-t bg-gray-50">
                        <div class="flex space-x-2">
                            <input type="text" placeholder="Type a message..." id="desktopMessageInput_${room.id}_${windowNumber}"
                                   class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500"
                                   onkeypress="if(event.key==='Enter') ChatSystem.sendMessageFromInput('desktopMessageInput_${room.id}_${windowNumber}', '${room.id}', ${windowNumber});">
                            <button onclick="ChatSystem.sendMessageFromInput('desktopMessageInput_${room.id}_${windowNumber}', '${room.id}', ${windowNumber})"
                                    class="bg-green-500 text-white px-4 py-2 rounded-lg">
                                <span class="material-symbols-outlined">send</span>
                            </button>
                        </div>
                    </div>
                `;
            },

            // Show mobile chat list (back button)
            showMobileChatList() {
                document.getElementById('chatListView').style.display = 'flex';
                const chatView = document.getElementById('mobileChatView');
                if (chatView) chatView.style.display = 'none';
            },

            // Generate message HTML
            generateMessageHTML(message) {
                const isOwn = message.senderId === this.currentUser.id;
                return `
                    <div class="flex ${isOwn ? 'justify-end' : 'justify-start'}">
                        <div class="max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${isOwn ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-900'}">
                            ${!isOwn ? `<p class="text-xs font-semibold mb-1">${message.senderName}</p>` : ''}
                            <p>${message.content}</p>
                            <p class="text-xs mt-1 ${isOwn ? 'text-green-100' : 'text-gray-500'}">${new Date(message.timestamp).toLocaleTimeString()}</p>
                        </div>
                    </div>
                `;
            },

            // Send message from input field
            sendMessageFromInput(inputId, roomId, windowNumber = null) {
                const input = document.getElementById(inputId);
                if (!input) return;

                const content = input.value.trim();
                if (!content) return;

                this.sendMessage(content, roomId, windowNumber);
                input.value = '';
            },

            // Send message
            sendMessage(content, roomId, windowNumber = null) {
                if (!content || !content.trim()) return;

                const room = this.chatRooms[roomId];
                if (!room) return;

                const message = {
                    id: Date.now(),
                    content: content.trim(),
                    senderId: this.currentUser.id,
                    senderName: this.currentUser.name,
                    timestamp: new Date().toISOString(),
                    type: 'text'
                };

                room.messages = room.messages || [];
                room.messages.push(message);
                room.lastActivity = new Date().toISOString();

                // Refresh sidebar to show latest message
                this.refreshChatSidebar();

                // Refresh the appropriate chat view
                if (windowNumber) {
                    this.selectChatRoom(roomId, windowNumber);
                } else {
                    // For mobile or single window
                    this.selectChatRoom(roomId);
                }
            },

            // Close new chat modal
            closeNewChatModal() {
                document.getElementById('newChatModal')?.remove();
            },

            closeChatInterface() {
                document.getElementById('chatModal')?.remove();
            },

            t(key) {
                const lang = currentLanguage || 'en';
                return this.translations[lang]?.[key] || key;
            },

            // Update chat badge with unread message count
            updateBadge() {
                const totalUnread = this.getTotalUnreadCount();
                const badges = document.querySelectorAll('#chatBadge');

                badges.forEach(badge => {
                    if (totalUnread > 0) {
                        badge.textContent = totalUnread > 99 ? '99+' : totalUnread;
                        badge.style.display = 'flex';
                    } else {
                        badge.style.display = 'none';
                    }
                });
            },

            // Get total unread message count across all rooms
            getTotalUnreadCount() {
                let total = 0;
                Object.values(this.chatRooms).forEach(room => {
                    total += room.unreadCount || 0;
                });
                return total;
            }
        };

        // Enhanced Caddy Management System
        const CaddySystem = {
            allCaddys: [
                // PATTANA GOLF RESORT & SPA (20 caddies)
                { id: 'pat002', name: 'Sunan Rojana', rating: 4.8, experience: 12, languages: ['Thai', 'English', 'German'], avatar: 'üë®', specialty: 'Resort Experience', homeClub: 'pattana-golf-resort', availability: 'available', totalRounds: 3456, reviews: 421, personality: 'Luxury service focused', strengths: ['Resort Services', 'Guest Relations', 'Ocean Course'] },
                { id: 'pat003', name: 'Ploy Siriwat', rating: 4.7, experience: 6, languages: ['Thai', 'English'], avatar: 'üë©', specialty: 'Spa & Golf Package', homeClub: 'pattana-golf-resort', availability: 'available', totalRounds: 1847, reviews: 198, personality: 'Relaxed and wellness-focused', strengths: ['Wellness Integration', 'Relaxation', 'Course Enjoyment'] },
                { id: 'pat004', name: 'Anuwat Teerachai', rating: 4.6, experience: 9, languages: ['Thai', 'English', 'Russian'], avatar: 'üë®‚Äçü¶≥', specialty: 'International Guests', homeClub: 'pattana-golf-resort', availability: 'booked', totalRounds: 2734, reviews: 312, personality: 'Cultural bridge specialist', strengths: ['Language Skills', 'Cultural Awareness', 'International Etiquette'] },
                { id: 'pat005', name: 'Siriporn Nakamura', rating: 4.9, experience: 11, languages: ['Thai', 'English', 'Japanese'], avatar: 'üë©', specialty: 'International Service', homeClub: 'pattana-golf-resort', availability: 'available', totalRounds: 3921, reviews: 456, personality: 'Precise and culturally aware', strengths: ['Japanese Guests', 'Precision', 'Cultural Service'] },
                { id: 'pat006', name: 'Kamon Srisuk', rating: 4.5, experience: 7, languages: ['Thai', 'English'], avatar: 'üë®', specialty: 'Ocean Course Expert', homeClub: 'pattana-golf-resort', availability: 'available', totalRounds: 2156, reviews: 234, personality: 'Ocean course specialist', strengths: ['Wind Reading', 'Coastal Play', 'Weather Adaptation'] },
                { id: 'pat007', name: 'Niran Phongsri', rating: 4.7, experience: 10, languages: ['Thai', 'English', 'Chinese'], avatar: 'üë®‚Äçü¶≤', specialty: 'VIP Championship', homeClub: 'pattana-golf-resort', availability: 'booked', totalRounds: 3245, reviews: 387, personality: 'Championship focused', strengths: ['Tournament Prep', 'Elite Service', 'Course Management'] },
                { id: 'pat008', name: 'Wassana Chitpong', rating: 4.6, experience: 5, languages: ['Thai', 'English'], avatar: 'üë©‚Äçü¶±', specialty: 'Family Resort Golf', homeClub: 'pattana-golf-resort', availability: 'available', totalRounds: 1567, reviews: 178, personality: 'Family-oriented and fun', strengths: ['Family Groups', 'Resort Activities', 'Fun Golf'] },
                { id: 'pat009', name: 'Thanapon Wira', rating: 4.8, experience: 14, languages: ['Thai', 'English', 'French'], avatar: 'üë®', specialty: 'Luxury Resort Service', homeClub: 'pattana-golf-resort', availability: 'available', totalRounds: 4123, reviews: 523, personality: 'Luxury service expert', strengths: ['Premium Service', 'Fine Dining', 'Resort Concierge'] },
                { id: 'pat010', name: 'Kulthida Manee', rating: 4.7, experience: 8, languages: ['Thai', 'English'], avatar: 'üë©', specialty: 'Ladies Golf Specialist', homeClub: 'pattana-golf-resort', availability: 'available', totalRounds: 2234, reviews: 267, personality: 'Supportive and encouraging', strengths: ['Ladies Golf', 'Technique Teaching', 'Confidence Building'] },
                { id: 'pat011', name: 'Sombat Rattana', rating: 4.9, experience: 16, languages: ['Thai', 'English', 'Korean'], avatar: 'üë®‚Äçü¶≥', specialty: 'Master Caddy', homeClub: 'pattana-golf-resort', availability: 'available', totalRounds: 5234, reviews: 634, personality: 'Master of the course', strengths: ['Course History', 'Expert Knowledge', 'Elite Guidance'] },
                { id: 'pat012', name: 'Pensri Kamal', rating: 4.5, experience: 4, languages: ['Thai', 'English'], avatar: 'üë©', specialty: 'New Golfer Support', homeClub: 'pattana-golf-resort', availability: 'available', totalRounds: 1123, reviews: 134, personality: 'Patient and teaching-focused', strengths: ['Beginner Support', 'Basic Instruction', 'Encouragement'] },
                { id: 'pat013', name: 'Wichai Thongchai', rating: 4.6, experience: 9, languages: ['Thai', 'English', 'Spanish'], avatar: 'üë®', specialty: 'International Tourism', homeClub: 'pattana-golf-resort', availability: 'booked', totalRounds: 2567, reviews: 298, personality: 'Tourism and hospitality expert', strengths: ['Tourism Knowledge', 'Local Culture', 'Hospitality'] },
                { id: 'pat014', name: 'Siriporn Jaidee', rating: 4.8, experience: 11, languages: ['Thai', 'English', 'Japanese'], avatar: 'üë©‚Äçü¶≤', specialty: 'Precision Golf', homeClub: 'pattana-golf-resort', availability: 'available', totalRounds: 3456, reviews: 412, personality: 'Precision and technique focused', strengths: ['Technical Analysis', 'Precision Play', 'Shot Planning'] },
                { id: 'pat015', name: 'Charn Wongsa', rating: 4.7, experience: 13, languages: ['Thai', 'English', 'Chinese'], avatar: 'üë®', specialty: 'Business Golf', homeClub: 'pattana-golf-resort', availability: 'available', totalRounds: 3834, reviews: 445, personality: 'Business-focused and professional', strengths: ['Business Etiquette', 'Networking Support', 'Professional Service'] },
                { id: 'pat016', name: 'Mayuree Tanin', rating: 4.5, experience: 6, languages: ['Thai', 'English'], avatar: 'üë©', specialty: 'Resort Leisure Golf', homeClub: 'pattana-golf-resort', availability: 'available', totalRounds: 1789, reviews: 201, personality: 'Leisure and relaxation focused', strengths: ['Leisure Golf', 'Relaxation', 'Resort Experience'] },
                { id: 'pat017', name: 'Narong Sila', rating: 4.8, experience: 10, languages: ['Thai', 'English', 'Italian'], avatar: 'üë®‚Äçü¶≤', specialty: 'European Guests', homeClub: 'pattana-golf-resort', availability: 'booked', totalRounds: 2923, reviews: 356, personality: 'European culture specialist', strengths: ['European Customs', 'Cultural Adaptation', 'International Service'] },
                { id: 'pat018', name: 'Amporn Ritual', rating: 4.6, experience: 7, languages: ['Thai', 'English'], avatar: 'üë©‚Äçü¶±', specialty: 'Course Photography', homeClub: 'pattana-golf-resort', availability: 'available', totalRounds: 2012, reviews: 234, personality: 'Artistic and scenic focused', strengths: ['Photo Spots', 'Scenic Views', 'Memory Making'] },
                { id: 'pat019', name: 'Preecha Nawin', rating: 4.9, experience: 15, languages: ['Thai', 'English', 'Arabic'], avatar: 'üë®', specialty: 'Premium Championship', homeClub: 'pattana-golf-resort', availability: 'available', totalRounds: 4567, reviews: 556, personality: 'Championship excellence focused', strengths: ['Elite Performance', 'Championship Standards', 'Premium Service'] },
                { id: 'pat020', name: 'Ratana Sompong', rating: 4.7, experience: 8, languages: ['Thai', 'English'], avatar: 'üë©', specialty: 'Wellness Golf', homeClub: 'pattana-golf-resort', availability: 'available', totalRounds: 2345, reviews: 278, personality: 'Health and wellness focused', strengths: ['Wellness Integration', 'Health Benefits', 'Mindful Golf'] },

                // PATTAYA GOLF CLUB (20 caddies)
                { id: 'pat001', name: 'Ning Prasert', rating: 4.9, experience: 8, languages: ['Thai', 'English'], avatar: 'üë®‚Äçü¶≤', specialty: 'Championship Course', homeClub: 'pattana-golf-resort', availability: 'booked', totalRounds: 3, reviews: 2, personality: 'Professional and detail-oriented', strengths: ['Course Knowledge', 'Club Selection', 'Reading Greens'], currentBooking: { date: '2025-01-15', time: '09:00', golfer: 'Sarah Johnson', holes: 18 } },
                { id: 'pgc002', name: 'Malee Wongsiri', rating: 4.6, experience: 5, languages: ['Thai', 'English'], avatar: 'üë©‚Äçü¶±', specialty: 'Family & Beginner', homeClub: 'pattaya-golf', availability: 'available', totalRounds: 1234, reviews: 156, personality: 'Fun and family-friendly', strengths: ['Family Groups', 'Beginner Instruction', 'Fun Atmosphere'] },
                { id: 'pgc003', name: 'Somsak Thiwat', rating: 4.8, experience: 12, languages: ['Thai', 'English', 'German'], avatar: 'üë®', specialty: 'City Course Expert', homeClub: 'pattaya-golf', availability: 'booked', totalRounds: 3567, reviews: 423, personality: 'Urban golf specialist', strengths: ['City Course', 'Traffic Management', 'Urban Golf'] },
                { id: 'pgc004', name: 'Pranee Kaewta', rating: 4.7, experience: 9, languages: ['Thai', 'English', 'Russian'], avatar: 'üë©', specialty: 'Tourist Groups', homeClub: 'pattaya-golf', availability: 'available', totalRounds: 2456, reviews: 289, personality: 'Tourist-friendly and helpful', strengths: ['Tourist Groups', 'City Knowledge', 'Entertainment Golf'] },
                { id: 'pgc005', name: 'Chalerm Sarit', rating: 4.5, experience: 6, languages: ['Thai', 'English'], avatar: 'üë®‚Äçü¶≥', specialty: 'Quick Play Expert', homeClub: 'pattaya-golf', availability: 'available', totalRounds: 1876, reviews: 212, personality: 'Efficient and quick', strengths: ['Fast Play', 'Time Management', 'Efficient Service'] },
                { id: 'pgc006', name: 'Wipob Srinuan', rating: 4.8, experience: 11, languages: ['Thai', 'English', 'Chinese'], avatar: 'üë®', specialty: 'Business Meetings', homeClub: 'pattaya-golf', availability: 'available', totalRounds: 3234, reviews: 378, personality: 'Business professional', strengths: ['Business Golf', 'Meeting Support', 'Professional Networking'] },
                { id: 'pgc007', name: 'Suchada Prom', rating: 4.6, experience: 7, languages: ['Thai', 'English'], avatar: 'üë©‚Äçü¶≤', specialty: 'Ladies Golf', homeClub: 'pattaya-golf', availability: 'booked', totalRounds: 2123, reviews: 245, personality: 'Ladies golf specialist', strengths: ['Ladies Golf', 'Technique Tips', 'Social Golf'] },
                { id: 'pgc008', name: 'Thawee Bunma', rating: 4.7, experience: 10, languages: ['Thai', 'English', 'Japanese'], avatar: 'üë®', specialty: 'Traditional Golf', homeClub: 'pattaya-golf', availability: 'available', totalRounds: 2897, reviews: 334, personality: 'Traditional golf purist', strengths: ['Golf Traditions', 'Classic Techniques', 'Golf History'] },
                { id: 'pgc009', name: 'Naree Thong', rating: 4.5, experience: 4, languages: ['Thai', 'English'], avatar: 'üë©', specialty: 'Beginner Support', homeClub: 'pattaya-golf', availability: 'available', totalRounds: 1345, reviews: 156, personality: 'Patient teacher', strengths: ['Beginner Instruction', 'Basic Techniques', 'Encouragement'] },
                { id: 'pgc010', name: 'Bancha Kraison', rating: 4.9, experience: 14, languages: ['Thai', 'English', 'Korean'], avatar: 'üë®‚Äçü¶≤', specialty: 'Pro Shop Integration', homeClub: 'pattaya-golf', availability: 'available', totalRounds: 4123, reviews: 498, personality: 'Equipment expert', strengths: ['Equipment Knowledge', 'Pro Shop Services', 'Golf Technology'] },
                { id: 'pgc011', name: 'Oranuch Sinam', rating: 4.6, experience: 8, languages: ['Thai', 'English'], avatar: 'üë©‚Äçü¶±', specialty: 'Social Golf', homeClub: 'pattaya-golf', availability: 'available', totalRounds: 2234, reviews: 267, personality: 'Social and networking focused', strengths: ['Social Events', 'Group Management', 'Golf Networking'] },
                { id: 'pgc012', name: 'Kitti Wongsawan', rating: 4.8, experience: 13, languages: ['Thai', 'English', 'French'], avatar: 'üë®', specialty: 'Restaurant Integration', homeClub: 'pattaya-golf', availability: 'booked', totalRounds: 3678, reviews: 445, personality: 'Hospitality expert', strengths: ['Restaurant Services', 'Dining Integration', 'Hospitality'] },
                { id: 'pgc013', name: 'Sirilak Janya', rating: 4.7, experience: 9, languages: ['Thai', 'English', 'Spanish'], avatar: 'üë©', specialty: 'Event Golf', homeClub: 'pattaya-golf', availability: 'available', totalRounds: 2567, reviews: 301, personality: 'Event coordination expert', strengths: ['Event Management', 'Group Coordination', 'Special Occasions'] },
                { id: 'pgc014', name: 'Prapat Sanoh', rating: 4.5, experience: 5, languages: ['Thai', 'English'], avatar: 'üë®‚Äçü¶≥', specialty: 'City Tourism Golf', homeClub: 'pattaya-golf', availability: 'available', totalRounds: 1654, reviews: 189, personality: 'City tourism expert', strengths: ['City Tours', 'Local Attractions', 'Tourism Golf'] },
                { id: 'pgc015', name: 'Wilai Precha', rating: 4.8, experience: 11, languages: ['Thai', 'English', 'Italian'], avatar: 'üë©', specialty: 'Cultural Golf Tours', homeClub: 'pattaya-golf', availability: 'available', totalRounds: 3123, reviews: 376, personality: 'Cultural tour specialist', strengths: ['Cultural Integration', 'Local Culture', 'Educational Golf'] },
                { id: 'pgc016', name: 'Chai Promma', rating: 4.6, experience: 7, languages: ['Thai', 'English'], avatar: 'üë®', specialty: 'Fitness Golf', homeClub: 'pattaya-golf', availability: 'available', totalRounds: 1987, reviews: 234, personality: 'Fitness and health focused', strengths: ['Golf Fitness', 'Health Benefits', 'Physical Conditioning'] },
                { id: 'pgc017', name: 'Sunisa Kruea', rating: 4.7, experience: 10, languages: ['Thai', 'English', 'Chinese'], avatar: 'üë©‚Äçü¶≤', specialty: 'Shopping Tour Golf', homeClub: 'pattaya-golf', availability: 'booked', totalRounds: 2876, reviews: 334, personality: 'Shopping and leisure expert', strengths: ['Shopping Tours', 'Leisure Activities', 'Entertainment'] },
                { id: 'pgc018', name: 'Amnuay Thani', rating: 4.9, experience: 15, languages: ['Thai', 'English', 'Arabic'], avatar: 'üë®', specialty: 'VIP City Service', homeClub: 'pattaya-golf', availability: 'available', totalRounds: 4456, reviews: 534, personality: 'VIP city service expert', strengths: ['VIP Services', 'City Elite', 'Premium Urban Golf'] },
                { id: 'pgc019', name: 'Duangjai Sila', rating: 4.5, experience: 6, languages: ['Thai', 'English'], avatar: 'üë©', specialty: 'Photography Golf', homeClub: 'pattaya-golf', availability: 'available', totalRounds: 1765, reviews: 201, personality: 'Photography enthusiast', strengths: ['Golf Photography', 'Scenic Shots', 'Memory Capture'] },
                { id: 'pgc020', name: 'Wasan Kaew', rating: 4.8, experience: 12, languages: ['Thai', 'English', 'Portuguese'], avatar: 'üë®‚Äçü¶≤', specialty: 'International Business', homeClub: 'pattaya-golf', availability: 'available', totalRounds: 3567, reviews: 423, personality: 'International business expert', strengths: ['Business Deals', 'International Relations', 'Corporate Golf'] },

                // THAI COUNTRY CLUB (20 caddies)
                { id: 'tcc001', name: 'Somchai Jaidee', rating: 4.8, experience: 12, languages: ['Thai', 'English', 'Japanese'], avatar: 'üë®', specialty: 'Strategy & Mental Game', homeClub: 'thai-country-club', availability: 'booked', totalRounds: 4238, reviews: 512, personality: 'Calm and strategic thinker', strengths: ['Mental Coaching', 'Course Strategy', 'Pressure Management'] },
                { id: 'tcc002', name: 'Pongsak Rattana', rating: 4.8, experience: 10, languages: ['Thai', 'English', 'Korean'], avatar: 'üë®', specialty: 'Tournament Play', homeClub: 'thai-country-club', availability: 'available', totalRounds: 3456, reviews: 387, personality: 'Competitive and precise', strengths: ['Tournament Experience', 'Precision', 'Competitive Play'] },
                { id: 'tcc003', name: 'Apichat Seeda', rating: 4.9, experience: 16, languages: ['Thai', 'English', 'Chinese'], avatar: 'üë®‚Äçü¶≥', specialty: 'Championship Master', homeClub: 'thai-country-club', availability: 'available', totalRounds: 5234, reviews: 634, personality: 'Championship excellence', strengths: ['Elite Performance', 'Championship History', 'Master Guidance'] },
                { id: 'tcc004', name: 'Sirada Komon', rating: 4.7, experience: 9, languages: ['Thai', 'English', 'German'], avatar: 'üë©', specialty: 'VIP Tournament Service', homeClub: 'thai-country-club', availability: 'booked', totalRounds: 2876, reviews: 345, personality: 'VIP service specialist', strengths: ['VIP Treatment', 'Tournament Prep', 'Elite Service'] },
                { id: 'tcc005', name: 'Weerawat Pansa', rating: 4.8, experience: 13, languages: ['Thai', 'English', 'Japanese'], avatar: 'üë®', specialty: 'Professional Training', homeClub: 'thai-country-club', availability: 'available', totalRounds: 3967, reviews: 478, personality: 'Professional coach', strengths: ['Professional Training', 'Skill Development', 'Performance Analysis'] },
                { id: 'tcc006', name: 'Montra Theerasak', rating: 4.6, experience: 7, languages: ['Thai', 'English'], avatar: 'üë©‚Äçü¶±', specialty: 'Ladies Tournament', homeClub: 'thai-country-club', availability: 'available', totalRounds: 2123, reviews: 256, personality: 'Ladies golf champion supporter', strengths: ['Ladies Golf', 'Tournament Support', 'Competitive Ladies'] },
                { id: 'tcc007', name: 'Thana Rojvorakul', rating: 4.9, experience: 15, languages: ['Thai', 'English', 'French'], avatar: 'üë®‚Äçü¶≤', specialty: 'Luxury Tournament', homeClub: 'thai-country-club', availability: 'available', totalRounds: 4567, reviews: 567, personality: 'Luxury tournament expert', strengths: ['Luxury Events', 'Premium Tournaments', 'Elite Competitions'] },
                { id: 'tcc008', name: 'Sasithorn Niran', rating: 4.7, experience: 11, languages: ['Thai', 'English', 'Russian'], avatar: 'üë©', specialty: 'International Tournaments', homeClub: 'thai-country-club', availability: 'booked', totalRounds: 3234, reviews: 389, personality: 'International competition expert', strengths: ['International Events', 'Global Standards', 'Cross-Cultural Competition'] },
                { id: 'tcc009', name: 'Krisada Manop', rating: 4.5, experience: 6, languages: ['Thai', 'English'], avatar: 'üë®', specialty: 'Junior Development', homeClub: 'thai-country-club', availability: 'available', totalRounds: 1876, reviews: 212, personality: 'Youth development focused', strengths: ['Junior Golf', 'Youth Training', 'Future Champions'] },
                { id: 'tcc010', name: 'Pensiri Tawan', rating: 4.8, experience: 12, languages: ['Thai', 'English', 'Spanish'], avatar: 'üë©‚Äçü¶≤', specialty: 'Performance Analytics', homeClub: 'thai-country-club', availability: 'available', totalRounds: 3456, reviews: 423, personality: 'Data and performance expert', strengths: ['Performance Data', 'Analytics', 'Improvement Tracking'] },
                { id: 'tcc011', name: 'Natthawut Siri', rating: 4.6, experience: 8, languages: ['Thai', 'English', 'Korean'], avatar: 'üë®‚Äçü¶≥', specialty: 'Equipment Specialist', homeClub: 'thai-country-club', availability: 'available', totalRounds: 2567, reviews: 298, personality: 'Equipment technology expert', strengths: ['Equipment Analysis', 'Technology Integration', 'Gear Optimization'] },
                { id: 'tcc012', name: 'Waraporn Chai', rating: 4.7, experience: 10, languages: ['Thai', 'English', 'Chinese'], avatar: 'üë©', specialty: 'Mental Performance', homeClub: 'thai-country-club', availability: 'available', totalRounds: 2987, reviews: 356, personality: 'Mental game specialist', strengths: ['Mental Training', 'Psychological Support', 'Focus Enhancement'] },
                { id: 'tcc013', name: 'Samart Thong', rating: 4.9, experience: 14, languages: ['Thai', 'English', 'Arabic'], avatar: 'üë®', specialty: 'Elite Championship', homeClub: 'thai-country-club', availability: 'booked', totalRounds: 4123, reviews: 501, personality: 'Elite championship expert', strengths: ['Elite Competition', 'Championship Mindset', 'Winning Strategy'] },
                { id: 'tcc014', name: 'Kannika Prapat', rating: 4.5, experience: 5, languages: ['Thai', 'English'], avatar: 'üë©‚Äçü¶±', specialty: 'Fitness Integration', homeClub: 'thai-country-club', availability: 'available', totalRounds: 1567, reviews: 178, personality: 'Fitness and golf integration', strengths: ['Golf Fitness', 'Physical Conditioning', 'Strength Training'] },
                { id: 'tcc015', name: 'Vitoon Sanit', rating: 4.8, experience: 11, languages: ['Thai', 'English', 'Italian'], avatar: 'üë®', specialty: 'Course Record Expert', homeClub: 'thai-country-club', availability: 'available', totalRounds: 3234, reviews: 389, personality: 'Course record specialist', strengths: ['Course Records', 'Historical Knowledge', 'Achievement Support'] },
                { id: 'tcc016', name: 'Praneet Wila', rating: 4.6, experience: 7, languages: ['Thai', 'English'], avatar: 'üë©', specialty: 'Sponsor Relations', homeClub: 'thai-country-club', availability: 'available', totalRounds: 2123, reviews: 245, personality: 'Sponsor and media expert', strengths: ['Sponsor Relations', 'Media Management', 'PR Support'] },
                { id: 'tcc017', name: 'Somsiri Thawi', rating: 4.7, experience: 9, languages: ['Thai', 'English', 'Portuguese'], avatar: 'üë©‚Äçü¶≤', specialty: 'International Media', homeClub: 'thai-country-club', availability: 'available', totalRounds: 2678, reviews: 312, personality: 'International media specialist', strengths: ['Media Relations', 'International Press', 'Tournament Coverage'] },
                { id: 'tcc018', name: 'Worawit Kiat', rating: 4.9, experience: 17, languages: ['Thai', 'English', 'Mandarin'], avatar: 'üë®‚Äçü¶≥', specialty: 'World-Class Tournament', homeClub: 'thai-country-club', availability: 'available', totalRounds: 5678, reviews: 678, personality: 'World-class tournament veteran', strengths: ['World Championships', 'Global Events', 'Elite Standards'] },
                { id: 'tcc019', name: 'Siripen Nawa', rating: 4.5, experience: 6, languages: ['Thai', 'English'], avatar: 'üë©', specialty: 'Digital Integration', homeClub: 'thai-country-club', availability: 'available', totalRounds: 1789, reviews: 201, personality: 'Digital technology expert', strengths: ['Digital Scoring', 'Technology Integration', 'Modern Golf'] },
                { id: 'tcc020', name: 'Precha Manat', rating: 4.8, experience: 13, languages: ['Thai', 'English', 'Hindi'], avatar: 'üë®', specialty: 'Championship Legacy', homeClub: 'thai-country-club', availability: 'booked', totalRounds: 3876, reviews: 456, personality: 'Championship legacy keeper', strengths: ['Tournament History', 'Legacy Management', 'Championship Culture'] },

                // SIAM PLANTATION GOLF CLUB (20 caddies)
                { id: 'siam001', name: 'Apinya Thaworn', rating: 4.7, experience: 6, languages: ['Thai', 'English'], avatar: 'üë©', specialty: 'Executive Course', homeClub: 'siam-plantation', availability: 'available', totalRounds: 1847, reviews: 198, personality: 'Encouraging and patient', strengths: ['Teaching', 'Beginner Support', 'Positive Energy'] },
                { id: 'siam002', name: 'Siriporn Nakamura', rating: 4.9, experience: 11, languages: ['Thai', 'English', 'Japanese'], avatar: 'üë©', specialty: 'International Service', homeClub: 'siam-plantation', availability: 'booked', totalRounds: 3987, reviews: 445, personality: 'Culturally aware and professional', strengths: ['International Guests', 'Cultural Bridge', 'Multi-lingual'] },
    { id: 'siam003', name: 'Kritsana Wichit', rating: 4.6, experience: 8, languages: ['Thai', 'English'], avatar: 'üë®', specialty: 'Tropical Golf', homeClub: 'siam-plantation', availability: 'available', totalRounds: 2234, reviews: 267, personality: 'Nature lover and relaxed', strengths: ['Tropical Course', 'Nature Integration', 'Relaxed Golf'] },
    { id: 'siam004', name: 'Pensri Malai', rating: 4.8, experience: 10, languages: ['Thai', 'English', 'Chinese'], avatar: 'üë©‚Äçü¶±', specialty: 'Resort Family Golf', homeClub: 'siam-plantation', availability: 'available', totalRounds: 2876, reviews: 334, personality: 'Family-focused and fun', strengths: ['Family Golf', 'Resort Activities', 'Fun Experiences'] },
    { id: 'siam005', name: 'Suthat Boonma', rating: 4.5, experience: 5, languages: ['Thai', 'English'], avatar: 'üë®‚Äçü¶≤', specialty: 'Beginner Plantation', homeClub: 'siam-plantation', availability: 'available', totalRounds: 1456, reviews: 167, personality: 'Patient teacher', strengths: ['Beginner Support', 'Basic Skills', 'Encouragement'] },
    { id: 'siam006', name: 'Wanlapa Siri', rating: 4.7, experience: 9, languages: ['Thai', 'English', 'German'], avatar: 'üë©', specialty: 'Landscape Golf', homeClub: 'siam-plantation', availability: 'booked', totalRounds: 2567, reviews: 298, personality: 'Scenic and artistic', strengths: ['Landscape Appreciation', 'Scenic Golf', 'Photography'] },
    { id: 'siam007', name: 'Chalermpol Thani', rating: 4.9, experience: 14, languages: ['Thai', 'English', 'French'], avatar: 'üë®', specialty: 'Luxury Plantation', homeClub: 'siam-plantation', availability: 'available', totalRounds: 3789, reviews: 456, personality: 'Luxury resort specialist', strengths: ['Luxury Service', 'Fine Golf', 'Resort Excellence'] },
    { id: 'siam008', name: 'Suchitra Kwan', rating: 4.6, experience: 7, languages: ['Thai', 'English'], avatar: 'üë©‚Äçü¶≤', specialty: 'Health & Wellness Golf', homeClub: 'siam-plantation', availability: 'available', totalRounds: 1987, reviews: 234, personality: 'Health and wellness focused', strengths: ['Wellness Golf', 'Health Benefits', 'Mindful Play'] },
    { id: 'siam009', name: 'Preecha Sombat', rating: 4.8, experience: 12, languages: ['Thai', 'English', 'Korean'], avatar: 'üë®‚Äçü¶≥', specialty: 'Corporate Plantation', homeClub: 'siam-plantation', availability: 'available', totalRounds: 3234, reviews: 389, personality: 'Corporate golf specialist', strengths: ['Business Golf', 'Corporate Events', 'Professional Service'] },
    { id: 'siam010', name: 'Sirilak Prasert', rating: 4.7, experience: 8, languages: ['Thai', 'English'], avatar: 'üë©', specialty: 'Ladies Plantation Golf', homeClub: 'siam-plantation', availability: 'available', totalRounds: 2345, reviews: 278, personality: 'Ladies golf supporter', strengths: ['Ladies Golf', 'Social Golf', 'Group Play'] },
    { id: 'siam011', name: 'Thaworn Chai', rating: 4.5, experience: 6, languages: ['Thai', 'English'], avatar: 'üë®', specialty: 'Quick Resort Rounds', homeClub: 'siam-plantation', availability: 'available', totalRounds: 1678, reviews: 189, personality: 'Efficient and friendly', strengths: ['Quick Play', 'Time Management', 'Efficient Service'] },
    { id: 'siam012', name: 'Napaporn Wila', rating: 4.8, experience: 11, languages: ['Thai', 'English', 'Spanish'], avatar: 'üë©‚Äçü¶±', specialty: 'International Resort', homeClub: 'siam-plantation', availability: 'booked', totalRounds: 2987, reviews: 356, personality: 'International hospitality expert', strengths: ['International Service', 'Resort Hospitality', 'Cultural Awareness'] },
    { id: 'siam013', name: 'Somjit Krung', rating: 4.6, experience: 9, languages: ['Thai', 'English', 'Russian'], avatar: 'üë®', specialty: 'Tropical Course Expert', homeClub: 'siam-plantation', availability: 'available', totalRounds: 2456, reviews: 289, personality: 'Tropical golf specialist', strengths: ['Tropical Conditions', 'Weather Adaptation', 'Seasonal Golf'] },
    { id: 'siam014', name: 'Siriphan Thong', rating: 4.7, experience: 10, languages: ['Thai', 'English', 'Italian'], avatar: 'üë©', specialty: 'Resort Entertainment', homeClub: 'siam-plantation', availability: 'available', totalRounds: 2678, reviews: 312, personality: 'Entertainment and fun focused', strengths: ['Entertainment Golf', 'Fun Activities', 'Resort Events'] },
    { id: 'siam015', name: 'Wichan Sila', rating: 4.9, experience: 15, languages: ['Thai', 'English', 'Mandarin'], avatar: 'üë®‚Äçü¶≤', specialty: 'Master Plantation', homeClub: 'siam-plantation', availability: 'available', totalRounds: 4123, reviews: 501, personality: 'Plantation course master', strengths: ['Course Mastery', 'Tropical Expertise', 'Elite Guidance'] },
    { id: 'siam016', name: 'Pensook Niran', rating: 4.5, experience: 4, languages: ['Thai', 'English'], avatar: 'üë©‚Äçü¶≤', specialty: 'Family Friendly Golf', homeClub: 'siam-plantation', availability: 'available', totalRounds: 1234, reviews: 145, personality: 'Family-oriented and patient', strengths: ['Family Support', 'Kid-Friendly', 'Patient Teaching'] },
    { id: 'siam017', name: 'Manit Jaidee', rating: 4.8, experience: 13, languages: ['Thai', 'English', 'Portuguese'], avatar: 'üë®', specialty: 'Nature Photography Golf', homeClub: 'siam-plantation', availability: 'available', totalRounds: 3567, reviews: 423, personality: 'Nature and photography enthusiast', strengths: ['Nature Photography', 'Scenic Golf', 'Environmental Awareness'] },
    { id: 'siam018', name: 'Sirisuda Prom', rating: 4.6, experience: 7, languages: ['Thai', 'English'], avatar: 'üë©', specialty: 'Spa Golf Integration', homeClub: 'siam-plantation', availability: 'available', totalRounds: 1876, reviews: 212, personality: 'Spa and wellness integration', strengths: ['Spa Services', 'Wellness Integration', 'Relaxation Golf'] },
    { id: 'siam019', name: 'Watchara Somboon', rating: 4.7, experience: 11, languages: ['Thai', 'English', 'Hindi'], avatar: 'üë®‚Äçü¶≥', specialty: 'Cultural Plantation Golf', homeClub: 'siam-plantation', availability: 'booked', totalRounds: 2987, reviews: 356, personality: 'Cultural integration specialist', strengths: ['Cultural Golf', 'Local Traditions', 'Educational Golf'] },
    { id: 'siam020', name: 'Siriporn Chawla', rating: 4.8, experience: 12, languages: ['Thai', 'English', 'Arabic'], avatar: 'üë©', specialty: 'Luxury Tropical Service', homeClub: 'siam-plantation', availability: 'available', totalRounds: 3234, reviews: 389, personality: 'Luxury tropical specialist', strengths: ['Luxury Tropical', 'Premium Service', 'Elite Plantation Golf'] },

    // ROYAL GARDEN GOLF CLUB (20 caddies)
    { id: 'royal001', name: 'Chaiwat Suksan', rating: 4.9, experience: 15, languages: ['Thai', 'English', 'Chinese'], avatar: 'üë®‚Äçü¶≥', specialty: 'VIP Luxury Service', homeClub: 'royal-garden', availability: 'booked', totalRounds: 5847, reviews: 695, personality: 'Luxury service specialist', strengths: ['VIP Experience', 'Cultural Knowledge', 'Luxury Service'] },
    { id: 'royal002', name: 'Thanakit Suwan', rating: 4.7, experience: 7, languages: ['Thai', 'English'], avatar: 'üë®‚Äçü¶±', specialty: 'Course Photography', homeClub: 'royal-garden', availability: 'available', totalRounds: 2134, reviews: 243, personality: 'Creative and observant', strengths: ['Photography', 'Scenic Knowledge', 'Social Media'] },
    { id: 'royal003', name: 'Siriporn Kamal', rating: 4.8, experience: 12, languages: ['Thai', 'English', 'Japanese'], avatar: 'üë©', specialty: 'Executive Golf', homeClub: 'royal-garden', availability: 'available', totalRounds: 3456, reviews: 412, personality: 'Executive service focused', strengths: ['Executive Golf', 'Business Support', 'Professional Service'] },
    { id: 'royal004', name: 'Wichit Thani', rating: 4.6, experience: 8, languages: ['Thai', 'English', 'Korean'], avatar: 'üë®', specialty: 'Quick Executive Rounds', homeClub: 'royal-garden', availability: 'available', totalRounds: 2234, reviews: 267, personality: 'Efficient and professional', strengths: ['Quick Play', 'Executive Efficiency', 'Time Management'] },
    { id: 'royal005', name: 'Malai Siri', rating: 4.7, experience: 10, languages: ['Thai', 'English', 'German'], avatar: 'üë©‚Äçü¶±', specialty: 'Beginner Executive', homeClub: 'royal-garden', availability: 'booked', totalRounds: 2876, reviews: 334, personality: 'Patient and encouraging', strengths: ['Beginner Support', 'Executive Teaching', 'Confidence Building'] },
    { id: 'royal006', name: 'Prasert Chai', rating: 4.5, experience: 5, languages: ['Thai', 'English'], avatar: 'üë®‚Äçü¶≤', specialty: 'Family Executive Golf', homeClub: 'royal-garden', availability: 'available', totalRounds: 1567, reviews: 178, personality: 'Family-friendly', strengths: ['Family Golf', 'Kid Support', 'Fun Executive Golf'] },
    { id: 'royal007', name: 'Sirilak Wongsa', rating: 4.9, experience: 14, languages: ['Thai', 'English', 'French'], avatar: 'üë©', specialty: 'Luxury Executive', homeClub: 'royal-garden', availability: 'available', totalRounds: 3789, reviews: 456, personality: 'Luxury and elegance focused', strengths: ['Luxury Service', 'Elegant Golf', 'Premium Executive'] },
    { id: 'royal008', name: 'Narong Phet', rating: 4.6, experience: 6, languages: ['Thai', 'English'], avatar: 'üë®', specialty: 'Corporate Executive', homeClub: 'royal-garden', availability: 'available', totalRounds: 1789, reviews: 201, personality: 'Corporate focused', strengths: ['Corporate Golf', 'Business Networking', 'Executive Events'] },
    { id: 'royal009', name: 'Pensri Niran', rating: 4.8, experience: 11, languages: ['Thai', 'English', 'Spanish'], avatar: 'üë©‚Äçü¶≤', specialty: 'Ladies Executive Golf', homeClub: 'royal-garden', availability: 'available', totalRounds: 3123, reviews: 376, personality: 'Ladies golf champion', strengths: ['Ladies Golf', 'Executive Ladies', 'Social Golf'] },
    { id: 'royal010', name: 'Somsak Krung', rating: 4.7, experience: 9, languages: ['Thai', 'English', 'Chinese'], avatar: 'üë®‚Äçü¶≥', specialty: 'Business Executive Golf', homeClub: 'royal-garden', availability: 'available', totalRounds: 2567, reviews: 298, personality: 'Business golf specialist', strengths: ['Business Golf', 'Deal Making', 'Executive Networking'] },
    { id: 'royal011', name: 'Wipada Sila', rating: 4.5, experience: 4, languages: ['Thai', 'English'], avatar: 'üë©', specialty: 'Relaxed Executive', homeClub: 'royal-garden', availability: 'available', totalRounds: 1345, reviews: 156, personality: 'Relaxed and easygoing', strengths: ['Relaxed Golf', 'Stress Relief', 'Easy Executive'] },
    { id: 'royal012', name: 'Thawee Jaidee', rating: 4.8, experience: 13, languages: ['Thai', 'English', 'Russian'], avatar: 'üë®', specialty: 'International Executive', homeClub: 'royal-garden', availability: 'booked', totalRounds: 3678, reviews: 445, personality: 'International business expert', strengths: ['International Golf', 'Cultural Bridge', 'Global Executive'] },
    { id: 'royal013', name: 'Siriphan Thong', rating: 4.6, experience: 7, languages: ['Thai', 'English'], avatar: 'üë©‚Äçü¶±', specialty: 'Event Executive Golf', homeClub: 'royal-garden', availability: 'available', totalRounds: 1987, reviews: 234, personality: 'Event coordination expert', strengths: ['Event Golf', 'Group Management', 'Executive Events'] },
    { id: 'royal014', name: 'Preecha Sombat', rating: 4.7, experience: 10, languages: ['Thai', 'English', 'Italian'], avatar: 'üë®‚Äçü¶≤', specialty: 'Cultural Executive', homeClub: 'royal-garden', availability: 'available', totalRounds: 2678, reviews: 312, personality: 'Cultural integration specialist', strengths: ['Cultural Golf', 'Executive Culture', 'International Etiquette'] },
    { id: 'royal015', name: 'Sirisuda Prom', rating: 4.9, experience: 16, languages: ['Thai', 'English', 'Mandarin'], avatar: 'üë©', specialty: 'Master Executive', homeClub: 'royal-garden', availability: 'available', totalRounds: 4456, reviews: 534, personality: 'Executive course master', strengths: ['Course Mastery', 'Executive Excellence', 'Elite Guidance'] },
    { id: 'royal016', name: 'Manit Wila', rating: 4.5, experience: 6, languages: ['Thai', 'English'], avatar: 'üë®', specialty: 'Technology Executive', homeClub: 'royal-garden', availability: 'available', totalRounds: 1654, reviews: 189, personality: 'Technology integration expert', strengths: ['Golf Technology', 'Digital Golf', 'Modern Executive'] },
    { id: 'royal017', name: 'Pensook Chai', rating: 4.8, experience: 12, languages: ['Thai', 'English', 'Portuguese'], avatar: 'üë©‚Äçü¶≤', specialty: 'Wellness Executive', homeClub: 'royal-garden', availability: 'available', totalRounds: 3234, reviews: 389, personality: 'Wellness and health focused', strengths: ['Wellness Golf', 'Health Executive', 'Mindful Golf'] },
    { id: 'royal018', name: 'Watchara Nawin', rating: 4.6, experience: 8, languages: ['Thai', 'English'], avatar: 'üë®‚Äçü¶≥', specialty: 'Social Executive Golf', homeClub: 'royal-garden', availability: 'available', totalRounds: 2123, reviews: 245, personality: 'Social golf specialist', strengths: ['Social Golf', 'Executive Networking', 'Group Golf'] },
    { id: 'royal019', name: 'Siriporn Krung', rating: 4.7, experience: 11, languages: ['Thai', 'English', 'Hindi'], avatar: 'üë©', specialty: 'Premium Executive', homeClub: 'royal-garden', availability: 'booked', totalRounds: 2987, reviews: 356, personality: 'Premium service specialist', strengths: ['Premium Service', 'Executive Premium', 'Elite Golf'] },
    { id: 'royal020', name: 'Wichan Thani', rating: 4.8, experience: 14, languages: ['Thai', 'English', 'Arabic'], avatar: 'üë®', specialty: 'Luxury Royal Golf', homeClub: 'royal-garden', availability: 'available', totalRounds: 3876, reviews: 456, personality: 'Royal service expert', strengths: ['Royal Treatment', 'Luxury Executive', 'Elite Service'] },

    // BANGPRA INTERNATIONAL GOLF CLUB (20 caddies)
    { id: 'bang001', name: 'Somboon Seaside', rating: 4.8, experience: 12, languages: ['Thai', 'English', 'Japanese'], avatar: 'üë®', specialty: 'Seaside Golf Expert', homeClub: 'bangpra-international', availability: 'available', totalRounds: 3456, reviews: 412, personality: 'Ocean breeze specialist', strengths: ['Wind Reading', 'Coastal Golf', 'Weather Adaptation'] },
    { id: 'bang002', name: 'Siriporn Ocean', rating: 4.7, experience: 9, languages: ['Thai', 'English', 'Korean'], avatar: 'üë©', specialty: 'International Seaside', homeClub: 'bangpra-international', availability: 'booked', totalRounds: 2567, reviews: 298, personality: 'International coastal expert', strengths: ['International Service', 'Coastal Knowledge', 'Cultural Bridge'] },
    { id: 'bang003', name: 'Wichai Wind', rating: 4.9, experience: 15, languages: ['Thai', 'English', 'Chinese'], avatar: 'üë®‚Äçü¶≤', specialty: 'Wind Challenge Master', homeClub: 'bangpra-international', availability: 'available', totalRounds: 4123, reviews: 501, personality: 'Wind golf master', strengths: ['Wind Management', 'Challenge Golf', 'Elite Coastal'] },
    { id: 'bang004', name: 'Pranee Breeze', rating: 4.6, experience: 7, languages: ['Thai', 'English'], avatar: 'üë©‚Äçü¶±', specialty: 'Family Seaside Golf', homeClub: 'bangpra-international', availability: 'available', totalRounds: 1987, reviews: 234, personality: 'Family coastal specialist', strengths: ['Family Golf', 'Seaside Fun', 'Child-Friendly'] },
    { id: 'bang005', name: 'Thaworn Wave', rating: 4.8, experience: 11, languages: ['Thai', 'English', 'German'], avatar: 'üë®', specialty: 'Scenic Golf Expert', homeClub: 'bangpra-international', availability: 'available', totalRounds: 3234, reviews: 389, personality: 'Scenic golf specialist', strengths: ['Scenic Views', 'Photography Golf', 'Nature Golf'] },
    { id: 'bang006', name: 'Sirilak Surf', rating: 4.5, experience: 5, languages: ['Thai', 'English'], avatar: 'üë©', specialty: 'Beginner Coastal', homeClub: 'bangpra-international', availability: 'available', totalRounds: 1456, reviews: 167, personality: 'Patient coastal teacher', strengths: ['Beginner Support', 'Coastal Teaching', 'Basic Seaside'] },
    { id: 'bang007', name: 'Preecha Tide', rating: 4.7, experience: 10, languages: ['Thai', 'English', 'French'], avatar: 'üë®‚Äçü¶≥', specialty: 'Tidal Golf Expert', homeClub: 'bangpra-international', availability: 'available', totalRounds: 2876, reviews: 334, personality: 'Tidal conditions expert', strengths: ['Tidal Knowledge', 'Timing Golf', 'Coastal Conditions'] },
    { id: 'bang008', name: 'Pensri Salt', rating: 4.6, experience: 8, languages: ['Thai', 'English'], avatar: 'üë©‚Äçü¶≤', specialty: 'Ladies Seaside Golf', homeClub: 'bangpra-international', availability: 'booked', totalRounds: 2234, reviews: 267, personality: 'Ladies coastal golf expert', strengths: ['Ladies Golf', 'Seaside Ladies', 'Coastal Social'] },
    { id: 'bang009', name: 'Somsak Storm', rating: 4.8, experience: 13, languages: ['Thai', 'English', 'Spanish'], avatar: 'üë®', specialty: 'Weather Challenge Golf', homeClub: 'bangpra-international', availability: 'available', totalRounds: 3678, reviews: 445, personality: 'Weather challenge expert', strengths: ['Weather Golf', 'Storm Management', 'Challenge Expert'] },
    { id: 'bang010', name: 'Siriphan Coral', rating: 4.7, experience: 9, languages: ['Thai', 'English', 'Russian'], avatar: 'üë©', specialty: 'Marine Golf Tours', homeClub: 'bangpra-international', availability: 'available', totalRounds: 2567, reviews: 301, personality: 'Marine tourism expert', strengths: ['Marine Knowledge', 'Tourism Golf', 'Coastal Tours'] },
    { id: 'bang011', name: 'Narong Shell', rating: 4.5, experience: 6, languages: ['Thai', 'English'], avatar: 'üë®', specialty: 'Quick Coastal Rounds', homeClub: 'bangpra-international', availability: 'available', totalRounds: 1678, reviews: 189, personality: 'Efficient coastal golf', strengths: ['Quick Play', 'Efficient Coastal', 'Time Management'] },
    { id: 'bang012', name: 'Wipada Pearl', rating: 4.9, experience: 14, languages: ['Thai', 'English', 'Italian'], avatar: 'üë©‚Äçü¶±', specialty: 'Luxury Seaside', homeClub: 'bangpra-international', availability: 'available', totalRounds: 3789, reviews: 456, personality: 'Luxury coastal specialist', strengths: ['Luxury Seaside', 'Premium Coastal', 'Elite Ocean Golf'] },
    { id: 'bang013', name: 'Thawee Anchor', rating: 4.6, experience: 7, languages: ['Thai', 'English'], avatar: 'üë®‚Äçü¶≤', specialty: 'Maritime Golf', homeClub: 'bangpra-international', availability: 'available', totalRounds: 1987, reviews: 234, personality: 'Maritime golf specialist', strengths: ['Maritime Golf', 'Naval Golf', 'Coastal Business'] },
    { id: 'bang014', name: 'Sirisuda Dolphin', rating: 4.8, experience: 12, languages: ['Thai', 'English', 'Portuguese'], avatar: 'üë©', specialty: 'Marine Life Golf', homeClub: 'bangpra-international', availability: 'available', totalRounds: 3123, reviews: 376, personality: 'Marine life enthusiast', strengths: ['Marine Life', 'Environmental Golf', 'Nature Education'] },
    { id: 'bang015', name: 'Manit Lighthouse', rating: 4.7, experience: 11, languages: ['Thai', 'English', 'Mandarin'], avatar: 'üë®‚Äçü¶≥', specialty: 'Navigation Golf', homeClub: 'bangpra-international', availability: 'booked', totalRounds: 2987, reviews: 356, personality: 'Navigation expert', strengths: ['Course Navigation', 'Strategic Golf', 'Course Management'] },
    { id: 'bang016', name: 'Pensook Harbor', rating: 4.5, experience: 4, languages: ['Thai', 'English'], avatar: 'üë©', specialty: 'Harbor View Golf', homeClub: 'bangpra-international', availability: 'available', totalRounds: 1234, reviews: 145, personality: 'Harbor tourism expert', strengths: ['Harbor Views', 'Tourism Golf', 'Scenic Golf'] },
    { id: 'bang017', name: 'Watchara Sailor', rating: 4.8, experience: 13, languages: ['Thai', 'English', 'Hindi'], avatar: 'üë®', specialty: 'Sailing Golf Integration', homeClub: 'bangpra-international', availability: 'available', totalRounds: 3567, reviews: 423, personality: 'Sailing and golf expert', strengths: ['Sailing Knowledge', 'Water Sports', 'Marine Recreation'] },
    { id: 'bang018', name: 'Siriporn Mermaid', rating: 4.6, experience: 8, languages: ['Thai', 'English'], avatar: 'üë©‚Äçü¶≤', specialty: 'Aquatic Golf Tours', homeClub: 'bangpra-international', availability: 'available', totalRounds: 2123, reviews: 245, personality: 'Aquatic tourism specialist', strengths: ['Aquatic Tours', 'Water Activities', 'Marine Golf'] },
    { id: 'bang019', name: 'Wichan Captain', rating: 4.7, experience: 10, languages: ['Thai', 'English', 'Arabic'], avatar: 'üë®', specialty: 'Captain\'s Golf', homeClub: 'bangpra-international', availability: 'available', totalRounds: 2678, reviews: 312, personality: 'Leadership and golf expert', strengths: ['Leadership Golf', 'Team Golf', 'Maritime Leadership'] },
    { id: 'bang020', name: 'Sirilak Admiral', rating: 4.9, experience: 16, languages: ['Thai', 'English', 'Swedish'], avatar: 'üë©', specialty: 'Elite Maritime Golf', homeClub: 'bangpra-international', availability: 'available', totalRounds: 4456, reviews: 534, personality: 'Elite maritime golf expert', strengths: ['Elite Maritime', 'Premium Coastal', 'Admiral Service'] },

    // CRYSTAL BAY GOLF CLUB (20 caddies)
    { id: 'crystal001', name: 'Siriporn Crystal', rating: 4.8, experience: 11, languages: ['Thai', 'English', 'Japanese'], avatar: 'üë©', specialty: 'Bay View Golf', homeClub: 'crystal-bay', availability: 'available', totalRounds: 3123, reviews: 376, personality: 'Bay view specialist', strengths: ['Bay Views', 'Scenic Golf', 'Photography Golf'] },
    { id: 'crystal002', name: 'Wichai Clear', rating: 4.7, experience: 9, languages: ['Thai', 'English', 'Korean'], avatar: 'üë®', specialty: 'Crystal Clear Golf', homeClub: 'crystal-bay', availability: 'booked', totalRounds: 2567, reviews: 298, personality: 'Clarity and precision expert', strengths: ['Clear Strategy', 'Precision Golf', 'Focus Enhancement'] },
    { id: 'crystal003', name: 'Pranee Shimmer', rating: 4.9, experience: 14, languages: ['Thai', 'English', 'Chinese'], avatar: 'üë©‚Äçü¶±', specialty: 'Luxury Bay Golf', homeClub: 'crystal-bay', availability: 'available', totalRounds: 3789, reviews: 456, personality: 'Luxury bay specialist', strengths: ['Luxury Service', 'Bay Luxury', 'Premium Golf'] },
    { id: 'crystal004', name: 'Thaworn Sapphire', rating: 4.6, experience: 7, languages: ['Thai', 'English'], avatar: 'üë®‚Äçü¶≤', specialty: 'Gemstone Golf', homeClub: 'crystal-bay', availability: 'available', totalRounds: 1987, reviews: 234, personality: 'Precious golf specialist', strengths: ['Gemstone Knowledge', 'Precious Golf', 'Luxury Education'] },
    { id: 'crystal005', name: 'Sirilak Diamond', rating: 4.8, experience: 12, languages: ['Thai', 'English', 'German'], avatar: 'üë©', specialty: 'Diamond Service Golf', homeClub: 'crystal-bay', availability: 'available', totalRounds: 3234, reviews: 389, personality: 'Diamond service expert', strengths: ['Diamond Service', 'Premium Golf', 'Elite Treatment'] },
    { id: 'crystal006', name: 'Preecha Ruby', rating: 4.5, experience: 5, languages: ['Thai', 'English'], avatar: 'üë®', specialty: 'Beginner Bay Golf', homeClub: 'crystal-bay', availability: 'available', totalRounds: 1456, reviews: 167, personality: 'Patient bay teacher', strengths: ['Beginner Support', 'Bay Teaching', 'Basic Golf'] },
    { id: 'crystal007', name: 'Pensri Emerald', rating: 4.7, experience: 10, languages: ['Thai', 'English', 'French'], avatar: 'üë©‚Äçü¶≤', specialty: 'Green Bay Golf', homeClub: 'crystal-bay', availability: 'available', totalRounds: 2876, reviews: 334, personality: 'Green golf specialist', strengths: ['Green Reading', 'Environmental Golf', 'Nature Integration'] },
    { id: 'crystal008', name: 'Somsak Opal', rating: 4.6, experience: 8, languages: ['Thai', 'English'], avatar: 'üë®‚Äçü¶≥', specialty: 'Family Bay Golf', homeClub: 'crystal-bay', availability: 'booked', totalRounds: 2234, reviews: 267, personality: 'Family bay specialist', strengths: ['Family Golf', 'Bay Family Fun', 'Child-Friendly'] },
    { id: 'crystal009', name: 'Siriphan Topaz', rating: 4.8, experience: 13, languages: ['Thai', 'English', 'Spanish'], avatar: 'üë©', specialty: 'Resort Bay Golf', homeClub: 'crystal-bay', availability: 'available', totalRounds: 3678, reviews: 445, personality: 'Resort bay expert', strengths: ['Resort Golf', 'Bay Resort', 'Hospitality Golf'] },
    { id: 'crystal010', name: 'Narong Quartz', rating: 4.7, experience: 9, languages: ['Thai', 'English', 'Russian'], avatar: 'üë®', specialty: 'Practice Bay Golf', homeClub: 'crystal-bay', availability: 'available', totalRounds: 2567, reviews: 301, personality: 'Practice facility expert', strengths: ['Practice Facilities', 'Skill Development', 'Training Golf'] },
    { id: 'crystal011', name: 'Wipada Jade', rating: 4.5, experience: 6, languages: ['Thai', 'English'], avatar: 'üë©‚Äçü¶±', specialty: 'Wellness Bay Golf', homeClub: 'crystal-bay', availability: 'available', totalRounds: 1678, reviews: 189, personality: 'Wellness bay specialist', strengths: ['Wellness Golf', 'Health Benefits', 'Mindful Bay Golf'] },
    { id: 'crystal012', name: 'Thawee Amethyst', rating: 4.9, experience: 15, languages: ['Thai', 'English', 'Italian'], avatar: 'üë®', specialty: 'VIP Crystal Golf', homeClub: 'crystal-bay', availability: 'available', totalRounds: 4123, reviews: 501, personality: 'VIP crystal specialist', strengths: ['VIP Service', 'Crystal Elite', 'Premium Bay Golf'] },
    { id: 'crystal013', name: 'Sirisuda Pearl', rating: 4.6, experience: 7, languages: ['Thai', 'English'], avatar: 'üë©', specialty: 'Ladies Bay Golf', homeClub: 'crystal-bay', availability: 'available', totalRounds: 1987, reviews: 234, personality: 'Ladies bay golf expert', strengths: ['Ladies Golf', 'Bay Ladies', 'Social Golf'] },
    { id: 'crystal014', name: 'Manit Coral', rating: 4.8, experience: 12, languages: ['Thai', 'English', 'Portuguese'], avatar: 'üë®‚Äçü¶≤', specialty: 'Marine Bay Golf', homeClub: 'crystal-bay', availability: 'available', totalRounds: 3123, reviews: 376, personality: 'Marine bay specialist', strengths: ['Marine Knowledge', 'Bay Marine Life', 'Environmental Golf'] },
    { id: 'crystal015', name: 'Pensook Turquoise', rating: 4.7, experience: 11, languages: ['Thai', 'English', 'Mandarin'], avatar: 'üë©‚Äçü¶≤', specialty: 'Scenic Bay Master', homeClub: 'crystal-bay', availability: 'booked', totalRounds: 2987, reviews: 356, personality: 'Scenic bay master', strengths: ['Scenic Mastery', 'Bay Photography', 'View Golf'] },
    { id: 'crystal016', name: 'Watchara Amber', rating: 4.5, experience: 4, languages: ['Thai', 'English'], avatar: 'üë®', specialty: 'Quick Bay Rounds', homeClub: 'crystal-bay', availability: 'available', totalRounds: 1234, reviews: 145, personality: 'Quick bay golf specialist', strengths: ['Quick Play', 'Efficient Bay Golf', 'Time Management'] },
    { id: 'crystal017', name: 'Siriporn Garnet', rating: 4.8, experience: 13, languages: ['Thai', 'English', 'Hindi'], avatar: 'üë©', specialty: 'Cultural Bay Golf', homeClub: 'crystal-bay', availability: 'available', totalRounds: 3567, reviews: 423, personality: 'Cultural bay specialist', strengths: ['Cultural Golf', 'Bay Culture', 'International Etiquette'] },
    { id: 'crystal018', name: 'Wichan Citrine', rating: 4.6, experience: 8, languages: ['Thai', 'English'], avatar: 'üë®‚Äçü¶≥', specialty: 'Business Bay Golf', homeClub: 'crystal-bay', availability: 'available', totalRounds: 2123, reviews: 245, personality: 'Business bay specialist', strengths: ['Business Golf', 'Bay Networking', 'Corporate Golf'] },
    { id: 'crystal019', name: 'Sirilak Moonstone', rating: 4.7, experience: 10, languages: ['Thai', 'English', 'Arabic'], avatar: 'üë©‚Äçü¶±', specialty: 'Evening Bay Golf', homeClub: 'crystal-bay', availability: 'available', totalRounds: 2678, reviews: 312, personality: 'Evening golf specialist', strengths: ['Evening Golf', 'Twilight Golf', 'Night Bay Golf'] },
    { id: 'crystal020', name: 'Preecha Platinum', rating: 4.9, experience: 16, languages: ['Thai', 'English', 'Swedish'], avatar: 'üë®', specialty: 'Elite Crystal Bay', homeClub: 'crystal-bay', availability: 'available', totalRounds: 4456, reviews: 534, personality: 'Elite crystal bay expert', strengths: ['Elite Bay Golf', 'Platinum Service', 'Master Crystal Golf'] },

    // LAEM CHABANG INTERNATIONAL COUNTRY CLUB (20 caddies)
    { id: 'laem001', name: 'Siriporn International', rating: 4.9, experience: 14, languages: ['Thai', 'English', 'Japanese', 'Chinese'], avatar: 'üë©', specialty: 'International Championship', homeClub: 'laem-chabang', availability: 'available', totalRounds: 4123, reviews: 501, personality: 'International golf expert', strengths: ['International Standards', 'Multi-lingual', 'Championship Golf'] },
    { id: 'laem002', name: 'Wichai Country', rating: 4.8, experience: 12, languages: ['Thai', 'English', 'Korean'], avatar: 'üë®', specialty: 'Country Club Excellence', homeClub: 'laem-chabang', availability: 'booked', totalRounds: 3456, reviews: 412, personality: 'Country club specialist', strengths: ['Club Excellence', 'Member Service', 'Elite Golf'] },
    { id: 'laem003', name: 'Pranee Global', rating: 4.7, experience: 10, languages: ['Thai', 'English', 'German'], avatar: 'üë©‚Äçü¶±', specialty: 'Global Golf Standards', homeClub: 'laem-chabang', availability: 'available', totalRounds: 2876, reviews: 334, personality: 'Global standards expert', strengths: ['Global Standards', 'International Etiquette', 'World Golf'] },
    { id: 'laem004', name: 'Thaworn Elite', rating: 4.9, experience: 16, languages: ['Thai', 'English', 'French'], avatar: 'üë®‚Äçü¶≤', specialty: 'Elite International Golf', homeClub: 'laem-chabang', availability: 'available', totalRounds: 4567, reviews: 556, personality: 'Elite international specialist', strengths: ['Elite Golf', 'International Elite', 'Championship Standards'] },
    { id: 'laem005', name: 'Sirilak Premier', rating: 4.6, experience: 8, languages: ['Thai', 'English'], avatar: 'üë©', specialty: 'Premier Country Golf', homeClub: 'laem-chabang', availability: 'available', totalRounds: 2234, reviews: 267, personality: 'Premier service specialist', strengths: ['Premier Service', 'Country Club', 'Member Excellence'] },
    { id: 'laem006', name: 'Preecha World', rating: 4.8, experience: 13, languages: ['Thai', 'English', 'Spanish'], avatar: 'üë®', specialty: 'World Class Golf', homeClub: 'laem-chabang', availability: 'available', totalRounds: 3678, reviews: 445, personality: 'World class golf expert', strengths: ['World Class', 'International Golf', 'Global Excellence'] },
    { id: 'laem007', name: 'Pensri Champion', rating: 4.7, experience: 11, languages: ['Thai', 'English', 'Russian'], avatar: 'üë©‚Äçü¶≤', specialty: 'Championship Support', homeClub: 'laem-chabang', availability: 'available', totalRounds: 3123, reviews: 376, personality: 'Championship supporter', strengths: ['Championship Golf', 'Tournament Support', 'Elite Competition'] },
    { id: 'laem008', name: 'Somsak Master', rating: 4.5, experience: 6, languages: ['Thai', 'English'], avatar: 'üë®‚Äçü¶≥', specialty: 'Master Class Golf', homeClub: 'laem-chabang', availability: 'booked', totalRounds: 1678, reviews: 189, personality: 'Master class specialist', strengths: ['Master Golf', 'Class Excellence', 'Elite Teaching'] },
    { id: 'laem009', name: 'Siriphan Legend', rating: 4.8, experience: 15, languages: ['Thai', 'English', 'Italian'], avatar: 'üë©', specialty: 'Legendary Golf Service', homeClub: 'laem-chabang', availability: 'available', totalRounds: 3789, reviews: 456, personality: 'Legendary service expert', strengths: ['Legendary Service', 'Golf Legends', 'Historic Golf'] },
    { id: 'laem010', name: 'Narong Trophy', rating: 4.6, experience: 9, languages: ['Thai', 'English', 'Portuguese'], avatar: 'üë®', specialty: 'Trophy Golf Expert', homeClub: 'laem-chabang', availability: 'available', totalRounds: 2567, reviews: 298, personality: 'Trophy golf specialist', strengths: ['Trophy Golf', 'Achievement Support', 'Victory Golf'] },
    { id: 'laem011', name: 'Wipada Crown', rating: 4.7, experience: 12, languages: ['Thai', 'English', 'Mandarin'], avatar: 'üë©‚Äçü¶±', specialty: 'Crown Golf Service', homeClub: 'laem-chabang', availability: 'available', totalRounds: 2987, reviews: 356, personality: 'Crown service specialist', strengths: ['Crown Service', 'Royal Golf', 'Elite Treatment'] },
    { id: 'laem012', name: 'Thawee Excellence', rating: 4.9, experience: 17, languages: ['Thai', 'English', 'Arabic'], avatar: 'üë®', specialty: 'Golf Excellence Master', homeClub: 'laem-chabang', availability: 'available', totalRounds: 4789, reviews: 567, personality: 'Excellence master', strengths: ['Golf Excellence', 'Master Service', 'Elite Mastery'] },
    { id: 'laem013', name: 'Sirisuda Victory', rating: 4.5, experience: 5, languages: ['Thai', 'English'], avatar: 'üë©', specialty: 'Victory Support Golf', homeClub: 'laem-chabang', availability: 'available', totalRounds: 1456, reviews: 167, personality: 'Victory supporter', strengths: ['Victory Support', 'Winning Golf', 'Success Support'] },
    { id: 'laem014', name: 'Manit Supreme', rating: 4.8, experience: 14, languages: ['Thai', 'English', 'Hindi'], avatar: 'üë®‚Äçü¶≤', specialty: 'Supreme Golf Service', homeClub: 'laem-chabang', availability: 'available', totalRounds: 3567, reviews: 423, personality: 'Supreme service expert', strengths: ['Supreme Service', 'Elite Golf', 'Master Excellence'] },
    { id: 'laem015', name: 'Pensook Prestige', rating: 4.7, experience: 10, languages: ['Thai', 'English', 'Swedish'], avatar: 'üë©‚Äçü¶≤', specialty: 'Prestige Golf', homeClub: 'laem-chabang', availability: 'booked', totalRounds: 2678, reviews: 312, personality: 'Prestige specialist', strengths: ['Prestige Golf', 'Elite Prestige', 'Distinguished Service'] },
    { id: 'laem016', name: 'Watchara Grandmaster', rating: 4.6, experience: 7, languages: ['Thai', 'English'], avatar: 'üë®', specialty: 'Grandmaster Golf', homeClub: 'laem-chabang', availability: 'available', totalRounds: 1987, reviews: 234, personality: 'Grandmaster specialist', strengths: ['Grandmaster Golf', 'Master Teaching', 'Elite Guidance'] },
    { id: 'laem017', name: 'Siriporn Ultimate', rating: 4.9, experience: 18, languages: ['Thai', 'English', 'Norwegian'], avatar: 'üë©', specialty: 'Ultimate Golf Experience', homeClub: 'laem-chabang', availability: 'available', totalRounds: 5123, reviews: 634, personality: 'Ultimate golf expert', strengths: ['Ultimate Golf', 'Perfect Experience', 'Master Ultimate'] },
    { id: 'laem018', name: 'Wichan Divine', rating: 4.8, experience: 13, languages: ['Thai', 'English', 'Dutch'], avatar: 'üë®‚Äçü¶≥', specialty: 'Divine Golf Service', homeClub: 'laem-chabang', availability: 'available', totalRounds: 3234, reviews: 389, personality: 'Divine service specialist', strengths: ['Divine Service', 'Heavenly Golf', 'Perfect Golf'] },
    { id: 'laem019', name: 'Sirilak Infinite', rating: 4.7, experience: 11, languages: ['Thai', 'English', 'Finnish'], avatar: 'üë©‚Äçü¶±', specialty: 'Infinite Golf Possibilities', homeClub: 'laem-chabang', availability: 'available', totalRounds: 2789, reviews: 334, personality: 'Infinite possibilities expert', strengths: ['Infinite Golf', 'Limitless Service', 'Endless Excellence'] },
    { id: 'laem020', name: 'Preecha Eternal', rating: 4.9, experience: 19, languages: ['Thai', 'English', 'Danish'], avatar: 'üë®', specialty: 'Eternal Golf Mastery', homeClub: 'laem-chabang', availability: 'available', totalRounds: 5456, reviews: 678, personality: 'Eternal golf master', strengths: ['Eternal Mastery', 'Timeless Golf', 'Legendary Excellence'] }
            ],

            waitlists: {},
            activeOffers: {},

            getRandomPromotionalCaddys(count = 4) {
                const shuffled = [...this.allCaddys].sort(() => 0.5 - Math.random());
                return shuffled.slice(0, count).map(caddie => {
                    // Find the actual course this caddie works at
                    const actualCourse = GolfCoursesDatabase.courses.find(c => c.homeClub === caddie.homeClub) ||
                                       GolfCourseDatabase.courses.find(c => c.id === caddie.homeClub);
                    return {
                        ...caddie,
                        promotedCourse: actualCourse || {
                            name: 'Pattaya Golf Club',
                            location: 'Central Pattaya',
                            image: '‚õ≥',
                            rating: 4.6,
                            holes: 18
                        }
                    };
                });
            },

            addToWaitlist(caddieId, golferId, golferInfo) {
                if (!this.waitlists[caddieId]) {
                    this.waitlists[caddieId] = [];
                }

                const waitlistEntry = {
                    golferId,
                    golferName: golferInfo.name,
                    timestamp: new Date(),
                    priority: this.waitlists[caddieId].length + 1
                };

                this.waitlists[caddieId].push(waitlistEntry);
                return waitlistEntry.priority;
            },

            sendTimedOffer(caddieId, golferId) {
                const offerId = `offer-${caddieId}-${golferId}-${Date.now()}`;
                const caddie = this.allCaddys.find(c => c.id === caddieId);

                this.activeOffers[offerId] = {
                    caddieId,
                    golferId,
                    caddieName: caddie.name,
                    expiresAt: new Date(Date.now() + 10 * 60 * 1000), // 10 minutes
                    status: 'pending'
                };

                this.showOfferModal(offerId);

                // Auto-expire after 10 minutes
                setTimeout(() => {
                    if (this.activeOffers[offerId]?.status === 'pending') {
                        this.expireOffer(offerId);
                    }
                }, 10 * 60 * 1000);

                return offerId;
            },

            showOfferModal(offerId) {
                const offer = this.activeOffers[offerId];
                const caddie = this.allCaddys.find(c => c.id === offer.caddieId);
                const course = GolfCourseDatabase.getCourseById(caddie.homeClub);

                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.id = `offer-modal-${offerId}`;

                modal.innerHTML = `
                    <div class="bg-white rounded-2xl p-8 max-w-md mx-4 shadow-2xl">
                        <div class="text-center mb-6">
                            <div class="text-6xl mb-4">üéâ</div>
                            <h3 class="text-2xl font-bold text-gray-900 mb-2">Caddy Available!</h3>
                            <p class="text-gray-600">Your preferred caddie is now available</p>
                        </div>

                        <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6 mb-6">
                            <div class="flex items-center space-x-4 mb-4">
                                <div class="text-4xl">${caddie.avatar}</div>
                                <div>
                                    <h4 class="font-bold text-lg">${caddie.name}</h4>
                                    <div class="flex items-center space-x-2">
                                        <span class="text-yellow-500">‚≠ê</span>
                                        <span class="font-semibold">${caddie.rating}</span>
                                        <span class="text-gray-600">(${caddie.reviews} reviews)</span>
                                    </div>
                                </div>
                            </div>
                            <p class="text-sm text-gray-700 mb-3">${caddie.specialty} ‚Ä¢ ${caddie.experience} years</p>
                            <p class="text-sm text-gray-600">${caddie.personality}</p>
                        </div>

                        <div class="bg-gray-50 rounded-xl p-4 mb-6">
                            <h5 class="font-semibold mb-2">Available at:</h5>
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl">${course.image}</span>
                                <div>
                                    <p class="font-semibold">${course.name}</p>
                                    <p class="text-sm text-gray-600">${course.location}</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-red-50 border border-red-200 rounded-xl p-4 mb-6">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-red-500">‚è∞</span>
                                <span class="font-semibold text-red-700">Limited Time Offer</span>
                            </div>
                            <p class="text-sm text-red-600">This offer expires in <span id="countdown-${offerId}" class="font-bold">10:00</span></p>
                        </div>

                        <div class="flex space-x-3">
                            <button onclick="CaddySystem.acceptOffer('${offerId}')"
                                    class="flex-1 bg-green-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-green-700 transition-colors">
                                Accept & Book
                            </button>
                            <button onclick="CaddySystem.declineOffer('${offerId}')"
                                    class="flex-1 bg-gray-300 text-gray-700 px-6 py-3 rounded-xl font-semibold hover:bg-gray-400 transition-colors">
                                Pass
                            </button>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
                this.startCountdown(offerId);
            },

            startCountdown(offerId) {
                const offer = this.activeOffers[offerId];
                const countdownElement = document.getElementById(`countdown-${offerId}`);

                const updateCountdown = () => {
                    const now = new Date();
                    const timeLeft = offer.expiresAt - now;

                    if (timeLeft <= 0) {
                        this.expireOffer(offerId);
                        return;
                    }

                    const minutes = Math.floor(timeLeft / 60000);
                    const seconds = Math.floor((timeLeft % 60000) / 1000);

                    if (countdownElement) {
                        countdownElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    }
                };

                const interval = setInterval(updateCountdown, 1000);
                offer.countdownInterval = interval;
                updateCountdown();
            },

            acceptOffer(offerId) {
                const offer = this.activeOffers[offerId];
                offer.status = 'accepted';

                // Remove from waitlist
                this.removeFromWaitlist(offer.caddieId, offer.golferId);

                // AUTOMATIC CADDY SWITCHING LOGIC
                const currentUser = AppState.currentUser;
                const newCaddie = this.allCaddys.find(c => c.id === offer.caddieId);

                // Check if golfer has existing caddy booking to replace
                if (currentUser && bookingCart.caddies && bookingCart.caddies.length > 0) {
                    // Find existing caddy booking for this golfer
                    const existingCaddyIndex = bookingCart.caddies.findIndex(c =>
                        c.golferName === currentUser.name ||
                        c.golferId === currentUser.name.toLowerCase().replace(' ', '_')
                    );

                    if (existingCaddyIndex >= 0) {
                        const previousCaddy = bookingCart.caddies[existingCaddyIndex];
                        console.log(`[CADDY SWITCH] Replacing ${previousCaddy.name} with ${newCaddie.name}`);

                        // Make previous caddy available again
                        const prevCaddieObj = this.allCaddys.find(c => c.id === previousCaddy.id);
                        if (prevCaddieObj) {
                            prevCaddieObj.availability = 'available';
                            console.log(`[SUCCESS] ${prevCaddieObj.name} is now available again`);
                        }

                        // Replace with new caddy in booking cart
                        bookingCart.caddies[existingCaddyIndex] = {
                            id: newCaddie.id,
                            name: newCaddie.name,
                            type: 'booking',
                            rate: 1200,
                            specialty: newCaddie.specialty,
                            rating: newCaddie.rating,
                            avatar: newCaddie.avatar,
                            golferName: currentUser.name,
                            golferId: currentUser.name.toLowerCase().replace(' ', '_')
                        };

                        // Update booking cart display
                        updateBookingCartDisplay();

                        // Notify golfer of switch
                        NotificationManager.show(`üîÑ Caddy switched! ${newCaddie.name} is now your caddy`, 'success');
                        console.log(`[SUCCESS] Booking transferred from ${previousCaddy.name} to ${newCaddie.name}`);

                        // Notify new caddy of booking assignment
                        this.notifyCaddyOfBooking(newCaddie.id, {
                            golferName: currentUser.name,
                            date: bookingCart.course ? 'Today' : 'TBD',
                            time: 'TBD',
                            course: bookingCart.course ? bookingCart.course.name : 'TBD'
                        });

                        // Mark new caddy as booked
                        newCaddie.availability = 'booked';

                        // Update new caddy's current booking info
                        newCaddie.currentBooking = {
                            date: new Date().toISOString().split('T')[0],
                            time: '08:00',
                            golfer: currentUser.name,
                            holes: 18
                        };

                        // Close modal
                        const modal = document.getElementById(`offer-modal-${offerId}`);
                        if (modal) modal.remove();

                        // Clear countdown
                        if (offer.countdownInterval) {
                            clearInterval(offer.countdownInterval);
                        }

                        // Don't show booking flow - just confirm the switch
                        console.log(`[SUCCESS] Offer accepted for caddie ${offer.caddieName} - automatic switch completed`);
                        return; // Exit early - no need for new booking flow
                    }
                }

                // If no existing booking to replace, proceed with normal flow
                // Mark caddie as booked
                newCaddie.availability = 'booked';

                // Close modal
                const modal = document.getElementById(`offer-modal-${offerId}`);
                if (modal) modal.remove();

                // Clear countdown
                if (offer.countdownInterval) {
                    clearInterval(offer.countdownInterval);
                }

                // Show booking flow for new booking
                this.showCaddyBookingFlow(offer.caddieId);

                console.log(`[SUCCESS] Offer accepted for caddie ${offer.caddieName}`);
            },

            declineOffer(offerId) {
                const offer = this.activeOffers[offerId];
                offer.status = 'declined';

                // Remove from waitlist
                this.removeFromWaitlist(offer.caddieId, offer.golferId);

                // Close modal
                const modal = document.getElementById(`offer-modal-${offerId}`);
                if (modal) modal.remove();

                // Clear countdown
                if (offer.countdownInterval) {
                    clearInterval(offer.countdownInterval);
                }

                // Send offer to next person in waitlist
                this.processNextInWaitlist(offer.caddieId);

                console.log(`[INFO] Offer declined for caddie ${offer.caddieName}`);
            },

            expireOffer(offerId) {
                const offer = this.activeOffers[offerId];
                offer.status = 'expired';

                // Remove from waitlist
                this.removeFromWaitlist(offer.caddieId, offer.golferId);

                // Close modal
                const modal = document.getElementById(`offer-modal-${offerId}`);
                if (modal) modal.remove();

                // Clear countdown
                if (offer.countdownInterval) {
                    clearInterval(offer.countdownInterval);
                }

                // Send offer to next person in waitlist
                this.processNextInWaitlist(offer.caddieId);

                console.log(`[INFO] Offer expired for caddie ${offer.caddieName}`);
            },

            removeFromWaitlist(caddieId, golferId) {
                if (this.waitlists[caddieId]) {
                    this.waitlists[caddieId] = this.waitlists[caddieId].filter(entry => entry.golferId !== golferId);
                }
            },

            processNextInWaitlist(caddieId) {
                if (this.waitlists[caddieId] && this.waitlists[caddieId].length > 0) {
                    const nextGolfer = this.waitlists[caddieId][0];
                    this.sendTimedOffer(caddieId, nextGolfer.golferId);
                }
            },

            showCaddyBookingFlow(caddieId) {
                try {
                    const caddie = this.allCaddys.find(c => c.id === caddieId);
                    if (!caddie) {
                        console.error('Caddy not found:', caddieId);
                        NotificationManager.show('Caddy not found. Please try again.', 'error');
                        return;
                    }

                    const course = GolfCourseDatabase.getCourseById(caddie.homeClub);
                    if (!course) {
                        console.error('Course not found for caddie:', caddie.homeClub);
                        NotificationManager.show('Course information not available.', 'error');
                        return;
                    }

                    // Show course booking interface - switch to booking tab
                    showGolferTab('booking', null);

                    // Pre-fill course selection
                    setTimeout(() => {
                        const courseElement = document.querySelector(`[data-course="${caddie.homeClub}"]`);
                        if (courseElement) {
                            courseElement.click();
                        }

                        // Show course info with caddie pre-selected
                        this.showCourseInfoModal(course, caddie);
                    }, 100);

                    console.log('Caddy booking flow initiated for:', caddie.name);
                } catch (error) {
                    console.error('Error in showCaddyBookingFlow:', error);
                    NotificationManager.show('Error loading booking. Please try again.', 'error');
                }
            },

            showCourseInfoModal(course, caddie = null) {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';

                modal.innerHTML = `
                    <div class="bg-white rounded-2xl p-8 max-w-2xl mx-4 shadow-2xl max-h-screen overflow-y-auto">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-2xl font-bold text-gray-900">Course Information</h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                        </div>

                        <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6 mb-6">
                            <div class="flex items-center space-x-4 mb-4">
                                <span class="text-4xl">${course.image}</span>
                                <div>
                                    <h4 class="text-2xl font-bold">${course.name}</h4>
                                    <p class="text-gray-600">${course.location}</p>
                                    <div class="flex items-center space-x-2 mt-2">
                                        <span class="text-yellow-500">‚≠ê</span>
                                        <span class="font-semibold">${course.rating}</span>
                                        <span class="text-gray-600">‚Ä¢ ${course.holes} holes ‚Ä¢ ${course.type}</span>
                                    </div>
                                </div>
                            </div>
                            <p class="text-gray-700">${course.description}</p>
                        </div>

                        ${caddie ? `
                            <div class="bg-green-50 border border-green-200 rounded-xl p-4 mb-6">
                                <div class="flex items-center space-x-2 mb-2">
                                    <span class="text-green-600">‚úì</span>
                                    <span class="font-semibold text-green-700">Caddy Pre-Selected</span>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <span class="text-2xl">${caddie.avatar}</span>
                                    <div>
                                        <p class="font-semibold">${caddie.name}</p>
                                        <p class="text-sm text-gray-600">${caddie.specialty}</p>
                                    </div>
                                </div>
                            </div>
                        ` : ''}

                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="bg-gray-50 rounded-xl p-4">
                                <h5 class="font-semibold mb-2">Green Fees</h5>
                                <p class="text-sm text-gray-600">Weekday: ‡∏ø${course.greenFees.weekday.toLocaleString()}</p>
                                <p class="text-sm text-gray-600">Weekend: ‡∏ø${course.greenFees.weekend.toLocaleString()}</p>
                            </div>
                            <div class="bg-gray-50 rounded-xl p-4">
                                <h5 class="font-semibold mb-2">Amenities</h5>
                                <div class="text-sm text-gray-600">
                                    ${course.amenities.slice(0, 3).map(amenity => `<p>‚Ä¢ ${amenity}</p>`).join('')}
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-3">
                            <button onclick="this.closest('.fixed').remove(); showGolferTab('booking', null);"
                                    class="flex-1 bg-primary-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-primary-700 transition-colors">
                                Book Tee Time
                            </button>
                            <button onclick="this.closest('.fixed').remove()"
                                    class="bg-gray-300 text-gray-700 px-6 py-3 rounded-xl font-semibold hover:bg-gray-400 transition-colors">
                                Close
                            </button>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
            },

            notifyCaddyOfBooking(caddieId, bookingDetails) {
                const caddie = this.allCaddys.find(c => c.id === caddieId);
                if (!caddie) {
                    console.error('Caddy not found for notification:', caddieId);
                    return;
                }

                // Log the booking notification for caddy
                console.log(`[CADDY NOTIFICATION] ${caddie.name} assigned to ${bookingDetails.golferName}`);
                console.log(`[BOOKING DETAILS] Course: ${bookingDetails.course}, Date: ${bookingDetails.date}, Time: ${bookingDetails.time}`);

                // In a real implementation, this would send push notification to caddy's device
                // For now, we'll show a success message indicating the caddy has been notified
                NotificationManager.show(`üì± ${caddie.name} has been notified of the booking assignment`, 'info');

                // Update caddy's notification queue (for when they check their dashboard)
                if (!caddie.notifications) {
                    caddie.notifications = [];
                }

                caddie.notifications.push({
                    id: `booking-${Date.now()}`,
                    type: 'booking_assignment',
                    title: 'New Booking Assignment',
                    message: `You have been assigned to ${bookingDetails.golferName}`,
                    details: bookingDetails,
                    timestamp: new Date(),
                    read: false
                });

                console.log(`[SUCCESS] ${caddie.name} notified of booking assignment via real-time system`);
            }
        };

        // Enhanced Booking System with Caddy and Payment
        const BookingSystem = {
            currentBooking: {
                course: null,
                date: null,
                time: null,
                players: 1,
                caddies: [],
                services: [],
                paymentMethod: null,
                total: 0
            },

            get caddieDatabase() {
                // Use CaddySystem data without pricing - pricing determined by golf course
                return CaddySystem.allCaddys.map(caddie => ({
                    id: caddie.id,
                    name: caddie.name,
                    rating: caddie.rating,
                    experience: caddie.experience,
                    languages: caddie.languages,
                    avatar: caddie.avatar,
                    specialty: caddie.specialty,
                    availability: caddie.availability === 'available',
                    homeClub: caddie.homeClub,
                    totalRounds: caddie.totalRounds,
                    reviews: caddie.reviews,
                    personality: caddie.personality,
                    strengths: caddie.strengths
                }));
            },

            serviceOptions: [
                { id: 'cart', name: 'Golf Cart Rental', price: 600, icon: 'üöó', description: 'Electric golf cart for 2 players' },
                { id: 'clubs', name: 'Club Rental Set', price: 400, icon: '‚õ≥', description: 'Premium club set with bag' },
                { id: 'shoes', name: 'Golf Shoes Rental', price: 200, icon: 'üëü', description: 'Professional golf shoes' },
                { id: 'insurance', name: 'Play Insurance', price: 150, icon: 'üõ°Ô∏è', description: 'Covers medical & equipment' },
                { id: 'lesson', name: 'Pro Lesson (30min)', price: 800, icon: 'üéØ', description: 'One-on-one instruction' }
            ],

            updateSummary() {
                const booking = this.currentBooking;
                const summaryContainer = document.getElementById('bookingSummary');
                const totalContainer = document.getElementById('bookingTotal');

                if (!summaryContainer || !totalContainer) return;

                if (!booking.course || !booking.date || !booking.time) {
                    summaryContainer.innerHTML = '<p class="text-gray-500 text-center py-8">Please complete your booking details</p>';
                    totalContainer.innerHTML = '<div class="text-center"><span class="text-2xl font-bold text-gray-400">‡∏ø0</span></div>';
                    return;
                }

                let total = 0;
                const coursePrice = { championship: 2500, executive: 1800, practice: 1200 }[booking.course] || 0;
                total += coursePrice * booking.players;

                // Caddy pricing now determined by golf course - not added to total here
                booking.services.forEach(service => total += service.price);

                this.currentBooking.total = total;

                summaryContainer.innerHTML = `
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Course (${booking.players} players)</span>
                            <span class="font-semibold">‡∏ø${(coursePrice * booking.players).toLocaleString()}</span>
                        </div>
                        ${booking.caddies.map(caddie => `
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">${caddie.name} (Caddy)</span>
                                <span class="font-semibold text-blue-600">Included in Course Fee</span>
                            </div>
                        `).join('')}
                        ${booking.services.map(service => `
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">${service.name}</span>
                                <span class="font-semibold">‡∏ø${service.price.toLocaleString()}</span>
                            </div>
                        `).join('')}
                        <div class="border-t pt-3">
                            <div class="flex justify-between items-center text-lg font-bold">
                                <span>Total</span>
                                <span class="text-primary-600">‡∏ø${total.toLocaleString()}</span>
                            </div>
                        </div>
                    </div>
                `;

                totalContainer.innerHTML = `
                    <div class="text-center">
                        <span class="text-2xl font-bold text-primary-600">‡∏ø${total.toLocaleString()}</span>
                        <p class="text-sm text-gray-500 mt-1">Total Amount</p>
                    </div>
                `;
            }
        };

        // Legacy function - redirect to new selectCourse
        function selectCourseOld(element, courseType) {
            // This is the old function, now redirects to the new one
            const courseMap = {
                'championship': 'pattaya-golf-club',
                'executive': 'royal-garden',
                'practice': 'crystal-bay'
            };
            const courseId = courseMap[courseType] || 'pattaya-golf-club';
            selectCourse(courseId);
        }

        function selectCaddy(caddieId, fromPromotion = false) {
            const caddie = BookingSystem.caddieDatabase.find(c => c.id === caddieId);
            if (!caddie) return;

            // If caddie is not available, show waitlist option
            if (!caddie.availability) {
                showCaddyWaitlistModal(caddie);
                return;
            }

            // If from promotion (random caddie), show course info first
            if (fromPromotion) {
                const course = GolfCourseDatabase.getCourseById(caddie.homeClub);
                CaddySystem.showCourseInfoModal(course, caddie);
                return;
            }

            const existingIndex = BookingSystem.currentBooking.caddies.findIndex(c => c.id === caddieId);
            const caddieElement = document.querySelector(`[data-caddie="${caddieId}"]`);

            if (existingIndex >= 0) {
                BookingSystem.currentBooking.caddies.splice(existingIndex, 1);
                if (caddieElement) {
                    caddieElement.classList.remove('border-primary-500', 'bg-primary-50');
                    caddieElement.classList.add('border-gray-200');
                }
            } else {
                BookingSystem.currentBooking.caddies.push(caddie);
                if (caddieElement) {
                    caddieElement.classList.remove('border-gray-200');
                    caddieElement.classList.add('border-primary-500', 'bg-primary-50');
                }
            }

            BookingSystem.updateSummary();
        }

        function showCaddyWaitlistModal(caddie) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';

            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-md mx-4 shadow-2xl">
                    <div class="text-center mb-6">
                        <div class="text-4xl mb-4">${caddie.avatar}</div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-2">${caddie.name}</h3>
                        <p class="text-gray-600">This caddie is currently booked</p>
                    </div>

                    <div class="bg-gray-50 rounded-xl p-6 mb-6">
                        <div class="flex items-center space-x-2 mb-3">
                            <span class="text-yellow-500">‚≠ê</span>
                            <span class="font-semibold">${caddie.rating}</span>
                            <span class="text-gray-600">(${caddie.reviews} reviews)</span>
                        </div>
                        <p class="text-sm text-gray-700 mb-2">${caddie.specialty} ‚Ä¢ ${caddie.experience} years</p>
                        <p class="text-sm text-gray-600">${caddie.personality}</p>
                        <div class="mt-3">
                            <p class="text-xs text-gray-500 font-medium">Strengths:</p>
                            <p class="text-xs text-gray-600">${caddie.strengths.join(', ')}</p>
                        </div>
                    </div>

                    <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6">
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-blue-500">üìã</span>
                            <span class="font-semibold text-blue-700">Join Waitlist</span>
                        </div>
                        <p class="text-sm text-blue-600">Get notified when ${caddie.name} becomes available. You'll have 10 minutes to accept the offer.</p>
                    </div>

                    <div class="flex space-x-3">
                        <button onclick="joinCaddyWaitlist('${caddie.id}'); this.closest('.fixed').remove();"
                                class="flex-1 bg-blue-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-blue-700 transition-colors">
                            Join Waitlist
                        </button>
                        <button onclick="this.closest('.fixed').remove()"
                                class="bg-gray-300 text-gray-700 px-6 py-3 rounded-xl font-semibold hover:bg-gray-400 transition-colors">
                            Cancel
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        function joinCaddyWaitlist(caddieId) {
            const golferInfo = {
                name: AppState.currentUser.name,
                id: AppState.currentUser.role + '_user_' + Date.now()
            };

            const position = CaddySystem.addToWaitlist(caddieId, golferInfo.id, golferInfo);

            console.log(`[SUCCESS] Added to waitlist for caddie ${caddieId}. Position: ${position}`);

            // Show confirmation
            const confirmationModal = document.createElement('div');
            confirmationModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';

            confirmationModal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-md mx-4 shadow-2xl">
                    <div class="text-center">
                        <div class="text-6xl mb-4">‚úÖ</div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-2">Added to Waitlist</h3>
                        <p class="text-gray-600 mb-4">You're #${position} in line</p>
                        <p class="text-sm text-gray-500 mb-6">We'll notify you when the caddie becomes available. You'll have 10 minutes to accept the offer.</p>
                        <button onclick="this.closest('.fixed').remove()"
                                class="bg-primary-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-primary-700 transition-colors">
                            Got it!
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(confirmationModal);

            // Auto-close after 3 seconds
            setTimeout(() => {
                if (confirmationModal.parentNode) {
                    confirmationModal.remove();
                }
            }, 3000);
        }

        function loadPromotionalCaddys() {
            const promotionalCaddys = CaddySystem.getRandomPromotionalCaddys(4);
            const mobileContainer = document.getElementById('promotionalCaddysContainer');
            const desktopContainer = document.getElementById('promotionalCaddysDesktop');

            // Function to generate caddie card HTML
            const generateCaddyCard = (caddie, isMobile = false) => `
                <div class="bg-gradient-to-br from-white to-gray-50 rounded-xl p-4 border border-gray-200 hover:border-primary-300 hover:shadow-lg transition-all ${isMobile ? 'mobile-caddie-card' : ''}">
                    <div class="flex items-center space-x-3 mb-3">
                        <div class="text-3xl">${caddie.avatar}</div>
                        <div>
                            <h4 class="font-bold text-gray-900">${caddie.name}</h4>
                            <div class="flex items-center space-x-2">
                                <span class="text-yellow-500">‚≠ê</span>
                                <span class="text-sm font-semibold">${caddie.rating}</span>
                                <span class="text-xs text-gray-500">(${caddie.reviews})</span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <p class="text-xs text-gray-600 font-medium">${caddie.specialty}</p>
                        <p class="text-xs text-gray-500">${caddie.experience} years experience</p>
                        <p class="text-xs text-gray-500 mt-1">${caddie.languages.join(', ')}</p>
                    </div>

                    <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-3 mb-3">
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-lg">${caddie.promotedCourse.image}</span>
                            <div>
                                <p class="font-semibold text-sm text-gray-900">${caddie.promotedCourse.name}</p>
                                <p class="text-xs text-gray-600">${caddie.promotedCourse.location}</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-1">
                                <span class="text-yellow-400">‚≠ê</span>
                                <span class="text-xs font-semibold">${caddie.promotedCourse.rating}</span>
                            </div>
                            <span class="text-xs text-gray-600">${caddie.promotedCourse.holes} holes</span>
                        </div>
                    </div>

                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-1">
                            <span class="w-2 h-2 rounded-full ${caddie.availability === 'available' ? 'bg-green-500' : 'bg-red-500'}"></span>
                            <span class="text-xs font-medium ${caddie.availability === 'available' ? 'text-green-700' : 'text-red-700'}">
                                ${caddie.availability === 'available' ? 'Available' : 'Join Waitlist'}
                            </span>
                        </div>
                        <span class="text-xs text-gray-500">${caddie.totalRounds} rounds</span>
                    </div>

                    <!-- Action Buttons -->
                    <div class="mt-3 flex gap-2">
                        ${caddie.availability === 'available' ?
                            `<button onclick="bookCaddyFromFeature('${caddie.id}', '${caddie.name}')" class="flex-1 bg-primary-600 text-white text-xs py-2 px-3 rounded-lg hover:bg-primary-700 transition-colors">
                                <span class="material-symbols-outlined text-xs mr-1">event_available</span>
                                Book Now
                            </button>` :
                            `<button onclick="joinWaitlistFromFeature('${caddie.id}', '${caddie.name}')" class="flex-1 bg-orange-500 text-white text-xs py-2 px-3 rounded-lg hover:bg-orange-600 transition-colors">
                                <span class="material-symbols-outlined text-xs mr-1">schedule</span>
                                Join Waitlist
                            </button>`
                        }
                        <button onclick="selectCaddy('${caddie.id}', true)" class="bg-gray-100 text-gray-700 text-xs py-2 px-3 rounded-lg hover:bg-gray-200 transition-colors">
                            <span class="material-symbols-outlined text-xs">info</span>
                        </button>
                    </div>
                </div>
            `;

            // Populate mobile container (horizontal scrolling)
            if (mobileContainer) {
                mobileContainer.innerHTML = promotionalCaddys.map(caddie =>
                    generateCaddyCard(caddie, true)
                ).join('');
            }

            // Populate desktop container (grid layout)
            if (desktopContainer) {
                desktopContainer.innerHTML = promotionalCaddys.map(caddie =>
                    generateCaddyCard(caddie, false)
                ).join('');
            }
        }

        function refreshPromotionalCaddys() {
            const mobileContainer = document.getElementById('promotionalCaddysContainer');
            const desktopContainer = document.getElementById('promotionalCaddysDesktop');

            // Loading animation HTML
            const loadingHTML = `
                <div class="text-center py-8 ${mobileContainer ? 'mobile-caddie-card flex-shrink-0' : 'col-span-4'}">
                    <div class="inline-flex items-center space-x-2">
                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"></div>
                        <span class="text-gray-600">Finding new caddies...</span>
                    </div>
                </div>
            `;

            // Add loading animation to both containers
            if (mobileContainer) {
                mobileContainer.innerHTML = loadingHTML;
            }
            if (desktopContainer) {
                desktopContainer.innerHTML = loadingHTML.replace('mobile-caddie-card flex-shrink-0', 'col-span-4');
            }

            // Load new promotional caddies after brief delay
            setTimeout(() => {
                loadPromotionalCaddys();
            }, 800);
        }

        // Test function to simulate caddie becoming available
        function testCaddyAvailability() {
            const bookedCaddys = CaddySystem.allCaddys.filter(c => c.availability === 'booked');
            if (bookedCaddys.length > 0) {
                const randomCaddy = bookedCaddys[0];
                randomCaddy.availability = 'available';

                // Send offer to first person in waitlist
                CaddySystem.processNextInWaitlist(randomCaddy.id);

                console.log(`[TEST] ${randomCaddy.name} is now available`);
            }
        }

        function toggleService(serviceId) {
            const service = BookingSystem.serviceOptions.find(s => s.id === serviceId);
            if (!service) return;

            const existingIndex = BookingSystem.currentBooking.services.findIndex(s => s.id === serviceId);
            const serviceElement = document.querySelector(`[data-service="${serviceId}"]`);

            if (existingIndex >= 0) {
                BookingSystem.currentBooking.services.splice(existingIndex, 1);
                serviceElement.classList.remove('border-primary-500', 'bg-primary-50');
                serviceElement.classList.add('border-gray-200');
            } else {
                BookingSystem.currentBooking.services.push(service);
                serviceElement.classList.remove('border-gray-200');
                serviceElement.classList.add('border-primary-500', 'bg-primary-50');
            }

            BookingSystem.updateSummary();
        }

        function selectPaymentMethod(method) {
            // Update new booking cart system
            if (!bookingCart.paymentMethod) {
                bookingCart.paymentMethod = method;
            } else {
                bookingCart.paymentMethod = method;
            }

            // Update old booking system for compatibility
            BookingSystem.currentBooking.paymentMethod = method;

            // Update UI
            document.querySelectorAll('.payment-option').forEach(opt => {
                opt.classList.remove('border-primary-500', 'bg-primary-50');
                opt.classList.add('border-gray-200');
            });
            const selectedOption = document.querySelector(`[data-payment="${method}"]`);
            if (selectedOption) {
                selectedOption.classList.remove('border-gray-200');
                selectedOption.classList.add('border-primary-500', 'bg-primary-50');
            }

            // Update cart display to enable confirm button
            updateBookingCartDisplay();

            NotificationManager.show(`Payment method set to ${method}`, 'success');
        }

        function resetBookingForm() {
            BookingSystem.currentBooking = {
                course: null, date: null, time: null, players: 1,
                caddies: [], services: [], paymentMethod: null, total: 0
            };
            document.querySelectorAll('.course-option, .payment-option').forEach(option => {
                option.classList.remove('border-primary-500', 'bg-primary-50');
                option.classList.add('border-gray-200');
            });
            document.querySelectorAll('[data-caddie], [data-service]').forEach(option => {
                option.classList.remove('border-primary-500', 'bg-primary-50');
                option.classList.add('border-gray-200');
            });
            document.getElementById('bookingDate').value = '';
            document.getElementById('bookingTime').value = '';
            document.getElementById('playerCount').value = '1';
        }

        // Legacy booking system function - redirects to new system
        function confirmBookingOld() {
            const booking = BookingSystem.currentBooking;

            booking.date = document.getElementById('bookingDate')?.value;
            booking.time = document.getElementById('bookingTime')?.value;
            booking.players = parseInt(document.getElementById('playerCount')?.value || 1);

            if (!booking.course || !booking.date || !booking.time) {
                NotificationManager.show('Please complete all required booking details', 'error');
                return;
            }

            if (!booking.paymentMethod) {
                NotificationManager.show('Please select a payment method', 'error');
                return;
            }

            LoadingManager.show('Processing your booking and payment...');

            setTimeout(() => {
                const bookingId = 'MCP' + Date.now().toString().slice(-6);
                NotificationManager.show(`Booking confirmed! Reference: ${bookingId}. Confirmation sent to your email.`, 'success');
                LoadingManager.hide();

                // Reset booking form
                resetBookingForm();
                showGolferTab('overview');
            }, 3000);
        }

        function cancelBooking() {
            resetBookingForm();
            showGolferTab('overview');
        }

        // Enhanced Google Maps GPS & Navigation System
        let googleMap = null;
        let playerMarker = null;
        let holeMarkers = [];
        let currentMapType = 'satellite';

        const GPSNavigationSystem = {
            currentPosition: null,
            courseData: {
                name: 'Royal Thai Golf Course',
                par: 72,
                totalDistance: 6847,
                // Sample golf course coordinates (Pattaya area)
                center: { lat: 12.9236, lng: 100.8854 },
                holes: [
                    { number: 1, par: 4, distance: 425, teeBox: {lat: 13.7563, lng: 100.5018}, pin: {lat: 13.7568, lng: 100.5025}, hazards: ['bunker', 'water'] },
                    { number: 2, par: 3, distance: 185, teeBox: {lat: 13.7570, lng: 100.5028}, pin: {lat: 13.7575, lng: 100.5032}, hazards: ['bunker'] },
                    { number: 3, par: 5, distance: 520, teeBox: {lat: 13.7578, lng: 100.5035}, pin: {lat: 13.7585, lng: 100.5045}, hazards: ['water', 'trees'] },
                    { number: 4, par: 4, distance: 380, teeBox: {lat: 13.7588, lng: 100.5048}, pin: {lat: 13.7592, lng: 100.5053}, hazards: ['bunker'] },
                    { number: 5, par: 4, distance: 410, teeBox: {lat: 13.7595, lng: 100.5056}, pin: {lat: 13.7600, lng: 100.5062}, hazards: ['trees'] },
                    { number: 6, par: 3, distance: 165, teeBox: {lat: 13.7603, lng: 100.5065}, pin: {lat: 13.7607, lng: 100.5068}, hazards: ['water'] },
                    { number: 7, par: 4, distance: 395, teeBox: {lat: 13.7610, lng: 100.5071}, pin: {lat: 13.7615, lng: 100.5078}, hazards: ['bunker', 'trees'] },
                    { number: 8, par: 5, distance: 485, teeBox: {lat: 13.7618, lng: 100.5081}, pin: {lat: 13.7625, lng: 100.5090}, hazards: ['water'] },
                    { number: 9, par: 4, distance: 365, teeBox: {lat: 13.7628, lng: 100.5093}, pin: {lat: 13.7632, lng: 100.5098}, hazards: ['bunker'] },
                    { number: 10, par: 4, distance: 420, teeBox: {lat: 13.7635, lng: 100.5101}, pin: {lat: 13.7640, lng: 100.5108}, hazards: ['trees'] },
                    { number: 11, par: 3, distance: 175, teeBox: {lat: 13.7643, lng: 100.5111}, pin: {lat: 13.7647, lng: 100.5115}, hazards: ['water'] },
                    { number: 12, par: 5, distance: 510, teeBox: {lat: 13.7650, lng: 100.5118}, pin: {lat: 13.7658, lng: 100.5128}, hazards: ['bunker', 'water'] },
                    { number: 13, par: 4, distance: 400, teeBox: {lat: 13.7661, lng: 100.5131}, pin: {lat: 13.7666, lng: 100.5138}, hazards: ['trees'] },
                    { number: 14, par: 4, distance: 385, teeBox: {lat: 13.7669, lng: 100.5141}, pin: {lat: 13.7673, lng: 100.5146}, hazards: ['bunker'] },
                    { number: 15, par: 3, distance: 155, teeBox: {lat: 13.7676, lng: 100.5149}, pin: {lat: 13.7679, lng: 100.5152}, hazards: ['water'] },
                    { number: 16, par: 4, distance: 435, teeBox: {lat: 13.7682, lng: 100.5155}, pin: {lat: 13.7688, lng: 100.5162}, hazards: ['bunker', 'trees'] },
                    { number: 17, par: 5, distance: 495, teeBox: {lat: 13.7691, lng: 100.5165}, pin: {lat: 13.7699, lng: 100.5175}, hazards: ['water'] },
                    { number: 18, par: 4, distance: 445, teeBox: {lat: 13.7702, lng: 100.5178}, pin: {lat: 13.7708, lng: 100.5185}, hazards: ['bunker', 'water'] }
                ]
            },
            currentHole: 1,
            trackingActive: false,
            paceOfPlay: {
                startTime: null,
                holeStartTimes: {},
                targetTimes: [15, 12, 18, 15, 16, 10, 16, 18, 14, 16, 11, 19, 15, 15, 9, 17, 19, 17] // minutes per hole
            },
            weatherConditions: {
                temperature: 32,
                humidity: 75,
                windSpeed: 8,
                windDirection: 'NE',
                condition: 'partly_cloudy'
            }
        };

        function getCurrentLocation() {
            LoadingManager.show('Getting your precise location...');

            if (!navigator.geolocation) {
                LoadingManager.hide();
                NotificationManager.show('GPS not supported by this device', 'error');
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    GPSNavigationSystem.currentPosition = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        accuracy: position.coords.accuracy,
                        timestamp: new Date()
                    };

                    updateLocationDisplay();
                    detectCurrentHole();
                    calculateDistances();

                    // Update OpenStreetMap with real location
                    if (googleMap) {
                        updatePlayerLocation(GPSNavigationSystem.currentPosition);
                        googleMap.setView([position.coords.latitude, position.coords.longitude], 17);
                    }

                    LoadingManager.hide();
                    NotificationManager.show('üìç Location updated with ¬±' + Math.round(position.coords.accuracy) + 'm accuracy', 'success');
                },
                (error) => {
                    LoadingManager.hide();
                    let errorMessage = 'Unable to get your location. ';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage += 'Please allow location access.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage += 'Location information unavailable.';
                            break;
                        case error.TIMEOUT:
                            errorMessage += 'Location request timed out.';
                            break;
                    }
                    NotificationManager.show(errorMessage, 'error');
                    console.error('GPS Error:', error);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 15000,
                    maximumAge: 30000
                }
            );
        }

        function startGPSTracking() {
            if (!navigator.geolocation) {
                NotificationManager.show('GPS not supported by this device', 'error');
                return;
            }

            GPSNavigationSystem.trackingActive = true;
            GPSNavigationSystem.paceOfPlay.startTime = new Date();
            GPSNavigationSystem.paceOfPlay.holeStartTimes[GPSNavigationSystem.currentHole] = new Date();

            const trackingOptions = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 5000
            };

            const trackingId = navigator.geolocation.watchPosition(
                (position) => {
                    GPSNavigationSystem.currentPosition = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        accuracy: position.coords.accuracy,
                        speed: position.coords.speed,
                        heading: position.coords.heading,
                        timestamp: new Date()
                    };

                    updateLocationDisplay();
                    detectCurrentHole();
                    calculateDistances();
                    updatePaceOfPlay();
                },
                (error) => console.error('GPS Tracking Error:', error),
                trackingOptions
            );

            GPSNavigationSystem.trackingId = trackingId;
            NotificationManager.show('üéØ GPS tracking started - Live course navigation active', 'success');
        }

        function stopGPSTracking() {
            if (GPSNavigationSystem.trackingId) {
                navigator.geolocation.clearWatch(GPSNavigationSystem.trackingId);
                GPSNavigationSystem.trackingActive = false;
                NotificationManager.show('GPS tracking stopped', 'info');
            }
        }

        function detectCurrentHole() {
            if (!GPSNavigationSystem.currentPosition) return;

            const currentPos = GPSNavigationSystem.currentPosition;
            let closestHole = 1;
            let minDistance = Infinity;

            GPSNavigationSystem.courseData.holes.forEach(hole => {
                const distance = calculateDistance(
                    currentPos.lat, currentPos.lng,
                    hole.teeBox.lat, hole.teeBox.lng
                );

                if (distance < minDistance) {
                    minDistance = distance;
                    closestHole = hole.number;
                }
            });

            if (GPSNavigationSystem.currentHole !== closestHole) {
                GPSNavigationSystem.currentHole = closestHole;
                GPSNavigationSystem.paceOfPlay.holeStartTimes[closestHole] = new Date();
                updateHoleDisplay();
            }
        }

        function calculateDistances() {
            if (!GPSNavigationSystem.currentPosition) return;

            const currentHole = GPSNavigationSystem.courseData.holes.find(h => h.number === GPSNavigationSystem.currentHole);
            if (!currentHole) return;

            const pos = GPSNavigationSystem.currentPosition;
            const distanceToPin = calculateDistance(pos.lat, pos.lng, currentHole.pin.lat, currentHole.pin.lng);

            updateDistanceDisplay({
                toPin: Math.round(distanceToPin),
                toFront: Math.round(distanceToPin * 0.85),
                toCenter: Math.round(distanceToPin * 0.92),
                toBack: Math.round(distanceToPin * 1.15)
            });
        }

        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371000;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const distance = R * c;
            return distance * 1.09361; // Convert to yards
        }

        function updatePaceOfPlay() {
            const currentHole = GPSNavigationSystem.currentHole || 1;
            const totalHoles = 18;
            const progress = (currentHole / totalHoles) * 100;

            // Calculate expected time (4.5 hours for 18 holes)
            const expectedMinutesPerHole = (4.5 * 60) / 18; // 15 minutes per hole
            const expectedElapsedMinutes = currentHole * expectedMinutesPerHole;

            // Calculate actual elapsed time (from start of round)
            const roundStartTime = GPSNavigationSystem.roundStartTime || new Date();
            const actualElapsedMinutes = (new Date() - roundStartTime) / (1000 * 60);

            // Determine pace status
            let paceStatus = 'On Time';
            let paceColor = 'green';

            if (actualElapsedMinutes > expectedElapsedMinutes + 15) {
                paceStatus = 'Behind';
                paceColor = 'red';
            } else if (actualElapsedMinutes < expectedElapsedMinutes - 15) {
                paceStatus = 'Ahead';
                paceColor = 'blue';
            }

            // Update pace display
            const paceElements = document.querySelectorAll('.pace-status');
            paceElements.forEach(el => {
                if (el) {
                    el.textContent = paceStatus;
                    el.className = `pace-status font-bold text-2xl text-${paceColor}-600`;
                }
            });

            // Update progress bar
            const progressBars = document.querySelectorAll('.pace-progress');
            progressBars.forEach(bar => {
                if (bar) {
                    bar.style.width = `${progress}%`;
                    bar.className = `pace-progress h-2 rounded-full bg-${paceColor}-600`;
                }
            });

            // Update elapsed time display
            const elapsedElements = document.querySelectorAll('.elapsed-time');
            elapsedElements.forEach(el => {
                if (el) {
                    const hours = Math.floor(actualElapsedMinutes / 60);
                    const minutes = Math.floor(actualElapsedMinutes % 60);
                    el.textContent = `${hours}h ${minutes}m elapsed`;
                }
            });
        }

        function updateLocationDisplay() {
            const pos = GPSNavigationSystem.currentPosition;
            if (!pos) return;

            const elements = {
                currentLat: pos.lat.toFixed(6),
                currentLng: pos.lng.toFixed(6),
                gpsAccuracy: Math.round(pos.accuracy) + 'm',
                lastUpdate: pos.timestamp.toLocaleTimeString()
            };

            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });
        }

        function updateHoleDisplay() {
            const currentHole = GPSNavigationSystem.courseData.holes.find(h => h.number === GPSNavigationSystem.currentHole);
            if (!currentHole) return;

            const elements = {
                currentHole: currentHole.number,
                currentHoleNum: currentHole.number,
                currentPar: currentHole.par,
                holeDistance: currentHole.distance + ' yds'
            };

            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });

            renderHoleLayout();
        }

        function updateDistanceDisplay(distances) {
            const elements = {
                distanceToPin: distances.toPin,
                pinDistance: distances.toPin + ' yds',
                frontDistance: distances.toFront + ' yds',
                centerDistance: distances.toCenter + ' yds',
                backDistance: distances.toBack + ' yds'
            };

            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });
        }

        function renderHoleLayout() {
            const layoutContainer = document.getElementById('holeLayoutContainer');
            if (!layoutContainer) return;

            const hole = GPSNavigationSystem.courseData.holes.find(h => h.number === GPSNavigationSystem.currentHole);
            if (!hole) return;

            layoutContainer.innerHTML = `
                <div class="hole-layout bg-gradient-to-b from-green-100 to-green-200 rounded-xl p-6 relative" style="height: 300px;">
                    <div class="absolute top-4 left-4 bg-white px-3 py-1 rounded-lg shadow-md">
                        <span class="text-lg font-bold text-gray-900">Hole ${hole.number}</span>
                        <span class="text-sm text-gray-600 ml-2">Par ${hole.par} ‚Ä¢ ${hole.distance} yds</span>
                    </div>

                    <!-- Tee Box -->
                    <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 w-8 h-4 bg-blue-600 rounded-sm shadow-md"></div>
                    <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 text-xs text-blue-700 font-bold">TEE</div>

                    <!-- Pin & Green -->
                    <div class="absolute top-20 left-1/2 transform -translate-x-1/2 w-16 h-12 bg-green-400 rounded-full opacity-80"></div>
                    <div class="absolute top-16 left-1/2 transform -translate-x-1/2 w-2 h-8 bg-red-600 rounded-full shadow-md"></div>
                    <div class="absolute top-12 left-1/2 transform -translate-x-1/2 text-xs text-red-700 font-bold">PIN</div>

                    <!-- Current Position -->
                    ${GPSNavigationSystem.currentPosition ? `
                        <div class="absolute top-1/2 left-1/3 transform -translate-x-1/2 -translate-y-1/2 w-4 h-4 bg-primary-500 rounded-full border-2 border-white shadow-lg animate-pulse"></div>
                        <div class="absolute top-1/2 left-1/3 transform -translate-x-1/2 -translate-y-1/2 mt-6 text-xs text-primary-700 font-bold">YOU</div>
                    ` : ''}

                    <!-- Hazards -->
                    ${hole.hazards.includes('water') ? '<div class="absolute top-1/4 right-1/4 w-14 h-10 bg-blue-400 rounded-full opacity-70 shadow-inner"></div><div class="absolute top-1/4 right-1/4 w-14 h-10 flex items-center justify-center text-xs text-blue-800 font-bold">üíß</div>' : ''}
                    ${hole.hazards.includes('bunker') ? '<div class="absolute top-3/4 left-1/4 w-10 h-8 bg-yellow-400 rounded-full opacity-80 shadow-inner"></div><div class="absolute top-3/4 left-1/4 w-10 h-8 flex items-center justify-center text-xs">üèñÔ∏è</div>' : ''}
                    ${hole.hazards.includes('trees') ? '<div class="absolute top-1/3 left-1/6 w-6 h-8 bg-green-700 rounded-full opacity-80"></div><div class="absolute top-1/3 left-1/6 w-6 h-8 flex items-center justify-center text-xs">üå≥</div>' : ''}
                </div>
            `;
        }

        function showWeatherInfo() {
            const weather = GPSNavigationSystem.weatherConditions;
            NotificationManager.show(
                `üå°Ô∏è ${weather.temperature}¬∞C ‚Ä¢ üí® ${weather.windSpeed}km/h ${weather.windDirection} ‚Ä¢ üíß ${weather.humidity}% humidity`,
                'info'
            );
        }

        function measureDistance() {
            NotificationManager.show('Tap two points on the course to measure distance', 'info');
        }

        function findNearestCart() {
            LoadingManager.show('Locating nearest cart...');

            setTimeout(() => {
                LoadingManager.hide();
                NotificationManager.show('Nearest cart located: 50 yards northeast near hole 6 tee box', 'success');
            }, 1500);
        }

        function callMarshal() {
            LoadingManager.show('Contacting course marshal...');

            setTimeout(() => {
                LoadingManager.hide();
                NotificationManager.show('Marshal notified. They will be with you shortly.', 'success');
            }, 1500);
        }

        // Course Selection for Booking
        document.addEventListener('DOMContentLoaded', function() {
            // Set minimum date for booking
            const dateInput = document.getElementById('bookingDate');
            if (dateInput) {
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                dateInput.min = tomorrow.toISOString().split('T')[0];
            }

            // Course selection handlers
            document.querySelectorAll('.course-option').forEach(option => {
                option.addEventListener('click', function() {
                    // Remove selection from all options
                    document.querySelectorAll('.course-option').forEach(opt => {
                        opt.classList.remove('border-primary-500', 'bg-primary-50');
                        opt.classList.add('border-gray-200');
                    });

                    // Add selection to clicked option
                    this.classList.remove('border-gray-200');
                    this.classList.add('border-primary-500', 'bg-primary-50');

                    updateBookingSummary();
                });
            });

            // Booking form change handlers
            ['bookingDate', 'bookingTime', 'playerCount'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', function() {
                        // Update legacy booking system
                        BookingSystem.currentBooking.date = document.getElementById('bookingDate')?.value;
                        BookingSystem.currentBooking.time = document.getElementById('bookingTime')?.value;
                        BookingSystem.currentBooking.players = parseInt(document.getElementById('playerCount')?.value || 1);
                        BookingSystem.updateSummary();

                        // Update new booking cart display to enable/disable confirm button
                        updateBookingCartDisplay();
                    });
                }
            });
        });

        function updateBookingSummary() {
            const selectedCourse = document.querySelector('.course-option.border-primary-500');
            const date = document.getElementById('bookingDate')?.value;
            const time = document.getElementById('bookingTime')?.value;
            const players = document.getElementById('playerCount')?.value;

            const summaryContainer = document.getElementById('bookingSummary');
            const totalContainer = document.getElementById('bookingTotal');

            if (!summaryContainer || !totalContainer) return;

            if (!selectedCourse || !date || !time || !players) {
                summaryContainer.innerHTML = '<p class="text-gray-600">Select course and date to see summary</p>';
                totalContainer.textContent = '‡∏ø0';
                return;
            }

            const courseName = selectedCourse.querySelector('h4').textContent;
            const coursePrice = parseInt(selectedCourse.querySelector('.text-primary-600').textContent.replace('‡∏ø', '').replace(',', ''));
            const total = coursePrice * parseInt(players);

            const formattedDate = new Date(date).toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric'
            });

            summaryContainer.innerHTML = `
                <div class="space-y-2">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Course:</span>
                        <span class="font-medium">${courseName}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Date:</span>
                        <span class="font-medium">${formattedDate}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Time:</span>
                        <span class="font-medium">${time}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Players:</span>
                        <span class="font-medium">${players}</span>
                    </div>
                    <div class="flex justify-between border-t pt-2">
                        <span class="text-gray-600">Price per player:</span>
                        <span class="font-medium">‡∏ø${coursePrice.toLocaleString()}</span>
                    </div>
                </div>
            `;

            totalContainer.textContent = `‡∏ø${total.toLocaleString()}`;
        }

        // ===== PRO SHOP POS SYSTEM =====
        let proshopCart = [];

        // Pro Shop POS Functions
        function addToCart(name, price, sku) {
            const existingItem = proshopCart.find(item => item.sku === sku);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                proshopCart.push({
                    name: name,
                    price: price,
                    sku: sku,
                    quantity: 1
                });
            }

            updateCartDisplay();
            enablePaymentButtons();
        }

        function removeFromCart(sku) {
            proshopCart = proshopCart.filter(item => item.sku !== sku);
            updateCartDisplay();

            if (proshopCart.length === 0) {
                disablePaymentButtons();
            }
        }

        function updateCartQuantity(sku, quantity) {
            const item = proshopCart.find(item => item.sku === sku);
            if (item) {
                if (quantity <= 0) {
                    removeFromCart(sku);
                } else {
                    item.quantity = quantity;
                    updateCartDisplay();
                }
            }
        }

        function updateCartDisplay() {
            const cartItemsContainer = document.getElementById('cart-items');
            const subtotalEl = document.getElementById('cart-subtotal');
            const taxEl = document.getElementById('cart-tax');
            const totalEl = document.getElementById('cart-total');

            if (proshopCart.length === 0) {
                cartItemsContainer.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <span class="material-symbols-outlined text-4xl mb-2 block">shopping_cart</span>
                        <p class="text-sm">Cart is empty</p>
                        <p class="text-xs">Add products to start a sale</p>
                    </div>
                `;
                subtotalEl.textContent = '‚Çø0';
                taxEl.textContent = '‚Çø0';
                totalEl.textContent = '‚Çø0';
                return;
            }

            const cartHtml = proshopCart.map(item => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex-1">
                        <p class="font-medium text-sm">${item.name}</p>
                        <p class="text-xs text-gray-600">‚Çø${item.price.toLocaleString()} each</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button onclick="updateCartQuantity('${item.sku}', ${item.quantity - 1})"
                                class="w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center text-xs">-</button>
                        <span class="text-sm font-medium w-8 text-center">${item.quantity}</span>
                        <button onclick="updateCartQuantity('${item.sku}', ${item.quantity + 1})"
                                class="w-6 h-6 bg-purple-600 text-white rounded-full flex items-center justify-center text-xs">+</button>
                        <button onclick="removeFromCart('${item.sku}')"
                                class="ml-2 text-red-600 hover:text-red-800">
                            <span class="material-symbols-outlined text-sm">delete</span>
                        </button>
                    </div>
                </div>
            `).join('');

            cartItemsContainer.innerHTML = cartHtml;

            const subtotal = proshopCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * 0.07; // 7% tax
            const total = subtotal + tax;

            subtotalEl.textContent = `‚Çø${subtotal.toLocaleString()}`;
            taxEl.textContent = `‚Çø${Math.round(tax).toLocaleString()}`;
            totalEl.textContent = `‚Çø${Math.round(total).toLocaleString()}`;
        }

        function clearCart() {
            proshopCart = [];
            updateCartDisplay();
            disablePaymentButtons();
        }

        function enablePaymentButtons() {
            document.getElementById('cash-btn').disabled = false;
            document.getElementById('card-btn').disabled = false;
        }

        function disablePaymentButtons() {
            document.getElementById('cash-btn').disabled = true;
            document.getElementById('card-btn').disabled = true;
        }

        function processPayment(method) {
            if (proshopCart.length === 0) return;

            const subtotal = proshopCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * 0.07;
            const total = subtotal + tax;
            const transactionId = 'TXN' + Date.now();

            // Simulate payment processing
            const paymentModal = document.createElement('div');
            paymentModal.className = 'modal-overlay';
            paymentModal.innerHTML = `
                <div class="modal-content max-w-md">
                    <div class="text-center py-6">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="material-symbols-outlined text-3xl text-green-600">check_circle</span>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">Payment Successful!</h2>
                        <p class="text-gray-600 mb-4">Transaction #${transactionId}</p>
                        <div class="bg-gray-50 rounded-lg p-4 mb-4 text-left">
                            <div class="space-y-2">
                                ${proshopCart.map(item => `
                                    <div class="flex justify-between text-sm">
                                        <span>${item.name} x${item.quantity}</span>
                                        <span>‚Çø${(item.price * item.quantity).toLocaleString()}</span>
                                    </div>
                                `).join('')}
                                <hr class="my-2">
                                <div class="flex justify-between text-sm">
                                    <span>Subtotal:</span>
                                    <span>‚Çø${subtotal.toLocaleString()}</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span>Tax (7%):</span>
                                    <span>‚Çø${Math.round(tax).toLocaleString()}</span>
                                </div>
                                <div class="flex justify-between font-bold">
                                    <span>Total:</span>
                                    <span>‚Çø${Math.round(total).toLocaleString()}</span>
                                </div>
                                <div class="flex justify-between text-sm text-gray-600 mt-2">
                                    <span>Payment Method:</span>
                                    <span class="capitalize">${method}</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="printReceipt('${transactionId}')" class="btn-outline flex-1">
                                <span class="material-symbols-outlined text-sm mr-2">print</span>
                                Print Receipt
                            </button>
                            <button onclick="closePaymentModal()" class="btn-primary flex-1">
                                New Sale
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(paymentModal);
            clearCart();
        }

        function printReceipt(transactionId) {
            // Simulate receipt printing
            alert(`Receipt for transaction ${transactionId} sent to printer.`);
        }

        function closePaymentModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
            }
        }

        // Category filtering for products
        function filterByCategory(category) {
            const products = document.querySelectorAll('.product-card');
            const tabs = document.querySelectorAll('.category-tab');

            // Update active tab
            tabs.forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[data-category="${category}"]`).classList.add('active');

            // Filter products
            products.forEach(product => {
                if (category === 'all' || product.dataset.category === category) {
                    product.style.display = 'block';
                } else {
                    product.style.display = 'none';
                }
            });
        }

        // Initialize category tab listeners
        document.addEventListener('DOMContentLoaded', function() {
            const categoryTabs = document.querySelectorAll('.category-tab');
            categoryTabs.forEach(tab => {
                tab.addEventListener('click', () => filterByCategory(tab.dataset.category));
            });

            // Search functionality
            const searchInput = document.getElementById('product-search');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    const products = document.querySelectorAll('.product-card');

                    products.forEach(product => {
                        const productName = product.querySelector('h4').textContent.toLowerCase();
                        if (productName.includes(searchTerm)) {
                            product.style.display = 'block';
                        } else {
                            product.style.display = 'none';
                        }
                    });
                });
            }
        });

        // ===== MAINTENANCE SYSTEM =====

        // Maintenance System for Course Updates and Photo Management
        const MaintenanceSystem = {
            courseUpdates: [],
            uploadedPhotos: [],

            // Initialize hole numbers based on course selection
            updateHoleNumbers() {
                const courseSection = document.getElementById('courseSection')?.value;
                const holeSelect = document.getElementById('holeNumber');

                if (!holeSelect) return;

                holeSelect.innerHTML = '<option value="">Select hole number...</option>';

                if (courseSection === 'A') {
                    for (let i = 1; i <= 9; i++) {
                        holeSelect.innerHTML += `<option value="${i}">Hole ${i}</option>`;
                    }
                } else if (courseSection === 'B') {
                    for (let i = 10; i <= 18; i++) {
                        holeSelect.innerHTML += `<option value="${i}">Hole ${i}</option>`;
                    }
                } else if (courseSection === 'C') {
                    holeSelect.innerHTML += '<option value="range">Practice Range</option>';
                    holeSelect.innerHTML += '<option value="driving">Driving Range</option>';
                } else if (courseSection === 'D') {
                    holeSelect.innerHTML += '<option value="putting">Putting Green</option>';
                    holeSelect.innerHTML += '<option value="chipping">Chipping Area</option>';
                }
            },

            // Handle photo upload and preview
            handlePhotoUpload(files) {
                const previewContainer = document.getElementById('photoPreview');
                if (!previewContainer) return;

                Array.from(files).forEach((file, index) => {
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const photoId = Date.now() + '_' + index;
                            this.uploadedPhotos.push({
                                id: photoId,
                                data: e.target.result,
                                name: file.name,
                                size: file.size
                            });

                            const photoDiv = document.createElement('div');
                            photoDiv.className = 'relative group';
                            photoDiv.innerHTML = `
                                <img src="${e.target.result}" class="w-full h-24 object-cover rounded-lg border">
                                <button onclick="MaintenanceSystem.removePhoto('${photoId}')"
                                        class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity">
                                    <span class="material-symbols-outlined text-xs">close</span>
                                </button>
                                <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-1 rounded-b-lg">
                                    ${file.name}
                                </div>
                            `;
                            previewContainer.appendChild(photoDiv);
                        };
                        reader.readAsDataURL(file);
                    }
                });
            },

            // Remove photo from upload
            removePhoto(photoId) {
                this.uploadedPhotos = this.uploadedPhotos.filter(photo => photo.id !== photoId);

                const previewContainer = document.getElementById('photoPreview');
                if (previewContainer) {
                    previewContainer.innerHTML = '';
                    // Re-render remaining photos
                    this.uploadedPhotos.forEach(photo => {
                        const photoDiv = document.createElement('div');
                        photoDiv.className = 'relative group';
                        photoDiv.innerHTML = `
                            <img src="${photo.data}" class="w-full h-24 object-cover rounded-lg border">
                            <button onclick="MaintenanceSystem.removePhoto('${photo.id}')"
                                    class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity">
                                <span class="material-symbols-outlined text-xs">close</span>
                            </button>
                            <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-1 rounded-b-lg">
                                ${photo.name}
                            </div>
                        `;
                        previewContainer.appendChild(photoDiv);
                    });
                }
            },

            // Submit course update
            submitCourseUpdate() {
                const courseSection = document.getElementById('courseSection')?.value;
                const holeNumber = document.getElementById('holeNumber')?.value;
                const areaType = document.getElementById('areaType')?.value;
                const issuePriority = document.getElementById('issuePriority')?.value;
                const issueDescription = document.getElementById('issueDescription')?.value;

                if (!courseSection || !areaType || !issueDescription) {
                    alert('Please fill in all required fields');
                    return;
                }

                const update = {
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    courseSection,
                    holeNumber,
                    areaType,
                    priority: issuePriority || 'medium',
                    description: issueDescription,
                    photos: [...this.uploadedPhotos],
                    reporter: AppState.currentUser.name,
                    status: 'open'
                };

                this.courseUpdates.unshift(update);
                this.renderRecentUpdates();
                this.clearForm();

                // Show success message
                alert('Course update submitted successfully!');

                // Notify management and caddies via chat
                this.notifyStaffOfUpdate(update);
            },

            // Notify staff through chat system
            notifyStaffOfUpdate(update) {
                if (typeof ChatSystem !== 'undefined' && ChatSystem.chatRooms) {
                    const message = {
                        id: Date.now(),
                        senderId: AppState.currentUser.role + '_' + AppState.currentUser.name.replace(/\s+/g, '_').toLowerCase(),
                        senderName: AppState.currentUser.name,
                        text: `üîß Course Update: ${update.areaType.replace('-', ' ')} issue reported on Course ${update.courseSection}${update.holeNumber ? ` Hole ${update.holeNumber}` : ''}. Priority: ${update.priority.toUpperCase()}`,
                        timestamp: new Date().toISOString(),
                        language: 'en',
                        type: 'maintenance'
                    };

                    // Send to staff coordination chat
                    if (ChatSystem.chatRooms['staff_coordination']) {
                        ChatSystem.chatRooms['staff_coordination'].messages.push(message);
                        ChatSystem.chatRooms['staff_coordination'].unreadCount = (ChatSystem.chatRooms['staff_coordination'].unreadCount || 0) + 1;
                    }

                    // Update chat badge
                    if (ChatSystem.updateBadge) {
                        ChatSystem.updateBadge();
                    }
                }
            },

            // Clear the form after submission
            clearForm() {
                document.getElementById('courseSection').value = '';
                document.getElementById('holeNumber').innerHTML = '<option value="">Select hole number...</option>';
                document.getElementById('areaType').value = '';
                document.getElementById('issuePriority').value = 'low';
                document.getElementById('issueDescription').value = '';
                document.getElementById('photoPreview').innerHTML = '';
                this.uploadedPhotos = [];
            },

            // Render recent updates
            renderRecentUpdates() {
                const container = document.getElementById('recentUpdates');
                if (!container) return;

                if (this.courseUpdates.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <span class="material-symbols-outlined text-6xl mb-4 block">grass</span>
                            <p>No recent course updates</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.courseUpdates.map(update => `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <div class="p-2 ${this.getPriorityColor(update.priority)} rounded-lg">
                                    <span class="material-symbols-outlined">${this.getAreaIcon(update.areaType)}</span>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-800">Course ${update.courseSection}${update.holeNumber ? ` - Hole ${update.holeNumber}` : ''}</h4>
                                    <p class="text-sm text-gray-600">${update.areaType.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="px-2 py-1 ${this.getPriorityBadgeColor(update.priority)} text-xs font-medium rounded-full">
                                    ${update.priority.toUpperCase()}
                                </span>
                                <p class="text-xs text-gray-500 mt-1">${this.formatTimestamp(update.timestamp)}</p>
                            </div>
                        </div>

                        <p class="text-gray-700 mb-3">${update.description}</p>

                        ${update.photos.length > 0 ? `
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-3">
                                ${update.photos.map(photo => `
                                    <img src="${photo.data}" alt="${photo.name}"
                                         class="w-full h-20 object-cover rounded-lg border cursor-pointer hover:opacity-80"
                                         onclick="MaintenanceSystem.showPhotoModal('${photo.data}', '${photo.name}')">
                                `).join('')}
                            </div>
                        ` : ''}

                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-600">Reported by: <strong>${update.reporter}</strong></span>
                            <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full">${update.status}</span>
                        </div>
                    </div>
                `).join('');
            },

            // Show photo in modal
            showPhotoModal(photoData, photoName) {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="max-w-4xl max-h-full p-4">
                        <div class="bg-white rounded-lg overflow-hidden">
                            <div class="p-4 border-b flex items-center justify-between">
                                <h3 class="font-semibold">${photoName}</h3>
                                <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                                    <span class="material-symbols-outlined">close</span>
                                </button>
                            </div>
                            <img src="${photoData}" alt="${photoName}" class="max-w-full max-h-96 object-contain">
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);

                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
            },

            // Helper functions
            getPriorityColor(priority) {
                const colors = {
                    'low': 'bg-blue-100 text-blue-600',
                    'medium': 'bg-yellow-100 text-yellow-600',
                    'high': 'bg-orange-100 text-orange-600',
                    'critical': 'bg-red-100 text-red-600'
                };
                return colors[priority] || colors.medium;
            },

            getPriorityBadgeColor(priority) {
                const colors = {
                    'low': 'bg-blue-100 text-blue-700',
                    'medium': 'bg-yellow-100 text-yellow-700',
                    'high': 'bg-orange-100 text-orange-700',
                    'critical': 'bg-red-100 text-red-700'
                };
                return colors[priority] || colors.medium;
            },

            getAreaIcon(areaType) {
                const icons = {
                    'tee-box': 'sports_golf',
                    'fairway': 'grass',
                    'rough': 'nature',
                    'fairway-bunker': 'terrain',
                    'greenside-bunker': 'terrain',
                    'green': 'flag',
                    'flag-cup': 'golf_course'
                };
                return icons[areaType] || 'grass';
            },

            formatTimestamp(timestamp) {
                const date = new Date(timestamp);
                const now = new Date();
                const diffMs = now - date;
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

                if (diffDays > 0) {
                    return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
                } else if (diffHours > 0) {
                    return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
                } else {
                    const diffMins = Math.floor(diffMs / (1000 * 60));
                    return `${diffMins} min${diffMins > 1 ? 's' : ''} ago`;
                }
            },

            // Load sample data
            loadSampleData() {
                this.courseUpdates = [
                    {
                        id: 1,
                        timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                        courseSection: 'A',
                        holeNumber: '5',
                        areaType: 'green',
                        priority: 'high',
                        description: 'Green has several bare spots that need reseeding. The condition affects putting quality.',
                        photos: [],
                        reporter: 'Tom Rodriguez',
                        status: 'open'
                    },
                    {
                        id: 2,
                        timestamp: new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString(),
                        courseSection: 'B',
                        holeNumber: '12',
                        areaType: 'fairway-bunker',
                        priority: 'medium',
                        description: 'Sand needs to be added and raked. Some contamination from nearby fairway.',
                        photos: [],
                        reporter: 'Maria Santos',
                        status: 'open'
                    }
                ];
            }
        };

        // Global functions for maintenance
        function handlePhotoUpload(event) {
            MaintenanceSystem.handlePhotoUpload(event.target.files);
        }

        function submitCourseUpdate() {
            MaintenanceSystem.submitCourseUpdate();
        }

        // Initialize course section change listener
        document.addEventListener('DOMContentLoaded', function() {
            const courseSelect = document.getElementById('courseSection');
            if (courseSelect) {
                courseSelect.addEventListener('change', () => MaintenanceSystem.updateHoleNumbers());
            }

            // Load sample data when maintenance dashboard is accessed
            setTimeout(() => {
                MaintenanceSystem.loadSampleData();
                MaintenanceSystem.renderRecentUpdates();
            }, 1000);
        });

        // ===== WAITLIST & BOOKING MANAGEMENT =====

        // Ning Caddy Booking Demo Functions
        function demonstrateNingBooking() {
            const ningCaddy = CaddySystem.allCaddys.find(c => c.id === 'pat001');
            if (!ningCaddy) {
                alert('Ning not found in system');
                return;
            }

            if (ningCaddy.availability === 'booked') {
                // Show current booking info and waitlist option
                const waitlistPosition = EnhancedBookingManager.waitlists['pat001']?.length + 1 || 1;
                const confirmJoin = confirm(`Ning Prasert is currently booked until 13:00 today.

Current booking: Private Golf Lesson at Pattana Golf Resort
Waitlist position available: #${waitlistPosition}

Would you like to join the waitlist?`);

                if (confirmJoin) {
                    const golferName = prompt('Enter your name for the waitlist:') || AppState.currentUser.name;
                    EnhancedBookingManager.joinWaitlist('pat001');
                    alert(`Successfully added to Ning's waitlist at position #${waitlistPosition}!

You will be notified when she becomes available.`);
                }
            } else {
                // Direct booking available
                alert(`Ning Prasert is available for immediate booking!

Pattana Golf Resort & Spa
Rating: ‚òÖ${ningCaddy.rating}
Specialty: ${ningCaddy.specialty}`);
            }
        }

        function showNingAvailability() {
            const ningCaddy = CaddySystem.allCaddys.find(c => c.id === 'pat001');
            const waitlist = EnhancedBookingManager.waitlists['pat001'] || [];

            let statusMessage = `üèåÔ∏è Ning Prasert - Pattana Golf Resort

Status: ${ningCaddy.availability === 'booked' ? 'üî¥ Currently Booked' : 'üü¢ Available'}
Rating: ‚òÖ${ningCaddy.rating} (${ningCaddy.reviews} reviews)
Experience: ${ningCaddy.experience} years
Total Rounds: ${ningCaddy.totalRounds}`;

            if (ningCaddy.currentBooking) {
                statusMessage += `

üìÖ Current Booking:
‚Ä¢ ${ningCaddy.currentBooking.golfer}
‚Ä¢ ${ningCaddy.currentBooking.date} at ${ningCaddy.currentBooking.time}
‚Ä¢ ${ningCaddy.currentBooking.holes} holes`;
            }

            if (waitlist.length > 0) {
                statusMessage += `

‚è≥ Waitlist (${waitlist.length} people):`;
                waitlist.forEach((person, index) => {
                    statusMessage += `\n${index + 1}. ${person.golferName}`;
                });
            }

            alert(statusMessage);
        }

        // Enhanced Booking Manager with Edit/Cancel capabilities
        const EnhancedBookingManager = {
            waitlists: {
                'pat001': [ // Ning Prasert - has waitlist due to being booked
                    { id: 'w101', golferName: 'David Kim', joinTime: new Date(Date.now() - 3 * 60 * 60 * 1000), priority: 1 },
                    { id: 'w102', golferName: 'Maria Rodriguez', joinTime: new Date(Date.now() - 2 * 60 * 60 * 1000), priority: 2 },
                    { id: 'w103', golferName: 'James Wilson', joinTime: new Date(Date.now() - 1 * 60 * 60 * 1000), priority: 3 }
                ],
                'c002': [], // Somchai Jaidee
                'c003': [   // Apinya Thaworn (busy)
                    { id: 'w1', golferName: 'Mike Chen', joinTime: new Date(Date.now() - 2 * 60 * 60 * 1000), priority: 1 },
                    { id: 'w2', golferName: 'Anna Smith', joinTime: new Date(Date.now() - 1 * 60 * 60 * 1000), priority: 2 },
                    { id: 'w3', golferName: 'David Kim', joinTime: new Date(Date.now() - 30 * 60 * 1000), priority: 3 }
                ],
                'c004': [] // Chaiwat Suksan
            },

            bookings: [
                {
                    id: 'booking001',
                    type: 'tee_time',
                    golferName: AppState.currentUser.name,
                    course: 'Pattaya Golf Club',
                    date: '2024-10-01',
                    time: '08:00 AM',
                    players: 2,
                    status: 'confirmed',
                    createdAt: new Date(Date.now() - 24 * 60 * 60 * 1000)
                },
                {
                    id: 'booking002',
                    type: 'caddie',
                    golferName: AppState.currentUser.name,
                    caddieName: 'Ning Prasert',
                    caddieId: 'c001',
                    date: '2024-10-01',
                    time: '08:00 AM',
                    status: 'confirmed',
                    createdAt: new Date(Date.now() - 24 * 60 * 60 * 1000)
                }
            ],

            // Join caddie waitlist
            joinWaitlist(caddieId, event) {
                if (event) event.stopPropagation();

                const caddieNames = {
                    'pat001': 'Ning Prasert',
                    'c002': 'Somchai Jaidee',
                    'c003': 'Apinya Thaworn',
                    'c004': 'Chaiwat Suksan'
                };

                // Check if already on waitlist
                const existingWaitlist = this.waitlists[caddieId].find(w => w.golferName === AppState.currentUser.name);
                if (existingWaitlist) {
                    alert('You are already on the waitlist for this caddie!');
                    return;
                }

                // Add to waitlist
                const waitlistEntry = {
                    id: 'w' + Date.now(),
                    golferName: AppState.currentUser.name,
                    joinTime: new Date(),
                    priority: this.waitlists[caddieId].length + 1
                };

                this.waitlists[caddieId].push(waitlistEntry);

                alert(`Added to waitlist for ${caddieNames[caddieId]}! You are position #${waitlistEntry.priority}`);
                this.updateWaitlistDisplay();
            },

            // Update waitlist display on cards
            updateWaitlistDisplay() {
                Object.keys(this.waitlists).forEach(caddieId => {
                    const waitlist = this.waitlists[caddieId];
                    const card = document.querySelector(`[data-caddie="${caddieId}"]`);
                    if (card && waitlist.length > 0) {
                        // Find existing waitlist info or create new
                        let waitlistInfo = card.querySelector('.waitlist-info');
                        if (!waitlistInfo) {
                            waitlistInfo = document.createElement('div');
                            waitlistInfo.className = 'waitlist-info text-xs text-gray-600 mt-2';
                            card.appendChild(waitlistInfo);
                        }
                        waitlistInfo.textContent = `Waitlist: ${waitlist.length} ${waitlist.length === 1 ? 'person' : 'people'}`;
                    }
                });
            },

            // Edit booking
            editBooking(bookingId) {
                const booking = this.bookings.find(b => b.id === bookingId);
                if (!booking) return;

                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-2xl p-6 w-full max-w-md mx-4">
                        <h3 class="text-lg font-bold mb-4">Edit ${booking.type === 'tee_time' ? 'Tee Time' : 'Caddy'} Booking</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                <input type="date" id="editDate" value="${booking.date}" class="form-input w-full">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Time</label>
                                <select id="editTime" class="form-select w-full">
                                    <option value="06:00 AM" ${booking.time === '06:00 AM' ? 'selected' : ''}>06:00 AM</option>
                                    <option value="07:00 AM" ${booking.time === '07:00 AM' ? 'selected' : ''}>07:00 AM</option>
                                    <option value="08:00 AM" ${booking.time === '08:00 AM' ? 'selected' : ''}>08:00 AM</option>
                                    <option value="09:00 AM" ${booking.time === '09:00 AM' ? 'selected' : ''}>09:00 AM</option>
                                    <option value="10:00 AM" ${booking.time === '10:00 AM' ? 'selected' : ''}>10:00 AM</option>
                                </select>
                            </div>
                            ${booking.type === 'tee_time' ? `
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Players</label>
                                <select id="editPlayers" class="form-select w-full">
                                    <option value="1" ${booking.players === 1 ? 'selected' : ''}>1 Player</option>
                                    <option value="2" ${booking.players === 2 ? 'selected' : ''}>2 Players</option>
                                    <option value="3" ${booking.players === 3 ? 'selected' : ''}>3 Players</option>
                                    <option value="4" ${booking.players === 4 ? 'selected' : ''}>4 Players</option>
                                </select>
                            </div>
                            ` : ''}
                        </div>
                        <div class="flex space-x-3 mt-6">
                            <button onclick="EnhancedBookingManager.saveBookingChanges('${bookingId}', this.closest('.fixed'))" class="btn-primary flex-1">Save Changes</button>
                            <button onclick="this.closest('.fixed').remove()" class="btn-secondary flex-1">Cancel</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            // Save booking changes
            saveBookingChanges(bookingId, modal) {
                const booking = this.bookings.find(b => b.id === bookingId);
                if (!booking) return;

                booking.date = document.getElementById('editDate').value;
                booking.time = document.getElementById('editTime').value;
                if (booking.type === 'tee_time') {
                    booking.players = parseInt(document.getElementById('editPlayers').value);
                }

                // Save to localStorage
                this.saveToLocalStorage();

                // Trigger cloud sync for cross-device updates
                if (typeof SimpleCloudSync !== 'undefined') {
                    console.log('[BookingManager] BOOKING UPDATED - TRIGGERING CLOUD SYNC');
                    SimpleCloudSync.saveToCloudSoon();
                }

                alert('Booking updated successfully!');
                modal.remove();
                this.refreshBookingDisplay();
            },

            // Cancel booking
            cancelBooking(bookingId) {
                const booking = this.bookings.find(b => b.id === bookingId);
                if (!booking) return;

                const confirmMsg = `Are you sure you want to cancel this ${booking.type === 'tee_time' ? 'tee time' : 'caddie'} booking?`;
                if (confirm(confirmMsg)) {
                    // Remove from bookings
                    this.bookings = this.bookings.filter(b => b.id !== bookingId);

                    // Send deletion tombstone to server
                    console.log('[BookingManager] BOOKING CANCELLED - SENDING DELETION TOMBSTONE');
                    SimpleCloudSync.handleDeletion('bookings', bookingId);

                    // Also save local state
                    this.saveToLocalStorage();

                    // If it's a caddie booking, notify next person on waitlist
                    if (booking.type === 'caddie' && booking.caddieId) {
                        this.notifyNextOnWaitlist(booking.caddieId);
                    }

                    alert('Booking cancelled successfully!');
                    this.refreshBookingDisplay();
                }
            },

            // Notify next person on waitlist
            notifyNextOnWaitlist(caddieId) {
                const waitlist = this.waitlists[caddieId];
                if (waitlist.length > 0) {
                    const nextPerson = waitlist.shift(); // Remove first person
                    // Re-prioritize remaining waitlist
                    waitlist.forEach((person, index) => {
                        person.priority = index + 1;
                    });

                    alert(`${nextPerson.golferName} has been notified of caddie availability!`);
                    this.updateWaitlistDisplay();
                }
            },

            // Refresh booking display (to be called after changes)
            refreshBookingDisplay() {
                // This would update the UI where bookings are displayed
                console.log('Booking display refreshed');
            },

            // Get golfer's current waitlist positions
            getGolferWaitlists() {
                const golferWaitlists = [];
                Object.keys(this.waitlists).forEach(caddieId => {
                    const waitlistEntry = this.waitlists[caddieId].find(w => w.golferName === AppState.currentUser.name);
                    if (waitlistEntry) {
                        const caddieNames = {
                            'pat001': 'Ning Prasert',
                            'c002': 'Somchai Jaidee',
                            'c003': 'Apinya Thaworn',
                            'c004': 'Chaiwat Suksan'
                        };
                        golferWaitlists.push({
                            caddieId,
                            caddieName: caddieNames[caddieId],
                            position: waitlistEntry.priority,
                            joinTime: waitlistEntry.joinTime
                        });
                    }
                });
                return golferWaitlists;
            },

            // Get caddie's current bookings and waitlist
            getCaddyInfo(caddieId) {
                const bookings = this.bookings.filter(b => b.caddieId === caddieId);
                const waitlist = this.waitlists[caddieId] || [];
                return { bookings, waitlist };
            }
        };

        // Global functions for UI
        function joinWaitlist(caddieId, event) {
            EnhancedBookingManager.joinWaitlist(caddieId, event);
        }

        function editBooking(bookingId) {
            EnhancedBookingManager.editBooking(bookingId);
        }

        function cancelBooking(bookingId) {
            EnhancedBookingManager.cancelBooking(bookingId);
        }

        // Initialize waitlist display on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                EnhancedBookingManager.updateWaitlistDisplay();
            }, 500);
        });

    </script>
</head>

<body>
    <!-- Login Screen -->
    <div id="login" class="screen active">
        <div class="min-h-screen hero-gradient flex items-center justify-center p-6">
            <div class="glass-card p-10 w-full max-w-lg">
                <div class="text-center mb-10">
                    <!-- Language Selector -->
                    <div class="flex justify-center space-x-2 mb-6">
                        <button class="language-btn" data-lang="en" onclick="changeLanguage('en')" title="English">EN</button>
                        <button class="language-btn" data-lang="th" onclick="changeLanguage('th')" title="‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢">TH</button>
                        <button class="language-btn" data-lang="ko" onclick="changeLanguage('ko')" title="ÌïúÍµ≠Ïñ¥">KO</button>
                        <button class="language-btn" data-lang="ja" onclick="changeLanguage('ja')" title="Êó•Êú¨Ë™û">JA</button>
                    </div>

                    <div class="w-24 h-24 mx-auto mb-6">
                        <img src="mcipro.png" alt="MciPro Logo" class="w-full h-full object-contain">
                    </div>
                    <p class="text-lg text-gray-600 mb-4" data-i18n="app.subtitle">Professional Golf Course Management</p>
                    <div class="flex items-center justify-center space-x-2 text-sm text-gray-600">
                        <div class="status-online"></div>
                        <span>System Online ‚Ä¢ Enterprise Security</span>
                    </div>
                </div>

                <!-- LINE Login Section -->
                <div id="lineLoginContainer" class="space-y-8">
                    <button onclick="loginWithLINE()" class="line-login-btn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63h2.386c.349 0 .63.285.63.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63.349 0 .631.285.631.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.281.628-.629.628M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/>
                        </svg>
                        Login with LINE
                    </button>

                    <div class="relative">
                        <div class="absolute inset-0 flex items-center">
                            <div class="w-full border-t border-gray-300"></div>
                        </div>
                        <div class="relative flex justify-center text-sm">
                            <span class="px-6 bg-white text-gray-500 font-medium">Enterprise Access Options</span>
                        </div>
                    </div>
                </div>

                <!-- Fallback Login Options -->
                <div id="fallbackLoginContainer" class="space-y-4">
                    <button onclick="login('golfer')" class="btn-primary w-full justify-center">
                        <span class="material-symbols-outlined">sports_golf</span>
                        Golfer Access
                    </button>
                    <button onclick="login('caddie')" class="btn-secondary w-full justify-center">
                        <span class="material-symbols-outlined">person_add</span>
                        Caddy Access
                    </button>
                    <button onclick="login('manager')" class="w-full btn-primary justify-center" style="background: var(--orange-600);">
                        <span class="material-symbols-outlined">manage_accounts</span>
                        Manager Access
                    </button>
                    <button onclick="login('proshop')" class="w-full btn-primary justify-center" style="background: var(--purple-600);">
                        <span class="material-symbols-outlined">storefront</span>
                        Pro Shop Access
                    </button>
                    <button onclick="login('maintenance')" class="w-full btn-primary justify-center" style="background: #065f46; color: white;">
                        <span class="material-symbols-outlined">grass</span>
                        Maintenance Access
                    </button>
                    <button onclick="login('society')" class="w-full btn-primary justify-center mt-4" style="background: var(--orange-600);">
                        <span class="material-symbols-outlined">groups</span>
                        Society Organizer
                    </button>
                </div>

                <div class="mt-8 text-center space-y-3">
                    <button onclick="showMyProfiles()" class="w-full btn-secondary justify-center">
                        <span class="material-symbols-outlined">person</span>
                        My Profiles
                    </button>
                    <button onclick="showCreateProfileScreen()" class="w-full btn-primary justify-center" style="background: #10b981; color: white;">
                        <span class="material-symbols-outlined">person_add</span>
                        Create New Profile
                    </button>
                    <button onclick="showOTPScreen()" class="text-primary-600 hover:text-primary-700 font-semibold text-sm transition-colors">
                        <span class="material-symbols-outlined text-sm mr-1">smartphone</span>
                        Mobile Authentication (SMS)
                    </button>
                </div>

                <div class="mt-8 text-center text-xs text-gray-500">
                    <p class="font-semibold">¬© 2025 MciPro Enterprise Platform</p>
                    <p>Professional Golf Course Management Solution</p>
                </div>
            </div>
        </div>
    </div>

    <!-- OTP Authentication Screen -->
    <div id="otpScreen" class="screen">
        <div class="min-h-screen hero-gradient flex items-center justify-center p-6">
            <div class="glass-card p-10 w-full max-w-lg">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-6">
                        <span class="material-symbols-outlined text-3xl text-primary-600">smartphone</span>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900 mb-3">Mobile Verification</h2>
                    <p class="text-gray-600">Enter your phone number to receive a secure access code</p>
                </div>

                <div class="space-y-6">
                    <div>
                        <label class="form-label">Phone Number</label>
                        <input type="tel" id="phoneInput" class="form-input" placeholder="+66 XX XXX XXXX" maxlength="15">
                    </div>

                    <button onclick="sendOTP()" id="sendOTPBtn" class="btn-primary w-full justify-center">
                        <span class="material-symbols-outlined">send</span>
                        Send Verification Code
                    </button>

                    <div id="otpInputSection" class="hidden space-y-6">
                        <div>
                            <label class="form-label">Enter 6-Digit Code</label>
                            <div class="flex justify-center space-x-3 mt-4">
                                <input type="text" class="otp-input" maxlength="1" autocomplete="off">
                                <input type="text" class="otp-input" maxlength="1" autocomplete="off">
                                <input type="text" class="otp-input" maxlength="1" autocomplete="off">
                                <input type="text" class="otp-input" maxlength="1" autocomplete="off">
                                <input type="text" class="otp-input" maxlength="1" autocomplete="off">
                                <input type="text" class="otp-input" maxlength="1" autocomplete="off">
                            </div>
                        </div>

                        <button onclick="verifyOTP()" class="btn-primary w-full justify-center">
                            <span class="material-symbols-outlined">verified</span>
                            Verify & Login
                        </button>
                    </div>
                </div>

                <div class="mt-10 text-center">
                    <button onclick="showScreen('login')" class="text-primary-600 hover:text-primary-700 font-medium text-sm transition-colors">
                        <span class="material-symbols-outlined text-sm mr-1">arrow_back</span>
                        Back to Login Options
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- PLACEHOLDER DASHBOARDS - Will be built in subsequent phases -->

    <!-- Profile Creation Screen -->
    <div id="createProfileScreen" class="screen">
        <div class="min-h-screen hero-gradient flex items-center justify-center p-6">
            <div class="glass-card p-10 w-full max-w-2xl">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-6">
                        <span class="material-symbols-outlined text-3xl text-primary-600">person_add</span>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-900 mb-2" data-i18n="profile.create">Create Your Profile</h2>
                    <p class="text-gray-600" data-i18n="profile.choose.role">Choose your role and fill in your information</p>
                </div>

                <form id="profileCreationForm" class="space-y-6">
                    <!-- Role Selection -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">Select Your Role</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <label class="role-selection-card">
                                <input type="radio" name="role" value="golfer" class="sr-only">
                                <div class="role-card">
                                    <span class="material-symbols-outlined text-2xl">sports_golf</span>
                                    <span class="text-sm font-medium">Golfer</span>
                                </div>
                            </label>
                            <label class="role-selection-card">
                                <input type="radio" name="role" value="caddie" class="sr-only">
                                <div class="role-card">
                                    <span class="material-symbols-outlined text-2xl">person_add</span>
                                    <span class="text-sm font-medium">Caddy</span>
                                </div>
                            </label>
                            <label class="role-selection-card">
                                <input type="radio" name="role" value="manager" class="sr-only">
                                <div class="role-card">
                                    <span class="material-symbols-outlined text-2xl">manage_accounts</span>
                                    <span class="text-sm font-medium">Manager</span>
                                </div>
                            </label>
                            <label class="role-selection-card">
                                <input type="radio" name="role" value="proshop" class="sr-only">
                                <div class="role-card">
                                    <span class="material-symbols-outlined text-2xl">storefront</span>
                                    <span class="text-sm font-medium">Pro Shop</span>
                                </div>
                            </label>
                            <label class="role-selection-card">
                                <input type="radio" name="role" value="maintenance" class="sr-only">
                                <div class="role-card">
                                    <span class="material-symbols-outlined text-2xl">grass</span>
                                    <span class="text-sm font-medium">Maintenance</span>
                                </div>
                            </label>
                            <label class="role-selection-card">
                                <input type="radio" name="role" value="society" class="sr-only">
                                <div class="role-card">
                                    <span class="material-symbols-outlined text-2xl">groups</span>
                                    <span class="text-sm font-medium">Society Organizer</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Basic Information -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">First Name *</label>
                            <input type="text" id="firstName" name="firstName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Last Name *</label>
                            <input type="text" id="lastName" name="lastName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                            <input type="email" id="email" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number *</label>
                            <input type="tel" id="phone" name="phone" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                        </div>
                    </div>

                    <!-- Golf Course Affiliation -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Home Golf Course</label>
                        <select id="homeClub" name="homeClub" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                            <option value="">Select your home course...</option>
                            <option value="Pattana Golf Resort & Spa">Pattana Golf Resort & Spa</option>
                            <option value="Pattaya Golf Club">Pattaya Golf Club</option>
                            <option value="Thai Country Club">Thai Country Club</option>
                            <option value="Siam Plantation Golf Club">Siam Plantation Golf Club</option>
                            <option value="Royal Garden Golf Club">Royal Garden Golf Club</option>
                            <option value="Bangpra International Golf Club">Bangpra International Golf Club</option>
                            <option value="Crystal Bay Golf Club">Crystal Bay Golf Club</option>
                            <option value="Laem Chabang International Country Club">Laem Chabang International Country Club</option>
                        </select>
                    </div>

                    <!-- Role-Specific Fields Container -->
                    <div id="roleSpecificFields" class="hidden">
                        <!-- Will be populated dynamically based on role selection -->
                    </div>

                    <!-- Profile Picture Upload -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Profile Picture (Optional)</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                            <input type="file" id="profilePicture" name="profilePicture" accept="image/*" class="hidden">
                            <div id="uploadArea" onclick="document.getElementById('profilePicture').click()" class="cursor-pointer">
                                <span class="material-symbols-outlined text-4xl text-gray-400 mb-2">add_a_photo</span>
                                <p class="text-sm text-gray-600">Click to upload a profile picture</p>
                            </div>
                            <div id="imagePreview" class="hidden">
                                <img id="previewImg" src="" alt="Preview" class="w-20 h-20 rounded-full mx-auto object-cover">
                                <button type="button" onclick="removeImage()" class="text-red-600 text-sm mt-2">Remove</button>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Notes -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Additional Information (Optional)</label>
                        <textarea id="additionalInfo" name="additionalInfo" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="Any additional information you'd like to share..."></textarea>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex space-x-4">
                        <button type="button" onclick="goBackToLogin()" class="flex-1 btn-secondary justify-center">
                            <span class="material-symbols-outlined">arrow_back</span>
                            Back to Login
                        </button>
                        <button type="submit" class="flex-1 btn-primary justify-center">
                            <span class="material-symbols-outlined">save</span>
                            Create Profile
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Golfer Dashboard -->
    <div id="golferDashboard" class="screen">
        <header class="nav-header">
            <div class="max-w-7xl mx-auto px-4 lg:px-8">
                <div class="flex justify-between items-center py-3 md:py-5">
                    <div class="flex items-center space-x-2 md:space-x-4">
                        <img class="user-avatar" style="display: none;">
                        <div>
                            <h1 class="text-base md:text-xl font-bold text-gray-900">Golfer Dashboard</h1>
                            <p class="text-xs md:text-sm text-gray-600 hidden sm:block">Welcome back, <span class="user-name-display">Golfer</span>!</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 md:space-x-4">
                        <button onclick="ProfileSystem.showProfileModal()" class="btn-secondary px-2 py-2 md:px-3 md:py-2" title="Profile Settings">
                            <span class="material-symbols-outlined text-sm">person</span>
                            <span class="hidden md:inline ml-1">Profile</span>
                        </button>
                        <button onclick="sendEmergencyAlert()" class="emergency-btn p-2 md:p-3" title="Emergency Alert">
                            <span class="material-symbols-outlined text-sm md:text-base">emergency</span>
                        </button>
                        <button onclick="ChatSystem.showChatInterface()" class="btn-primary relative px-2 py-2 md:px-4 md:py-2" style="background: #10b981;" title="Chat">
                            <span class="material-symbols-outlined text-sm">chat</span>
                            <span class="hidden md:inline ml-1">Chat</span>
                            <span id="chatBadge" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-4 w-4 md:h-5 md:w-5 flex items-center justify-center font-medium" style="display: none;">0</span>
                        </button>
                        <button onclick="logout()" class="btn-logout px-2 py-2 md:px-3 md:py-2">
                            <span class="material-symbols-outlined text-sm">logout</span>
                            <span class="hidden md:inline ml-1">Logout</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 lg:px-8">
                <div class="flex overflow-x-auto space-x-2 md:space-x-8">
                    <button onclick="showGolferTab('overview', event)" class="tab-button active px-2 md:px-4">
                        <span class="material-symbols-outlined text-sm">dashboard</span>
                        <span class="hidden sm:inline ml-1">Overview</span>
                    </button>
                    <button onclick="showGolferTab('booking', event)" class="tab-button px-2 md:px-4">
                        <span class="material-symbols-outlined text-sm">event</span>
                        <span class="hidden sm:inline ml-1">Booking</span>
                    </button>
                    <button onclick="showGolferTab('schedule', event)" class="tab-button px-2 md:px-4">
                        <span class="material-symbols-outlined text-sm">calendar_month</span>
                        <span class="hidden sm:inline ml-1">Schedule</span>
                    </button>
                    <button onclick="showGolferTab('food', event)" class="tab-button px-2 md:px-4">
                        <span class="material-symbols-outlined text-sm">restaurant</span>
                        <span class="hidden sm:inline ml-1">Food & Dining</span>
                    </button>
                    <button onclick="showGolferTab('status', event)" class="tab-button relative px-2 md:px-4">
                        <span class="material-symbols-outlined text-sm">receipt_long</span>
                        <span class="hidden sm:inline ml-1">Order Status</span>
                        <span class="absolute top-0 right-2 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center font-medium" id="orderStatusTabBadge" style="display: none;">0</span>
                    </button>
                    <button onclick="showGolferTab('stats', event)" class="tab-button px-2 md:px-4">
                        <span class="material-symbols-outlined text-sm">analytics</span>
                        <span class="hidden sm:inline ml-1">Statistics</span>
                    </button>
                    <button onclick="showGolferTab('gps', event)" class="tab-button px-2 md:px-4">
                        <span class="material-symbols-outlined text-sm">location_on</span>
                        <span class="hidden sm:inline ml-1">GPS & Navigation</span>
                    </button>
                    <button onclick="showGolferTab('rounds', event)" class="tab-button px-2 md:px-4">
                        <span class="material-symbols-outlined text-sm">history</span>
                        <span class="hidden sm:inline ml-1">Round History</span>
                    </button>
                </div>
            </div>
        </nav>

        <main class="max-w-7xl mx-auto px-6 lg:px-8 py-8">
            <!-- Overview Tab -->
            <div id="golfer-overview" class="tab-content active">
                <!-- Compact Welcome Section -->
                <div class="premium-gradient text-white rounded-lg p-3 mb-4 relative overflow-hidden">
                    <div class="relative z-10">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-lg font-bold mb-1">Welcome back, <span class="user-name-display">Golfer</span>!</h2>
                                <div class="flex items-center space-x-3 text-sm opacity-90">
                                    <div class="flex items-center space-x-1">
                                        <span class="material-symbols-outlined text-sm">emoji_events</span>
                                        <span>Premium</span>
                                    </div>
                                    <div class="flex items-center space-x-1">
                                        <span class="material-symbols-outlined text-sm">golf_course</span>
                                        <span class="home-club">Pattaya Golf Club</span>
                                    </div>
                                    <div class="flex items-center space-x-1 club-affiliation-container" style="display: none;">
                                        <span class="material-symbols-outlined text-sm">groups</span>
                                        <span class="club-affiliation">Society</span>
                                    </div>
                                    <div class="flex items-center space-x-1">
                                        <span class="material-symbols-outlined text-sm">calendar_today</span>
                                        <span>Since <span class="member-since">2024</span></span>
                                    </div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold user-handicap">18</div>
                                <div class="text-xs opacity-80">Handicap</div>
                            </div>
                        </div>
                    </div>
                    <div class="absolute top-0 right-0 w-16 h-16 bg-white opacity-10 rounded-full transform translate-x-8 -translate-y-8"></div>
                </div>

                <!-- Persistent Emergency Alerts -->
                <div id="golfer-emergency-alerts" class="persistent-emergency-alerts mb-4" style="display: none;">
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-2">
                                <span class="material-symbols-outlined text-red-600">emergency</span>
                                <h3 class="text-lg font-bold text-red-800">Active Emergency Alerts</h3>
                            </div>
                            <span id="golfer-alert-count" class="bg-red-600 text-white text-xs px-2 py-1 rounded-full font-medium">0</span>
                        </div>
                        <div id="golfer-alert-list" class="space-y-2">
                            <!-- Emergency alerts will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Quick Actions Grid -->
                <!-- Mobile: Horizontal scrolling container -->
                <div class="block md:hidden mobile-scroll-container mb-8">
                    <div class="flex space-x-4 overflow-x-auto pb-4 scrollbar-hide">
                        <button onclick="showGolferTab('booking', event)" class="flex-shrink-0 w-64 card-hover metric-card text-center group">
                            <div class="w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-primary-200 transition-colors">
                                <span class="material-symbols-outlined text-3xl text-primary-600">event</span>
                            </div>
                            <h3 class="font-bold text-gray-900 mb-2">Book Tee Time</h3>
                            <p class="text-sm text-gray-600">Reserve your next round</p>
                            <div class="mt-3 text-xs bg-primary-50 text-primary-700 px-3 py-1 rounded-full inline-block">
                                Available Now
                            </div>
                        </button>

                        <button onclick="showGolferTab('food', event)" class="flex-shrink-0 w-64 card-hover metric-card text-center group">
                            <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-orange-200 transition-colors">
                                <span class="material-symbols-outlined text-3xl text-orange-600">restaurant</span>
                            </div>
                            <h3 class="font-bold text-gray-900 mb-2">Order Food</h3>
                            <p class="text-sm text-gray-600">Delicious course dining</p>
                            <div class="mt-3 text-xs bg-orange-50 text-orange-700 px-3 py-1 rounded-full inline-block">
                                Kitchen Open
                            </div>
                        </button>

                        <button onclick="showGolferTab('gps', event)" class="flex-shrink-0 w-64 card-hover metric-card text-center group">
                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-blue-200 transition-colors">
                                <span class="material-symbols-outlined text-3xl text-blue-600">gps_fixed</span>
                            </div>
                            <h3 class="font-bold text-gray-900 mb-2">GPS Navigation</h3>
                            <p class="text-sm text-gray-600">Course mapping & distances</p>
                            <div class="mt-3 text-xs bg-blue-50 text-blue-700 px-3 py-1 rounded-full inline-block">
                                Active
                            </div>
                        </button>

                        <button onclick="showGolferTab('profile', event)" class="flex-shrink-0 w-64 card-hover metric-card text-center group">
                            <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-purple-200 transition-colors">
                                <span class="material-symbols-outlined text-3xl text-purple-600">person</span>
                            </div>
                            <h3 class="font-bold text-gray-900 mb-2">Profile & Stats</h3>
                            <p class="text-sm text-gray-600">View performance data</p>
                            <div class="mt-3 text-xs bg-purple-50 text-purple-700 px-3 py-1 rounded-full inline-block">
                                Updated
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Desktop: Grid layout -->
                <div class="hidden md:grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <button onclick="showGolferTab('booking', event)" class="card-hover metric-card text-center group">
                        <div class="w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-primary-200 transition-colors">
                            <span class="material-symbols-outlined text-3xl text-primary-600">event</span>
                        </div>
                        <h3 class="font-bold text-gray-900 mb-2">Book Tee Time</h3>
                        <p class="text-sm text-gray-600">Reserve your next round</p>
                        <div class="mt-3 text-xs bg-primary-50 text-primary-700 px-3 py-1 rounded-full inline-block">
                            Available Now
                        </div>
                    </button>

                    <button onclick="showGolferTab('food', event)" class="card-hover metric-card text-center group">
                        <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-orange-200 transition-colors">
                            <span class="material-symbols-outlined text-3xl text-orange-600">restaurant</span>
                        </div>
                        <h3 class="font-bold text-gray-900 mb-2">Order Food</h3>
                        <p class="text-sm text-gray-600">Course dining & beverages</p>
                        <div class="mt-3 text-xs bg-orange-50 text-orange-700 px-3 py-1 rounded-full inline-block">
                            Kitchen Open
                        </div>
                    </button>

                    <button onclick="showGolferTab('gps', event)" class="card-hover metric-card text-center group">
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-blue-200 transition-colors">
                            <span class="material-symbols-outlined text-3xl text-blue-600">location_on</span>
                        </div>
                        <h3 class="font-bold text-gray-900 mb-2">GPS Tracker</h3>
                        <p class="text-sm text-gray-600">Course navigation</p>
                        <div class="mt-3 text-xs bg-blue-50 text-blue-700 px-3 py-1 rounded-full inline-block">
                            Live Tracking
                        </div>
                    </button>

                    <button onclick="showGolferTab('stats', event)" class="card-hover metric-card text-center group">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-purple-200 transition-colors">
                            <span class="material-symbols-outlined text-3xl text-purple-600">analytics</span>
                        </div>
                        <h3 class="font-bold text-gray-900 mb-2">Statistics</h3>
                        <p class="text-sm text-gray-600">Performance tracking</p>
                        <div class="mt-3 text-xs bg-purple-50 text-purple-700 px-3 py-1 rounded-full inline-block">
                            47 Rounds
                        </div>
                    </button>
                </div>

                <!-- Featured Caddys - Golf Course Promotions -->
                <div class="metric-card mb-8">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-900">Featured Caddys & Courses</h3>
                        <button onclick="refreshPromotionalCaddys()" class="text-primary-600 hover:text-primary-700 text-sm font-medium">
                            <span class="material-symbols-outlined text-sm">refresh</span>
                            Refresh
                        </button>
                    </div>
                    <p class="text-gray-600 mb-6">Discover top-rated caddies and explore new golf courses</p>

                    <!-- Mobile: Horizontal scrolling container -->
                    <div class="block md:hidden mobile-scroll-container">
                        <div id="promotionalCaddysContainer" class="flex space-x-4 overflow-x-auto pb-4 scrollbar-hide">
                            <!-- Promotional caddies will be loaded here for mobile -->
                        </div>
                    </div>

                    <!-- Desktop: Grid layout -->
                    <div class="hidden md:grid md:grid-cols-2 lg:grid-cols-4 gap-4" id="promotionalCaddysDesktop">
                        <!-- Promotional caddies will be loaded here for desktop -->
                    </div>
                </div>

                <!-- Current Status Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Today's Tee Time -->
                    <div class="metric-card">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-900">Today's Tee Time</h3>
                        </div>
                        <div class="text-center py-8">
                            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="material-symbols-outlined text-gray-400 text-2xl">schedule</span>
                            </div>
                            <p class="text-gray-500 font-medium">No tee time booked today</p>
                            <p class="text-sm text-gray-400 mt-1">Book your next round to see it here</p>
                        </div>
                        <div class="mt-6">
                            <button class="btn-primary w-full" onclick="TabManager.showTab('golferDashboard', 'booking', event)">
                                <span class="material-symbols-outlined text-sm">add</span>
                                Book Tee Time
                            </button>
                        </div>
                    </div>

                    <!-- Live Course Status -->
                    <div class="metric-card">
                        <h3 class="text-xl font-bold text-gray-900 mb-6">Live Course Status</h3>
                        <div class="grid grid-cols-2 gap-6 mb-6">
                            <div class="text-center">
                                <div class="metric-value text-3xl" id="currentHole">7</div>
                                <div class="metric-label">Current Hole</div>
                            </div>
                            <div class="text-center">
                                <div class="metric-value text-3xl" id="distanceToPin">145</div>
                                <div class="metric-label">Yards to Pin</div>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <span class="material-symbols-outlined text-blue-600">thermostat</span>
                                    <span class="font-medium">Temperature</span>
                                </div>
                                <span class="font-bold text-gray-900">75¬∞F</span>
                            </div>
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <span class="material-symbols-outlined text-green-600">air</span>
                                    <span class="font-medium">Wind</span>
                                </div>
                                <span class="font-bold text-gray-900">5 mph NE</span>
                            </div>
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <span class="material-symbols-outlined text-yellow-500">wb_sunny</span>
                                    <span class="font-medium">Conditions</span>
                                </div>
                                <span class="font-bold text-gray-900">Sunny</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Overview -->
                <div class="metric-card">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-900">Performance Overview</h3>
                        <button onclick="showGolferTab('stats', event)" class="text-primary-600 hover:text-primary-700 font-medium text-sm">
                            View Details ‚Üí
                        </button>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                        <div class="text-center">
                            <div class="metric-value" id="bestScore">72</div>
                            <div class="metric-label">Best Score</div>
                            <div class="text-xs text-green-600 mt-1">Personal Record</div>
                        </div>
                        <div class="text-center">
                            <div class="metric-value" id="avgScore">76.4</div>
                            <div class="metric-label">Average Score</div>
                            <div class="text-xs text-blue-600 mt-1">Last 10 rounds</div>
                        </div>
                        <div class="text-center">
                            <div class="metric-value" id="totalRounds">0</div>
                            <div class="metric-label">Rounds Played</div>
                            <div class="text-xs text-purple-600 mt-1">This year</div>
                        </div>
                        <div class="text-center">
                            <div class="metric-value">3</div>
                            <div class="metric-label">Eagles</div>
                            <div class="text-xs text-yellow-600 mt-1">This month</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Booking Tab -->
            <div id="golfer-booking" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Booking Form -->
                    <div class="lg:col-span-2">
                        <div class="metric-card">
                            <h3 class="text-2xl font-bold text-gray-900 mb-6">Book Your Tee Time</h3>

                            <!-- Golf Course Search & Selection -->
                            <div class="space-y-6">
                                <div>
                                    <label class="form-label">Search & Select Golf Course</label>
                                    <div class="relative mb-4">
                                        <input
                                            type="text"
                                            id="courseSearchInput"
                                            placeholder="Search courses (e.g., Pattana, Championship, Executive...)"
                                            class="form-input pl-10"
                                            oninput="filterCourses(this.value)"
                                        >
                                        <span class="absolute left-3 top-1/2 transform -translate-y-1/2 material-symbols-outlined text-gray-400">search</span>
                                    </div>

                                    <!-- Mobile: Horizontal scrolling container -->
                                    <div class="block md:hidden mobile-scroll-container">
                                        <div id="courseGridMobile" class="flex space-x-4 overflow-x-auto pb-4 scrollbar-hide">
                                            <!-- Courses will be loaded here for mobile -->
                                        </div>
                                    </div>

                                    <!-- Desktop: Grid layout -->
                                    <div id="courseGrid" class="hidden md:grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        <!-- Courses will be populated here for desktop -->
                                    </div>

                                    <div id="selectedCourseInfo" class="mt-4 p-4 bg-primary-50 border border-primary-200 rounded-lg hidden">
                                        <div class="flex items-center space-x-2">
                                            <span class="material-symbols-outlined text-primary-600">golf_course</span>
                                            <span class="font-semibold text-primary-900">Selected: </span>
                                            <span id="selectedCourseName" class="text-primary-800"></span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Date & Time Selection -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="form-label">Select Date</label>
                                        <input type="date" id="bookingDate" class="form-input" min="">
                                    </div>
                                    <div>
                                        <label class="form-label">Preferred Time</label>
                                        <select id="bookingTime" class="form-input">
                                            <option value="">Choose time...</option>
                                            <option value="06:00">6:00 AM</option>
                                            <option value="06:30">6:30 AM</option>
                                            <option value="07:00">7:00 AM</option>
                                            <option value="07:30">7:30 AM</option>
                                            <option value="08:00">8:00 AM</option>
                                            <option value="08:30">8:30 AM</option>
                                            <option value="09:00">9:00 AM</option>
                                            <option value="09:30">9:30 AM</option>
                                            <option value="10:00">10:00 AM</option>
                                            <option value="10:30">10:30 AM</option>
                                            <option value="11:00">11:00 AM</option>
                                            <option value="11:30">11:30 AM</option>
                                            <option value="12:00">12:00 PM</option>
                                            <option value="12:30">12:30 PM</option>
                                            <option value="13:00">1:00 PM</option>
                                            <option value="13:30">1:30 PM</option>
                                            <option value="14:00">2:00 PM</option>
                                            <option value="14:30">2:30 PM</option>
                                            <option value="15:00">3:00 PM</option>
                                            <option value="15:30">3:30 PM</option>
                                            <option value="16:00">4:00 PM</option>
                                            <option value="16:30">4:30 PM</option>
                                            <option value="17:00">5:00 PM</option>
                                            <option value="17:30">5:30 PM</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Players & Caddy -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="form-label">Number of Players</label>
                                        <select id="playerCount" class="form-input">
                                            <option value="1">1 Player</option>
                                            <option value="2">2 Players</option>
                                            <option value="3">3 Players</option>
                                            <option value="4">4 Players</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Professional Caddy Selection -->
                                <div class="border-t pt-6" id="caddieSelectionSection" style="display: none;">
                                    <div class="flex items-center justify-between mb-4">
                                        <h4 class="font-bold text-gray-900">Select Professional Caddys</h4>
                                        <div class="text-sm text-gray-600">
                                            <span id="availableCaddyCount">0</span> available ‚Ä¢
                                            <span id="waitlistCaddyCount">0</span> on waitlist
                                        </div>
                                    </div>

                                    <!-- Caddy Search -->
                                    <div class="relative mb-4">
                                        <input
                                            type="text"
                                            id="caddieSearchInput"
                                            placeholder="Search by caddie name, number, or specialty..."
                                            class="form-input pl-10"
                                            oninput="filterCaddys(this.value)"
                                        >
                                        <span class="absolute left-3 top-1/2 transform -translate-y-1/2 material-symbols-outlined text-gray-400">search</span>
                                    </div>

                                    <!-- Mobile: Horizontal scrolling caddies -->
                                    <div class="block md:hidden mobile-scroll-container">
                                        <div id="caddieGridMobile" class="flex space-x-4 overflow-x-auto pb-4 scrollbar-hide">
                                            <!-- Caddys will be populated here for mobile -->
                                            <div class="flex-shrink-0 w-72 text-center text-gray-600 py-8">
                                                <span class="material-symbols-outlined text-4xl text-gray-400 mb-2">person_search</span>
                                                <p class="text-sm">Select a golf course to see available caddies</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Desktop: Grid layout -->
                                    <div id="caddieGrid" class="hidden md:grid md:grid-cols-2 gap-4">
                                        <!-- Caddys will be populated here based on selected course -->
                                        <div class="col-span-2 text-center text-gray-600 py-8">
                                            <span class="material-symbols-outlined text-4xl text-gray-400 mb-2">person_search</span>
                                            <p>Select a golf course to see available caddies</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Premium Services -->
                                <div class="border-t pt-6">
                                    <h4 class="font-bold text-gray-900 mb-4">Premium Services</h4>

                                    <!-- Mobile: Horizontal scrolling container -->
                                    <div class="block md:hidden mobile-scroll-container">
                                        <div class="flex space-x-4 overflow-x-auto pb-4 scrollbar-hide">
                                            <div class="flex-shrink-0 w-72 service-card p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-primary-500 transition-colors" data-service="cart" onclick="toggleServiceNew('cart')">
                                                <div class="flex items-center justify-between mb-2">
                                                    <div class="flex items-center">
                                                        <span class="text-2xl mr-3">üöó</span>
                                                        <h5 class="font-bold text-gray-900">Golf Cart Rental</h5>
                                                    </div>
                                                    <span class="text-primary-600 font-bold">‡∏ø600</span>
                                                </div>
                                                <p class="text-sm text-gray-600">Electric golf cart for 2 players</p>
                                            </div>

                                            <div class="flex-shrink-0 w-72 service-card p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-primary-500 transition-colors" data-service="clubs" onclick="toggleServiceNew('clubs')">
                                                <div class="flex items-center justify-between mb-2">
                                                    <div class="flex items-center">
                                                        <span class="text-2xl mr-3">‚õ≥</span>
                                                        <h5 class="font-bold text-gray-900">Club Rental Set</h5>
                                                    </div>
                                                    <span class="text-primary-600 font-bold">‡∏ø400</span>
                                                </div>
                                                <p class="text-sm text-gray-600">Premium club set with bag</p>
                                            </div>

                                            <div class="flex-shrink-0 w-72 service-card p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-primary-500 transition-colors" data-service="shoes" onclick="toggleServiceNew('shoes')">
                                                <div class="flex items-center justify-between mb-2">
                                                    <div class="flex items-center">
                                                        <span class="text-2xl mr-3">üëü</span>
                                                        <h5 class="font-bold text-gray-900">Golf Shoes Rental</h5>
                                                    </div>
                                                    <span class="text-primary-600 font-bold">‡∏ø200</span>
                                                </div>
                                                <p class="text-sm text-gray-600">Professional golf shoes</p>
                                            </div>

                                            <div class="flex-shrink-0 w-72 service-card p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-primary-500 transition-colors" data-service="insurance" onclick="toggleServiceNew('insurance')">
                                                <div class="flex items-center justify-between mb-2">
                                                    <div class="flex items-center">
                                                        <span class="text-2xl mr-3">üõ°Ô∏è</span>
                                                        <h5 class="font-bold text-gray-900">Play Insurance</h5>
                                                    </div>
                                                    <span class="text-primary-600 font-bold">‡∏ø150</span>
                                                </div>
                                                <p class="text-sm text-gray-600">Covers medical & equipment</p>
                                            </div>

                                            <div class="flex-shrink-0 w-72 service-card p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-primary-500 transition-colors" data-service="lesson" onclick="toggleServiceNew('lesson')">
                                                <div class="flex items-center justify-between mb-2">
                                                    <div class="flex items-center">
                                                        <span class="text-2xl mr-3">üéØ</span>
                                                        <h5 class="font-bold text-gray-900">Pro Lesson (30min)</h5>
                                                    </div>
                                                    <span class="text-primary-600 font-bold">‡∏ø800</span>
                                                </div>
                                                <p class="text-sm text-gray-600">One-on-one instruction</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Desktop: Grid layout -->
                                    <div class="hidden md:grid md:grid-cols-2 gap-4">
                                        <div class="service-card p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-primary-500 transition-colors" data-service="cart" onclick="toggleServiceNew('cart')">
                                            <div class="flex items-center justify-between mb-2">
                                                <div class="flex items-center">
                                                    <span class="text-2xl mr-3">üöó</span>
                                                    <h5 class="font-bold text-gray-900">Golf Cart Rental</h5>
                                                </div>
                                                <span class="text-primary-600 font-bold">‡∏ø600</span>
                                            </div>
                                            <p class="text-sm text-gray-600">Electric golf cart for 2 players</p>
                                        </div>

                                        <div class="service-card p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-primary-500 transition-colors" data-service="clubs" onclick="toggleServiceNew('clubs')">
                                            <div class="flex items-center justify-between mb-2">
                                                <div class="flex items-center">
                                                    <span class="text-2xl mr-3">‚õ≥</span>
                                                    <h5 class="font-bold text-gray-900">Club Rental Set</h5>
                                                </div>
                                                <span class="text-primary-600 font-bold">‡∏ø400</span>
                                            </div>
                                            <p class="text-sm text-gray-600">Premium club set with bag</p>
                                        </div>

                                        <div class="service-card p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-primary-500 transition-colors" data-service="shoes" onclick="toggleServiceNew('shoes')">
                                            <div class="flex items-center justify-between mb-2">
                                                <div class="flex items-center">
                                                    <span class="text-2xl mr-3">üëü</span>
                                                    <h5 class="font-bold text-gray-900">Golf Shoes Rental</h5>
                                                </div>
                                                <span class="text-primary-600 font-bold">‡∏ø200</span>
                                            </div>
                                            <p class="text-sm text-gray-600">Professional golf shoes</p>
                                        </div>

                                        <div class="service-card p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-primary-500 transition-colors" data-service="insurance" onclick="toggleServiceNew('insurance')">
                                            <div class="flex items-center justify-between mb-2">
                                                <div class="flex items-center">
                                                    <span class="text-2xl mr-3">üõ°Ô∏è</span>
                                                    <h5 class="font-bold text-gray-900">Play Insurance</h5>
                                                </div>
                                                <span class="text-primary-600 font-bold">‡∏ø150</span>
                                            </div>
                                            <p class="text-sm text-gray-600">Covers medical & equipment</p>
                                        </div>

                                        <div class="service-card p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-primary-500 transition-colors" data-service="lesson" onclick="toggleServiceNew('lesson')">
                                            <div class="flex items-center justify-between mb-2">
                                                <div class="flex items-center">
                                                    <span class="text-2xl mr-3">üéØ</span>
                                                    <h5 class="font-bold text-gray-900">Pro Lesson (30min)</h5>
                                                </div>
                                                <span class="text-primary-600 font-bold">‡∏ø800</span>
                                            </div>
                                            <p class="text-sm text-gray-600">One-on-one instruction</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Payment Method -->
                                <div class="border-t pt-6">
                                    <h4 class="font-bold text-gray-900 mb-4">Payment Method</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="payment-option p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-primary-500 transition-colors" data-payment="credit" onclick="selectPaymentMethod('credit')">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center">
                                                    <span class="material-symbols-outlined text-2xl mr-3 text-blue-600">credit_card</span>
                                                    <div>
                                                        <h5 class="font-bold text-gray-900">Credit/Debit Card</h5>
                                                        <p class="text-sm text-gray-600">Visa, Mastercard, JCB</p>
                                                    </div>
                                                </div>
                                                <span class="material-symbols-outlined text-green-600">verified</span>
                                            </div>
                                        </div>

                                        <div class="payment-option p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-primary-500 transition-colors" data-payment="promptpay" onclick="selectPaymentMethod('promptpay')">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center">
                                                    <span class="material-symbols-outlined text-2xl mr-3 text-purple-600">qr_code</span>
                                                    <div>
                                                        <h5 class="font-bold text-gray-900">PromptPay</h5>
                                                        <p class="text-sm text-gray-600">QR Code Payment</p>
                                                    </div>
                                                </div>
                                                <span class="material-symbols-outlined text-green-600">verified</span>
                                            </div>
                                        </div>

                                        <div class="payment-option p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-primary-500 transition-colors" data-payment="cash" onclick="selectPaymentMethod('cash')">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center">
                                                    <span class="material-symbols-outlined text-2xl mr-3 text-green-600">payments</span>
                                                    <div>
                                                        <h5 class="font-bold text-gray-900">Cash</h5>
                                                        <p class="text-sm text-gray-600">Pay at Pro Shop</p>
                                                    </div>
                                                </div>
                                                <span class="material-symbols-outlined text-green-600">verified</span>
                                            </div>
                                        </div>

                                        <div class="payment-option p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-primary-500 transition-colors" data-payment="linepay" onclick="selectPaymentMethod('linepay')">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center">
                                                    <span class="material-symbols-outlined text-2xl mr-3 text-green-500">account_balance_wallet</span>
                                                    <div>
                                                        <h5 class="font-bold text-gray-900">LINE Pay</h5>
                                                        <p class="text-sm text-gray-600">Mobile Wallet</p>
                                                    </div>
                                                </div>
                                                <span class="material-symbols-outlined text-green-600">verified</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex space-x-4 pt-6 border-t">
                                    <button onclick="cancelBooking()" class="btn-secondary flex-1">
                                        <span class="material-symbols-outlined text-sm">cancel</span>
                                        Cancel
                                    </button>
                                    <button onclick="confirmBooking()" class="btn-primary flex-1">
                                        <span class="material-symbols-outlined text-sm">check</span>
                                        Confirm Booking
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Booking Cart -->
                    <div class="lg:col-span-1">
                        <div class="sticky top-8">
                            <div class="metric-card">
                                <div class="flex items-center justify-between mb-4">
                                    <h4 class="font-bold text-gray-900">Booking Cart</h4>
                                    <span class="bg-primary-100 text-primary-800 text-xs px-2 py-1 rounded-full" id="cartItemCount">0</span>
                                </div>

                                <!-- Cart Items Container -->
                                <div id="bookingCartContainer" class="space-y-3 max-h-96 overflow-y-auto">
                                    <div class="text-center text-gray-600 py-8">
                                        <span class="material-symbols-outlined text-4xl text-gray-400 mb-2">shopping_cart</span>
                                        <p class="text-sm">Your cart is empty</p>
                                        <p class="text-xs">Select a course and caddies to start</p>
                                    </div>
                                </div>

                                <!-- Cart Summary -->
                                <div class="mt-6 space-y-3 border-t pt-4">
                                    <div class="flex justify-between text-sm">
                                        <span>Course Fee:</span>
                                        <span id="cartCourseTotal">‡∏ø0</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span>Caddy Services:</span>
                                        <span id="cartCaddyTotal">‡∏ø0</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span>Premium Services:</span>
                                        <span id="cartServicesTotal">‡∏ø0</span>
                                    </div>
                                    <div class="flex justify-between text-sm text-gray-500">
                                        <span>Service Charge (10%):</span>
                                        <span id="cartServiceCharge">‡∏ø0</span>
                                    </div>
                                    <div class="border-t pt-3">
                                        <div class="flex justify-between items-center">
                                            <span class="font-bold text-gray-900">Total:</span>
                                            <span id="cartGrandTotal" class="font-bold text-xl text-primary-600">‡∏ø0</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Action Buttons -->
                                <div class="mt-6 space-y-3">
                                    <button onclick="confirmBooking()" id="confirmBookingBtn" class="w-full bg-primary-600 text-white py-3 px-4 rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                        <span class="material-symbols-outlined text-sm mr-2">check</span>
                                        Confirm Booking
                                    </button>
                                    <button onclick="clearBookingCart()" class="w-full bg-gray-100 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-200 transition-colors">
                                        <span class="material-symbols-outlined text-sm mr-2">clear</span>
                                        Clear Cart
                                    </button>
                                </div>
                            </div>

                            <!-- Recent Bookings -->
                            <div class="metric-card mt-6">
                                <h4 class="font-bold text-gray-900 mb-4">Your Recent Bookings</h4>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div>
                                            <p class="font-medium text-sm">Championship</p>
                                            <p class="text-xs text-gray-600">Today 2:00 PM</p>
                                        </div>
                                        <span class="status-badge status-confirmed text-xs">Confirmed</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div>
                                            <p class="font-medium text-sm">Executive</p>
                                            <p class="text-xs text-gray-600">Yesterday 9:00 AM</p>
                                        </div>
                                        <span class="text-xs text-gray-500">Completed</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Schedule Tab -->
            <div id="golfer-schedule" class="tab-content">
                <div class="space-y-8">
                    <!-- Schedule Header -->
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-900">My Schedule</h2>
                            <p class="text-gray-600 mt-2">Manage your tee times, caddie bookings, and waitlists</p>
                        </div>
                        <button onclick="refreshSchedule()" class="bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 transition-colors">
                            <span class="material-symbols-outlined text-sm mr-2">refresh</span>
                            Refresh
                        </button>
                    </div>

                    <!-- Quick Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="metric-card text-center">
                            <div class="text-3xl font-bold text-blue-600" id="upcomingEventsCount">0</div>
                            <div class="text-sm text-gray-600">Upcoming Events</div>
                        </div>
                        <div class="metric-card text-center">
                            <div class="text-3xl font-bold text-green-600" id="confirmedCaddysCount">0</div>
                            <div class="text-sm text-gray-600">Confirmed Caddys</div>
                        </div>
                        <div class="metric-card text-center">
                            <div class="text-3xl font-bold text-orange-600" id="waitlistCount">0</div>
                            <div class="text-sm text-gray-600">Waitlists</div>
                        </div>
                        <div class="metric-card text-center">
                            <div class="text-3xl font-bold text-purple-600" id="thisWeekCount">0</div>
                            <div class="text-sm text-gray-600">This Week</div>
                        </div>
                    </div>

                    <!-- Filter Tabs -->
                    <div class="bg-white rounded-xl p-6 shadow-sm border">
                        <div class="flex space-x-4 mb-6">
                            <button onclick="filterSchedule('all')" class="schedule-filter-btn active" data-filter="all">
                                All Events
                            </button>
                            <button onclick="filterSchedule('upcoming')" class="schedule-filter-btn" data-filter="upcoming">
                                Upcoming
                            </button>
                            <button onclick="filterSchedule('today')" class="schedule-filter-btn" data-filter="today">
                                Today
                            </button>
                            <button onclick="filterSchedule('caddies')" class="schedule-filter-btn" data-filter="caddies">
                                Caddy Bookings
                            </button>
                            <button onclick="filterSchedule('waitlist')" class="schedule-filter-btn" data-filter="waitlist">
                                Waitlists
                            </button>
                        </div>

                        <!-- Schedule List -->
                        <div id="scheduleList" class="space-y-4">
                            <!-- Schedule items will be loaded here -->
                        </div>

                        <!-- Empty State -->
                        <div id="emptySchedule" class="text-center py-12 hidden">
                            <div class="text-6xl mb-4">üìÖ</div>
                            <h3 class="text-xl font-semibold text-gray-900 mb-2">No events scheduled</h3>
                            <p class="text-gray-600 mb-6">Start by booking a tee time or selecting a caddie</p>
                            <div class="flex justify-center space-x-4">
                                <button onclick="showGolferTab('booking', null)" class="bg-primary-600 text-white px-6 py-3 rounded-lg hover:bg-primary-700">
                                    Book Tee Time
                                </button>
                                <button onclick="showGolferTab('overview', null)" class="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-300">
                                    Browse Caddys
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Food Ordering Tab -->
            <div id="golfer-food" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Menu Categories -->
                    <div class="lg:col-span-2 space-y-8">
                        <!-- Appetizers & Starters -->
                        <section>
                            <h3 class="text-xl font-bold text-gray-900 mb-6">Appetizers & Starters</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="menu-item-card metric-card hover:shadow-lg transition-shadow">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                                <span class="text-2xl">ü•ó</span>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-900">Caesar Salad</h4>
                                                <p class="text-sm text-gray-600">Fresh romaine, parmesan, croutons</p>
                                                <p class="text-primary-600 font-bold">‡∏ø280</p>
                                            </div>
                                        </div>
                                        <button onclick="addToFoodCart(1)" class="btn-primary">
                                            <span class="material-symbols-outlined text-sm">add</span>
                                        </button>
                                    </div>
                                </div>

                                <div class="menu-item-card metric-card hover:shadow-lg transition-shadow">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                                                <span class="text-2xl">üç§</span>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-900">Shrimp Cocktail</h4>
                                                <p class="text-sm text-gray-600">Premium jumbo shrimp</p>
                                                <p class="text-primary-600 font-bold">‡∏ø420</p>
                                            </div>
                                        </div>
                                        <button onclick="addToFoodCart(2)" class="btn-primary">
                                            <span class="material-symbols-outlined text-sm">add</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Main Courses -->
                        <section>
                            <h3 class="text-xl font-bold text-gray-900 mb-6">Main Courses</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="menu-item-card metric-card hover:shadow-lg transition-shadow">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                                                <span class="text-2xl">ü•©</span>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-900">Wagyu Steak</h4>
                                                <p class="text-sm text-gray-600">Grade A5 with seasonal vegetables</p>
                                                <p class="text-primary-600 font-bold">‡∏ø1,680</p>
                                            </div>
                                        </div>
                                        <button onclick="addToFoodCart(3)" class="btn-primary">
                                            <span class="material-symbols-outlined text-sm">add</span>
                                        </button>
                                    </div>
                                </div>

                                <div class="menu-item-card metric-card hover:shadow-lg transition-shadow">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                                <span class="text-2xl">üêü</span>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-900">Grilled Salmon</h4>
                                                <p class="text-sm text-gray-600">Atlantic salmon with herbs</p>
                                                <p class="text-primary-600 font-bold">‡∏ø680</p>
                                            </div>
                                        </div>
                                        <button onclick="addToFoodCart(4)" class="btn-primary">
                                            <span class="material-symbols-outlined text-sm">add</span>
                                        </button>
                                    </div>
                                </div>

                                <div class="menu-item-card metric-card hover:shadow-lg transition-shadow">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                                                <span class="text-2xl">ü•™</span>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-900">Club Sandwich</h4>
                                                <p class="text-sm text-gray-600">Triple-decker with fries</p>
                                                <p class="text-primary-600 font-bold">‡∏ø380</p>
                                            </div>
                                        </div>
                                        <button onclick="addToFoodCart(5)" class="btn-primary">
                                            <span class="material-symbols-outlined text-sm">add</span>
                                        </button>
                                    </div>
                                </div>

                                <div class="menu-item-card metric-card hover:shadow-lg transition-shadow">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                                <span class="text-2xl">üçõ</span>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-900">Thai Green Curry</h4>
                                                <p class="text-sm text-gray-600">With jasmine rice</p>
                                                <p class="text-primary-600 font-bold">‡∏ø320</p>
                                            </div>
                                        </div>
                                        <button onclick="addToFoodCart(6)" class="btn-primary">
                                            <span class="material-symbols-outlined text-sm">add</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Beverages -->
                        <section>
                            <h3 class="text-xl font-bold text-gray-900 mb-6">Beverages</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="menu-item-card metric-card hover:shadow-lg transition-shadow">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                                <span class="text-2xl">üçä</span>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-900">Fresh Orange Juice</h4>
                                                <p class="text-sm text-gray-600">Freshly squeezed</p>
                                                <p class="text-primary-600 font-bold">‡∏ø120</p>
                                            </div>
                                        </div>
                                        <button onclick="addToFoodCart(7)" class="btn-primary">
                                            <span class="material-symbols-outlined text-sm">add</span>
                                        </button>
                                    </div>
                                </div>

                                <div class="menu-item-card metric-card hover:shadow-lg transition-shadow">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-brown-100 rounded-lg flex items-center justify-center">
                                                <span class="text-2xl">‚òï</span>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-900">Premium Coffee</h4>
                                                <p class="text-sm text-gray-600">Single origin arabica</p>
                                                <p class="text-primary-600 font-bold">‡∏ø150</p>
                                            </div>
                                        </div>
                                        <button onclick="addToFoodCart(8)" class="btn-primary">
                                            <span class="material-symbols-outlined text-sm">add</span>
                                        </button>
                                    </div>
                                </div>

                                <div class="menu-item-card metric-card hover:shadow-lg transition-shadow">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                                <span class="text-2xl">üíß</span>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-900">Sparkling Water</h4>
                                                <p class="text-sm text-gray-600">San Pellegrino</p>
                                                <p class="text-primary-600 font-bold">‡∏ø80</p>
                                            </div>
                                        </div>
                                        <button onclick="addToFoodCart(9)" class="btn-primary">
                                            <span class="material-symbols-outlined text-sm">add</span>
                                        </button>
                                    </div>
                                </div>

                                <div class="menu-item-card metric-card hover:shadow-lg transition-shadow">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                                <span class="text-2xl">üç∑</span>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-900">House Wine</h4>
                                                <p class="text-sm text-gray-600">Red or White glass</p>
                                                <p class="text-primary-600 font-bold">‡∏ø280</p>
                                            </div>
                                        </div>
                                        <button onclick="addToFoodCart(10)" class="btn-primary">
                                            <span class="material-symbols-outlined text-sm">add</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Heineken Small -->
                                <div class="menu-item-card metric-card hover:shadow-lg transition-shadow">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                                <span class="text-2xl">üç∫</span>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-900">Heineken Small</h4>
                                                <p class="text-sm text-gray-600">Premium Dutch beer (330ml)</p>
                                                <p class="text-primary-600 font-bold">‡∏ø120</p>
                                            </div>
                                        </div>
                                        <button onclick="addToFoodCart(19)" class="btn-primary">
                                            <span class="material-symbols-outlined text-sm">add</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Heineken Large -->
                                <div class="menu-item-card metric-card hover:shadow-lg transition-shadow">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                                <span class="text-2xl">üç∫</span>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-900">Heineken Large</h4>
                                                <p class="text-sm text-gray-600">Premium Dutch beer (640ml)</p>
                                                <p class="text-primary-600 font-bold">‡∏ø180</p>
                                            </div>
                                        </div>
                                        <button onclick="addToFoodCart(20)" class="btn-primary">
                                            <span class="material-symbols-outlined text-sm">add</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Chang Beer Small -->
                                <div class="menu-item-card metric-card hover:shadow-lg transition-shadow">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                                                <span class="text-2xl">üç∫</span>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-900">Chang Beer Small</h4>
                                                <p class="text-sm text-gray-600">Local Thai beer (330ml)</p>
                                                <p class="text-primary-600 font-bold">‡∏ø100</p>
                                            </div>
                                        </div>
                                        <button onclick="addToFoodCart(21)" class="btn-primary">
                                            <span class="material-symbols-outlined text-sm">add</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Chang Beer Large -->
                                <div class="menu-item-card metric-card hover:shadow-lg transition-shadow">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                                                <span class="text-2xl">üç∫</span>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-900">Chang Beer Large</h4>
                                                <p class="text-sm text-gray-600">Local Thai beer (640ml)</p>
                                                <p class="text-primary-600 font-bold">‡∏ø150</p>
                                            </div>
                                        </div>
                                        <button onclick="addToFoodCart(22)" class="btn-primary">
                                            <span class="material-symbols-outlined text-sm">add</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Singha Beer Small -->
                                <div class="menu-item-card metric-card hover:shadow-lg transition-shadow">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                                <span class="text-2xl">üç∫</span>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-900">Singha Beer Small</h4>
                                                <p class="text-sm text-gray-600">Classic Thai beer (330ml)</p>
                                                <p class="text-primary-600 font-bold">‡∏ø110</p>
                                            </div>
                                        </div>
                                        <button onclick="addToFoodCart(23)" class="btn-primary">
                                            <span class="material-symbols-outlined text-sm">add</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Singha Beer Large -->
                                <div class="menu-item-card metric-card hover:shadow-lg transition-shadow">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                                <span class="text-2xl">üç∫</span>
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-900">Singha Beer Large</h4>
                                                <p class="text-sm text-gray-600">Classic Thai beer (640ml)</p>
                                                <p class="text-primary-600 font-bold">‡∏ø160</p>
                                            </div>
                                        </div>
                                        <button onclick="addToFoodCart(24)" class="btn-primary">
                                            <span class="material-symbols-outlined text-sm">add</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>

                    <!-- Cart Sidebar -->
                    <div class="lg:col-span-1">
                        <div class="sticky top-8">
                            <div class="metric-card">
                                <div class="flex items-center justify-between mb-4">
                                    <h4 class="font-bold text-gray-900">Your Order</h4>
                                    <span id="cartItemCount" class="bg-primary-600 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center">0</span>
                                </div>
                                <div id="foodCartContainer" class="space-y-3 mb-6 max-h-64 overflow-y-auto">
                                    <p class="text-gray-600 text-sm text-center py-8">Your cart is empty</p>
                                </div>

                                <div class="border-t pt-4">
                                    <div class="flex justify-between items-center mb-4">
                                        <span class="font-bold text-gray-900">Subtotal:</span>
                                        <span id="cartSubtotal" class="font-bold text-xl text-primary-600">‡∏ø0</span>
                                    </div>
                                    <div class="flex justify-between items-center mb-4 text-sm">
                                        <span class="text-gray-600">Service charge (10%):</span>
                                        <span id="serviceCharge" class="text-gray-600">‡∏ø0</span>
                                    </div>
                                    <div class="flex justify-between items-center mb-6 border-t pt-2">
                                        <span class="font-bold text-gray-900">Total:</span>
                                        <span id="cartTotal" class="font-bold text-xl text-primary-600">‡∏ø0</span>
                                    </div>

                                    <button onclick="placeOrder()" id="placeOrderBtn" class="btn-primary w-full justify-center" disabled>
                                        <span class="material-symbols-outlined">shopping_cart_checkout</span>
                                        Place Order
                                    </button>
                                </div>

                                <div class="mt-4 text-xs text-gray-500 text-center">
                                    <p>Order will be delivered to your table</p>
                                    <p>Estimated delivery: 25-35 minutes</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Order Status Tab -->
            <div id="golfer-status" class="tab-content">
                <div class="space-y-8">
                    <!-- Active Orders -->
                    <div class="metric-card">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center">
                                <h3 class="text-2xl font-bold text-gray-900 mr-3">Active Orders</h3>
                                <span class="bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full" id="activeOrdersBadge" style="display: none;">0</span>
                            </div>
                            <span class="text-sm text-gray-500" id="activeOrdersCount">0 active orders</span>
                        </div>
                        <div id="activeOrdersList" class="space-y-4">
                            <div class="text-center py-8 text-gray-500">
                                <span class="material-symbols-outlined text-4xl mb-2 opacity-50">receipt_long</span>
                                <p>No active orders</p>
                                <button onclick="showGolferTab('food', event)" class="mt-4 bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700">
                                    Order Food & Drinks
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Order History -->
                    <div class="metric-card">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center">
                                <h3 class="text-xl font-bold text-gray-900 mr-3">Recent Orders</h3>
                                <span class="bg-blue-500 text-white text-xs font-bold px-2 py-1 rounded-full" id="orderHistoryBadge" style="display: none;">0</span>
                            </div>
                            <button onclick="clearOrderHistory()" class="text-sm text-red-600 hover:text-red-700">
                                Clear History
                            </button>
                        </div>
                        <div id="orderHistoryList" class="space-y-4">
                            <div class="text-center py-8 text-gray-500">
                                <span class="material-symbols-outlined text-4xl mb-2 opacity-50">history</span>
                                <p>No order history</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <button onclick="showGolferTab('food', event)" class="metric-card text-center group hover:bg-primary-50">
                            <div class="w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-primary-200 transition-colors">
                                <span class="material-symbols-outlined text-3xl text-primary-600">restaurant</span>
                            </div>
                            <h4 class="font-semibold text-gray-900 mb-2">Order Food</h4>
                            <p class="text-sm text-gray-600">Browse menu & place orders</p>
                        </button>

                        <button onclick="refreshOrderStatus()" class="metric-card text-center group hover:bg-blue-50">
                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-blue-200 transition-colors">
                                <span class="material-symbols-outlined text-3xl text-blue-600">refresh</span>
                            </div>
                            <h4 class="font-semibold text-gray-900 mb-2">Refresh Status</h4>
                            <p class="text-sm text-gray-600">Update order tracking</p>
                        </button>

                        <button onclick="contactKitchen()" class="metric-card text-center group hover:bg-orange-50">
                            <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-orange-200 transition-colors">
                                <span class="material-symbols-outlined text-3xl text-orange-600">call</span>
                            </div>
                            <h4 class="font-semibold text-gray-900 mb-2">Contact Kitchen</h4>
                            <p class="text-sm text-gray-600">Call about your order</p>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Statistics Tab -->
            <div id="golfer-stats" class="tab-content">
                <div class="space-y-8">
                    <!-- Performance Summary -->
                    <div class="metric-card">
                        <h3 class="text-2xl font-bold text-gray-900 mb-6">Performance Summary</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
                            <div class="text-center">
                                <div class="metric-value user-handicap">18</div>
                                <div class="metric-label">Current Handicap</div>
                                <div class="text-xs text-green-600 mt-1">
                                    <span class="material-symbols-outlined text-xs">trending_down</span>
                                    Improving
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="metric-value">76.4</div>
                                <div class="metric-label">Average Score</div>
                                <div class="text-xs text-blue-600 mt-1">Last 10 rounds</div>
                            </div>
                            <div class="text-center">
                                <div class="metric-value">72</div>
                                <div class="metric-label">Best Score</div>
                                <div class="text-xs text-purple-600 mt-1">Personal best</div>
                            </div>
                            <div class="text-center">
                                <div class="metric-value">0</div>
                                <div class="metric-label">Rounds Played</div>
                                <div class="text-xs text-orange-600 mt-1">This year</div>
                            </div>
                        </div>

                        <!-- Personal Info -->
                        <div class="mt-6 p-4 bg-gradient-to-r from-blue-50 to-green-50 rounded-lg">
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                <div class="text-center">
                                    <div class="text-sm font-medium text-gray-600">Experience</div>
                                    <div class="experience-level font-semibold text-blue-600">Intermediate</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-sm font-medium text-gray-600">Home Club</div>
                                    <div class="home-club font-semibold text-green-600">Pattaya Golf Club</div>
                                </div>
                                <div class="text-center club-affiliation-stats-container" style="display: none;">
                                    <div class="text-sm font-medium text-gray-600">Society</div>
                                    <div class="club-affiliation font-semibold text-blue-600">Society Name</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-sm font-medium text-gray-600">Member Since</div>
                                    <div class="member-since font-semibold text-purple-600">2024</div>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Rounds -->
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="font-bold text-gray-900">Recent Rounds</h4>
                            <button onclick="showAddScoreModal()" class="btn-primary">
                                <span class="material-symbols-outlined text-sm">add</span>
                                Add Score
                            </button>
                        </div>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center">
                                        <span class="material-symbols-outlined text-primary-600">golf_course</span>
                                    </div>
                                    <div>
                                        <p class="font-semibold text-gray-900">Championship Course</p>
                                        <p class="text-sm text-gray-600">Yesterday ‚Ä¢ 18 holes</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="font-bold text-2xl text-primary-600">74</div>
                                    <div class="text-xs text-green-600">+2 Par</div>
                                </div>
                            </div>

                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                                        <span class="material-symbols-outlined text-blue-600">golf_course</span>
                                    </div>
                                    <div>
                                        <p class="font-semibold text-gray-900">Executive Course</p>
                                        <p class="text-sm text-gray-600">3 days ago ‚Ä¢ 18 holes</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="font-bold text-2xl text-primary-600">72</div>
                                    <div class="text-xs text-yellow-600">Par ‚Ä¢ Personal Best!</div>
                                </div>
                            </div>

                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center">
                                        <span class="material-symbols-outlined text-orange-600">golf_course</span>
                                    </div>
                                    <div>
                                        <p class="font-semibold text-gray-900">Practice Course</p>
                                        <p class="text-sm text-gray-600">1 week ago ‚Ä¢ 9 holes</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="font-bold text-2xl text-primary-600">38</div>
                                    <div class="text-xs text-blue-600">+2 Par</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Achievements -->
                    <div class="metric-card">
                        <h3 class="text-xl font-bold text-gray-900 mb-6">Achievements</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="achievement-card p-4 bg-yellow-50 border-2 border-yellow-200 rounded-lg text-center">
                                <div class="w-12 h-12 bg-yellow-500 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <span class="material-symbols-outlined text-white">emoji_events</span>
                                </div>
                                <h4 class="font-bold text-gray-900">Eagle Achievement</h4>
                                <p class="text-sm text-gray-600">3 eagles this month</p>
                            </div>

                            <div class="achievement-card p-4 bg-green-50 border-2 border-green-200 rounded-lg text-center">
                                <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <span class="material-symbols-outlined text-white">trending_down</span>
                                </div>
                                <h4 class="font-bold text-gray-900">Handicap Improvement</h4>
                                <p class="text-sm text-gray-600">Reduced by 2 points</p>
                            </div>

                            <div class="achievement-card p-4 bg-blue-50 border-2 border-blue-200 rounded-lg text-center">
                                <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <span class="material-symbols-outlined text-white">schedule</span>
                                </div>
                                <h4 class="font-bold text-gray-900">New Player</h4>
                                <p class="text-sm text-gray-600">0 rounds this year</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- GPS & Navigation Tab -->
            <div id="golfer-gps" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Course Map -->
                    <div class="lg:col-span-2">
                        <div class="metric-card">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gray-900">Course Navigation</h3>
                                <button onclick="getCurrentLocation()" class="btn-primary">
                                    <span class="material-symbols-outlined text-sm">my_location</span>
                                    Update Location
                                </button>
                            </div>

                            <!-- Google Maps Course View -->
                            <div id="courseMap" class="rounded-lg mb-6" style="height: 400px; width: 100%;">
                                <!-- Map will be loaded here -->
                            </div>

                            <!-- Map Controls -->
                            <div class="flex items-center justify-between mb-4 p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-4">
                                    <button onclick="toggleMapType()" class="btn-sm btn-outline">
                                        <span class="material-symbols-outlined text-sm">satellite</span>
                                        Satellite
                                    </button>
                                    <button onclick="centerOnPlayer()" class="btn-sm btn-outline">
                                        <span class="material-symbols-outlined text-sm">my_location</span>
                                        Center on Me
                                    </button>
                                </div>
                                <div class="text-sm text-gray-600">
                                    <span id="mapAccuracy">GPS Accuracy: --</span>
                                </div>
                            </div>

                            <!-- Hole Information -->
                            <div class="grid grid-cols-3 gap-4">
                                <div class="text-center p-4 bg-blue-50 rounded-lg">
                                    <div class="font-bold text-2xl text-blue-600" id="currentHoleNum">7</div>
                                    <div class="text-sm text-blue-800">Current Hole</div>
                                </div>
                                <div class="text-center p-4 bg-green-50 rounded-lg">
                                    <div class="font-bold text-2xl text-green-600">Par 4</div>
                                    <div class="text-sm text-green-800">Hole Par</div>
                                </div>
                                <div class="text-center p-4 bg-purple-50 rounded-lg">
                                    <div class="font-bold text-2xl text-purple-600">387</div>
                                    <div class="text-sm text-purple-800">Yards Total</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- GPS Data & Tools -->
                    <div class="lg:col-span-1">
                        <div class="space-y-6">
                            <!-- Distance Information -->
                            <div class="metric-card">
                                <h4 class="font-bold text-gray-900 mb-4">Distance Information</h4>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <span class="font-medium">To Front</span>
                                        <span class="font-bold text-green-600">125 yds</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-primary-50 rounded-lg">
                                        <span class="font-medium">To Pin</span>
                                        <span class="font-bold text-primary-600" id="pinDistance">145 yds</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <span class="font-medium">To Back</span>
                                        <span class="font-bold text-red-600">165 yds</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Course Conditions -->
                            <div class="metric-card">
                                <h4 class="font-bold text-gray-900 mb-4">Course Conditions</h4>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                                        <div class="flex items-center space-x-2">
                                            <span class="material-symbols-outlined text-blue-600">thermostat</span>
                                            <span class="font-medium">Temperature</span>
                                        </div>
                                        <span class="font-bold text-blue-600">75¬∞F</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                                        <div class="flex items-center space-x-2">
                                            <span class="material-symbols-outlined text-green-600">air</span>
                                            <span class="font-medium">Wind</span>
                                        </div>
                                        <span class="font-bold text-green-600">5 mph NE</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                                        <div class="flex items-center space-x-2">
                                            <span class="material-symbols-outlined text-yellow-600">water_drop</span>
                                            <span class="font-medium">Humidity</span>
                                        </div>
                                        <span class="font-bold text-yellow-600">65%</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Actions -->
                            <div class="metric-card">
                                <h4 class="font-bold text-gray-900 mb-4">Quick Actions</h4>
                                <div class="space-y-3">
                                    <button onclick="measureDistance()" class="btn-primary w-full">
                                        <span class="material-symbols-outlined text-sm">straighten</span>
                                        Measure Distance
                                    </button>
                                    <button onclick="findNearestCart()" class="btn-secondary w-full">
                                        <span class="material-symbols-outlined text-sm">local_taxi</span>
                                        Find Cart
                                    </button>
                                    <button onclick="callMarshal()" class="btn-secondary w-full">
                                        <span class="material-symbols-outlined text-sm">support_agent</span>
                                        Call Marshal
                                    </button>
                                </div>
                            </div>

                            <!-- Pace of Play -->
                            <div class="metric-card">
                                <h4 class="font-bold text-gray-900 mb-4">Pace of Play</h4>
                                <div class="text-center">
                                    <div class="font-bold text-2xl text-green-600">On Time</div>
                                    <div class="text-sm text-gray-600 mb-3">2h 15m elapsed</div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-green-600 h-2 rounded-full" style="width: 42%"></div>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-2">Hole 7 of 18</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Round History Tab -->
            <div id="golfer-rounds" class="tab-content">
                <div class="space-y-6">
                    <!-- Header -->
                    <div class="flex items-center justify-between">
                        <h2 class="text-2xl font-bold text-gray-900">Round History</h2>
                        <button onclick="addNewRound()" class="btn-primary">
                            <span class="material-symbols-outlined text-sm">add</span>
                            Add Round
                        </button>
                    </div>

                    <!-- Stats Summary -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="metric-card text-center">
                            <div class="font-bold text-3xl text-primary-600">24</div>
                            <div class="text-sm text-gray-600">Total Rounds</div>
                        </div>
                        <div class="metric-card text-center">
                            <div class="font-bold text-3xl text-blue-600">78.5</div>
                            <div class="text-sm text-gray-600">Average Score</div>
                        </div>
                        <div class="metric-card text-center">
                            <div class="font-bold text-3xl text-green-600">12.4</div>
                            <div class="text-sm text-gray-600">Current Handicap</div>
                        </div>
                        <div class="metric-card text-center">
                            <div class="font-bold text-3xl text-purple-600">72</div>
                            <div class="text-sm text-gray-600">Best Round</div>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="metric-card">
                        <div class="flex flex-wrap items-center gap-4">
                            <div class="flex items-center space-x-2">
                                <label class="text-sm font-medium text-gray-700">Course:</label>
                                <select class="form-select text-sm">
                                    <option>All Courses</option>
                                    <option>Phuket Country Club</option>
                                    <option>Blue Canyon Country Club</option>
                                    <option>Laguna Golf Phuket</option>
                                </select>
                            </div>
                            <div class="flex items-center space-x-2">
                                <label class="text-sm font-medium text-gray-700">Year:</label>
                                <select class="form-select text-sm">
                                    <option>2024</option>
                                    <option>2023</option>
                                    <option>2022</option>
                                </select>
                            </div>
                            <div class="flex items-center space-x-2">
                                <label class="text-sm font-medium text-gray-700">Tees:</label>
                                <select class="form-select text-sm">
                                    <option>All Tees</option>
                                    <option>Championship</option>
                                    <option>Regular</option>
                                    <option>Forward</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Rounds -->
                    <div class="metric-card">
                        <h3 class="text-lg font-bold text-gray-900 mb-4">Recent Rounds</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Date</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Course</th>
                                        <th class="text-left py-3 px-4 font-medium text-gray-700">Tees</th>
                                        <th class="text-center py-3 px-4 font-medium text-gray-700">Score</th>
                                        <th class="text-center py-3 px-4 font-medium text-gray-700">Par</th>
                                        <th class="text-center py-3 px-4 font-medium text-gray-700">Diff</th>
                                        <th class="text-center py-3 px-4 font-medium text-gray-700">Handicap Diff</th>
                                        <th class="text-right py-3 px-4 font-medium text-gray-700">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                                        <td class="py-3 px-4">Dec 28, 2024</td>
                                        <td class="py-3 px-4 font-medium">Phuket Country Club</td>
                                        <td class="py-3 px-4">Championship</td>
                                        <td class="py-3 px-4 text-center font-bold text-green-600">76</td>
                                        <td class="py-3 px-4 text-center">72</td>
                                        <td class="py-3 px-4 text-center">+4</td>
                                        <td class="py-3 px-4 text-center">8.2</td>
                                        <td class="py-3 px-4 text-right">
                                            <button onclick="viewRoundDetails('round1')" class="text-primary-600 hover:text-primary-800 text-sm">View</button>
                                        </td>
                                    </tr>
                                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                                        <td class="py-3 px-4">Dec 24, 2024</td>
                                        <td class="py-3 px-4 font-medium">Blue Canyon Country Club</td>
                                        <td class="py-3 px-4">Regular</td>
                                        <td class="py-3 px-4 text-center font-bold text-green-600">79</td>
                                        <td class="py-3 px-4 text-center">72</td>
                                        <td class="py-3 px-4 text-center">+7</td>
                                        <td class="py-3 px-4 text-center">11.1</td>
                                        <td class="py-3 px-4 text-right">
                                            <button onclick="viewRoundDetails('round2')" class="text-primary-600 hover:text-primary-800 text-sm">View</button>
                                        </td>
                                    </tr>
                                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                                        <td class="py-3 px-4">Dec 20, 2024</td>
                                        <td class="py-3 px-4 font-medium">Laguna Golf Phuket</td>
                                        <td class="py-3 px-4">Championship</td>
                                        <td class="py-3 px-4 text-center font-bold text-red-600">84</td>
                                        <td class="py-3 px-4 text-center">72</td>
                                        <td class="py-3 px-4 text-center">+12</td>
                                        <td class="py-3 px-4 text-center">16.8</td>
                                        <td class="py-3 px-4 text-right">
                                            <button onclick="viewRoundDetails('round3')" class="text-primary-600 hover:text-primary-800 text-sm">View</button>
                                        </td>
                                    </tr>
                                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                                        <td class="py-3 px-4">Dec 15, 2024</td>
                                        <td class="py-3 px-4 font-medium">Phuket Country Club</td>
                                        <td class="py-3 px-4">Regular</td>
                                        <td class="py-3 px-4 text-center font-bold text-green-600">72</td>
                                        <td class="py-3 px-4 text-center">72</td>
                                        <td class="py-3 px-4 text-center">E</td>
                                        <td class="py-3 px-4 text-center">3.4</td>
                                        <td class="py-3 px-4 text-right">
                                            <button onclick="viewRoundDetails('round4')" class="text-primary-600 hover:text-primary-800 text-sm">View</button>
                                        </td>
                                    </tr>
                                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                                        <td class="py-3 px-4">Dec 10, 2024</td>
                                        <td class="py-3 px-4 font-medium">Blue Canyon Country Club</td>
                                        <td class="py-3 px-4">Championship</td>
                                        <td class="py-3 px-4 text-center font-bold text-orange-600">81</td>
                                        <td class="py-3 px-4 text-center">72</td>
                                        <td class="py-3 px-4 text-center">+9</td>
                                        <td class="py-3 px-4 text-center">13.7</td>
                                        <td class="py-3 px-4 text-right">
                                            <button onclick="viewRoundDetails('round5')" class="text-primary-600 hover:text-primary-800 text-sm">View</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Performance Trends -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Score Trend Chart -->
                        <div class="metric-card">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">Score Trend</h3>
                            <div class="h-64 flex items-center justify-center bg-gray-50 rounded-lg">
                                <div class="text-center text-gray-500">
                                    <span class="material-symbols-outlined text-4xl mb-2">trending_up</span>
                                    <p>Score trend chart would appear here</p>
                                </div>
                            </div>
                        </div>

                        <!-- Handicap Progress -->
                        <div class="metric-card">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">Handicap Progress</h3>
                            <div class="h-64 flex items-center justify-center bg-gray-50 rounded-lg">
                                <div class="text-center text-gray-500">
                                    <span class="material-symbols-outlined text-4xl mb-2">analytics</span>
                                    <p>Handicap progress chart would appear here</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Caddy Dashboard -->
    <div id="caddieDashboard" class="screen">
        <header class="nav-header">
            <div class="max-w-7xl mx-auto px-4 lg:px-8">
                <div class="flex justify-between items-center py-3 md:py-5">
                    <div class="flex items-center space-x-2 md:space-x-4">
                        <img class="user-avatar" style="display: none;">
                        <div>
                            <h1 class="text-base md:text-xl font-bold text-gray-900">Caddy Dashboard</h1>
                            <p class="text-xs md:text-sm text-gray-600 hidden sm:block">Welcome back, <span class="user-name-display">Caddy</span>!</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 md:space-x-4">
                        <button onclick="sendEmergencyAlert()" class="emergency-btn p-2 md:p-3" title="Emergency Alert">
                            <span class="material-symbols-outlined text-sm md:text-base">emergency</span>
                        </button>
                        <button onclick="ChatSystem.showChatInterface()" class="btn-primary relative px-2 py-2 md:px-4 md:py-2" style="background: #10b981;" title="Chat">
                            <span class="material-symbols-outlined text-sm">chat</span>
                            <span class="hidden md:inline ml-1">Chat</span>
                            <span id="chatBadge" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-4 w-4 md:h-5 md:w-5 flex items-center justify-center font-medium" style="display: none;">0</span>
                        </button>
                        <button onclick="logout()" class="btn-logout px-2 py-2 md:px-3 md:py-2">
                            <span class="material-symbols-outlined text-sm">logout</span>
                            <span class="hidden md:inline ml-1">Logout</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Enhanced Caddy Dashboard Navigation -->
        <nav class="tab-navigation border-b">
            <div class="max-w-7xl mx-auto px-4 lg:px-8">
                <div class="flex space-x-2 md:space-x-8 overflow-x-auto">
                    <button onclick="showCaddyTab('overview', event)" class="tab-button active text-xs md:text-sm px-2 md:px-4">
                        <span class="material-symbols-outlined text-sm">dashboard</span>
                        <span class="hidden sm:inline">Overview</span>
                    </button>
                    <button onclick="showCaddyTab('assignments', event)" class="tab-button text-xs md:text-sm px-2 md:px-4">
                        <span class="material-symbols-outlined text-sm">assignment</span>
                        <span class="hidden sm:inline">My Assignments</span>
                    </button>
                    <button onclick="showCaddyTab('tracking', event)" class="tab-button text-xs md:text-sm px-2 md:px-4">
                        <span class="material-symbols-outlined text-sm">location_on</span>
                        <span class="hidden sm:inline">Live Tracking</span>
                    </button>
                    <button onclick="showCaddyTab('earnings', event)" class="tab-button text-xs md:text-sm px-2 md:px-4">
                        <span class="material-symbols-outlined text-sm">payments</span>
                        <span class="hidden sm:inline">Earnings</span>
                    </button>
                    <button onclick="showCaddyTab('profile', event)" class="tab-button text-xs md:text-sm px-2 md:px-4">
                        <span class="material-symbols-outlined text-sm">person</span>
                        <span class="hidden sm:inline">Profile</span>
                    </button>
                </div>
            </div>
        </nav>

        <main class="max-w-7xl mx-auto px-4 lg:px-8 py-4 md:py-8">
            <!-- Overview Tab -->
            <div id="caddie-overview" class="tab-content active">
                <!-- Mobile-Optimized Hero Welcome Section -->
                <div class="premium-gradient text-white rounded-xl p-3 md:p-4 mb-6 relative overflow-hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 items-center">
                        <div>
                            <h2 class="text-lg md:text-xl font-bold mb-1">Good Morning, Ning!</h2>
                            <p class="text-blue-100 mb-2 text-xs md:text-sm">Professional Caddy ‚Ä¢ Pattana Golf Resort</p>
                            <div class="flex items-center space-x-3 md:space-x-4">
                                <div class="text-center">
                                    <div class="text-sm md:text-lg font-bold">4.9</div>
                                    <div class="text-xs text-blue-100">Rating</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-sm md:text-lg font-bold">‡∏ø12,800</div>
                                    <div class="text-xs text-blue-100">This Month</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-sm md:text-lg font-bold">24</div>
                                    <div class="text-xs text-blue-100">Total Rounds</div>
                                </div>
                            </div>
                        </div>
                        <div class="text-left md:text-right">
                            <div class="premium-badge inline-flex items-center px-2 md:px-3 py-1 rounded-full bg-yellow-500 text-yellow-900 font-bold text-xs md:text-sm">
                                ‚≠ê Elite Status
                            </div>
                            <p class="text-blue-100 text-xs mt-1">Top 5% Performance</p>
                        </div>
                    </div>
                </div>

                <!-- Persistent Emergency Alerts -->
                <div id="caddie-emergency-alerts" class="persistent-emergency-alerts mb-4" style="display: none;">
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-2">
                                <span class="material-symbols-outlined text-red-600">emergency</span>
                                <h3 class="text-lg font-bold text-red-800">Active Emergency Alerts</h3>
                            </div>
                            <span id="caddie-alert-count" class="bg-red-600 text-white text-xs px-2 py-1 rounded-full font-medium">0</span>
                        </div>
                        <div id="caddie-alert-list" class="space-y-2">
                            <!-- Emergency alerts will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Current Status & Waitlist Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6 mb-6">
                    <!-- Current Status -->
                    <div class="metric-card">
                        <h3 class="text-lg font-bold text-gray-900 mb-4">Current Status</h3>
                        <div class="flex items-center space-x-3 mb-4">
                            <span class="status-badge status-busy">Currently Booked</span>
                            <p class="text-sm text-gray-600">until 13:00</p>
                        </div>
                        <div class="p-3 md:p-4 bg-blue-50 rounded-lg">
                            <h5 class="font-medium text-blue-900 mb-2">Current Booking:</h5>
                            <p class="text-sm text-blue-800 font-medium">Sarah Johnson</p>
                            <p class="text-xs text-blue-600">09:00 - 13:00 ‚Ä¢ Private Golf Lesson</p>
                            <p class="text-xs text-blue-600">Pattana Golf Resort</p>
                        </div>
                    </div>

                    <!-- Waitlist -->
                    <div class="metric-card">
                        <h3 class="text-lg font-bold text-gray-900 mb-4">Waitlist (3 people)</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between p-3 bg-orange-50 rounded-lg">
                                <div>
                                    <p class="font-medium text-orange-900">1. David Kim</p>
                                    <p class="text-xs text-orange-600">Requested: Today 14:00</p>
                                </div>
                                <button class="text-xs bg-orange-600 text-white px-2 py-1 rounded">Notify</button>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-orange-50 rounded-lg">
                                <div>
                                    <p class="font-medium text-orange-900">2. Maria Rodriguez</p>
                                    <p class="text-xs text-orange-600">Requested: Tomorrow 10:00</p>
                                </div>
                                <button class="text-xs bg-orange-600 text-white px-2 py-1 rounded">Notify</button>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-orange-50 rounded-lg">
                                <div>
                                    <p class="font-medium text-orange-900">3. James Wilson</p>
                                    <p class="text-xs text-orange-600">Requested: Tomorrow 15:00</p>
                                </div>
                                <button class="text-xs bg-orange-600 text-white px-2 py-1 rounded">Notify</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Live Tracking Section -->
                <div class="mb-8">
                    <div class="metric-card">
                        <div class="text-center">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Live Round Tracking</h3>

                            <!-- Tracking Not Started State -->
                            <div id="trackingNotStarted" class="space-y-4">
                                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <span class="material-symbols-outlined text-4xl text-green-600">play_circle</span>
                                </div>
                                <p class="text-gray-600 mb-6">Start tracking when you reach the first hole with your golfer</p>
                                <button onclick="startLiveTracking()" class="bg-green-600 hover:bg-green-700 text-white px-8 py-4 rounded-xl font-bold text-lg transition-colors">
                                    üèåÔ∏è Start Round Tracking
                                </button>
                            </div>

                            <!-- Tracking Active State -->
                            <div id="trackingActive" class="space-y-4" style="display: none;">
                                <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse">
                                    <span class="material-symbols-outlined text-4xl text-blue-600">radio_button_checked</span>
                                </div>
                                <div class="bg-blue-50 p-6 rounded-lg mb-6">
                                    <h4 class="font-bold text-blue-900 mb-3">Round in Progress</h4>
                                    <div class="grid grid-cols-3 gap-4 text-center">
                                        <div>
                                            <div class="text-2xl font-bold text-blue-600" id="currentHoleTracking">1</div>
                                            <div class="text-sm text-blue-800">Current Hole</div>
                                        </div>
                                        <div>
                                            <div class="text-2xl font-bold text-blue-600" id="roundTimeTracking">0:00</div>
                                            <div class="text-sm text-blue-800">Round Time</div>
                                        </div>
                                        <div>
                                            <div class="text-2xl font-bold text-blue-600" id="locationStatus">üìç Live</div>
                                            <div class="text-sm text-blue-800">GPS Status</div>
                                        </div>
                                    </div>
                                </div>
                                <button onclick="finishLiveTracking()" class="bg-red-600 hover:bg-red-700 text-white px-8 py-4 rounded-xl font-bold text-lg transition-colors">
                                    üèÅ Finish Round
                                </button>

                                <!-- Quick Actions for Mobile -->
                                <div class="mt-6 grid grid-cols-2 gap-3 md:hidden">
                                    <button onclick="showCaddyTab('tracking', event)" class="btn-secondary text-sm">
                                        <span class="material-symbols-outlined text-sm">location_on</span>
                                        GPS Details
                                    </button>
                                    <button onclick="updateCurrentHole()" class="btn-secondary text-sm">
                                        <span class="material-symbols-outlined text-sm">golf_course</span>
                                        Next Hole
                                    </button>
                                </div>
                            </div>

                            <!-- Tracking Completed State -->
                            <div id="trackingCompleted" class="space-y-4" style="display: none;">
                                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <span class="material-symbols-outlined text-4xl text-green-600">check_circle</span>
                                </div>
                                <div class="bg-green-50 p-6 rounded-lg mb-6">
                                    <h4 class="font-bold text-green-900 mb-3">Round Completed!</h4>
                                    <div class="grid grid-cols-2 gap-4 text-center">
                                        <div>
                                            <div class="text-xl font-bold text-green-600" id="finalRoundTime">3:45</div>
                                            <div class="text-sm text-green-800">Total Time</div>
                                        </div>
                                        <div>
                                            <div class="text-xl font-bold text-green-600">18</div>
                                            <div class="text-sm text-green-800">Holes Completed</div>
                                        </div>
                                    </div>
                                </div>
                                <button onclick="resetTracking()" class="bg-primary-600 hover:bg-primary-700 text-white px-6 py-3 rounded-xl font-semibold transition-colors">
                                    Start New Round
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Status Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="metric-card text-center">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="material-symbols-outlined text-3xl text-green-600">assignment_turned_in</span>
                        </div>
                        <h3 class="font-bold text-gray-900 mb-2">Today's Assignment</h3>
                        <p class="text-sm text-gray-600">John Mitchell</p>
                        <div class="mt-3 text-xs bg-green-50 text-green-700 px-3 py-1 rounded-full inline-block">
                            Hole 7 ‚Ä¢ 9:30 AM
                        </div>
                    </div>

                    <div class="metric-card text-center">
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="material-symbols-outlined text-3xl text-blue-600">location_on</span>
                        </div>
                        <h3 class="font-bold text-gray-900 mb-2">Current Location</h3>
                        <p class="text-sm text-gray-600">Championship Course</p>
                        <div class="mt-3 text-xs bg-blue-50 text-blue-700 px-3 py-1 rounded-full inline-block">
                            Live Tracking Active
                        </div>
                    </div>

                    <div class="metric-card text-center">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="material-symbols-outlined text-3xl text-purple-600">schedule</span>
                        </div>
                        <h3 class="font-bold text-gray-900 mb-2">Next Assignment</h3>
                        <p class="text-sm text-gray-600">2:00 PM Today</p>
                        <div class="mt-3 text-xs bg-purple-50 text-purple-700 px-3 py-1 rounded-full inline-block">
                            Executive Course
                        </div>
                    </div>

                    <div class="metric-card text-center">
                        <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="material-symbols-outlined text-3xl text-orange-600">payments</span>
                        </div>
                        <h3 class="font-bold text-gray-900 mb-2">Today's Earnings</h3>
                        <p class="text-sm text-gray-600">‚Çø1,200</p>
                        <div class="mt-3 text-xs bg-orange-50 text-orange-700 px-3 py-1 rounded-full inline-block">
                            2 Rounds Completed
                        </div>
                    </div>
                </div>

                <!-- Current Status -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="metric-card">
                        <h3 class="text-xl font-bold text-gray-900 mb-6">Current Round Status</h3>
                        <div class="bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-lg">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h4 class="font-bold text-gray-900">John Mitchell</h4>
                                    <p class="text-sm text-gray-600">Handicap: 12 ‚Ä¢ Member ID: M1047</p>
                                </div>
                                <div class="status-online rounded-full"></div>
                            </div>
                            <div class="grid grid-cols-3 gap-4 text-center">
                                <div>
                                    <div class="text-lg font-bold text-gray-900">7</div>
                                    <div class="text-xs text-gray-600">Current Hole</div>
                                </div>
                                <div>
                                    <div class="text-lg font-bold text-gray-900">+2</div>
                                    <div class="text-xs text-gray-600">Score to Par</div>
                                </div>
                                <div>
                                    <div class="text-lg font-bold text-gray-900">2h 15m</div>
                                    <div class="text-xs text-gray-600">Round Time</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <h3 class="text-xl font-bold text-gray-900 mb-6">Performance Metrics</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                                <span class="font-medium">Average Round Time</span>
                                <span class="font-bold text-green-600">3h 45m</span>
                            </div>
                            <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                                <span class="font-medium">Client Satisfaction</span>
                                <span class="font-bold text-green-600">4.9 ‚≠ê</span>
                            </div>
                            <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                                <span class="font-medium">Rounds This Week</span>
                                <span class="font-bold text-blue-600">12 Rounds</span>
                            </div>
                            <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                                <span class="font-medium">Weekly Earnings</span>
                                <span class="font-bold text-purple-600">‚Çø3,600</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Assignments Tab -->
            <div id="caddie-assignments" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2">
                        <div class="metric-card">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gray-900">Today's Assignments</h3>
                                <button onclick="refreshAssignments()" class="btn-secondary">
                                    <span class="material-symbols-outlined text-sm">refresh</span>
                                    Refresh
                                </button>
                            </div>

                            <div class="space-y-4" id="assignmentsList">
                                <div class="assignment-card bg-green-50 border-l-4 border-green-500 p-6 rounded-lg">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center text-white font-bold">
                                                JM
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-900">John Mitchell</h4>
                                                <p class="text-sm text-gray-600">Championship Course ‚Ä¢ 9:30 AM</p>
                                            </div>
                                        </div>
                                        <span class="status-badge status-active">Active</span>
                                    </div>
                                    <div class="grid grid-cols-3 gap-4 mb-4">
                                        <div class="text-center">
                                            <div class="font-bold text-gray-900">Hole 7</div>
                                            <div class="text-xs text-gray-600">Current</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="font-bold text-gray-900">‚Çø800</div>
                                            <div class="text-xs text-gray-600">Fee</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="font-bold text-gray-900">4.8‚≠ê</div>
                                            <div class="text-xs text-gray-600">Player Rating</div>
                                        </div>
                                    </div>
                                    <div class="flex space-x-3">
                                        <button onclick="updateLocation()" class="btn-primary flex-1">
                                            <span class="material-symbols-outlined text-sm">location_on</span>
                                            Update Location
                                        </button>
                                        <button onclick="submitRoundReport('current')" class="btn-secondary">
                                            <span class="material-symbols-outlined text-sm">description</span>
                                            Report
                                        </button>
                                    </div>
                                </div>

                                <div class="assignment-card bg-blue-50 border-l-4 border-blue-500 p-6 rounded-lg">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold">
                                                SW
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-900">Sarah Wilson</h4>
                                                <p class="text-sm text-gray-600">Executive Course ‚Ä¢ 2:00 PM</p>
                                            </div>
                                        </div>
                                        <span class="status-badge status-scheduled">Scheduled</span>
                                    </div>
                                    <div class="grid grid-cols-3 gap-4 mb-4">
                                        <div class="text-center">
                                            <div class="font-bold text-gray-900">18 Holes</div>
                                            <div class="text-xs text-gray-600">Full Round</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="font-bold text-gray-900">‚Çø750</div>
                                            <div class="text-xs text-gray-600">Fee</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="font-bold text-gray-900">5.0‚≠ê</div>
                                            <div class="text-xs text-gray-600">Player Rating</div>
                                        </div>
                                    </div>
                                    <p class="text-sm text-gray-600 bg-white p-3 rounded-lg">
                                        <strong>Notes:</strong> Prefers detailed yardage information. Plays fast. Regular Wednesday player.
                                    </p>
                                </div>

                                <div class="assignment-card bg-gray-50 border-l-4 border-gray-400 p-6 rounded-lg">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center space-x-4">
                                            <div class="w-12 h-12 bg-gray-400 rounded-full flex items-center justify-center text-white font-bold">
                                                RC
                                            </div>
                                            <div>
                                                <h4 class="font-bold text-gray-900">Robert Chen</h4>
                                                <p class="text-sm text-gray-600">Championship Course ‚Ä¢ 8:00 AM</p>
                                            </div>
                                        </div>
                                        <span class="status-badge status-completed">Completed</span>
                                    </div>
                                    <div class="grid grid-cols-3 gap-4">
                                        <div class="text-center">
                                            <div class="font-bold text-gray-900">18 Holes</div>
                                            <div class="text-xs text-gray-600">3h 30m</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="font-bold text-gray-900">‚Çø1,000</div>
                                            <div class="text-xs text-gray-600">Earned + Tip</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="font-bold text-gray-900">5.0‚≠ê</div>
                                            <div class="text-xs text-gray-600">Rating Given</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="lg:col-span-1">
                        <div class="space-y-6">
                            <div class="metric-card">
                                <h4 class="font-bold text-gray-900 mb-4">Assignment Summary</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Today Total</span>
                                        <span class="font-bold">3 Rounds</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Completed</span>
                                        <span class="font-bold text-green-600">1</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">In Progress</span>
                                        <span class="font-bold text-blue-600">1</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Scheduled</span>
                                        <span class="font-bold text-orange-600">1</span>
                                    </div>
                                    <div class="border-t pt-3">
                                        <div class="flex justify-between">
                                            <span class="font-bold">Projected Earnings</span>
                                            <span class="font-bold text-primary-600">‚Çø2,550</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="metric-card">
                                <h4 class="font-bold text-gray-900 mb-4">Week Ahead</h4>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div>
                                            <div class="font-medium">Tomorrow</div>
                                            <div class="text-sm text-gray-600">4 assignments</div>
                                        </div>
                                        <span class="text-green-600 font-bold">‚Çø3,200</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div>
                                            <div class="font-medium">Friday</div>
                                            <div class="text-sm text-gray-600">3 assignments</div>
                                        </div>
                                        <span class="text-green-600 font-bold">‚Çø2,400</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div>
                                            <div class="font-medium">Weekend</div>
                                            <div class="text-sm text-gray-600">6 assignments</div>
                                        </div>
                                        <span class="text-green-600 font-bold">‚Çø4,800</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tracking Tab -->
            <div id="caddie-tracking" class="tab-content">
                <div class="metric-card">
                    <h3 class="text-xl font-bold text-gray-900 mb-6">Live Course Tracking</h3>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div>
                            <div class="bg-green-100 rounded-lg p-6" style="height: 400px; position: relative;">
                                <div class="absolute top-4 left-4 bg-white px-3 py-1 rounded-lg shadow">
                                    <span class="text-sm font-bold">Live Tracking Active</span>
                                </div>
                                <div class="flex items-center justify-center h-full">
                                    <div class="text-center">
                                        <span class="material-symbols-outlined text-6xl text-green-600 mb-4 block">golf_course</span>
                                        <p class="text-gray-600">Interactive course map with real-time position</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-6">
                            <div class="bg-blue-50 p-6 rounded-lg">
                                <h4 class="font-bold text-blue-900 mb-4">Current Position</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-blue-700">Hole</span>
                                        <span class="font-bold text-blue-900" id="caddieCurrentHole">7</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-blue-700">Player</span>
                                        <span class="font-bold text-blue-900">John Mitchell</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-blue-700">Time on Course</span>
                                        <span class="font-bold text-blue-900">2h 15m</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-blue-700">Pace</span>
                                        <span class="font-bold text-green-600">On Time</span>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-purple-50 p-6 rounded-lg">
                                <h4 class="font-bold text-purple-900 mb-4">Round Progress</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-purple-700">Score</span>
                                        <span class="font-bold text-purple-900">+2 (38)</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-purple-700">Fairways Hit</span>
                                        <span class="font-bold text-purple-900">5/7 (71%)</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-purple-700">GIR</span>
                                        <span class="font-bold text-purple-900">4/7 (57%)</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-purple-700">Putts</span>
                                        <span class="font-bold text-purple-900">14</span>
                                    </div>
                                </div>
                            </div>

                            <div class="flex space-x-3">
                                <button onclick="updateCaddyLocation()" class="btn-primary flex-1">
                                    <span class="material-symbols-outlined text-sm">my_location</span>
                                    Update Location
                                </button>
                                <button onclick="startLiveTracking()" class="btn-secondary">
                                    <span class="material-symbols-outlined text-sm">play_arrow</span>
                                    Start Tracking
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->

            <!-- Earnings Tab -->
            <div id="caddie-earnings" class="tab-content">
                <!-- Add New Earnings Section -->
                <div class="metric-card mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg md:text-xl font-bold text-gray-900">Add New Earnings</h3>
                        <button onclick="toggleEarningsForm()" class="btn-primary text-sm">
                            <span class="material-symbols-outlined text-sm">add</span>
                            <span class="hidden md:inline ml-1">Add Earnings</span>
                        </button>
                    </div>

                    <div id="earningsForm" class="hidden bg-gray-50 rounded-lg p-4">
                        <form onsubmit="submitEarnings(event)" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="form-label">Client Name</label>
                                    <input type="text" id="clientName" class="form-input" placeholder="Enter client name" required>
                                </div>
                                <div>
                                    <label class="form-label">Service Type</label>
                                    <select id="serviceType" class="form-input" required>
                                        <option value="">Select service</option>
                                        <option value="round">Full Round</option>
                                        <option value="lesson">Private Lesson</option>
                                        <option value="half">Half Round</option>
                                        <option value="group">Group Session</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="form-label">Base Fee (‡∏ø)</label>
                                    <input type="number" id="baseFee" class="form-input" placeholder="800" required min="0">
                                </div>
                                <div>
                                    <label class="form-label">Tip Amount (‡∏ø)</label>
                                    <input type="number" id="tipAmount" class="form-input" placeholder="200" min="0">
                                </div>
                                <div>
                                    <label class="form-label">Date</label>
                                    <input type="date" id="earningsDate" class="form-input" required>
                                </div>
                                <div>
                                    <label class="form-label">Time</label>
                                    <input type="time" id="earningsTime" class="form-input" required>
                                </div>
                            </div>
                            <div>
                                <label class="form-label">Notes (Optional)</label>
                                <textarea id="earningsNotes" class="form-input" rows="2" placeholder="Additional notes about the service"></textarea>
                            </div>
                            <div class="flex space-x-3">
                                <button type="submit" class="btn-primary flex-1">
                                    <span class="material-symbols-outlined text-sm">save</span>
                                    Save Earnings
                                </button>
                                <button type="button" onclick="toggleEarningsForm()" class="btn-secondary">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2">
                        <div class="metric-card">
                            <h3 class="text-xl font-bold text-gray-900 mb-6">Earnings History</h3>

                            <div class="space-y-4">
                                <div class="earnings-item flex items-center justify-between p-4 bg-green-50 rounded-lg">
                                    <div class="flex items-center space-x-4">
                                        <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center text-white font-bold">
                                            RC
                                        </div>
                                        <div>
                                            <h4 class="font-bold text-gray-900">Robert Chen</h4>
                                            <p class="text-sm text-gray-600">Championship ‚Ä¢ Today 8:00 AM</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-green-600">‚Çø1,000</div>
                                        <div class="text-sm text-gray-600">‚Çø800 + ‚Çø200 tip</div>
                                    </div>
                                </div>

                                <div class="earnings-item flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                    <div class="flex items-center space-x-4">
                                        <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold">
                                            MW
                                        </div>
                                        <div>
                                            <h4 class="font-bold text-gray-900">Maria Wilson</h4>
                                            <p class="text-sm text-gray-600">Executive ‚Ä¢ Yesterday 2:00 PM</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-green-600">‚Çø900</div>
                                        <div class="text-sm text-gray-600">‚Çø750 + ‚Çø150 tip</div>
                                    </div>
                                </div>

                                <div class="earnings-item flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                    <div class="flex items-center space-x-4">
                                        <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold">
                                            DL
                                        </div>
                                        <div>
                                            <h4 class="font-bold text-gray-900">David Lee</h4>
                                            <p class="text-sm text-gray-600">Championship ‚Ä¢ Yesterday 9:30 AM</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-green-600">‚Çø850</div>
                                        <div class="text-sm text-gray-600">‚Çø800 + ‚Çø50 tip</div>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-6 pt-6 border-t">
                                <button class="btn-secondary w-full">View Full History</button>
                            </div>
                        </div>
                    </div>

                    <div class="lg:col-span-1">
                        <div class="space-y-6">
                            <div class="metric-card">
                                <h4 class="font-bold text-gray-900 mb-4">Earnings Summary</h4>
                                <div class="space-y-4">
                                    <div class="text-center p-4 bg-green-50 rounded-lg">
                                        <div class="text-2xl font-bold text-green-600">‚Çø1,200</div>
                                        <div class="text-sm text-gray-600">Today</div>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">This Week</span>
                                        <span class="font-bold">‚Çø8,450</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">This Month</span>
                                        <span class="font-bold">‚Çø28,750</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Average/Round</span>
                                        <span class="font-bold text-primary-600">‚Çø825</span>
                                    </div>
                                </div>
                            </div>

                            <div class="metric-card">
                                <h4 class="font-bold text-gray-900 mb-4">Performance Bonus</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Rating Bonus</span>
                                        <span class="font-bold text-green-600">‚Çø500</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Punctuality</span>
                                        <span class="font-bold text-green-600">‚Çø200</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Elite Status</span>
                                        <span class="font-bold text-yellow-600">‚Çø1,000</span>
                                    </div>
                                    <div class="border-t pt-3">
                                        <div class="flex justify-between">
                                            <span class="font-bold">Total Bonus</span>
                                            <span class="font-bold text-primary-600">‚Çø1,700</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="caddie-profile" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">My Profile</h3>
                        <button class="btn-sm btn-primary">
                            <span class="material-symbols-outlined text-sm">edit</span>
                            Edit Profile
                        </button>
                    </div>
                    <div class="space-y-6">
                        <!-- Basic Information -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-input" value="Ning Prasert" readonly>
                            </div>
                            <div>
                                <label class="form-label">Employee ID</label>
                                <input type="text" class="form-input" value="PAT001" readonly>
                            </div>
                            <div>
                                <label class="form-label">Home Club</label>
                                <input type="text" class="form-input" value="Pattana Golf Resort & Spa" readonly>
                            </div>
                            <div>
                                <label class="form-label">Specialty</label>
                                <input type="text" class="form-input" value="Championship Course" readonly>
                            </div>
                            <div>
                                <label class="form-label">Languages</label>
                                <input type="text" class="form-input" value="Thai, English" readonly>
                            </div>
                            <div>
                                <label class="form-label">Experience</label>
                                <input type="text" class="form-input" value="8 years" readonly>
                            </div>
                        </div>

                        <!-- Performance Stats -->
                        <div>
                            <h4 class="font-medium text-gray-900 mb-4">Performance Statistics</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="metric-card text-center">
                                    <div class="metric-value">0.0</div>
                                    <div class="metric-label">Current Rating</div>
                                </div>
                                <div class="metric-card text-center">
                                    <div class="metric-value">0</div>
                                    <div class="metric-label">Total Rounds</div>
                                </div>
                                <div class="metric-card text-center">
                                    <div class="metric-value">‚Çø0</div>
                                    <div class="metric-label">Total Earnings</div>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div>
                            <h4 class="font-medium text-gray-900 mb-4">Contact Information</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="form-label">Phone Number</label>
                                    <input type="text" class="form-input" value="+66 89 123 4567" readonly>
                                </div>
                                <div>
                                    <label class="form-label">Emergency Contact</label>
                                    <input type="text" class="form-input" value="+66 81 987 6543" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Manager Dashboard -->
    <div id="managerDashboard" class="screen">
        <header class="nav-header">
            <div class="max-w-7xl mx-auto px-4 lg:px-8">
                <div class="flex justify-between items-center py-3 md:py-5">
                    <div class="flex items-center space-x-2 md:space-x-4">
                        <img class="user-avatar" style="display: none;">
                        <div>
                            <h1 class="text-base md:text-xl font-bold text-gray-900">Manager Dashboard</h1>
                            <p class="text-xs md:text-sm text-gray-600">Welcome back, <span class="hidden md:inline">Manager </span><span class="user-name-display">Manager</span>!</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button onclick="sendEmergencyAlert()" class="emergency-btn" title="Emergency Broadcast">
                            <span class="material-symbols-outlined">emergency</span>
                        </button>
                        <button onclick="ChatSystem.showChatInterface()" class="btn-primary relative" style="background: #10b981; padding: 10px 16px;" title="Chat">
                            <span class="material-symbols-outlined text-sm">chat</span>
                            Chat
                            <span id="chatBadge" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-medium" style="display: none;">0</span>
                        </button>
                        <button onclick="logout()" class="btn-logout">
                            <span class="material-symbols-outlined text-sm">logout</span>
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Enhanced Manager Dashboard Navigation -->
        <nav class="tab-navigation border-b">
            <div class="max-w-7xl mx-auto px-4 lg:px-8">
                <div class="flex space-x-2 md:space-x-8 overflow-x-auto">
                    <button onclick="showManagerTab('overview', event)" class="tab-button active px-2 md:px-4" id="manager-overview-tab">
                        <span class="material-symbols-outlined text-sm">dashboard</span>
                        <span class="hidden sm:inline ml-1">Overview</span>
                    </button>
                    <button onclick="showManagerTab('staff', event)" class="tab-button px-2 md:px-4" id="manager-staff-tab">
                        <span class="material-symbols-outlined text-sm">groups</span>
                        <span class="hidden sm:inline ml-1">Staff Management</span>
                    </button>
                    <button onclick="showManagerTab('analytics', event)" class="tab-button px-2 md:px-4" id="manager-analytics-tab">
                        <span class="material-symbols-outlined text-sm">analytics</span>
                        <span class="hidden sm:inline ml-1">Analytics</span>
                    </button>
                    <button onclick="showManagerTab('reports', event)" class="tab-button px-2 md:px-4" id="manager-reports-tab">
                        <span class="material-symbols-outlined text-sm">description</span>
                        <span class="hidden sm:inline ml-1">Reports</span>
                    </button>
                    <button onclick="showManagerTab('settings', event)" class="tab-button px-2 md:px-4" id="manager-settings-tab">
                        <span class="material-symbols-outlined text-sm">settings</span>
                        <span class="hidden sm:inline ml-1">Settings</span>
                    </button>
                </div>
            </div>
        </nav>

        <main class="max-w-7xl mx-auto px-6 lg:px-8 py-8">
            <!-- Manager Overview Tab -->
            <div id="manager-overview" class="tab-content active">
                <!-- Manager Hero Section -->
                <div class="hero-section bg-gradient-to-r from-orange-600 to-orange-700 text-white rounded-3xl p-8 mb-8">
                    <div class="flex flex-col lg:flex-row justify-between items-center">
                        <div class="text-center lg:text-left mb-6 lg:mb-0">
                            <h2 class="text-3xl font-bold mb-2">Course Operations</h2>
                            <p class="text-orange-100 text-lg">Managing Pattaya Golf Club</p>
                            <div class="flex flex-wrap justify-center lg:justify-start gap-6 mt-4 text-sm">
                                <div class="flex items-center gap-2">
                                    <span class="material-symbols-outlined text-lg">golf_course</span>
                                    <span>18 Holes Active</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="material-symbols-outlined text-lg">groups</span>
                                    <span>47 Staff Members</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="material-symbols-outlined text-lg">trending_up</span>
                                    <span>98% Satisfaction</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl font-bold">‚Çø284,650</div>
                            <div class="text-orange-200">Monthly Revenue</div>
                            <div class="text-sm text-orange-200 mt-1">+12% vs last month</div>
                        </div>
                    </div>
                </div>

                <!-- Persistent Emergency Alerts -->
                <div id="manager-emergency-alerts" class="persistent-emergency-alerts mb-6" style="display: none;">
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-2">
                                <span class="material-symbols-outlined text-red-600">emergency</span>
                                <h3 class="text-lg font-bold text-red-800">Active Emergency Alerts</h3>
                            </div>
                            <span id="manager-alert-count" class="bg-red-600 text-white text-xs px-2 py-1 rounded-full font-medium">0</span>
                        </div>
                        <div id="manager-alert-list" class="space-y-2">
                            <!-- Emergency alerts will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Quick Stats Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Today's Rounds</p>
                                <p class="text-2xl font-bold text-gray-900">24</p>
                                <p class="text-xs text-green-600">+3 vs yesterday</p>
                            </div>
                            <div class="stat-icon bg-blue-100">
                                <span class="material-symbols-outlined text-blue-600">golf_course</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Active Caddys</p>
                                <p class="text-2xl font-bold text-gray-900">18</p>
                                <p class="text-xs text-green-600">All assigned</p>
                            </div>
                            <div class="stat-icon bg-green-100">
                                <span class="material-symbols-outlined text-green-600">person_check</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Course Occupancy</p>
                                <p class="text-2xl font-bold text-gray-900">78%</p>
                                <p class="text-xs text-orange-600">Peak hours</p>
                            </div>
                            <div class="stat-icon bg-orange-100">
                                <span class="material-symbols-outlined text-orange-600">bar_chart</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Emergency Alerts</p>
                                <p class="text-2xl font-bold text-gray-900">0</p>
                                <p class="text-xs text-gray-500">All clear</p>
                            </div>
                            <div class="stat-icon bg-red-100">
                                <span class="material-symbols-outlined text-red-600">emergency</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Live Operations Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Current Rounds -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Current Rounds</h3>
                            <span class="badge badge-success">Live</span>
                        </div>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                        <span class="material-symbols-outlined text-blue-600">person</span>
                                    </div>
                                    <div>
                                        <p class="font-medium">John Mitchell</p>
                                        <p class="text-sm text-gray-600">Hole 7 ‚Ä¢ Caddy: Ning</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-sm font-medium">2h 15m</p>
                                    <p class="text-xs text-gray-500">Good pace</p>
                                </div>
                            </div>
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                                        <span class="material-symbols-outlined text-green-600">groups</span>
                                    </div>
                                    <div>
                                        <p class="font-medium">Smith Group (4)</p>
                                        <p class="text-sm text-gray-600">Hole 12 ‚Ä¢ Caddy: Somchai</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-sm font-medium">3h 05m</p>
                                    <p class="text-xs text-orange-500">Slow pace</p>
                                </div>
                            </div>
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center">
                                        <span class="material-symbols-outlined text-purple-600">person</span>
                                    </div>
                                    <div>
                                        <p class="font-medium">Lisa Wong</p>
                                        <p class="text-sm text-gray-600">Hole 15 ‚Ä¢ Caddy: Malee</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-sm font-medium">3h 45m</p>
                                    <p class="text-xs text-green-500">Good pace</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Staff Status -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Staff Status</h3>
                            <button class="btn-sm btn-outline">Manage All</button>
                        </div>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                        <span class="material-symbols-outlined text-green-600 text-sm">person_check</span>
                                    </div>
                                    <span class="text-sm font-medium">Caddys</span>
                                </div>
                                <div class="text-right">
                                    <span class="text-sm font-bold">18/20</span>
                                    <span class="text-xs text-gray-500 ml-2">Active</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                        <span class="material-symbols-outlined text-blue-600 text-sm">restaurant</span>
                                    </div>
                                    <span class="text-sm font-medium">F&B Staff</span>
                                </div>
                                <div class="text-right">
                                    <span class="text-sm font-bold">12/15</span>
                                    <span class="text-xs text-gray-500 ml-2">Active</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                                        <span class="material-symbols-outlined text-purple-600 text-sm">store</span>
                                    </div>
                                    <span class="text-sm font-medium">Pro Shop</span>
                                </div>
                                <div class="text-right">
                                    <span class="text-sm font-bold">4/5</span>
                                    <span class="text-xs text-gray-500 ml-2">Active</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center">
                                        <span class="material-symbols-outlined text-orange-600 text-sm">build</span>
                                    </div>
                                    <span class="text-sm font-medium">Maintenance</span>
                                </div>
                                <div class="text-right">
                                    <span class="text-sm font-bold">8/10</span>
                                    <span class="text-xs text-gray-500 ml-2">Active</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center">
                                        <span class="material-symbols-outlined text-red-600 text-sm">security</span>
                                    </div>
                                    <span class="text-sm font-medium">Security</span>
                                </div>
                                <div class="text-right">
                                    <span class="text-sm font-bold">5/6</span>
                                    <span class="text-xs text-gray-500 ml-2">Active</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Staff Management Tab -->
            <div id="manager-staff" class="tab-content hidden">
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <h2 class="text-2xl font-bold text-gray-900">Staff Management</h2>
                        <div class="flex flex-wrap gap-3">
                            <button class="btn-sm btn-outline">
                                <span class="material-symbols-outlined text-sm">add</span>
                                Add Staff
                            </button>
                            <button class="btn-sm btn-outline">
                                <span class="material-symbols-outlined text-sm">schedule</span>
                                Schedules
                            </button>
                            <button class="btn-sm btn-primary">
                                <span class="material-symbols-outlined text-sm">analytics</span>
                                Performance
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Staff Categories -->
                <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 mb-8">
                    <!-- Caddys -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Caddys (20)</h3>
                            <span class="badge badge-success">18 Active</span>
                        </div>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white font-bold text-sm">N</div>
                                    <div>
                                        <p class="text-sm font-medium">Ning Sumalee</p>
                                        <p class="text-xs text-gray-500">Elite ‚Ä¢ 4.9‚òÖ</p>
                                    </div>
                                </div>
                                <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Active</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-sm">S</div>
                                    <div>
                                        <p class="text-sm font-medium">Somchai Thana</p>
                                        <p class="text-xs text-gray-500">Senior ‚Ä¢ 4.7‚òÖ</p>
                                    </div>
                                </div>
                                <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Active</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold text-sm">M</div>
                                    <div>
                                        <p class="text-sm font-medium">Malee Phong</p>
                                        <p class="text-xs text-gray-500">Standard ‚Ä¢ 4.5‚òÖ</p>
                                    </div>
                                </div>
                                <span class="px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded-full">Break</span>
                            </div>
                        </div>
                        <div class="mt-4">
                            <button class="w-full text-center text-sm text-blue-600 hover:text-blue-800">View All Caddys</button>
                        </div>
                    </div>

                    <!-- F&B Staff -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">F&B Staff (15)</h3>
                            <span class="badge badge-warning">12 Active</span>
                        </div>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold text-sm">P</div>
                                    <div>
                                        <p class="text-sm font-medium">Prasert Kitchen</p>
                                        <p class="text-xs text-gray-500">Head Chef</p>
                                    </div>
                                </div>
                                <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Active</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-pink-500 rounded-full flex items-center justify-center text-white font-bold text-sm">A</div>
                                    <div>
                                        <p class="text-sm font-medium">Anya Serving</p>
                                        <p class="text-xs text-gray-500">Server</p>
                                    </div>
                                </div>
                                <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Active</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-teal-500 rounded-full flex items-center justify-center text-white font-bold text-sm">K</div>
                                    <div>
                                        <p class="text-sm font-medium">Kamon Bar</p>
                                        <p class="text-xs text-gray-500">Bartender</p>
                                    </div>
                                </div>
                                <span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full">Off Today</span>
                            </div>
                        </div>
                        <div class="mt-4">
                            <button class="w-full text-center text-sm text-blue-600 hover:text-blue-800">View All F&B Staff</button>
                        </div>
                    </div>

                    <!-- Other Departments -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Other Departments</h3>
                            <span class="badge badge-info">21 Total</span>
                        </div>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                                        <span class="material-symbols-outlined text-purple-600 text-sm">store</span>
                                    </div>
                                    <span class="text-sm font-medium">Pro Shop</span>
                                </div>
                                <span class="text-sm text-gray-600">4/5 Active</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center">
                                        <span class="material-symbols-outlined text-orange-600 text-sm">build</span>
                                    </div>
                                    <span class="text-sm font-medium">Maintenance</span>
                                </div>
                                <span class="text-sm text-gray-600">8/10 Active</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center">
                                        <span class="material-symbols-outlined text-red-600 text-sm">security</span>
                                    </div>
                                    <span class="text-sm font-medium">Security</span>
                                </div>
                                <span class="text-sm text-gray-600">5/6 Active</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                        <span class="material-symbols-outlined text-blue-600 text-sm">admin_panel_settings</span>
                                    </div>
                                    <span class="text-sm font-medium">Administration</span>
                                </div>
                                <span class="text-sm text-gray-600">4/4 Active</span>
                            </div>
                        </div>
                        <div class="mt-4">
                            <button class="w-full text-center text-sm text-blue-600 hover:text-blue-800">Manage Departments</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="manager-analytics" class="tab-content hidden">
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <h2 class="text-2xl font-bold text-gray-900">Analytics & Insights</h2>
                        <div class="flex flex-wrap gap-3">
                            <select class="form-select text-sm">
                                <option>Last 7 days</option>
                                <option>Last 30 days</option>
                                <option>Last 3 months</option>
                            </select>
                            <button class="btn-sm btn-outline">
                                <span class="material-symbols-outlined text-sm">download</span>
                                Export
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Revenue Analytics -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Revenue Breakdown</h3>
                            <span class="text-sm text-gray-500">Last 30 days</span>
                        </div>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-4 h-4 bg-green-500 rounded"></div>
                                    <span class="text-sm">Green Fees</span>
                                </div>
                                <div class="text-right">
                                    <span class="font-bold">‚Çø165,400</span>
                                    <span class="text-sm text-gray-500 ml-2">58%</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-4 h-4 bg-blue-500 rounded"></div>
                                    <span class="text-sm">Caddy Services</span>
                                </div>
                                <div class="text-right">
                                    <span class="font-bold">‚Çø68,900</span>
                                    <span class="text-sm text-gray-500 ml-2">24%</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-4 h-4 bg-orange-500 rounded"></div>
                                    <span class="text-sm">F&B Sales</span>
                                </div>
                                <div class="text-right">
                                    <span class="font-bold">‚Çø32,150</span>
                                    <span class="text-sm text-gray-500 ml-2">11%</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-4 h-4 bg-purple-500 rounded"></div>
                                    <span class="text-sm">Pro Shop</span>
                                </div>
                                <div class="text-right">
                                    <span class="font-bold">‚Çø18,200</span>
                                    <span class="text-sm text-gray-500 ml-2">7%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Course Utilization</h3>
                            <span class="text-sm text-gray-500">Peak vs Off-peak</span>
                        </div>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <span class="text-sm">Peak Hours (8AM-2PM)</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-24 h-2 bg-gray-200 rounded-full">
                                        <div class="w-20 h-2 bg-red-500 rounded-full"></div>
                                    </div>
                                    <span class="text-sm font-bold">85%</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">Mid Hours (2PM-5PM)</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-24 h-2 bg-gray-200 rounded-full">
                                        <div class="w-16 h-2 bg-yellow-500 rounded-full"></div>
                                    </div>
                                    <span class="text-sm font-bold">65%</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">Evening (5PM-7PM)</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-24 h-2 bg-gray-200 rounded-full">
                                        <div class="w-10 h-2 bg-green-500 rounded-full"></div>
                                    </div>
                                    <span class="text-sm font-bold">42%</span>
                                </div>
                            </div>
                            <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                                <p class="text-sm text-blue-800">
                                    <strong>Recommendation:</strong> Consider promotional pricing for evening slots to increase utilization.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Metrics -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Customer Satisfaction</h3>
                        </div>
                        <div class="text-center py-4">
                            <div class="text-4xl font-bold text-green-600 mb-2">4.8</div>
                            <div class="text-sm text-gray-600 mb-4">Average Rating</div>
                            <div class="space-y-2">
                                <div class="flex items-center justify-between text-sm">
                                    <span>Course Quality</span>
                                    <span class="font-bold">4.9</span>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span>Service</span>
                                    <span class="font-bold">4.8</span>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span>Value</span>
                                    <span class="font-bold">4.7</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Staff Performance</h3>
                        </div>
                        <div class="text-center py-4">
                            <div class="text-4xl font-bold text-blue-600 mb-2">92%</div>
                            <div class="text-sm text-gray-600 mb-4">Efficiency Score</div>
                            <div class="space-y-2">
                                <div class="flex items-center justify-between text-sm">
                                    <span>Caddys</span>
                                    <span class="font-bold">96%</span>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span>F&B</span>
                                    <span class="font-bold">89%</span>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span>Pro Shop</span>
                                    <span class="font-bold">91%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Revenue Growth</h3>
                        </div>
                        <div class="text-center py-4">
                            <div class="text-4xl font-bold text-orange-600 mb-2">+12%</div>
                            <div class="text-sm text-gray-600 mb-4">Month over Month</div>
                            <div class="space-y-2">
                                <div class="flex items-center justify-between text-sm">
                                    <span>This Month</span>
                                    <span class="font-bold">‚Çø284,650</span>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span>Last Month</span>
                                    <span class="font-bold">‚Çø254,120</span>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span>Difference</span>
                                    <span class="font-bold text-green-600">+‚Çø30,530</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="manager-reports" class="tab-content hidden">
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <h2 class="text-2xl font-bold text-gray-900">Reports & Documentation</h2>
                        <div class="flex flex-wrap gap-3">
                            <button class="btn-sm btn-outline">
                                <span class="material-symbols-outlined text-sm">add</span>
                                New Report
                            </button>
                            <button class="btn-sm btn-primary">
                                <span class="material-symbols-outlined text-sm">download</span>
                                Export All
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Quick Reports -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <div class="card cursor-pointer hover:shadow-lg transition-shadow">
                        <div class="card-header">
                            <h3 class="card-title">Daily Operations</h3>
                            <span class="material-symbols-outlined text-gray-400">description</span>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Comprehensive daily summary including rounds, revenue, and incidents.</p>
                        <button class="btn-sm btn-outline w-full">Generate Report</button>
                    </div>

                    <div class="card cursor-pointer hover:shadow-lg transition-shadow">
                        <div class="card-header">
                            <h3 class="card-title">Staff Performance</h3>
                            <span class="material-symbols-outlined text-gray-400">analytics</span>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Individual and team performance metrics with ratings and feedback.</p>
                        <button class="btn-sm btn-outline w-full">Generate Report</button>
                    </div>

                    <div class="card cursor-pointer hover:shadow-lg transition-shadow">
                        <div class="card-header">
                            <h3 class="card-title">Financial Summary</h3>
                            <span class="material-symbols-outlined text-gray-400">account_balance</span>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Revenue breakdown, expenses, and profitability analysis.</p>
                        <button class="btn-sm btn-outline w-full">Generate Report</button>
                    </div>

                    <div class="card cursor-pointer hover:shadow-lg transition-shadow">
                        <div class="card-header">
                            <h3 class="card-title">Customer Feedback</h3>
                            <span class="material-symbols-outlined text-gray-400">star</span>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Customer satisfaction scores, reviews, and improvement suggestions.</p>
                        <button class="btn-sm btn-outline w-full">Generate Report</button>
                    </div>

                    <div class="card cursor-pointer hover:shadow-lg transition-shadow">
                        <div class="card-header">
                            <h3 class="card-title">Maintenance Log</h3>
                            <span class="material-symbols-outlined text-gray-400">build</span>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Course maintenance activities, repairs, and equipment status.</p>
                        <button class="btn-sm btn-outline w-full">Generate Report</button>
                    </div>

                    <div class="card cursor-pointer hover:shadow-lg transition-shadow">
                        <div class="card-header">
                            <h3 class="card-title">Safety & Incidents</h3>
                            <span class="material-symbols-outlined text-gray-400">emergency</span>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Emergency responses, safety incidents, and prevention measures.</p>
                        <button class="btn-sm btn-outline w-full">Generate Report</button>
                    </div>
                </div>

                <!-- Recent Reports -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Reports</h3>
                        <button class="btn-sm btn-outline">View All</button>
                    </div>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                    <span class="material-symbols-outlined text-blue-600">description</span>
                                </div>
                                <div>
                                    <p class="font-medium">Daily Operations - March 28, 2024</p>
                                    <p class="text-sm text-gray-600">24 rounds ‚Ä¢ ‚Çø12,350 revenue ‚Ä¢ No incidents</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-gray-500">2 hours ago</span>
                                <button class="btn-sm btn-outline">Download</button>
                            </div>
                        </div>

                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                                    <span class="material-symbols-outlined text-green-600">analytics</span>
                                </div>
                                <div>
                                    <p class="font-medium">Weekly Staff Performance</p>
                                    <p class="text-sm text-gray-600">All departments ‚Ä¢ 94% average score</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-gray-500">1 day ago</span>
                                <button class="btn-sm btn-outline">Download</button>
                            </div>
                        </div>

                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center">
                                    <span class="material-symbols-outlined text-orange-600">account_balance</span>
                                </div>
                                <div>
                                    <p class="font-medium">Monthly Financial Summary</p>
                                    <p class="text-sm text-gray-600">March 2024 ‚Ä¢ ‚Çø284,650 total revenue</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-gray-500">3 days ago</span>
                                <button class="btn-sm btn-outline">Download</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="manager-settings" class="tab-content hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Course Settings</h2>
                    <p class="text-gray-600">Manage course operations and system preferences</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Course Configuration -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Course Configuration</h3>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label class="form-label">Course Name</label>
                                <input type="text" class="form-input" value="Pattaya Golf Club" />
                            </div>
                            <div>
                                <label class="form-label">Operating Hours</label>
                                <div class="grid grid-cols-2 gap-4">
                                    <input type="time" class="form-input" value="06:00" />
                                    <input type="time" class="form-input" value="19:00" />
                                </div>
                            </div>
                            <div>
                                <label class="form-label">Maximum Players per Slot</label>
                                <select class="form-select">
                                    <option>4 Players</option>
                                    <option>3 Players</option>
                                    <option>2 Players</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Advance Booking Limit</label>
                                <select class="form-select">
                                    <option>30 days</option>
                                    <option>60 days</option>
                                    <option>90 days</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Pricing Settings -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Pricing Settings</h3>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label class="form-label">Peak Hours Green Fee</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">‚Çø</span>
                                    <input type="number" class="form-input pl-8" value="2500" />
                                </div>
                            </div>
                            <div>
                                <label class="form-label">Off-Peak Green Fee</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">‚Çø</span>
                                    <input type="number" class="form-input pl-8" value="1800" />
                                </div>
                            </div>
                            <div>
                                <label class="form-label">Caddy Base Fee</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">‚Çø</span>
                                    <input type="number" class="form-input pl-8" value="500" />
                                </div>
                            </div>
                            <div>
                                <label class="form-label">Cart Rental Fee</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">‚Çø</span>
                                    <input type="number" class="form-input pl-8" value="800" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Staff Settings -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Staff Settings</h3>
                        </div>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium">Automatic Caddy Assignment</p>
                                    <p class="text-sm text-gray-600">Assign caddies based on availability and rating</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer" />
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium">Performance Tracking</p>
                                    <p class="text-sm text-gray-600">Track staff performance and customer ratings</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer" />
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium">Shift Notifications</p>
                                    <p class="text-sm text-gray-600">Send shift reminders to staff</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer" />
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Emergency Settings -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Emergency Settings</h3>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label class="form-label">Emergency Contact</label>
                                <input type="tel" class="form-input" value="+66-2-xxx-xxxx" />
                            </div>
                            <div>
                                <label class="form-label">Medical Team Contact</label>
                                <input type="tel" class="form-input" value="+66-2-xxx-xxxx" />
                            </div>
                            <div>
                                <label class="form-label">Security Team Contact</label>
                                <input type="tel" class="form-input" value="+66-2-xxx-xxxx" />
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium">Emergency Broadcasts</p>
                                    <p class="text-sm text-gray-600">Send alerts to all staff and players</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer" />
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Save Settings -->
                <div class="mt-8 flex justify-end space-x-4">
                    <button class="btn-outline">Reset to Default</button>
                    <button class="btn-primary">Save Settings</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Pro Shop Dashboard -->
    <div id="proshopDashboard" class="screen">
        <header class="nav-header">
            <div class="max-w-7xl mx-auto px-4 lg:px-8">
                <div class="flex justify-between items-center py-3 md:py-5">
                    <div class="flex items-center space-x-2 md:space-x-4">
                        <img class="user-avatar" style="display: none;">
                        <div>
                            <h1 class="text-base md:text-xl font-bold text-gray-900">Pro Shop Dashboard</h1>
                            <p class="text-xs md:text-sm text-gray-600">Welcome back, <span class="hidden md:inline ml-1">Pro Shop </span><span class="user-name-display">Pro Shop</span>!</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button onclick="sendEmergencyAlert()" class="emergency-btn" title="Emergency Alert">
                            <span class="material-symbols-outlined">emergency</span>
                        </button>
                        <button onclick="ChatSystem.showChatInterface()" class="btn-primary relative" style="background: #10b981; padding: 10px 16px;" title="Chat">
                            <span class="material-symbols-outlined text-sm">chat</span>
                            Chat
                            <span id="chatBadge" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-medium" style="display: none;">0</span>
                        </button>
                        <button onclick="logout()" class="btn-logout">
                            <span class="material-symbols-outlined text-sm">logout</span>
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Enhanced Pro Shop Navigation -->
        <nav class="tab-navigation border-b">
            <div class="max-w-7xl mx-auto px-4 lg:px-8">
                <div class="flex space-x-2 md:space-x-8 overflow-x-auto">
                    <button onclick="showProshopTab('pos', event)" class="tab-button active px-2 md:px-4" id="proshop-pos-tab">
                        <span class="material-symbols-outlined text-sm">point_of_sale</span>
                        <span class="hidden sm:inline ml-1">Point of Sale</span>
                    </button>
                    <button onclick="showProshopTab('inventory', event)" class="tab-button px-2 md:px-4" id="proshop-inventory-tab">
                        <span class="material-symbols-outlined text-sm">inventory</span>
                        <span class="hidden sm:inline ml-1">Inventory</span>
                    </button>
                    <button onclick="showProshopTab('sales', event)" class="tab-button px-2 md:px-4" id="proshop-sales-tab">
                        <span class="material-symbols-outlined text-sm">trending_up</span>
                        <span class="hidden sm:inline ml-1">Sales Reports</span>
                    </button>
                    <button onclick="showProshopTab('customers', event)" class="tab-button px-2 md:px-4" id="proshop-customers-tab">
                        <span class="material-symbols-outlined text-sm">people</span>
                        <span class="hidden sm:inline ml-1">Customers</span>
                    </button>
                    <button onclick="showProshopTab('settings', event)" class="tab-button px-2 md:px-4" id="proshop-settings-tab">
                        <span class="material-symbols-outlined text-sm">settings</span>
                        <span class="hidden sm:inline ml-1">Settings</span>
                    </button>
                </div>
            </div>
        </nav>

        <main class="max-w-7xl mx-auto px-6 lg:px-8 py-8">
            <!-- Point of Sale Tab -->
            <div id="proshop-pos" class="tab-content active">
                <!-- Pro Shop Hero Section -->
                <div class="hero-section bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-3xl p-8 mb-8">
                    <div class="flex flex-col lg:flex-row justify-between items-center">
                        <div class="text-center lg:text-left mb-6 lg:mb-0">
                            <h2 class="text-3xl font-bold mb-2">Pro Shop POS</h2>
                            <p class="text-purple-100 text-lg">Golf Equipment & Merchandise</p>
                            <div class="flex flex-wrap justify-center lg:justify-start gap-6 mt-4 text-sm">
                                <div class="flex items-center gap-2">
                                    <span class="material-symbols-outlined text-lg">store</span>
                                    <span>450+ Items</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="material-symbols-outlined text-lg">shopping_cart</span>
                                    <span>28 Sales Today</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="material-symbols-outlined text-lg">star</span>
                                    <span>4.9‚òÖ Service</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl font-bold">‚Çø45,280</div>
                            <div class="text-purple-200">Today's Sales</div>
                            <div class="text-sm text-purple-200 mt-1">+8% vs yesterday</div>
                        </div>
                    </div>
                </div>

                <!-- Persistent Emergency Alerts -->
                <div id="proshop-emergency-alerts" class="persistent-emergency-alerts mb-6" style="display: none;">
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-2">
                                <span class="material-symbols-outlined text-red-600">emergency</span>
                                <h3 class="text-lg font-bold text-red-800">Active Emergency Alerts</h3>
                            </div>
                            <span id="proshop-alert-count" class="bg-red-600 text-white text-xs px-2 py-1 rounded-full font-medium">0</span>
                        </div>
                        <div id="proshop-alert-list" class="space-y-2">
                            <!-- Emergency alerts will be populated here -->
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Product Categories & Search -->
                    <div class="lg:col-span-2">
                        <!-- Search & Categories -->
                        <div class="mb-6">
                            <div class="flex flex-col sm:flex-row gap-4 mb-4">
                                <div class="flex-1 relative">
                                    <span class="material-symbols-outlined absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">search</span>
                                    <input type="text" placeholder="Search products..." class="form-input pl-10" id="product-search" />
                                </div>
                                <select class="form-select" id="category-filter">
                                    <option value="">All Categories</option>
                                    <option value="clubs">Golf Clubs</option>
                                    <option value="balls">Golf Balls</option>
                                    <option value="apparel">Apparel</option>
                                    <option value="accessories">Accessories</option>
                                    <option value="drinks">Beverages</option>
                                    <option value="snacks">Snacks</option>
                                </select>
                            </div>

                            <!-- Category Tabs -->
                            <div class="flex space-x-2 overflow-x-auto pb-2 mb-4">
                                <button class="category-tab active" data-category="all">All</button>
                                <button class="category-tab" data-category="clubs">Clubs</button>
                                <button class="category-tab" data-category="balls">Balls</button>
                                <button class="category-tab" data-category="apparel">Apparel</button>
                                <button class="category-tab" data-category="accessories">Accessories</button>
                                <button class="category-tab" data-category="drinks">Drinks</button>
                                <button class="category-tab" data-category="snacks">Snacks</button>
                            </div>
                        </div>

                        <!-- Product Grid -->
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="product-grid">
                            <!-- Golf Clubs -->
                            <div class="product-card" data-category="clubs" onclick="addToCart('Driver - Titleist TSR3', 12500, 'CLUB001')">
                                <div class="product-image bg-blue-100 rounded-lg aspect-square flex items-center justify-center mb-2">
                                    <span class="material-symbols-outlined text-3xl text-blue-600">golf_course</span>
                                </div>
                                <h4 class="font-medium text-sm mb-1">Driver - Titleist TSR3</h4>
                                <p class="text-xs text-gray-600 mb-2">Premium driver club</p>
                                <p class="font-bold text-purple-600">‚Çø12,500</p>
                                <p class="text-xs text-gray-500">Stock: 8</p>
                            </div>

                            <div class="product-card" data-category="clubs" onclick="addToCart('Iron Set - Mizuno JPX923', 28500, 'CLUB002')">
                                <div class="product-image bg-green-100 rounded-lg aspect-square flex items-center justify-center mb-2">
                                    <span class="material-symbols-outlined text-3xl text-green-600">golf_course</span>
                                </div>
                                <h4 class="font-medium text-sm mb-1">Iron Set - Mizuno JPX923</h4>
                                <p class="text-xs text-gray-600 mb-2">7-piece iron set</p>
                                <p class="font-bold text-purple-600">‚Çø28,500</p>
                                <p class="text-xs text-gray-500">Stock: 5</p>
                            </div>

                            <!-- Golf Balls -->
                            <div class="product-card" data-category="balls" onclick="addToCart('Pro V1 Golf Balls (12)', 1800, 'BALL001')">
                                <div class="product-image bg-yellow-100 rounded-lg aspect-square flex items-center justify-center mb-2">
                                    <span class="material-symbols-outlined text-3xl text-yellow-600">sports_golf</span>
                                </div>
                                <h4 class="font-medium text-sm mb-1">Pro V1 Golf Balls (12)</h4>
                                <p class="text-xs text-gray-600 mb-2">Premium golf balls</p>
                                <p class="font-bold text-purple-600">‚Çø1,800</p>
                                <p class="text-xs text-gray-500">Stock: 45</p>
                            </div>

                            <div class="product-card" data-category="balls" onclick="addToCart('Callaway Chrome Soft (12)', 1650, 'BALL002')">
                                <div class="product-image bg-orange-100 rounded-lg aspect-square flex items-center justify-center mb-2">
                                    <span class="material-symbols-outlined text-3xl text-orange-600">sports_golf</span>
                                </div>
                                <h4 class="font-medium text-sm mb-1">Callaway Chrome Soft (12)</h4>
                                <p class="text-xs text-gray-600 mb-2">Soft feel golf balls</p>
                                <p class="font-bold text-purple-600">‚Çø1,650</p>
                                <p class="text-xs text-gray-500">Stock: 32</p>
                            </div>

                            <!-- Apparel -->
                            <div class="product-card" data-category="apparel" onclick="addToCart('Nike Polo Shirt', 2200, 'APPAREL001')">
                                <div class="product-image bg-red-100 rounded-lg aspect-square flex items-center justify-center mb-2">
                                    <span class="material-symbols-outlined text-3xl text-red-600">checkroom</span>
                                </div>
                                <h4 class="font-medium text-sm mb-1">Nike Polo Shirt</h4>
                                <p class="text-xs text-gray-600 mb-2">Moisture-wicking polo</p>
                                <p class="font-bold text-purple-600">‚Çø2,200</p>
                                <p class="text-xs text-gray-500">Stock: 25</p>
                            </div>

                            <div class="product-card" data-category="apparel" onclick="addToCart('Adidas Golf Shoes', 4800, 'APPAREL002')">
                                <div class="product-image bg-indigo-100 rounded-lg aspect-square flex items-center justify-center mb-2">
                                    <span class="material-symbols-outlined text-3xl text-indigo-600">footwear</span>
                                </div>
                                <h4 class="font-medium text-sm mb-1">Adidas Golf Shoes</h4>
                                <p class="text-xs text-gray-600 mb-2">Waterproof golf shoes</p>
                                <p class="font-bold text-purple-600">‚Çø4,800</p>
                                <p class="text-xs text-gray-500">Stock: 18</p>
                            </div>

                            <!-- Beverages -->
                            <div class="product-card" data-category="drinks" onclick="addToCart('Sports Drink', 45, 'DRINK001')">
                                <div class="product-image bg-teal-100 rounded-lg aspect-square flex items-center justify-center mb-2">
                                    <span class="material-symbols-outlined text-3xl text-teal-600">local_drink</span>
                                </div>
                                <h4 class="font-medium text-sm mb-1">Sports Drink</h4>
                                <p class="text-xs text-gray-600 mb-2">Electrolyte drink</p>
                                <p class="font-bold text-purple-600">‚Çø45</p>
                                <p class="text-xs text-gray-500">Stock: 85</p>
                            </div>

                            <div class="product-card" data-category="drinks" onclick="addToCart('Bottled Water', 25, 'DRINK002')">
                                <div class="product-image bg-cyan-100 rounded-lg aspect-square flex items-center justify-center mb-2">
                                    <span class="material-symbols-outlined text-3xl text-cyan-600">water_drop</span>
                                </div>
                                <h4 class="font-medium text-sm mb-1">Bottled Water</h4>
                                <p class="text-xs text-gray-600 mb-2">Premium water</p>
                                <p class="font-bold text-purple-600">‚Çø25</p>
                                <p class="text-xs text-gray-500">Stock: 120</p>
                            </div>
                        </div>
                    </div>

                    <!-- Shopping Cart -->
                    <div class="lg:col-span-1">
                        <div class="card sticky top-4">
                            <div class="card-header">
                                <h3 class="card-title">Shopping Cart</h3>
                                <button onclick="clearCart()" class="btn-sm btn-outline">Clear</button>
                            </div>

                            <div id="cart-items" class="space-y-3 mb-4">
                                <div class="text-center py-8 text-gray-500">
                                    <span class="material-symbols-outlined text-4xl mb-2 block">shopping_cart</span>
                                    <p class="text-sm">Cart is empty</p>
                                    <p class="text-xs">Add products to start a sale</p>
                                </div>
                            </div>

                            <div class="border-t pt-4">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-medium">Subtotal:</span>
                                    <span class="font-bold" id="cart-subtotal">‚Çø0</span>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm text-gray-600">Tax (7%):</span>
                                    <span class="text-sm" id="cart-tax">‚Çø0</span>
                                </div>
                                <div class="flex justify-between items-center mb-4 text-lg font-bold">
                                    <span>Total:</span>
                                    <span id="cart-total">‚Çø0</span>
                                </div>

                                <div class="space-y-2">
                                    <button onclick="processPayment('cash')" class="btn-primary w-full" id="cash-btn" disabled>
                                        <span class="material-symbols-outlined text-sm mr-2">payments</span>
                                        Cash Payment
                                    </button>
                                    <button onclick="processPayment('card')" class="btn-outline w-full" id="card-btn" disabled>
                                        <span class="material-symbols-outlined text-sm mr-2">credit_card</span>
                                        Card Payment
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inventory Tab -->
            <div id="proshop-inventory" class="tab-content hidden">
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <h2 class="text-2xl font-bold text-gray-900">Inventory Management</h2>
                        <div class="flex flex-wrap gap-3">
                            <button class="btn-sm btn-outline">
                                <span class="material-symbols-outlined text-sm">add</span>
                                Add Product
                            </button>
                            <button class="btn-sm btn-outline">
                                <span class="material-symbols-outlined text-sm">upload</span>
                                Import CSV
                            </button>
                            <button class="btn-sm btn-primary">
                                <span class="material-symbols-outlined text-sm">download</span>
                                Export Report
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Inventory Stats -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Total Products</p>
                                <p class="text-2xl font-bold text-gray-900">453</p>
                                <p class="text-xs text-green-600">+12 this month</p>
                            </div>
                            <div class="stat-icon bg-blue-100">
                                <span class="material-symbols-outlined text-blue-600">inventory</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Low Stock Items</p>
                                <p class="text-2xl font-bold text-gray-900">23</p>
                                <p class="text-xs text-red-600">Needs attention</p>
                            </div>
                            <div class="stat-icon bg-red-100">
                                <span class="material-symbols-outlined text-red-600">warning</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Total Value</p>
                                <p class="text-2xl font-bold text-gray-900">‚Çø2.1M</p>
                                <p class="text-xs text-gray-500">Inventory value</p>
                            </div>
                            <div class="stat-icon bg-green-100">
                                <span class="material-symbols-outlined text-green-600">account_balance</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Top Seller</p>
                                <p class="text-2xl font-bold text-gray-900">Pro V1</p>
                                <p class="text-xs text-green-600">145 sold this month</p>
                            </div>
                            <div class="stat-icon bg-yellow-100">
                                <span class="material-symbols-outlined text-yellow-600">star</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Inventory Table -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Product Inventory</h3>
                        <div class="flex gap-2">
                            <select class="form-select text-sm">
                                <option>All Categories</option>
                                <option>Golf Clubs</option>
                                <option>Golf Balls</option>
                                <option>Apparel</option>
                                <option>Accessories</option>
                                <option>Beverages</option>
                            </select>
                            <select class="form-select text-sm">
                                <option>All Stock Levels</option>
                                <option>Low Stock (&lt;10)</option>
                                <option>Medium Stock (10-50)</option>
                                <option>High Stock (&gt;50)</option>
                            </select>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="table-header">Product</th>
                                    <th class="table-header">SKU</th>
                                    <th class="table-header">Category</th>
                                    <th class="table-header">Stock</th>
                                    <th class="table-header">Price</th>
                                    <th class="table-header">Status</th>
                                    <th class="table-header">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <tr>
                                    <td class="table-cell">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-10 h-10 bg-blue-100 rounded flex items-center justify-center">
                                                <span class="material-symbols-outlined text-blue-600">golf_course</span>
                                            </div>
                                            <div>
                                                <p class="font-medium">Driver - Titleist TSR3</p>
                                                <p class="text-sm text-gray-600">Premium driver club</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="table-cell font-mono text-sm">CLUB001</td>
                                    <td class="table-cell">Golf Clubs</td>
                                    <td class="table-cell">
                                        <span class="px-2 py-1 bg-red-100 text-red-800 text-sm rounded-full">8 units</span>
                                    </td>
                                    <td class="table-cell font-bold">‚Çø12,500</td>
                                    <td class="table-cell">
                                        <span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full">Low Stock</span>
                                    </td>
                                    <td class="table-cell">
                                        <div class="flex space-x-2">
                                            <button class="btn-sm btn-outline">Edit</button>
                                            <button class="btn-sm btn-outline">Reorder</button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="table-cell">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-10 h-10 bg-yellow-100 rounded flex items-center justify-center">
                                                <span class="material-symbols-outlined text-yellow-600">sports_golf</span>
                                            </div>
                                            <div>
                                                <p class="font-medium">Pro V1 Golf Balls (12)</p>
                                                <p class="text-sm text-gray-600">Premium golf balls</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="table-cell font-mono text-sm">BALL001</td>
                                    <td class="table-cell">Golf Balls</td>
                                    <td class="table-cell">
                                        <span class="px-2 py-1 bg-green-100 text-green-800 text-sm rounded-full">45 units</span>
                                    </td>
                                    <td class="table-cell font-bold">‚Çø1,800</td>
                                    <td class="table-cell">
                                        <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">In Stock</span>
                                    </td>
                                    <td class="table-cell">
                                        <div class="flex space-x-2">
                                            <button class="btn-sm btn-outline">Edit</button>
                                            <button class="btn-sm btn-outline">Reorder</button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="table-cell">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-10 h-10 bg-red-100 rounded flex items-center justify-center">
                                                <span class="material-symbols-outlined text-red-600">checkroom</span>
                                            </div>
                                            <div>
                                                <p class="font-medium">Nike Polo Shirt</p>
                                                <p class="text-sm text-gray-600">Moisture-wicking polo</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="table-cell font-mono text-sm">APPAREL001</td>
                                    <td class="table-cell">Apparel</td>
                                    <td class="table-cell">
                                        <span class="px-2 py-1 bg-green-100 text-green-800 text-sm rounded-full">25 units</span>
                                    </td>
                                    <td class="table-cell font-bold">‚Çø2,200</td>
                                    <td class="table-cell">
                                        <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">In Stock</span>
                                    </td>
                                    <td class="table-cell">
                                        <div class="flex space-x-2">
                                            <button class="btn-sm btn-outline">Edit</button>
                                            <button class="btn-sm btn-outline">Reorder</button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Sales Reports Tab -->
            <div id="proshop-sales" class="tab-content hidden">
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <h2 class="text-2xl font-bold text-gray-900">Sales Reports</h2>
                        <div class="flex flex-wrap gap-3">
                            <select class="form-select text-sm">
                                <option>Today</option>
                                <option>This Week</option>
                                <option>This Month</option>
                                <option>Custom Range</option>
                            </select>
                            <button class="btn-sm btn-primary">
                                <span class="material-symbols-outlined text-sm">download</span>
                                Export
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Sales Summary -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Today's Sales</p>
                                <p class="text-2xl font-bold text-gray-900">‚Çø45,280</p>
                                <p class="text-xs text-green-600">+8% vs yesterday</p>
                            </div>
                            <div class="stat-icon bg-green-100">
                                <span class="material-symbols-outlined text-green-600">trending_up</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Transactions</p>
                                <p class="text-2xl font-bold text-gray-900">28</p>
                                <p class="text-xs text-blue-600">5 in last hour</p>
                            </div>
                            <div class="stat-icon bg-blue-100">
                                <span class="material-symbols-outlined text-blue-600">receipt</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Avg. Sale</p>
                                <p class="text-2xl font-bold text-gray-900">‚Çø1,617</p>
                                <p class="text-xs text-gray-500">Per transaction</p>
                            </div>
                            <div class="stat-icon bg-purple-100">
                                <span class="material-symbols-outlined text-purple-600">calculate</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Top Category</p>
                                <p class="text-2xl font-bold text-gray-900">Balls</p>
                                <p class="text-xs text-green-600">42% of sales</p>
                            </div>
                            <div class="stat-icon bg-yellow-100">
                                <span class="material-symbols-outlined text-yellow-600">category</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Transactions -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Transactions</h3>
                        <button class="btn-sm btn-outline">View All</button>
                    </div>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                                    <span class="material-symbols-outlined text-green-600">check_circle</span>
                                </div>
                                <div>
                                    <p class="font-medium">Transaction #1247</p>
                                    <p class="text-sm text-gray-600">Pro V1 Golf Balls x2, Sports Drink x1</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold">‚Çø3,645</p>
                                <p class="text-sm text-gray-500">2 min ago</p>
                            </div>
                        </div>

                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                    <span class="material-symbols-outlined text-blue-600">credit_card</span>
                                </div>
                                <div>
                                    <p class="font-medium">Transaction #1246</p>
                                    <p class="text-sm text-gray-600">Nike Polo Shirt, Adidas Golf Shoes</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold">‚Çø7,000</p>
                                <p class="text-sm text-gray-500">15 min ago</p>
                            </div>
                        </div>

                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center">
                                    <span class="material-symbols-outlined text-purple-600">payments</span>
                                </div>
                                <div>
                                    <p class="font-medium">Transaction #1245</p>
                                    <p class="text-sm text-gray-600">Driver - Titleist TSR3</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold">‚Çø12,500</p>
                                <p class="text-sm text-gray-500">45 min ago</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customers Tab -->
            <div id="proshop-customers" class="tab-content hidden">
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <h2 class="text-2xl font-bold text-gray-900">Customer Management</h2>
                        <div class="flex flex-wrap gap-3">
                            <div class="relative">
                                <span class="material-symbols-outlined absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">search</span>
                                <input type="text" placeholder="Search customers..." class="form-input pl-10 text-sm" />
                            </div>
                            <button class="btn-sm btn-primary">
                                <span class="material-symbols-outlined text-sm">add</span>
                                Add Customer
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Customer Stats -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Total Customers</p>
                                <p class="text-2xl font-bold text-gray-900">1,247</p>
                                <p class="text-xs text-green-600">+23 this month</p>
                            </div>
                            <div class="stat-icon bg-blue-100">
                                <span class="material-symbols-outlined text-blue-600">people</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">VIP Customers</p>
                                <p class="text-2xl font-bold text-gray-900">89</p>
                                <p class="text-xs text-yellow-600">High value customers</p>
                            </div>
                            <div class="stat-icon bg-yellow-100">
                                <span class="material-symbols-outlined text-yellow-600">star</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">Avg. Purchase</p>
                                <p class="text-2xl font-bold text-gray-900">‚Çø2,350</p>
                                <p class="text-xs text-green-600">Per customer</p>
                            </div>
                            <div class="stat-icon bg-green-100">
                                <span class="material-symbols-outlined text-green-600">account_balance_wallet</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Customer List -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Customer Database</h3>
                        <select class="form-select text-sm">
                            <option>All Customers</option>
                            <option>VIP Customers</option>
                            <option>Recent Purchases</option>
                            <option>High Spenders</option>
                        </select>
                    </div>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold">JM</div>
                                <div>
                                    <p class="font-medium">John Mitchell</p>
                                    <p class="text-sm text-gray-600">john.mitchell@email.com ‚Ä¢ +66-xx-xxx-xxxx</p>
                                    <p class="text-xs text-gray-500">Member since March 2023</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full mb-2 inline-block">VIP</span>
                                <p class="font-bold">‚Çø45,600</p>
                                <p class="text-sm text-gray-500">Total spent</p>
                            </div>
                        </div>

                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center text-white font-bold">SW</div>
                                <div>
                                    <p class="font-medium">Sarah Wilson</p>
                                    <p class="text-sm text-gray-600">sarah.wilson@email.com ‚Ä¢ +66-xx-xxx-xxxx</p>
                                    <p class="text-xs text-gray-500">Member since January 2024</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full mb-2 inline-block">Regular</span>
                                <p class="font-bold">‚Çø12,400</p>
                                <p class="text-sm text-gray-500">Total spent</p>
                            </div>
                        </div>

                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold">RC</div>
                                <div>
                                    <p class="font-medium">Robert Chen</p>
                                    <p class="text-sm text-gray-600">robert.chen@email.com ‚Ä¢ +66-xx-xxx-xxxx</p>
                                    <p class="text-xs text-gray-500">Member since November 2023</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full mb-2 inline-block">VIP</span>
                                <p class="font-bold">‚Çø32,800</p>
                                <p class="text-sm text-gray-500">Total spent</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="proshop-settings" class="tab-content hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Pro Shop Settings</h2>
                    <p class="text-gray-600">Configure POS system and shop preferences</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- POS Settings -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">POS Configuration</h3>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label class="form-label">Shop Name</label>
                                <input type="text" class="form-input" value="Pattaya Golf Pro Shop" />
                            </div>
                            <div>
                                <label class="form-label">Tax Rate (%)</label>
                                <input type="number" class="form-input" value="7" step="0.1" />
                            </div>
                            <div>
                                <label class="form-label">Receipt Footer</label>
                                <textarea class="form-textarea" rows="3">Thank you for shopping at Pattaya Golf Pro Shop! Have a great round!</textarea>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium">Print Receipts Automatically</p>
                                    <p class="text-sm text-gray-600">Auto-print receipt after each sale</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer" />
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Inventory Alerts -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Inventory Alerts</h3>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label class="form-label">Low Stock Threshold</label>
                                <input type="number" class="form-input" value="10" />
                                <p class="text-xs text-gray-500 mt-1">Alert when stock falls below this number</p>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium">Email Notifications</p>
                                    <p class="text-sm text-gray-600">Send email alerts for low stock items</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer" />
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium">Auto-Reorder Suggestions</p>
                                    <p class="text-sm text-gray-600">Suggest reorders based on sales trends</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" />
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Settings -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Payment Methods</h3>
                        </div>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <span class="material-symbols-outlined text-gray-600">payments</span>
                                    <span class="font-medium">Cash Payments</span>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer" />
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <span class="material-symbols-outlined text-gray-600">credit_card</span>
                                    <span class="font-medium">Card Payments</span>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer" />
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <span class="material-symbols-outlined text-gray-600">account_balance</span>
                                    <span class="font-medium">Member Account Charging</span>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer" />
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Discount Settings -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Discounts & Promotions</h3>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label class="form-label">VIP Discount (%)</label>
                                <input type="number" class="form-input" value="10" step="0.5" />
                            </div>
                            <div>
                                <label class="form-label">Staff Discount (%)</label>
                                <input type="number" class="form-input" value="15" step="0.5" />
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium">Happy Hour Discount</p>
                                    <p class="text-sm text-gray-600">5% off drinks 3-5 PM</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" />
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Save Settings -->
                <div class="mt-8 flex justify-end space-x-4">
                    <button class="btn-outline">Reset to Default</button>
                    <button class="btn-primary">Save Settings</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Maintenance Dashboard -->
    <div id="maintenanceDashboard" class="screen">
        <header class="nav-header">
            <div class="max-w-7xl mx-auto px-4 lg:px-8">
                <div class="flex justify-between items-center py-3 md:py-5">
                    <div class="flex items-center space-x-2 md:space-x-4">
                        <img class="user-avatar" style="display: none;">
                        <div>
                            <h1 class="text-base md:text-xl font-bold text-gray-900">Maintenance Dashboard</h1>
                            <p class="text-xs md:text-sm text-gray-600">Welcome back, <span class="hidden md:inline ml-1">Maintenance </span><span class="user-name-display">Maintenance</span>!</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button onclick="sendEmergencyAlert()" class="emergency-btn" title="Emergency Alert">
                            <span class="material-symbols-outlined">emergency</span>
                        </button>
                        <button onclick="ChatSystem.showChatInterface()" class="btn-primary relative" style="background: #10b981; padding: 10px 16px;" title="Chat">
                            <span class="material-symbols-outlined text-sm">chat</span>
                            Chat
                            <span id="chatBadge" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-medium" style="display: none;">0</span>
                        </button>
                        <button onclick="logout()" class="btn-logout">
                            <span class="material-symbols-outlined text-sm">logout</span>
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Maintenance Navigation -->
        <nav class="tab-navigation border-b">
            <div class="max-w-7xl mx-auto px-4 lg:px-8">
                <div class="flex space-x-2 md:space-x-8 overflow-x-auto">
                    <button onclick="showMaintenanceTab('overview', event)" class="tab-button active px-2 md:px-4" id="maintenance-overview-tab">
                        <span class="material-symbols-outlined text-sm">dashboard</span>
                        <span class="hidden sm:inline ml-1">Overview</span>
                    </button>
                    <button onclick="showMaintenanceTab('course-updates', event)" class="tab-button px-2 md:px-4" id="maintenance-course-updates-tab">
                        <span class="material-symbols-outlined text-sm">photo_camera</span>
                        <span class="hidden sm:inline ml-1">Course Updates</span>
                    </button>
                    <button onclick="showMaintenanceTab('tasks', event)" class="tab-button px-2 md:px-4" id="maintenance-tasks-tab">
                        <span class="material-symbols-outlined text-sm">task</span>
                        <span class="hidden sm:inline ml-1">Task Management</span>
                    </button>
                    <button onclick="showMaintenanceTab('equipment', event)" class="tab-button px-2 md:px-4" id="maintenance-equipment-tab">
                        <span class="material-symbols-outlined text-sm">build</span>
                        <span class="hidden sm:inline ml-1">Equipment</span>
                    </button>
                    <button onclick="showMaintenanceTab('schedule', event)" class="tab-button px-2 md:px-4" id="maintenance-schedule-tab">
                        <span class="material-symbols-outlined text-sm">schedule</span>
                        <span class="hidden sm:inline ml-1">Schedule</span>
                    </button>
                </div>
            </div>
        </nav>

        <main class="max-w-7xl mx-auto px-6 lg:px-8 py-8">
            <!-- Overview Tab -->
            <div id="maintenance-overview" class="tab-content active">
                <!-- Maintenance Hero Section -->
                <div class="hero-section bg-gradient-to-r from-green-600 to-emerald-700 text-white rounded-3xl p-8 mb-8">
                    <div class="flex flex-col lg:flex-row justify-between items-center">
                        <div class="text-center lg:text-left mb-6 lg:mb-0">
                            <h2 class="text-3xl font-bold mb-2">Course Maintenance</h2>
                            <p class="text-green-100 text-lg">Professional Golf Course Care</p>
                            <div class="flex flex-wrap justify-center lg:justify-start gap-6 mt-4 text-sm">
                                <div class="flex items-center gap-2">
                                    <span class="material-symbols-outlined text-lg">grass</span>
                                    <span>4 Courses Active</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="material-symbols-outlined text-lg">task_alt</span>
                                    <span>12 Tasks Today</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="material-symbols-outlined text-lg">group</span>
                                    <span>8 Crew Members</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl font-bold">95%</div>
                            <div class="text-green-200">Course Condition</div>
                            <div class="text-sm text-green-200 mt-1">Excellent rating</div>
                        </div>
                    </div>
                </div>

                <!-- Persistent Emergency Alerts -->
                <div id="maintenance-emergency-alerts" class="persistent-emergency-alerts mb-6" style="display: none;">
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-2">
                                <span class="material-symbols-outlined text-red-600">emergency</span>
                                <h3 class="text-lg font-bold text-red-800">Active Emergency Alerts</h3>
                            </div>
                            <span id="maintenance-alert-count" class="bg-red-600 text-white text-xs px-2 py-1 rounded-full font-medium">0</span>
                        </div>
                        <div id="maintenance-alert-list" class="space-y-2">
                            <!-- Emergency alerts will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="stats-card bg-white rounded-2xl p-6 border border-gray-100">
                        <div class="flex items-center justify-between mb-4">
                            <div class="p-3 bg-green-100 rounded-xl">
                                <span class="material-symbols-outlined text-2xl text-green-600">grass</span>
                            </div>
                            <span class="text-2xl font-bold text-gray-800">18</span>
                        </div>
                        <h3 class="text-sm font-medium text-gray-600 mb-1">Holes Maintained</h3>
                        <p class="text-xs text-green-600">+2 this week</p>
                    </div>

                    <div class="stats-card bg-white rounded-2xl p-6 border border-gray-100">
                        <div class="flex items-center justify-between mb-4">
                            <div class="p-3 bg-blue-100 rounded-xl">
                                <span class="material-symbols-outlined text-2xl text-blue-600">water_drop</span>
                            </div>
                            <span class="text-2xl font-bold text-gray-800">6.2</span>
                        </div>
                        <h3 class="text-sm font-medium text-gray-600 mb-1">Water Usage (hrs)</h3>
                        <p class="text-xs text-blue-600">Optimal level</p>
                    </div>

                    <div class="stats-card bg-white rounded-2xl p-6 border border-gray-100">
                        <div class="flex items-center justify-between mb-4">
                            <div class="p-3 bg-yellow-100 rounded-xl">
                                <span class="material-symbols-outlined text-2xl text-yellow-600">build</span>
                            </div>
                            <span class="text-2xl font-bold text-gray-800">3</span>
                        </div>
                        <h3 class="text-sm font-medium text-gray-600 mb-1">Equipment Issues</h3>
                        <p class="text-xs text-yellow-600">Needs attention</p>
                    </div>

                    <div class="stats-card bg-white rounded-2xl p-6 border border-gray-100">
                        <div class="flex items-center justify-between mb-4">
                            <div class="p-3 bg-purple-100 rounded-xl">
                                <span class="material-symbols-outlined text-2xl text-purple-600">schedule</span>
                            </div>
                            <span class="text-2xl font-bold text-gray-800">8</span>
                        </div>
                        <h3 class="text-sm font-medium text-gray-600 mb-1">Pending Tasks</h3>
                        <p class="text-xs text-purple-600">Due today</p>
                    </div>
                </div>

                <!-- Today's Tasks -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white rounded-2xl p-6 border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-800 mb-6">Today's Priority Tasks</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-4 bg-red-50 rounded-xl border border-red-100">
                                <div class="flex items-center space-x-4">
                                    <div class="p-2 bg-red-100 rounded-lg">
                                        <span class="material-symbols-outlined text-red-600">grass</span>
                                    </div>
                                    <div>
                                        <h4 class="font-medium text-gray-800">Greens Cutting - Course A</h4>
                                        <p class="text-sm text-gray-600">Holes 1-9 greens maintenance</p>
                                    </div>
                                </div>
                                <span class="px-3 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full">High</span>
                            </div>

                            <div class="flex items-center justify-between p-4 bg-yellow-50 rounded-xl border border-yellow-100">
                                <div class="flex items-center space-x-4">
                                    <div class="p-2 bg-yellow-100 rounded-lg">
                                        <span class="material-symbols-outlined text-yellow-600">water_drop</span>
                                    </div>
                                    <div>
                                        <h4 class="font-medium text-gray-800">Bunker Maintenance</h4>
                                        <p class="text-sm text-gray-600">Sand replacement holes 5, 12, 16</p>
                                    </div>
                                </div>
                                <span class="px-3 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded-full">Medium</span>
                            </div>

                            <div class="flex items-center justify-between p-4 bg-blue-50 rounded-xl border border-blue-100">
                                <div class="flex items-center space-x-4">
                                    <div class="p-2 bg-blue-100 rounded-lg">
                                        <span class="material-symbols-outlined text-blue-600">build</span>
                                    </div>
                                    <div>
                                        <h4 class="font-medium text-gray-800">Equipment Check</h4>
                                        <p class="text-sm text-gray-600">Daily inspection of mowers</p>
                                    </div>
                                </div>
                                <span class="px-3 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-full">Low</span>
                            </div>
                        </div>
                    </div>

                    <!-- Weather & Conditions -->
                    <div class="bg-white rounded-2xl p-6 border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-800 mb-6">Weather & Course Conditions</h3>

                        <div class="mb-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center space-x-3">
                                    <span class="material-symbols-outlined text-3xl text-yellow-500">wb_sunny</span>
                                    <div>
                                        <h4 class="font-semibold text-gray-800">Sunny</h4>
                                        <p class="text-sm text-gray-600">Perfect for maintenance</p>
                                    </div>
                                </div>
                                <span class="text-3xl font-bold text-gray-800">28¬∞C</span>
                            </div>

                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Humidity:</span>
                                    <span class="font-medium">65%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Wind:</span>
                                    <span class="font-medium">12 km/h</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">UV Index:</span>
                                    <span class="font-medium">High</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Rain Chance:</span>
                                    <span class="font-medium">5%</span>
                                </div>
                            </div>
                        </div>

                        <div class="pt-4 border-t border-gray-100">
                            <h4 class="font-medium text-gray-800 mb-3">Course Status</h4>
                            <div class="space-y-2">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Course A (Holes 1-9)</span>
                                    <span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded">Excellent</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Course B (Holes 10-18)</span>
                                    <span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded">Excellent</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Practice Range</span>
                                    <span class="px-2 py-1 bg-yellow-100 text-yellow-700 text-xs font-medium rounded">Good</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-gray-600">Putting Green</span>
                                    <span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded">Excellent</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Course Updates Tab (Photo Upload) -->
            <div id="maintenance-course-updates" class="tab-content">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Live Course Updates</h2>
                    <p class="text-gray-600">Report course conditions with photos and detailed descriptions</p>
                </div>

                <!-- Course Update Form -->
                <div class="bg-white rounded-2xl p-6 border border-gray-100 mb-8">
                    <h3 class="text-lg font-semibold text-gray-800 mb-6">Submit Course Update</h3>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Left Column - Course Selection -->
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Course Section</label>
                                <select id="courseSection" class="form-select w-full">
                                    <option value="">Select course section...</option>
                                    <option value="A">Course A (Holes 1-9)</option>
                                    <option value="B">Course B (Holes 10-18)</option>
                                    <option value="C">Course C (Practice Range)</option>
                                    <option value="D">Course D (Putting Green)</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Hole Number</label>
                                <select id="holeNumber" class="form-select w-full">
                                    <option value="">Select hole number...</option>
                                    <!-- Options will be populated based on course selection -->
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Area Type</label>
                                <select id="areaType" class="form-select w-full">
                                    <option value="">Select area type...</option>
                                    <option value="tee-box">Tee Box</option>
                                    <option value="fairway">Fairway</option>
                                    <option value="rough">Rough</option>
                                    <option value="fairway-bunker">Fairway Bunker</option>
                                    <option value="greenside-bunker">Greenside Bunker</option>
                                    <option value="green">Green</option>
                                    <option value="flag-cup">Flag and Cup</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Issue Priority</label>
                                <select id="issuePriority" class="form-select w-full">
                                    <option value="low">Low - Routine maintenance</option>
                                    <option value="medium">Medium - Needs attention</option>
                                    <option value="high">High - Urgent repair</option>
                                    <option value="critical">Critical - Safety concern</option>
                                </select>
                            </div>
                        </div>

                        <!-- Right Column - Description & Photo -->
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                <textarea id="issueDescription" rows="6" class="form-input w-full" placeholder="Describe the issue or condition in detail..."></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Upload Photos</label>
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors">
                                    <input type="file" id="coursePhotos" multiple accept="image/*" class="hidden" onchange="handlePhotoUpload(event)">
                                    <span class="material-symbols-outlined text-4xl text-gray-400 mb-2">photo_camera</span>
                                    <p class="text-gray-600 mb-2">Click to upload photos or drag and drop</p>
                                    <button type="button" onclick="document.getElementById('coursePhotos').click()" class="btn-primary">
                                        <span class="material-symbols-outlined text-sm">upload</span>
                                        Choose Photos
                                    </button>
                                </div>
                                <div id="photoPreview" class="grid grid-cols-2 gap-2 mt-4"></div>
                            </div>

                            <button onclick="submitCourseUpdate()" class="btn-primary w-full">
                                <span class="material-symbols-outlined text-sm">send</span>
                                Submit Course Update
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Recent Updates -->
                <div class="bg-white rounded-2xl p-6 border border-gray-100">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-gray-800">Recent Course Updates</h3>
                        <select class="form-select" style="width: auto;">
                            <option value="all">All Courses</option>
                            <option value="A">Course A</option>
                            <option value="B">Course B</option>
                            <option value="C">Course C</option>
                            <option value="D">Course D</option>
                        </select>
                    </div>

                    <div id="recentUpdates" class="space-y-4">
                        <!-- Sample updates will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Other maintenance tabs will be added here -->
            <div id="maintenance-tasks" class="tab-content">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Task Management</h2>
                <p class="text-gray-600">Coming soon - Comprehensive task management system</p>
            </div>

            <div id="maintenance-equipment" class="tab-content">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Equipment Management</h2>
                <p class="text-gray-600">Coming soon - Equipment tracking and maintenance</p>
            </div>

            <div id="maintenance-schedule" class="tab-content">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Maintenance Schedule</h2>
                <p class="text-gray-600">Coming soon - Scheduling system for maintenance activities</p>
            </div>
        </main>
    </div>

    <!-- Add Score Modal -->
    <div id="addScoreModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" style="display: none;">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-screen overflow-hidden">
            <div class="flex items-center justify-between p-6 border-b border-gray-200">
                <h3 class="text-2xl font-bold text-gray-900">Add Golf Score</h3>
                <button onclick="closeAddScoreModal()" class="text-gray-400 hover:text-gray-600">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>

            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Course Name</label>
                    <input type="text" id="courseName" placeholder="e.g., Pattaya Golf Club"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Course Rating</label>
                        <input type="number" id="courseRating" placeholder="72.1" step="0.1" min="60" max="80"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Slope Rating</label>
                        <input type="number" id="slopeRating" placeholder="113" min="55" max="155"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Score</label>
                        <input type="number" id="scoreValue" placeholder="72" min="30" max="150"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Holes</label>
                        <select id="holesPlayed" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                            <option value="18">18 Holes</option>
                            <option value="9">9 Holes</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Date Played</label>
                    <input type="date" id="datePlayed"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Notes (Optional)</label>
                    <textarea id="scoreNotes" placeholder="Great weather, played with friends..." rows="3"
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500"></textarea>
                </div>
            </div>

            <div class="flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50">
                <button onclick="closeAddScoreModal()" class="px-6 py-3 text-gray-700 bg-gray-200 rounded-xl font-semibold hover:bg-gray-300 transition-colors">
                    Cancel
                </button>
                <button onclick="saveGolfScore()" class="px-6 py-3 bg-primary-600 text-white rounded-xl font-semibold hover:bg-primary-700 transition-colors">
                    Save Score
                </button>
            </div>
        </div>
    </div>

    <script>
        // Golf Score Management System with WHS Handicap
        const GolfScoreSystem = {
            scores: JSON.parse(localStorage.getItem('mcipro_golf_scores') || '[]'),

            saveScore(scoreData) {
                const newScore = {
                    id: Date.now(),
                    course: scoreData.course,
                    score: parseInt(scoreData.score),
                    holes: parseInt(scoreData.holes),
                    courseRating: parseFloat(scoreData.courseRating) || (scoreData.holes === 18 ? 72.0 : 36.0),
                    slopeRating: parseInt(scoreData.slopeRating) || 113,
                    date: scoreData.date,
                    notes: scoreData.notes || '',
                    timestamp: new Date().toISOString(),
                    differential: null
                };

                // Calculate score differential for WHS
                newScore.differential = this.calculateDifferential(newScore);

                this.scores.unshift(newScore); // Add to beginning for recent first
                localStorage.setItem('mcipro_golf_scores', JSON.stringify(this.scores));
                this.updateStatistics();
                this.refreshRecentRounds();
            },

            // WHS Score Differential Calculation
            calculateDifferential(scoreData) {
                if (scoreData.holes !== 18) return null; // Only calculate for 18-hole rounds

                const { score, courseRating, slopeRating } = scoreData;

                // WHS Formula: (Adjusted Gross Score - Course Rating) √ó 113 √∑ Slope Rating
                const differential = (score - courseRating) * 113 / slopeRating;
                return Math.round(differential * 10) / 10; // Round to 1 decimal place
            },

            // WHS Handicap Index Calculation
            calculateHandicapIndex() {
                const validScores = this.scores.filter(s => s.holes === 18 && s.differential !== null);

                if (validScores.length < 3) {
                    return null; // Need at least 3 scores for WHS
                }

                // Sort by differential (best to worst)
                const sortedDifferentials = validScores
                    .map(s => s.differential)
                    .sort((a, b) => a - b);

                let handicapIndex;
                const numScores = sortedDifferentials.length;

                if (numScores >= 20) {
                    // Use best 8 of most recent 20 scores
                    const recent20 = sortedDifferentials.slice(0, 20);
                    const best8 = recent20.slice(0, 8);
                    handicapIndex = best8.reduce((sum, diff) => sum + diff, 0) / 8;
                } else if (numScores >= 5) {
                    // Use best 1-3 scores based on WHS table
                    const numToUse = Math.floor(numScores / 4) || 1;
                    const bestScores = sortedDifferentials.slice(0, Math.max(1, numToUse));
                    handicapIndex = bestScores.reduce((sum, diff) => sum + diff, 0) / bestScores.length;
                } else {
                    // 3-4 scores: use best 1
                    handicapIndex = sortedDifferentials[0];
                }

                return Math.round(handicapIndex * 10) / 10; // Round to 1 decimal place
            },

            updateStatistics() {
                if (this.scores.length === 0) return;

                // Calculate WHS Handicap Index
                const whsHandicap = this.calculateHandicapIndex();
                const handicapElements = document.querySelectorAll('.user-handicap');
                handicapElements.forEach(el => {
                    if (whsHandicap !== null) {
                        el.textContent = whsHandicap.toFixed(1);
                        el.setAttribute('title', `WHS Handicap Index (${this.scores.filter(s => s.holes === 18).length} qualifying rounds)`);
                    } else {
                        el.textContent = 'N/A';
                        el.setAttribute('title', 'Need at least 3 eighteen-hole rounds for WHS handicap');
                    }
                });

                // Calculate average score (only for 18-hole rounds)
                const validScores = this.scores.filter(s => s.holes === 18);
                const avgScoreElements = document.querySelectorAll('#golfer-stats .metric-value');

                if (validScores.length > 0) {
                    const average = validScores.reduce((sum, s) => sum + s.score, 0) / validScores.length;
                    // Find average score element (2nd metric-value in stats section)
                    if (avgScoreElements[1]) {
                        avgScoreElements[1].textContent = average.toFixed(1);
                    }

                    // Update best score (3rd metric-value in stats section)
                    const bestScore = Math.min(...validScores.map(s => s.score));
                    if (avgScoreElements[2]) {
                        avgScoreElements[2].textContent = bestScore;
                    }
                } else {
                    // No valid scores yet
                    if (avgScoreElements[1]) avgScoreElements[1].textContent = 'N/A';
                    if (avgScoreElements[2]) avgScoreElements[2].textContent = 'N/A';
                }

                // Update rounds played (4th metric-value in stats section)
                if (avgScoreElements[3]) {
                    avgScoreElements[3].textContent = this.scores.length;
                }
            },

            refreshRecentRounds() {
                const container = document.querySelector('#golfer-stats .space-y-3');
                if (!container) return;

                // Clear existing rounds (keep only the first 3 demo rounds for now)
                const demoRounds = container.children.length;

                // Add new scores at the top
                this.scores.slice(0, 5).forEach((score, index) => {
                    const roundElement = this.createRoundElement(score);
                    if (index === 0) {
                        container.insertBefore(roundElement, container.firstChild);
                    } else {
                        container.insertBefore(roundElement, container.children[index]);
                    }
                });
            },

            createRoundElement(score) {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-4 bg-gray-50 rounded-lg';

                const par = score.holes === 18 ? 72 : 36;
                const scoreToPar = score.score - par;
                const parDisplay = scoreToPar === 0 ? 'Par' :
                                 scoreToPar > 0 ? `+${scoreToPar} Par` : `${scoreToPar} Par`;
                const parColor = scoreToPar === 0 ? 'text-yellow-600' :
                               scoreToPar > 0 ? 'text-red-600' : 'text-green-600';

                const formattedDate = new Date(score.date).toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric'
                });

                const differentialDisplay = score.differential !== null ?
                    `<div class="text-xs text-blue-600 mt-1">Diff: ${score.differential}</div>` : '';

                div.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center">
                            <span class="material-symbols-outlined text-primary-600">golf_course</span>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-900">${score.course}</p>
                            <p class="text-sm text-gray-600">${formattedDate} ‚Ä¢ ${score.holes} holes</p>
                            ${score.courseRating ? `<p class="text-xs text-gray-500">Rating: ${score.courseRating} / Slope: ${score.slopeRating}</p>` : ''}
                            ${score.notes ? `<p class="text-xs text-gray-500 mt-1">${score.notes}</p>` : ''}
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-2xl text-primary-600">${score.score}</div>
                        <div class="text-xs ${parColor}">${parDisplay}</div>
                        ${differentialDisplay}
                    </div>
                `;

                return div;
            }
        };

        // Modal functions
        function showAddScoreModal() {
            document.getElementById('addScoreModal').style.display = 'flex';
            // Set today's date as default
            document.getElementById('datePlayed').value = new Date().toISOString().split('T')[0];
        }

        function closeAddScoreModal() {
            document.getElementById('addScoreModal').style.display = 'none';
            // Clear form
            document.getElementById('courseName').value = '';
            document.getElementById('courseRating').value = '';
            document.getElementById('slopeRating').value = '';
            document.getElementById('scoreValue').value = '';
            document.getElementById('holesPlayed').value = '18';
            document.getElementById('datePlayed').value = '';
            document.getElementById('scoreNotes').value = '';
        }

        function saveGolfScore() {
            const courseName = document.getElementById('courseName').value.trim();
            const scoreValue = document.getElementById('scoreValue').value;
            const holesPlayed = document.getElementById('holesPlayed').value;
            const courseRating = document.getElementById('courseRating').value;
            const slopeRating = document.getElementById('slopeRating').value;
            const datePlayed = document.getElementById('datePlayed').value;
            const scoreNotes = document.getElementById('scoreNotes').value.trim();

            if (!courseName || !scoreValue || !datePlayed) {
                alert('Please fill in all required fields (Course Name, Score, Date).');
                return;
            }

            const score = parseInt(scoreValue);
            if (score < 30 || score > 150) {
                alert('Please enter a valid score between 30 and 150.');
                return;
            }

            // Validate course/slope ratings if provided
            if (courseRating && (courseRating < 60 || courseRating > 80)) {
                alert('Course rating should be between 60.0 and 80.0');
                return;
            }

            if (slopeRating && (slopeRating < 55 || slopeRating > 155)) {
                alert('Slope rating should be between 55 and 155');
                return;
            }

            GolfScoreSystem.saveScore({
                course: courseName,
                score: scoreValue,
                holes: holesPlayed,
                courseRating: courseRating,
                slopeRating: slopeRating,
                date: datePlayed,
                notes: scoreNotes
            });

            closeAddScoreModal();

            // Show success message
            const successDiv = document.createElement('div');
            successDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            successDiv.innerHTML = `
                <div class="flex items-center space-x-2">
                    <span class="material-symbols-outlined">check_circle</span>
                    <span>Score saved successfully!</span>
                </div>
            `;
            document.body.appendChild(successDiv);
            setTimeout(() => successDiv.remove(), 3000);
        }

        // Initialize scores on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                GolfScoreSystem.updateStatistics();
                GolfScoreSystem.refreshRecentRounds();
            }, 1000);
        });

        // Round History Functions
        function addNewRound() {
            // This will use the existing add score modal
            showAddScoreModal();
        }

        function viewRoundDetails(roundId) {
            // Create round details modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto mx-4">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-900">Round Details</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <span class="material-symbols-outlined">close</span>
                        </button>
                    </div>

                    <!-- Round Summary -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="metric-card text-center">
                            <div class="font-bold text-2xl text-primary-600">76</div>
                            <div class="text-sm text-gray-600">Total Score</div>
                        </div>
                        <div class="metric-card text-center">
                            <div class="font-bold text-2xl text-blue-600">+4</div>
                            <div class="text-sm text-gray-600">To Par</div>
                        </div>
                        <div class="metric-card text-center">
                            <div class="font-bold text-2xl text-green-600">8.2</div>
                            <div class="text-sm text-gray-600">Handicap Diff</div>
                        </div>
                        <div class="metric-card text-center">
                            <div class="font-bold text-2xl text-purple-600">12.4</div>
                            <div class="text-sm text-gray-600">Handicap Index</div>
                        </div>
                    </div>

                    <!-- Course Info -->
                    <div class="metric-card mb-6">
                        <h4 class="font-bold text-gray-900 mb-3">Course Information</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                            <div><span class="font-medium">Course:</span> Phuket Country Club</div>
                            <div><span class="font-medium">Date:</span> Dec 28, 2024</div>
                            <div><span class="font-medium">Tees:</span> Championship</div>
                            <div><span class="font-medium">Weather:</span> Sunny, 78¬∞F</div>
                        </div>
                    </div>

                    <!-- Hole by Hole Scorecard -->
                    <div class="metric-card">
                        <h4 class="font-bold text-gray-900 mb-3">Scorecard</h4>
                        <div class="overflow-x-auto">
                            <table class="min-w-full text-sm">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-2 px-3">Hole</th>
                                        <th class="text-center py-2 px-3">1</th>
                                        <th class="text-center py-2 px-3">2</th>
                                        <th class="text-center py-2 px-3">3</th>
                                        <th class="text-center py-2 px-3">4</th>
                                        <th class="text-center py-2 px-3">5</th>
                                        <th class="text-center py-2 px-3">6</th>
                                        <th class="text-center py-2 px-3">7</th>
                                        <th class="text-center py-2 px-3">8</th>
                                        <th class="text-center py-2 px-3">9</th>
                                        <th class="text-center py-2 px-3 font-bold">Out</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-b border-gray-100">
                                        <td class="py-2 px-3 font-medium">Par</td>
                                        <td class="text-center py-2 px-3">4</td>
                                        <td class="text-center py-2 px-3">3</td>
                                        <td class="text-center py-2 px-3">5</td>
                                        <td class="text-center py-2 px-3">4</td>
                                        <td class="text-center py-2 px-3">4</td>
                                        <td class="text-center py-2 px-3">3</td>
                                        <td class="text-center py-2 px-3">4</td>
                                        <td class="text-center py-2 px-3">5</td>
                                        <td class="text-center py-2 px-3">3</td>
                                        <td class="text-center py-2 px-3 font-bold">35</td>
                                    </tr>
                                    <tr class="border-b border-gray-100">
                                        <td class="py-2 px-3 font-medium">Score</td>
                                        <td class="text-center py-2 px-3">4</td>
                                        <td class="text-center py-2 px-3">4</td>
                                        <td class="text-center py-2 px-3">6</td>
                                        <td class="text-center py-2 px-3">3</td>
                                        <td class="text-center py-2 px-3">5</td>
                                        <td class="text-center py-2 px-3">3</td>
                                        <td class="text-center py-2 px-3">4</td>
                                        <td class="text-center py-2 px-3">5</td>
                                        <td class="text-center py-2 px-3">4</td>
                                        <td class="text-center py-2 px-3 font-bold">38</td>
                                    </tr>
                                </tbody>
                            </table>

                            <table class="min-w-full text-sm mt-4">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-2 px-3">Hole</th>
                                        <th class="text-center py-2 px-3">10</th>
                                        <th class="text-center py-2 px-3">11</th>
                                        <th class="text-center py-2 px-3">12</th>
                                        <th class="text-center py-2 px-3">13</th>
                                        <th class="text-center py-2 px-3">14</th>
                                        <th class="text-center py-2 px-3">15</th>
                                        <th class="text-center py-2 px-3">16</th>
                                        <th class="text-center py-2 px-3">17</th>
                                        <th class="text-center py-2 px-3">18</th>
                                        <th class="text-center py-2 px-3 font-bold">In</th>
                                        <th class="text-center py-2 px-3 font-bold">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-b border-gray-100">
                                        <td class="py-2 px-3 font-medium">Par</td>
                                        <td class="text-center py-2 px-3">4</td>
                                        <td class="text-center py-2 px-3">3</td>
                                        <td class="text-center py-2 px-3">4</td>
                                        <td class="text-center py-2 px-3">5</td>
                                        <td class="text-center py-2 px-3">4</td>
                                        <td class="text-center py-2 px-3">3</td>
                                        <td class="text-center py-2 px-3">4</td>
                                        <td class="text-center py-2 px-3">4</td>
                                        <td class="text-center py-2 px-3">5</td>
                                        <td class="text-center py-2 px-3 font-bold">37</td>
                                        <td class="text-center py-2 px-3 font-bold">72</td>
                                    </tr>
                                    <tr class="border-b border-gray-100">
                                        <td class="py-2 px-3 font-medium">Score</td>
                                        <td class="text-center py-2 px-3">4</td>
                                        <td class="text-center py-2 px-3">2</td>
                                        <td class="text-center py-2 px-3">5</td>
                                        <td class="text-center py-2 px-3">5</td>
                                        <td class="text-center py-2 px-3">4</td>
                                        <td class="text-center py-2 px-3">4</td>
                                        <td class="text-center py-2 px-3">4</td>
                                        <td class="text-center py-2 px-3">4</td>
                                        <td class="text-center py-2 px-3">6</td>
                                        <td class="text-center py-2 px-3 font-bold">38</td>
                                        <td class="text-center py-2 px-3 font-bold text-green-600">76</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // OpenStreetMap Initialization with Leaflet
        function initOpenStreetMap() {
            // Initialize the map
            googleMap = L.map('courseMap').setView([GPSNavigationSystem.courseData.center.lat, GPSNavigationSystem.courseData.center.lng], 16);

            // Add satellite imagery tiles
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: '&copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
                maxZoom: 19
            }).addTo(googleMap);

            // Add hole markers
            addHoleMarkers();

            // Add click listener for map
            googleMap.on('click', function(event) {
                console.log('Map clicked at:', event.latlng.lat, event.latlng.lng);
            });

            // Auto-get location when map loads
            setTimeout(() => {
                getCurrentLocation();
            }, 1000);
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                if (document.getElementById('courseMap')) {
                    initOpenStreetMap();
                }
            }, 2000);
        });

        function addHoleMarkers() {
            // Clear existing markers
            holeMarkers.forEach(marker => googleMap.removeLayer(marker));
            holeMarkers = [];

            // Add markers for each hole
            GPSNavigationSystem.courseData.holes.forEach(hole => {
                // Tee box marker
                const teeIcon = L.divIcon({
                    className: 'custom-marker',
                    html: `<div style="background: #2563eb; color: white; border: 2px solid white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px;">${hole.number}</div>`,
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                });

                const teeMarker = L.marker([hole.teeBox.lat, hole.teeBox.lng], { icon: teeIcon })
                    .addTo(googleMap)
                    .bindPopup(`
                        <div class="p-2">
                            <h4 class="font-bold text-lg">Hole ${hole.number}</h4>
                            <p>Par ${hole.par} ‚Ä¢ ${hole.distance} yards</p>
                            <p class="text-sm text-gray-600">Hazards: ${hole.hazards.join(', ')}</p>
                        </div>
                    `);

                // Pin marker
                const pinIcon = L.divIcon({
                    className: 'custom-marker',
                    html: `<div style="background: #dc2626; border: 2px solid white; border-radius: 50%; width: 16px; height: 16px;"></div>`,
                    iconSize: [16, 16],
                    iconAnchor: [8, 8]
                });

                const pinMarker = L.marker([hole.pin.lat, hole.pin.lng], { icon: pinIcon })
                    .addTo(googleMap)
                    .bindPopup(`Hole ${hole.number} Pin`);

                holeMarkers.push(teeMarker, pinMarker);
            });
        }

        function updatePlayerLocation(position) {
            const playerPos = [position.lat, position.lng];

            // Update or create player marker
            if (playerMarker) {
                playerMarker.setLatLng(playerPos);
            } else {
                const playerIcon = L.divIcon({
                    className: 'custom-marker',
                    html: `<div style="background: #10b981; border: 3px solid white; border-radius: 50%; width: 24px; height: 24px; box-shadow: 0 0 20px rgba(16, 185, 129, 0.6); animation: pulse 2s infinite;"></div>`,
                    iconSize: [24, 24],
                    iconAnchor: [12, 12]
                });

                playerMarker = L.marker(playerPos, { icon: playerIcon })
                    .addTo(googleMap)
                    .bindPopup('Your Location');

                // Add CSS animation for pulsing effect
                if (!document.getElementById('pulse-animation')) {
                    const style = document.createElement('style');
                    style.id = 'pulse-animation';
                    style.textContent = `
                        @keyframes pulse {
                            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
                            70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
                            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }

            // Update accuracy display
            if (position.accuracy) {
                document.getElementById('mapAccuracy').textContent = `GPS Accuracy: ¬±${Math.round(position.accuracy)}m`;
            }

            // Calculate distances to holes
            calculateDistancesToHoles({lat: position.lat, lng: position.lng});
        }

        function calculateDistancesToHoles(playerPos) {
            let closestHole = null;
            let minDistance = Infinity;

            GPSNavigationSystem.courseData.holes.forEach(hole => {
                // Calculate distance using Leaflet's distance function (in meters)
                const distanceToPin = googleMap.distance(
                    L.latLng(playerPos.lat, playerPos.lng),
                    L.latLng(hole.pin.lat, hole.pin.lng)
                );

                if (distanceToPin < minDistance) {
                    minDistance = distanceToPin;
                    closestHole = hole;
                }
            });

            if (closestHole) {
                // Update UI with current hole info
                document.getElementById('currentHoleNum').textContent = closestHole.number;

                // Convert meters to yards (1 meter = 1.09361 yards)
                const distanceInYards = Math.round(minDistance * 1.09361);
                document.getElementById('pinDistance').textContent = `${distanceInYards} yds`;
            }
        }

        function toggleMapType() {
            if (!googleMap) return;

            if (currentMapType === 'satellite') {
                // Switch to OpenStreetMap
                googleMap.eachLayer(function(layer) {
                    if (layer._url && layer._url.includes('arcgisonline')) {
                        googleMap.removeLayer(layer);
                    }
                });
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; OpenStreetMap contributors',
                    maxZoom: 19
                }).addTo(googleMap);
                currentMapType = 'osm';
                document.querySelector('[onclick="toggleMapType()"] span:last-child').textContent = 'Street Map';
            } else {
                // Switch back to satellite
                googleMap.eachLayer(function(layer) {
                    if (layer._url && layer._url.includes('openstreetmap')) {
                        googleMap.removeLayer(layer);
                    }
                });
                L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: '&copy; Esri',
                    maxZoom: 19
                }).addTo(googleMap);
                currentMapType = 'satellite';
                document.querySelector('[onclick="toggleMapType()"] span:last-child').textContent = 'Satellite';
            }
        }

        function centerOnPlayer() {
            if (!googleMap || !playerMarker) {
                NotificationManager.show('Player location not available', 'info');
                return;
            }

            googleMap.setView(playerMarker.getLatLng(), 18);
        }

        // Caddy Live Tracking System
        const CaddyTrackingSystem = {
            isTracking: false,
            startTime: null,
            currentHole: 1,
            trackingInterval: null,
            gpsWatchId: null,

            startTracking() {
                this.isTracking = true;
                this.startTime = new Date();
                this.currentHole = 1;

                // Update main dashboard UI
                document.getElementById('trackingNotStarted').style.display = 'none';
                document.getElementById('trackingActive').style.display = 'block';
                document.getElementById('trackingCompleted').style.display = 'none';

                // Update Live Tracking tab UI
                this.updateLiveTrackingTab();

                // Start GPS tracking
                this.startGPSTracking();

                // Start time counter
                this.startTimeCounter();

                // Save state
                localStorage.setItem('caddyTrackingActive', 'true');
                localStorage.setItem('caddyTrackingStartTime', this.startTime.toISOString());

                NotificationManager.show('üèåÔ∏è Round tracking started! GPS location active', 'success');
            },

            finishTracking() {
                this.isTracking = false;
                const endTime = new Date();
                const totalTime = this.formatTime(Math.floor((endTime - this.startTime) / 1000));

                // Stop GPS tracking
                this.stopGPSTracking();

                // Stop time counter
                if (this.trackingInterval) {
                    clearInterval(this.trackingInterval);
                }

                // Update UI
                document.getElementById('trackingActive').style.display = 'none';
                document.getElementById('trackingCompleted').style.display = 'block';
                document.getElementById('finalRoundTime').textContent = totalTime;

                // Save completed round data
                this.saveCompletedRound(totalTime);

                // Clear active state
                localStorage.removeItem('caddyTrackingActive');
                localStorage.removeItem('caddyTrackingStartTime');

                NotificationManager.show('üèÅ Round completed and saved!', 'success');
            },

            resetTracking() {
                this.isTracking = false;
                this.startTime = null;
                this.currentHole = 1;

                // Reset UI
                document.getElementById('trackingNotStarted').style.display = 'block';
                document.getElementById('trackingActive').style.display = 'none';
                document.getElementById('trackingCompleted').style.display = 'none';

                NotificationManager.show('Ready for new round!', 'info');
            },

            startGPSTracking() {
                if (!navigator.geolocation) return;

                this.gpsWatchId = navigator.geolocation.watchPosition(
                    (position) => {
                        // Update location status
                        document.getElementById('locationStatus').textContent = 'üìç Live';

                        // Auto-detect hole progression (simplified)
                        this.updateHoleProgression();
                    },
                    (error) => {
                        document.getElementById('locationStatus').textContent = '‚ùå GPS Error';
                        console.error('GPS tracking error:', error);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 5000
                    }
                );
            },

            stopGPSTracking() {
                if (this.gpsWatchId) {
                    navigator.geolocation.clearWatch(this.gpsWatchId);
                    this.gpsWatchId = null;
                }
            },

            startTimeCounter() {
                this.trackingInterval = setInterval(() => {
                    if (this.startTime) {
                        this.syncAllDisplays();
                    }
                }, 1000);
            },

            updateHoleProgression() {
                // Simulate hole progression (in real implementation, use GPS coordinates)
                // For demo, auto-advance every 12 minutes
                const elapsed = Math.floor((new Date() - this.startTime) / 1000);
                const estimatedHole = Math.min(Math.floor(elapsed / 720) + 1, 18); // 12 min per hole

                if (estimatedHole !== this.currentHole && estimatedHole <= 18) {
                    this.currentHole = estimatedHole;

                    // Update main dashboard
                    const mainHoleElement = document.getElementById('currentHoleTracking');
                    if (mainHoleElement) {
                        mainHoleElement.textContent = this.currentHole;
                    }

                    // Update Live Tracking tab
                    const liveHoleElement = document.getElementById('caddieCurrentHole');
                    if (liveHoleElement) {
                        liveHoleElement.textContent = this.currentHole;
                    }

                    if (this.currentHole <= 18) {
                        NotificationManager.show(`‚õ≥ Reached Hole ${this.currentHole}`, 'info');
                    }
                }
            },

            updateLiveTrackingTab() {
                // Update the tracking status indicator
                const trackingStatus = document.querySelector('#caddie-tracking .bg-white span');
                if (trackingStatus) {
                    trackingStatus.textContent = this.isTracking ? 'Live Tracking Active' : 'Tracking Stopped';
                }

                // Update hole number
                const liveHoleElement = document.getElementById('caddieCurrentHole');
                if (liveHoleElement) {
                    liveHoleElement.textContent = this.currentHole;
                }

                // Update round time
                if (this.startTime) {
                    const elapsed = Math.floor((new Date() - this.startTime) / 1000);
                    const timeDisplay = this.formatTime(elapsed);

                    // Find and update the "Time on Course" element
                    const timeElements = document.querySelectorAll('#caddie-tracking .font-bold.text-blue-900');
                    if (timeElements.length >= 3) {
                        timeElements[2].textContent = timeDisplay; // Third element is "Time on Course"
                    }
                }

                // Update tracking button text
                const trackingButton = document.querySelector('#caddie-tracking button[onclick="startLiveTracking()"]');
                if (trackingButton) {
                    const buttonText = trackingButton.querySelector('span:not(.material-symbols-outlined)');
                    if (buttonText) {
                        buttonText.textContent = this.isTracking ? 'Stop Tracking' : 'Start Tracking';
                    }

                    // Update onclick for stop functionality
                    if (this.isTracking) {
                        trackingButton.setAttribute('onclick', 'finishLiveTracking()');
                        trackingButton.className = 'btn-danger';
                    } else {
                        trackingButton.setAttribute('onclick', 'startLiveTracking()');
                        trackingButton.className = 'btn-secondary';
                    }
                }
            },

            syncAllDisplays() {
                // Update main dashboard time
                if (this.startTime) {
                    const elapsed = Math.floor((new Date() - this.startTime) / 1000);
                    const timeDisplay = this.formatTime(elapsed);

                    const mainTimeElement = document.getElementById('roundTimeTracking');
                    if (mainTimeElement) {
                        mainTimeElement.textContent = timeDisplay;
                    }
                }

                // Update Live Tracking tab
                this.updateLiveTrackingTab();
            },

            formatTime(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                if (hours > 0) {
                    return `${hours}:${minutes.toString().padStart(2, '0')}`;
                }
                return `${minutes}:${(seconds % 60).toString().padStart(2, '0')}`;
            },

            saveCompletedRound(totalTime) {
                const roundData = {
                    id: 'round_' + Date.now(),
                    date: new Date().toISOString().split('T')[0],
                    startTime: this.startTime.toISOString(),
                    endTime: new Date().toISOString(),
                    totalTime: totalTime,
                    holesCompleted: 18,
                    golfer: 'John Mitchell', // In real app, get from current assignment
                    course: 'Pattana Golf Resort & Spa'
                };

                const savedRounds = JSON.parse(localStorage.getItem('caddyCompletedRounds') || '[]');
                savedRounds.unshift(roundData);
                localStorage.setItem('caddyCompletedRounds', JSON.stringify(savedRounds));
            },

            // Initialize on page load
            initialize() {
                // Check if tracking was previously active
                const wasTracking = localStorage.getItem('caddyTrackingActive');
                if (wasTracking === 'true') {
                    const startTimeStr = localStorage.getItem('caddyTrackingStartTime');
                    if (startTimeStr) {
                        this.startTime = new Date(startTimeStr);
                        this.startTracking();
                    }
                }
            }
        };

        // Global functions for UI
        function startLiveTracking() {
            CaddyTrackingSystem.startTracking();
        }

        function finishLiveTracking() {
            CaddyTrackingSystem.finishTracking();
        }

        function resetTracking() {
            CaddyTrackingSystem.resetTracking();
        }

        // Function for Live Tracking tab "Update Location" button
        function updateCaddyLocation() {
            if (!navigator.geolocation) {
                NotificationManager.show('GPS not supported by this device', 'error');
                return;
            }

            NotificationManager.show('üìç Getting precise location...', 'info');

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    // Update location status in Live Tracking tab
                    const accuracy = Math.round(position.coords.accuracy);
                    NotificationManager.show(`üìç Location updated with ¬±${accuracy}m accuracy`, 'success');

                    // Update GPS status display
                    const locationStatus = document.getElementById('locationStatus');
                    if (locationStatus) {
                        locationStatus.textContent = `üìç ${accuracy}m`;
                    }

                    // If tracking is active, also update the main tracking system
                    if (CaddyTrackingSystem.isTracking) {
                        CaddyTrackingSystem.updateHoleProgression();
                    }
                },
                (error) => {
                    const errorMessage = error.code === 1 ? 'Please allow location access' :
                                       error.code === 2 ? 'Location unavailable' : 'Location request timed out';
                    NotificationManager.show(`‚ùå GPS Error: ${errorMessage}`, 'error');

                    const locationStatus = document.getElementById('locationStatus');
                    if (locationStatus) {
                        locationStatus.textContent = '‚ùå GPS Error';
                    }
                },
                {
                    enableHighAccuracy: true,
                    timeout: 15000,
                    maximumAge: 30000
                }
            );
        }

        // Initialize tracking system and sync displays
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                CaddyTrackingSystem.initialize();

                // Add event listener for tab switching to sync displays
                const trackingTabButton = document.querySelector('button[onclick*="tracking"]');
                if (trackingTabButton) {
                    trackingTabButton.addEventListener('click', () => {
                        setTimeout(() => {
                            CaddyTrackingSystem.syncAllDisplays();
                        }, 100);
                    });
                }
            }, 1500);
        });

        // Enhanced Caddy Tracking System with Sync
        const CaddyTrackingSync = {
            currentState: {
                isTracking: false,
                currentHole: 1,
                startTime: null,
                roundTime: '0:00',
                gpsStatus: 'Live'
            },

            startTracking() {
                this.currentState.isTracking = true;
                this.currentState.startTime = new Date();
                this.currentState.currentHole = 1;
                this.syncAllDisplays();
                this.startRoundTimer();

                // Save state
                localStorage.setItem('caddy_tracking_state', JSON.stringify(this.currentState));

                NotificationManager.show('üèåÔ∏è Round tracking started!', 'success');
            },

            finishTracking() {
                this.currentState.isTracking = false;
                this.currentState.startTime = null;
                this.syncAllDisplays();

                // Clear state
                localStorage.removeItem('caddy_tracking_state');

                NotificationManager.show('üèÅ Round completed!', 'success');
            },

            updateHole() {
                if (this.currentState.isTracking && this.currentState.currentHole < 18) {
                    this.currentState.currentHole++;
                    this.syncAllDisplays();
                    localStorage.setItem('caddy_tracking_state', JSON.stringify(this.currentState));
                }
            },

            syncAllDisplays() {
                // Sync Overview tab displays
                this.syncOverviewDisplay();
                // Sync Live Tracking tab displays
                this.syncLiveTrackingDisplay();
            },

            syncOverviewDisplay() {
                const trackingNotStarted = document.getElementById('trackingNotStarted');
                const trackingActive = document.getElementById('trackingActive');
                const trackingCompleted = document.getElementById('trackingCompleted');

                if (this.currentState.isTracking) {
                    if (trackingNotStarted) trackingNotStarted.style.display = 'none';
                    if (trackingActive) trackingActive.style.display = 'block';
                    if (trackingCompleted) trackingCompleted.style.display = 'none';

                    // Update Overview tracking data
                    const currentHoleElement = document.getElementById('currentHoleTracking');
                    const roundTimeElement = document.getElementById('roundTimeTracking');
                    const locationStatusElement = document.getElementById('locationStatus');

                    if (currentHoleElement) currentHoleElement.textContent = this.currentState.currentHole;
                    if (roundTimeElement) roundTimeElement.textContent = this.currentState.roundTime;
                    if (locationStatusElement) locationStatusElement.textContent = 'üìç ' + this.currentState.gpsStatus;
                } else {
                    if (trackingNotStarted) trackingNotStarted.style.display = 'block';
                    if (trackingActive) trackingActive.style.display = 'none';
                    if (trackingCompleted) trackingCompleted.style.display = 'none';
                }
            },

            syncLiveTrackingDisplay() {
                // This would sync with the Live Tracking tab
                // Update any tracking displays in the Live Tracking tab
                if (typeof CaddyTrackingSystem !== 'undefined') {
                    CaddyTrackingSystem.syncAllDisplays();
                }
            },

            startRoundTimer() {
                if (!this.currentState.isTracking) return;

                setInterval(() => {
                    if (this.currentState.isTracking && this.currentState.startTime) {
                        const elapsed = new Date() - this.currentState.startTime;
                        const hours = Math.floor(elapsed / (1000 * 60 * 60));
                        const minutes = Math.floor((elapsed % (1000 * 60 * 60)) / (1000 * 60));
                        this.currentState.roundTime = `${hours}:${minutes.toString().padStart(2, '0')}`;

                        // Update displays
                        const roundTimeElement = document.getElementById('roundTimeTracking');
                        if (roundTimeElement) roundTimeElement.textContent = this.currentState.roundTime;
                    }
                }, 60000); // Update every minute
            },

            loadState() {
                const saved = localStorage.getItem('caddy_tracking_state');
                if (saved) {
                    this.currentState = { ...this.currentState, ...JSON.parse(saved) };
                    if (this.currentState.startTime) {
                        this.currentState.startTime = new Date(this.currentState.startTime);
                    }
                    this.syncAllDisplays();
                    if (this.currentState.isTracking) {
                        this.startRoundTimer();
                    }
                }
            }
        };

        // Global tracking functions
        function startLiveTracking() {
            CaddyTrackingSync.startTracking();
        }

        function finishLiveTracking() {
            CaddyTrackingSync.finishTracking();
        }

        function updateCurrentHole() {
            CaddyTrackingSync.updateHole();
        }

        // Caddy Earnings Management System
        const CaddyEarningsSystem = {
            earnings: JSON.parse(localStorage.getItem('caddy_earnings') || '[]'),

            toggleForm() {
                const form = document.getElementById('earningsForm');
                if (form.classList.contains('hidden')) {
                    form.classList.remove('hidden');
                    // Set today's date as default
                    const today = new Date().toISOString().split('T')[0];
                    document.getElementById('earningsDate').value = today;
                    // Set current time as default
                    const now = new Date();
                    const timeString = now.getHours().toString().padStart(2, '0') + ':' +
                                     now.getMinutes().toString().padStart(2, '0');
                    document.getElementById('earningsTime').value = timeString;
                } else {
                    form.classList.add('hidden');
                }
            },

            submitEarnings(event) {
                event.preventDefault();

                const clientName = document.getElementById('clientName').value;
                const serviceType = document.getElementById('serviceType').value;
                const baseFee = parseFloat(document.getElementById('baseFee').value) || 0;
                const tipAmount = parseFloat(document.getElementById('tipAmount').value) || 0;
                const date = document.getElementById('earningsDate').value;
                const time = document.getElementById('earningsTime').value;
                const notes = document.getElementById('earningsNotes').value;

                const newEarning = {
                    id: Date.now(),
                    clientName,
                    serviceType,
                    baseFee,
                    tipAmount,
                    totalAmount: baseFee + tipAmount,
                    date,
                    time,
                    notes,
                    timestamp: new Date()
                };

                this.earnings.unshift(newEarning);
                this.saveEarnings();
                this.refreshEarningsDisplay();
                this.toggleForm();

                // Reset form
                event.target.reset();

                NotificationManager.show(`üí∞ Earnings of ‡∏ø${newEarning.totalAmount} added successfully!`, 'success');
            },

            saveEarnings() {
                localStorage.setItem('caddy_earnings', JSON.stringify(this.earnings));
            },

            refreshEarningsDisplay() {
                // This would update the earnings history display
                // For now, just refresh stats in the hero section
                this.updateHeroStats();
            },

            updateHeroStats() {
                // Calculate total earnings for current month
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();

                const monthlyEarnings = this.earnings.filter(earning => {
                    const earningDate = new Date(earning.date);
                    return earningDate.getMonth() === currentMonth &&
                           earningDate.getFullYear() === currentYear;
                }).reduce((total, earning) => total + earning.totalAmount, 0);

                // Update the hero section stats
                const monthlyEarningsDisplay = document.querySelector('.premium-gradient .text-sm.md\\:text-lg.font-bold');
                if (monthlyEarningsDisplay && monthlyEarningsDisplay.textContent.includes('‡∏ø')) {
                    monthlyEarningsDisplay.textContent = `‡∏ø${monthlyEarnings.toLocaleString()}`;
                }
            }
        };

        // Global functions for earnings
        function toggleEarningsForm() {
            CaddyEarningsSystem.toggleForm();
        }

        function submitEarnings(event) {
            CaddyEarningsSystem.submitEarnings(event);
        }

        // Initialize systems on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                CaddyEarningsSystem.updateHeroStats();
                CaddyTrackingSync.loadState();
            }, 1000);
        });
    </script>

</body>
</html>