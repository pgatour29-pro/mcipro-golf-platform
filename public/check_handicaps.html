<!DOCTYPE html>
<html>
<head>
    <title>CHECK HANDICAPS</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>CHECK CURRENT HANDICAPS</h1>
    <button id="checkBtn" style="padding:20px 40px;font-size:20px;background:blue;color:white;cursor:pointer;border:none;">CHECK ALL</button>
    <pre id="output" style="background:#eee;padding:20px;margin-top:20px;font-size:14px;"></pre>
    <script>
        const db = window.supabase.createClient(
            'https://pyeeplwsnupmhgbguwqs.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB5ZWVwbHdzbnVwbWhnYmd1d3FzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk4NDM2NjksImV4cCI6MjA3NTQxOTY2OX0.KVQ6WvDKz9s77lxn3AhSA_YTMCN6rsht9kDkMIDhngk'
        );
        const TRGG = '7c0e4b72-d925-44bc-afda-38259a7ba346';
        const out = document.getElementById('output');

        function log(msg) {
            out.textContent += msg + '\n';
            console.log(msg);
        }

        document.getElementById('checkBtn').onclick = async () => {
            out.textContent = '';
            log('=== CHECKING ALL PLAYER HANDICAPS ===\n');

            const players = ['rocky', 'ryan', 'pluto', 'jesse stoneberg'];

            for (const name of players) {
                log('--- ' + name.toUpperCase() + ' ---');

                const {data: profiles} = await db.from('user_profiles')
                    .select('line_user_id, name, handicap_index, profile_data')
                    .ilike('name', '%' + name + '%')
                    .limit(1);

                if (!profiles || !profiles[0]) {
                    log('NOT FOUND\n');
                    continue;
                }

                const p = profiles[0];
                log('Name: ' + p.name);
                log('ID: ' + p.line_user_id);
                log('user_profiles.handicap_index: ' + p.handicap_index);
                log('profile_data.handicap: ' + p.profile_data?.handicap);
                log('profile_data.golfInfo.handicap: ' + p.profile_data?.golfInfo?.handicap);

                // Check society_handicaps
                const {data: hcps} = await db.from('society_handicaps')
                    .select('*')
                    .eq('golfer_id', p.line_user_id);

                if (hcps && hcps.length > 0) {
                    hcps.forEach(h => {
                        const label = h.society_id === null ? 'UNIVERSAL' : 'TRAVELLERS';
                        log('society_handicaps.' + label + ': ' + h.handicap_index);
                    });
                } else {
                    log('society_handicaps: NONE');
                }

                log('');
            }

            log('=== DONE ===');
        };
    </script>
</body>
</html>
