<!DOCTYPE html>
<html>
<head>
    <title>MciPro Sync Test</title>
</head>
<body>
    <h1>MciPro Cross-Device Sync Test</h1>
    <div id="results"></div>

    <script>
        async function testSync() {
            const results = document.getElementById('results');

            // Test 7: Local mapping
            console.log('=== Test 7: Local mapping ===');
            const localSchedule = JSON.parse(localStorage.getItem('mcipro_schedule') || '[]');

            try {
                const response = await fetch('/.netlify/functions/bookings', {
                    headers: {
                        'Authorization': 'Bearer mcipro-site-key-2024',
                        'Content-Type': 'application/json'
                    }
                });
                const serverData = await response.json();

                results.innerHTML += `
                    <h2>Test 7: Local Mapping âœ…</h2>
                    <p>Local schedule length: ${localSchedule.length}</p>
                    <p>Server schedule_items length: ${serverData.schedule_items?.length || 0}</p>
                    <p>Match: ${localSchedule.length === (serverData.schedule_items?.length || 0) ? 'YES' : 'NO'}</p>

                    <h2>Full Server Response:</h2>
                    <pre>${JSON.stringify(serverData, null, 2)}</pre>

                    <h2>Local Storage:</h2>
                    <p>Bookings: ${JSON.parse(localStorage.getItem('mcipro_bookings') || '[]').length}</p>
                    <p>Profiles: ${JSON.parse(localStorage.getItem('mcipro_user_profiles') || '[]').length}</p>
                    <p>Schedule: ${localSchedule.length}</p>
                    <p>Alerts: ${JSON.parse(localStorage.getItem('emergency_alerts') || '[]').length}</p>
                `;

            } catch (error) {
                results.innerHTML += `<p>Error: ${error.message}</p>`;
            }
        }

        // Run test when page loads
        window.addEventListener('load', testSync);
    </script>
</body>
</html>